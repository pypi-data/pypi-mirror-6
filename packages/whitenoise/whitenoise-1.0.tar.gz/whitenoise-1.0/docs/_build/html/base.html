

<!DOCTYPE html>
<!--[if IE 8]><html class="no-js lt-ie9" lang="en" > <![endif]-->
<!--[if gt IE 8]><!--> <html class="no-js" lang="en" > <!--<![endif]-->
<head>
  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  
  <title>Using WhiteNoise with a WSGI application &mdash; WhiteNoise 0.13 documentation</title>
  

  
  

  
  <link href='https://fonts.googleapis.com/css?family=Lato:400,700|Roboto+Slab:400,700|Inconsolata:400,700' rel='stylesheet' type='text/css'>

  
  

    <script type="text/javascript">
      var DOCUMENTATION_OPTIONS = {
        URL_ROOT:'./',
        VERSION:'0.13',
        COLLAPSE_INDEX:false,
        FILE_SUFFIX:'.html',
        HAS_SOURCE:  true
      };
    </script>
      <script type="text/javascript" src="_static/jquery.js"></script>
      <script type="text/javascript" src="_static/underscore.js"></script>
      <script type="text/javascript" src="_static/doctools.js"></script>

    

  

  
  
    <link rel="stylesheet" href="_static/css/theme.css" type="text/css" />
    <script type="text/javascript" src="_static/js/theme.js"></script>
  

  
    <link rel="top" title="WhiteNoise 0.13 documentation" href="index.html"/> 

  <script src="//cdnjs.cloudflare.com/ajax/libs/modernizr/2.6.2/modernizr.min.js"></script>

</head>

<body class="wy-body-for-nav">

  <div class="wy-grid-for-nav">

    
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-nav-search">
        <a href="index.html" class="icon icon-home"> WhiteNoise</a>
        <form class="wy-form" action="search.html" method="get">
  <input type="text" name="q" placeholder="Search docs" />
  <input type="hidden" name="check_keywords" value="yes" />
  <input type="hidden" name="area" value="default" />
</form>
      </div>

      <div class="wy-menu wy-menu-vertical" data-spy="affix">
        
        
            <ul>
<li class="toctree-l1"><a class="reference internal" href="index.html">WhiteNoise</a></li>
</ul>

        
      </div>
      &nbsp;
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap">

      
      <nav class="wy-nav-top">
        <i data-toggle="wy-nav-top" class="icon icon-reorder"></i>
        <a href="/">WhiteNoise</a>
      </nav>


      
      <div class="wy-nav-content">
        <div class="rst-content">
          <ul class="wy-breadcrumbs">
  <li><a href="index.html">Docs</a> &raquo;</li>
  <li><a href="">Using WhiteNoise with a WSGI application</a></li>
  
</ul>
<hr/>

          
  <div class="section" id="using-whitenoise-with-a-wsgi-application">
<h1>Using WhiteNoise with a WSGI application<a class="headerlink" href="#using-whitenoise-with-a-wsgi-application" title="Permalink to this headline">¶</a></h1>
<div class="admonition note">
<p class="first admonition-title">Note</p>
<p class="last">These instructions apply to any WSGI application. However, for Django
applications you would be better off using the <a class="reference internal" href="django.html"><em>DjangoWhiteNoise</em></a>
class which makes integration easier.</p>
</div>
<p>To enable WhiteNoise you need to wrap your existing WSGI application in a
WhiteNoise instance and tell it where to find your static files. For example:</p>
<div class="highlight-python"><div class="highlight"><pre><span class="kn">from</span> <span class="nn">whitenoise</span> <span class="kn">import</span> <span class="n">WhiteNoise</span>

<span class="kn">from</span> <span class="nn">my_project</span> <span class="kn">import</span> <span class="n">MyWSGIApp</span>

<span class="n">application</span> <span class="o">=</span> <span class="n">MyWSGIApp</span><span class="p">()</span>
<span class="n">application</span> <span class="o">=</span> <span class="n">WhiteNoise</span><span class="p">(</span><span class="n">application</span><span class="p">,</span> <span class="n">root</span><span class="o">=</span><span class="s">&#39;/path/to/static/files&#39;</span><span class="p">)</span>
<span class="n">application</span><span class="o">.</span><span class="n">add_files</span><span class="p">(</span><span class="s">&#39;/path/to/more/static/files&#39;</span><span class="p">,</span> <span class="n">prefix</span><span class="o">=</span><span class="s">&#39;more-files/&#39;</span><span class="p">)</span>
</pre></div>
</div>
<p>On initialization, WhiteNoise walks over all the files in the directories that have
been added (descending into sub-directories) and builds a list of available static files.
Any requests which match a static file get served by WhiteNoise, all others are passed
through to the original WSGI application.</p>
<p>See the sections on <a class="reference internal" href="#gzip"><em>gzip handling</em></a> and <a class="reference internal" href="#caching"><em>caching</em></a>
for further details.</p>
<div class="section" id="whitenoise-api">
<h2>WhiteNoise API<a class="headerlink" href="#whitenoise-api" title="Permalink to this headline">¶</a></h2>
<dl class="class">
<dt id="WhiteNoise">
<em class="property">class </em><tt class="descname">WhiteNoise</tt><big>(</big><em>application</em>, <em>root=None</em>, <em>prefix=None</em>, <em>**kwargs</em><big>)</big><a class="headerlink" href="#WhiteNoise" title="Permalink to this definition">¶</a></dt>
<dd><table class="docutils field-list" frame="void" rules="none">
<col class="field-name" />
<col class="field-body" />
<tbody valign="top">
<tr class="field-odd field"><th class="field-name">Parameters:</th><td class="field-body"><ul class="first last simple">
<li><strong>application</strong> (<em>callable</em>) &#8211; Original WSGI application</li>
<li><strong>root</strong> (<em>str</em>) &#8211; If set, passed to <tt class="docutils literal"><span class="pre">add_files</span></tt> method</li>
<li><strong>prefix</strong> (<em>str</em>) &#8211; If set, passed to <tt class="docutils literal"><span class="pre">add_files</span></tt> method</li>
<li><strong>**kwargs</strong> &#8211; Sets <a class="reference internal" href="#configuration"><em>configuration attributes</em></a> for this instance</li>
</ul>
</td>
</tr>
</tbody>
</table>
</dd></dl>

<dl class="method">
<dt id="add_files">
<tt class="descname">add_files</tt><big>(</big><em>root</em>, <em>prefix=None</em>, <em>followlinks=False</em><big>)</big><a class="headerlink" href="#add_files" title="Permalink to this definition">¶</a></dt>
<dd><table class="docutils field-list" frame="void" rules="none">
<col class="field-name" />
<col class="field-body" />
<tbody valign="top">
<tr class="field-odd field"><th class="field-name">Parameters:</th><td class="field-body"><ul class="first last simple">
<li><strong>root</strong> (<em>str</em>) &#8211; Absolute path to a directory of static files to be served</li>
<li><strong>prefix</strong> (<em>str</em>) &#8211; If set, the URL prefix under which the files will be served. Trailing slashes
are automatically added.</li>
<li><strong>followlinks</strong> (<em>bool</em>) &#8211; Whether to follow directory symlinks when walking the directory tree to find files. Note that
symlinks to files will always work.</li>
</ul>
</td>
</tr>
</tbody>
</table>
</dd></dl>

</div>
<div class="section" id="gzip-support">
<span id="gzip"></span><h2>Gzip Support<a class="headerlink" href="#gzip-support" title="Permalink to this headline">¶</a></h2>
<p>When WhiteNoise builds its list of available files it checks for a
corresponding file with a <tt class="docutils literal"><span class="pre">.gz</span></tt> suffix (e.g., <tt class="docutils literal"><span class="pre">scripts/app.js</span></tt> and
<tt class="docutils literal"><span class="pre">scripts/app.js.gz</span></tt>). If it finds one, it will assume that this is a
gzip-compressed version of the original file and it will serve this in
preference to the uncompressed version where clients indicate that they accept
gzipped content (see note on Amazon S3 for why this behavour is important).</p>
<p>WhiteNoise comes with a command line utility which will generate gzipped versions of your
files for you. Usage is simple:</p>
<div class="highlight-console"><div class="highlight"><pre><span class="gp">$</span> python -m whitenoise.gzip --help

<span class="go">usage: gzip.py [-h] [-q] root [extensions [extensions ...]]</span>

<span class="go">Search for all files inside &lt;root&gt; *not* matching &lt;extensions&gt; and produce</span>
<span class="go">gzipped versions with a &#39;.gz&#39; suffix (as long this results in a smaller file)</span>

<span class="go">positional arguments:</span>
<span class="go">  root         Path root from which to search for files</span>
<span class="go">  extensions   File extensions to exclude from gzipping (default: jpg, jpeg,</span>
<span class="go">               png, gif, zip, gz, tgz, bz2, tbz, swf, flv)</span>

<span class="go">optional arguments:</span>
<span class="go">  -h, --help   show this help message and exit</span>
<span class="go">  -q, --quiet  Don&#39;t produce log output (default: False)</span>
</pre></div>
</div>
<p>You can either run this during development and commit your compressed files to
your repository, or you can run this as part of your build and deploy processs.
(Note that DjangoWhiteNoise handles this automatically, if you&#8217;re using the
custom storage backend.)</p>
</div>
<div class="section" id="caching-headers">
<span id="caching"></span><h2>Caching Headers<a class="headerlink" href="#caching-headers" title="Permalink to this headline">¶</a></h2>
<p>By default, WhiteNoise sets a max-age header on all responses it sends. You can
configure this by passing a <tt class="docutils literal"><span class="pre">max_age</span></tt> keyword argument.</p>
<p>Most modern static asset build systems create uniquely named versions of each file. This
results in files which are immutable (i.e., they can never change their contents) and
can therefore by cached indefinitely  In order to take advantage of this, WhiteNoise needs
to know which files are immutable. This can be done by sub-classing WhiteNoise and
overriding the following method:</p>
<div class="highlight-python"><div class="highlight"><pre><span class="k">def</span> <span class="nf">is_immutable_file</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">static_file</span><span class="p">,</span> <span class="n">url</span><span class="p">):</span>
   <span class="k">return</span> <span class="bp">False</span>
</pre></div>
</div>
<p>The exact details of how you implement this method will depend on your particular asset
build system (see the source for DjangoWhiteNoise for inspiration).</p>
<p>Once you have implemented this, any files which are flagged as immutable will have &#8216;cache
forever&#8217; headers set.</p>
</div>
<div class="section" id="using-a-content-distribution-network">
<h2>Using a Content Distribution Network<a class="headerlink" href="#using-a-content-distribution-network" title="Permalink to this headline">¶</a></h2>
<p>See the instructions for <a class="reference internal" href="django.html#cdn"><em>using a CDN with Django</em></a> . The same principles
apply here although obviously the exact method for generating the URLs for your static
files will depend on the libraries you&#8217;re using.</p>
</div>
<div class="section" id="configuration-attributes">
<span id="configuration"></span><h2>Configuration attributes<a class="headerlink" href="#configuration-attributes" title="Permalink to this headline">¶</a></h2>
<p>These can be set by passing keyword arguments to the constructor, or by
sub-classing WhiteNoise and setting the attributes directly.</p>
<dl class="attribute">
<dt id="max_age">
<tt class="descname">max_age</tt><a class="headerlink" href="#max_age" title="Permalink to this definition">¶</a></dt>
<dd><table class="docutils field-list" frame="void" rules="none">
<col class="field-name" />
<col class="field-body" />
<tbody valign="top">
<tr class="field-odd field"><th class="field-name">Default:</th><td class="field-body"><tt class="docutils literal"><span class="pre">60</span></tt></td>
</tr>
</tbody>
</table>
<p>Time (in seconds) for which browsers and proxies should cache files.</p>
<p>The default is chosen to be short enough not to cause problems with stale versions but
long enough that, if you&#8217;re running WhiteNoise behind a CND, the CDN will still take
the majority of the strain during times of heavy load.</p>
</dd></dl>

<dl class="attribute">
<dt id="charset">
<tt class="descname">charset</tt><a class="headerlink" href="#charset" title="Permalink to this definition">¶</a></dt>
<dd><table class="docutils field-list" frame="void" rules="none">
<col class="field-name" />
<col class="field-body" />
<tbody valign="top">
<tr class="field-odd field"><th class="field-name">Default:</th><td class="field-body"><tt class="docutils literal"><span class="pre">utf-8</span></tt></td>
</tr>
</tbody>
</table>
<p>Charset to add as part of the <tt class="docutils literal"><span class="pre">Content-Type</span></tt> header for all files whose
mimetype allows a charset.</p>
</dd></dl>

<dl class="attribute">
<dt id="allow_all_origins">
<tt class="descname">allow_all_origins</tt><a class="headerlink" href="#allow_all_origins" title="Permalink to this definition">¶</a></dt>
<dd><table class="docutils field-list" frame="void" rules="none">
<col class="field-name" />
<col class="field-body" />
<tbody valign="top">
<tr class="field-odd field"><th class="field-name">Default:</th><td class="field-body"><tt class="docutils literal"><span class="pre">True</span></tt></td>
</tr>
</tbody>
</table>
<p>Toggles whether to send an <tt class="docutils literal"><span class="pre">Access-Control-Allow-Origin:</span> <span class="pre">*</span></tt> header for all
static files.</p>
<p>This allows cross-origin requests for static files which means your static files
will continue to work as expected even if they are served via a CDN and therefore
on a different domain. Without this your static files will <em>mostly</em> work, but you
may have problems with fonts loading in Firefox, or accessing images in canvas
elements, or other mysterious things.</p>
<p>The W3C <a class="reference external" href="http://www.w3.org/TR/cors/#security">explicity state</a> that this behaviour is safe for publicly
accessible files.</p>
</dd></dl>

</div>
</div>


          <footer>
  

  <hr/>

  <p>
      &copy; Copyright 2013, David Evans.
  </p>

  <a href="https://www.github.com/snide/sphinx_rtd_theme">Sphinx theme</a> provided by <a href="http://readthedocs.org">Read the Docs</a>
</footer>
        </div>
      </div>

    </section>

  </div>
  

</body>
</html>