<html tal:replace="structure context/manage_page_header"
      tal:define="global items context/orderItemValues;
                  global account context/blAccount;
                  global sales_tax python: here.isReceivable() and 'sales_tax_due' or 'sales_tax_paid'"/>

    <span tal:replace="structure python:context.manage_tabs(help_topic='orders.stx',
                                                              help_product='BastionLedger')"/>

       <table border="0" width="100%" cellspacing="0" cellpadding="0"
              tal:define="products context/filtered_meta_types">
          <tr>
              <td align="left" valign="top" class="form-element"
                  tal:define="actions context/actions">
                 <table>
                    <tr>
                       <td class="form-label">Status</td>
                       <td class="form-element" tal:content="context/status"/>
		       <td class="form-element">
                          <form action="manage_statusModify" method="get" tal:condition="actions">
                             <select name="workflow_action">
                                <option tal:repeat="action actions"
                                        tal:attributes="value action/transition/id"
                                        tal:content="action/title"/>
                             </select>
                             <input type="submit" value=" Change "/>
                          </form>
                       </td>
                    </tr>
                    <tr tal:define="txn context/blTransaction" tal:condition="python: txn">
                       <td class="form-label">Transaction</td>
                       <td class="form-element">
                           <a href="" tal:attributes="href string:${txn/absolute_url}/manage_workspace"
                              tal:content="txn/getId"/>
                       </td>
                       <td class="form-element">(<span tal:replace="txn/status"/>)</td>
                    </tr>
                 </table>
              </td>
              <td align="right" valign="top" class="form-element">
                 <form method="get" action="" tal:attributes="action request/URL1">
                     <div tal:condition="python: len(products) > 1">
                         <select class="form-element" name=":action"
                                 onchange="" tal:attributes="onchange string:location.href='${request/URL1}/'+this.options[this.selectedIndex].value">
                             <option value="manage_workspace" disabled>Select type to add...</option>
                             <option tal:repeat="product products"
                                     value="" tal:attributes="value product/action"
                                     tal:content="product/name"/>
                          </select>
                          <input class="form-element" type="submit" value=" Add ">
                      </div>
                      <div tal:condition="python: len(products) == 1">
                         <span tal:define="product python:products[0]">
                            <input type="hidden" name=":method" value="" tal:attributes="value product/action"/>
                            <input class="form-element" type="submit" name="submit" value=""
                                 tal:attributes="value string: Add ${product/name}" />
                            </span>
                      </div>
                 </form>
              </td>
          </tr>
       </table>
       <br/>
       <form action="" method="post" tal:attributes="action request/URL1">
       <table border="0" cellspacing="0" cellpadding="2">
           <tr>
               <td class="form-label">Title</td>
               <td class="form-element" colspan="3">
                    <input type="text" name="title" size="50" value=""
                           tal:attributes="value context/title | nothing"/>
               </td>
               <td class="form-element" colspan="2" align="right" valign="top">
                    <div tal:repeat="attachment  context/attachmentValues">
                       <img src="trombone.gif">
                       <a href="" tal:attributes="href string:attachments/${attachment/getId}"
                          tal:content="attachment/getId"/>
                    </div>
               </td>
           </tr>
           <tr>
               <td class="form-label">Account</td>
               <td class="form-element"><a href="" 
                      tal:attributes="href python:'%s/%s/manage_workspace' % (request['URL2'], 
                                                                              account.getId())"
                      tal:content="account/prettyTitle"/>
               </td>
               <tal:block tal:condition="context/ref | nothing">
                    <td class="form-label" align="right">Reference</td>
                    <td class="form-element"><a href="" tal:attributes="href context/ref"
                                   tal:content="context/ref"/>
                    </td>
               </tal:block>
           </tr>
           <tr>
               <td class="form-label">Contact</td>
               <td class="form-element">
                    <input type="text" name="contact" size="25" value=""
                           tal:attributes="value context/contact | nothing"/>
               </td>
               <td class="form-label" valign="top" rowspan="2">Shipping Addr</td>
               <td class="form-element" rowspan="2">
                    <textarea name="shiptoaddress:text" rows="4" cols="30" 
                              tal:content="context/shiptoaddress"/>
               </td>
      
           </tr>
           <tr>
               <td class="form-label">Email</td>
               <td class="form-element">
                    <input type="text" name="email" size="25" value=""
                           tal:attributes="value context/email | nothing"/>
               </td>
           </tr>
           <tr><td>&nbsp;</td></tr>
           <tr tal:define="invoice_date context/invoiceDate" tal:condition="invoice_date">
               <td class="form-label">Invoice Date</td>
               <td class="form-element" tal:content="python: invoice_date.strftime('%Y/%m/%d')"/>
           </tr>
           <tr>
               <td class="form-label">Order Date</td>
               <td class="form-element">
                  <input type="text" name="orderdate:date" size="16" value=""
                         tal:attributes="value python: context.orderdate.strftime('%Y/%m/%d')"/>
               </td>
               <td class="form-label">Reqd. Date</td>
               <td class="form-element">
                  <input type="text" name="reqdate:date" size="16" value=""
                         tal:attributes="value python: context.reqdate.strftime('%Y/%m/%d')"/>
               </td>
           </tr>
           <tr>
               <td class="form-label">Tax Exempt</td>
               <td class="form-element">
                  <input type="checkbox" name="taxincluded:boolean" value="1" checked
                         tal:condition="context/taxincluded"/>
                  <input type="checkbox" name="taxincluded" value="1" 
                         tal:condition="not: context/taxincluded"/>
               </td>
               <td class="form-label">Discount (%)</td>
               <td class="form-element">
                  <input name="discount" size="5" value=""
                         tal:attributes="value python: context.discount * 100"/>
               </td>
           </tr>
           <tr>
               <td class="form-label" valign="top">Notes</td>
               <td class="form-element" colspan="3">
                  <textarea name="notes:text" rows="3" cols="50" tal:content="request/notes | context/notes"/>
               </td>
           </tr>
           <tr tal:condition="not: items">
               <td class="form-element">
                    <input class="form-element" type="submit" name="manage_edit:method" value="  Edit  ">
               </td>
           </tr>
       </table>
       <br/>
       <table border="0" cellpadding="2" cellspacing="0" width="100%"
	      tal:define="freight context/blorder_freight;
                          modifiable context/modifiable"
              tal:condition="items">
           <tr class="list-header">
               <td width="16">&nbsp;</td>
               <td width="25"  class="list-item">Type</td>
               <td class="list-item">Description</td>
               <td class="list-item">Last Modified</td>
               <td class="list-item" align="right">Quantity</td>
               <td class="list-item" align="right">Unit Price</td>
               <td class="list-item" align="right">Amount</td>
               <td width="5">&nbsp;</td>
           </tr>
           <tr tal:repeat="item items">
               <td class="list-item" valign="top">
                  <input type="checkbox" name="ids:list" value="" tal:attributes="value item/getId">
                  <input type="hidden" name="items.id:records" value="" tal:attributes="value item/getId" 
                         tal:condition="modifiable">
               </td>
               <td class="list-item" valign="top">
                  <a href="" tal:attributes="href string:${item/getId}/manage_workspace">
                     <img border="0" src="" tal:attributes="src item/icon"/></a></td>
               <td class="list-item" valign="top" tal:define="part python: item.blPart()">
                  <a href="" tal:condition="nocall: part"
                             tal:attributes="href string:${part/absolute_url}/manage_workspace"  
                             tal:content="item/title"/>
                  <span tal:condition="python: part is None" tal:content="item/title"/>
                  <div tal:condition="item/note" style="font-size: 8pt" tal:content="item/note"/>
               </td>
               <td class="list-item" valign="top" nowrap tal:content="item/modificationTime"/>
               <td class="list-item" valign="top" align="right">
                  <input type="text" name="items.qty:records:float" size="5" value="" align="right"
                         tal:attributes="value item/quantity"
                         tal:condition="modifiable"/>
                  <span tal:condition="not: context/modifiable" tal:replace="item/quantity"/>
               </td>
               <td class="list-item" valign="top" align="right" nowrap>
                  <span tal:condition="item/amount" tal:content="item/unit"/>
                  <input type="text" name="items.unit:records" size="12" value="" align="right"
                         tal:condition="not: item/amount"
                         tal:attributes="value item/unit"/>
               </td>
               <td class="list-item" valign="top" align="right" norwap 
                   tal:content="item/calculateGrossPrice"/>
               <td>&nbsp;</td>
           </tr>
           <tr>
               <td colspan="5" class="form-element">
                    <input tal:condition="items" class="form-element"
                           type="submit" name="manage_delObjects:method" value=" Delete ">
                    <input class="form-element"
                           type="submit" name="manage_edit:method" value="  Edit  ">
                    &nbsp;&nbsp;
                    <tal:block  tal:condition="not: modifiable">
                        <input type="text" name="notify_email" size="25" value=""
                               tal:attributes="value context/email | context/aq_parent/email | nothing;"/>
                        <input type="submit" name="manage_emailInvoice:method" value=" Email ">
                    </tal:block>
               </td>
               <td bgcolor="silver" class="form-label" align="right">Total</td>
               <td bgcolor="silver" class="form-label" align="right" tal:content="context/getGross"/>
               <td bgcolor="silver" class="form-label">&nbsp;</td>
           </tr>
           <tr class="form-element" tal:condition="context/discount">
              <td colspan="6" class="form-element" align="right">less Discount</td>
              <td class="form-element" align="right"
                  tal:content="python: context.getGross() * context.discount"/>
           </tr>
           <tr class="form-element" tal:condition="not: context/taxincluded"
               tal:repeat="acct python: context.Ledger.accountValues(tags=sales_tax)" >
              <td colspan="6" class="form-element" align="right">plus <em tal:content="acct/title"/></td>
              <td class="form-element" align="right" nowrap
                  tal:content="python: context.calculateTax(acct)"/>
              <td/>
           </tr>
           <tr class="form-element" tal:condition="python: freight > 0">
              <td colspan="6" class="form-element" align="right"><i>plus freight</i></td>
              <td class="form-element" align="right" nowrap
                  tal:content="freight"/>
              <td/>
           </tr>
           <tr tal:condition="python: freight or context.discount or not context.taxincluded">
              <td colspan="5">&nbsp;</td>
              <td bgcolor="silver" class="form-label" align="right"><b>Net</b></td>
              <td bgcolor="silver" class="form-label" align="right" nowrap><b tal:content="context/getNet"/></td>
              <td bgcolor="silver" class="form-label">&nbsp;</td>
           </tr>
       </table>
       </form>


<html tal:replace="structure context/manage_page_footer"/>
