<html xmlns:tal="http://xml.zope.org/namespaces/tal"
      xmlns:metal="http://xml.zope.org/namespaces/metal"
      metal:use-macro="context/main_template/macros/master"
      i18n:domain="bastionledger">

  <metal:border fill-slot="top_slot">
    <tal:border define="dummy python:request.set('enable_border',1)" />
  </metal:border>
 
<body>
  <div metal:fill-slot="main"
       tal:define="date request/date | python: DateTime() - 30;
                   utool context/@@plone_portal_state/portal_url;
                   lockable python:hasattr(here, 'wl_isLocked');
                   isLocked python:lockable and here.wl_isLocked();
                   months request/months | python: 4">

      <h1><img src="" alt="" tal:define="icon python:context.getIcon(1)" 
               tal:attributes="src string:${utool}/${icon}">&nbsp;<span tal:replace="context/Title | context/getId"/></h1>

   <div class="reviewHistory">
      <dl id="viewing" class="collapsible inline collapsedOnLoad">
        <dt class="collapsibleHeader">Query</dt>
        <dd class="collapsibleContent">
        <form name="edit_form" action="" method="post">
          <table summary="" border="0" cellpadding="2" cellspacing="0">
            <tr>
               <td class="field"
                   tal:define="inputvalue python: context.toLocalizedTime(date, long_format=0);
                               formname string:edit_form;
                               show_hm python: False;
                               inputname string:date;">
                   <strong>Start Date</strong>&nbsp;
                   <span metal:use-macro="here/calendar_macros/macros/calendarDatePickerBox"/>
               </td>
               <td class="field">
                   <strong>Months to show</strong>
                   <input type="text" name="months:int" size="2" maxlength="2" value=""
                          tal:attributes="value months"/>
               </td>
               <td>
                   <input type="submit" class="context" value=" Go "/>
               </td>
            </tr>
          </table>
        </form>
         </dd>
       </dl>
   </div>

      <form name="edit_form"  action="."  method="post"
            tal:attributes="action template/getId" >

         <table summary="" border="0" cellpadding="2" cellspacing="0" width="100%"
                tal:define="forecasts python: context.forecasts(date, months);
                            dates python: forecasts[0];
                            recs  python: forecasts[1];
                            totals python: forecasts[2];">
            <tr class="row">
                <td/>
                <td class="field"  
                    tal:define="ldate python: (DateTime(date) - months * 30).strftime('%Y/%m/%d')">
                    <a href="" style="text-decoration: none"
                       tal:attributes="href string:${context/absolute_url}/${template/getId}?date:date=${ldate}&amp;months:int=${months}">&laquo;</a>
                </td>
                <td class="field" tal:repeat="dt dates" colspan="2" align="center">
                    <b tal:content="python: dt.strftime('%b %Y')"/>
                </td>
                <td class="field" 
                    tal:define="rdate python: (DateTime(date) + months * 30).strftime('%Y/%m/%d')">
                    <a href="" style="text-decoration: none"
                       tal:attributes="href string:${context/absolute_url}/${template/getId}?date:date=${rdate}&amp;months:int=${months}">&raquo;</a>
                </td>
            </tr>
            <tr class="row">
                <td/>
                <td/>
                <tal:block tal:repeat="dt dates">
                    <td class="field" align="right"><b>Budgeted</b></td>
                    <td class="field" align="right"><b><i>Actual</i></b></td>
                </tal:block>
                <td/>
            </tr>
            <tr tal:repeat="rec recs" class="" 
                tal:attributes="class python: repeat['rec'].odd() and 'odd' or 'even'">
                <td class="field" nowrap  tal:define="account python:rec[0]">
                     <img src="" tal:define="icon python:account.getIcon(1)" alt="Account"
                          tal:attributes="src string:${utool}/${icon}"/>
                     <a href="" tal:attributes="href account/absolute_url"
                                tal:content="account/Title"/>
                </td>
                <td class="field">&nbsp;</td>
                <tal:block tal:repeat="v python:rec[1:]">
                    <td class="field" tal:condition="repeat/v/odd" align="right" nowrap>
                        <i tal:content="v"/>
                    </td>
                    <td class="field" tal:condition="repeat/v/even" align="right">
                        <input type="text" size="12" name="recs.amount:records" value="" style="text-align: right;" 
                               tal:attributes="value v"/>
                        <input type="hidden" name="recs.date:date:records" 
                               tal:attributes="value python: dates[repeat['v'].index / 2]"/>
                        <input type="hidden" name="recs.account:records" 
                               tal:attributes="value python: rec[0].getId()"/>
                    </td>
                </tal:block>
                <td class="field">&nbsp;</td>
            </tr>
            <tr class="row">
                <td/>
                <td/>
                <td class="field" tal:repeat="total totals" align="right" nowrap>
                    <b><span tal:condition="repeat/total/even" tal:replace="total"/>
                       <i tal:condition="repeat/total/odd" tal:content="total"/></b>
                </td>
                <td/>
            </tr>
         </table>

          <div class="formControls"
               tal:define="process_creation request/process_creation|nothing;">

            <img src="" class="context"
                   tal:define="portal context/portal_url/getPortalObject; locked portal/lock_icon.png;"
                   tal:condition="isLocked"
                   tal:replace="structure python:locked.tag(title='This item is locked')"
                   alt="Object locked"
                   i18n:attributes="alt"/>

            <input class="context"
                   
                   type="submit"
                   name="form.button.Save"
                   value="Save"
                   i18n:attributes="value"
                   tal:attributes="disabled python:isLocked and 'disabled' or None;" />

          </div>

        <input type="hidden" name="form.submitted" value="1" />

      </form>

  </div>
 
</body>
</html>
