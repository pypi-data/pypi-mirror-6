<div class="form" i18n:domain="ztfy.thesaurus">
	<fieldset tal:define="extracts view/extracts">
		<legend tal:condition="view/legend | nothing" tal:content="view/legend" i18n:translate="" />
		<fieldset class="half extracts" tal:condition="extracts">
			<legend i18n:translate="">Thesaurus extracts</legend>
			<div class="extract" tal:repeat="extract extracts/values">
				<tal:var define="can_manage extract/permission:ztfy.ManageThesaurusExtract">
					<span tal:condition="not:can_manage" class="square readonly"
						  style="border: none; width: 16px; background: transparent url('/--static--/ztfy.thesaurus/img/locked.gif') scroll no-repeat 50% 50%;"
						  title="This extract can't be modified" i18n:attributes="title"></span>
					<span tal:condition="can_manage" class="square" style="border: none; width: 16px;"></span>
					<span class="square showhide" tal:attributes="style string:border: none;; width: 16px;; background: transparent url('/--static--/ztfy.thesaurus/img/visible.gif') scroll no-repeat 50% 50%;;;
																  data-ztfy-extract-name extract/zope:name;
																  data-ztfy-extract-color extract/color;
																  data-ztfy-enabled python:'true' if can_manage else 'false';"
						  title="Show or hide terms of this extract" i18n:attributes="title"></span>
					<span class="square color" tal:attributes="style string:background-color: #${extract/color};"></span>
				</tal:var>
				&nbsp;<a class="label" title="Display extract terms tree" i18n:attributes="title">
					<img src="/--static--/ztfy.thesaurus/img/loupe.gif" tal:attributes="onclick string:$.ZTFY.dialog.open('${extract/@@absolute_url}/@@terms.html');" />
				</a>
				<tal:var content="extract/name" />
				<div class="clearer"></div>
			</div>
		</fieldset><br />
		<div class="pc60 tree"
			 tal:attributes="data-ztfy-base context/@@absolute_url">
			<div class="required-info"></div>
			<tal:loop repeat="node view/tree">
				<div>
					<img src="/--static--/ztfy.thesaurus/img/plus.png" class="plminus" tal:condition="node/hasChildren"
						 onclick="$.ZTFY.thesaurus.tree.expand(this);"/><img
						 src="/--static--/ztfy.thesaurus/img/lline.png" class="plminus" tal:condition="not:node/hasChildren" /><a
						 tal:attributes="class string:label ${node/cssClass}" tal:content="node/label" onclick="$.ZTFY.thesaurus.tree.openTerm(this); return false;" />
					<img class="extension"
						 tal:repeat="ext node/context/queryExtensions"
						 tal:attributes="src ext/icon;
										 title ext/label;
										 onclick string:$.ZTFY.dialog.open('${node/context/@@absolute_url}/${ext/target_view}');;"
						 i18n:attributes="title" />
					<tal:if condition="extracts">
						<tal:loop repeat="extract python:reversed(list(extracts.keys()))">
							<tal:if condition="python:extract in node.context.extracts">
								<span class="used square" tal:attributes="title python:extracts[extract].name;
																		  data-ztfy-extract-name extract;
																		  style python:'background-color: #%s;;' % extracts[extract].color;"></span>
							</tal:if>
							<tal:if condition="python:extract not in node.context.extracts">
								<span class="square" tal:attributes="title python:extracts[extract].name;
																	 data-ztfy-extract-name extract;"
									  style="background-color: white;"></span>
							</tal:if> 
						</tal:loop>
					</tal:if>
					<div class="subnodes"></div>
				</div>
			</tal:loop>
		</div><br />
		<fieldset class="search half">
			<legend i18n:translate="">Terms search engine</legend>
			<div>
				<a class="find button icon icon-search" title="Expand tree to selected term" i18n:attributes="title"
				   onclick="$.ZTFY.thesaurus.tree.findTerm(this);"></a>
				<input type="text" name="query"
						data-ztfy-widget="multiselect"
						data-multiselect-class="directory"
						data-multiselect-separator="|"
						data-multiselect-search-callback="$.ZTFY.thesaurus.findTermsWithLabel"
						data-multiselect-max-results="20"
						data-multiselect-enable-new="false"
						data-multiselect-complex-search="false"
						data-multiselect-max-selection-length="1" />
			</div>
		</fieldset>
	</fieldset>
</div>