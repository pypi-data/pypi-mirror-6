<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html tal:omit-tag=""
  lang="en"
  xml:lang="en"
  xmlns="http://www.w3.org/1999/xhtml"
  xmlns:metal="http://xml.zope.org/namespaces/metal"
  xmlns:tal="http://xml.zope.org/namespaces/tal"
  xmlns:i18n="http://xml.zope.org/namespaces/i18n"
  tal:define="global vein string:status"
  i18n:domain="silva">
<metal:block use-macro="here/macro_index/macros/master">

  <metal:block metal:fill-slot="middleground">
    <tal:buttons tal:replace="structure model/@@tab_publish_extra" />
  </metal:block>


<metal:block fill-slot="main"
  tal:define="
    unapproved python:model.get_unapproved_version() is not None;
    request_pending python:unapproved and model.is_version_approval_requested();
    approved python:model.get_approved_version() is not None;
    published python:model.get_public_version() is not None;
    closed python:model.get_public_version_status() == 'closed';
    next python:model.get_next_version() is not None;
    vmadapter python:modules['Products'].Silva.adapters.version_management.getVersionManagementAdapter(model);
    mangle modules/Products/Silva/mangle;
">

<table class="columns columns3">
  <tbody>
    <tr>
      <td class="left" rowspan="2">
        <tal:block replace="nothing">
          _____________________ sidebar subtable _____________________
        </tal:block>
        <metal:block use-macro="here/macro_vein_navigation/macros/vein" />
      </td>
      <td class="main">
        <tal:block replace="nothing">
          _____________________ main subtable _____________________
        </tal:block>

<table class="listing">
<thead>
  <tr tal:replace="nothing"> ______________ vein + title row ______________ </tr>
  <tr>
    <td class="top" colspan="3">
    <h2>
      <img tal:replace="structure icon" />
      <tal:block i18n:translate="">status of &#xab;<tal:block content="title" i18n:name="title"/>&#xbb;</tal:block>
    </h2>
    </td>
  </tr>
  <tr class="top-controls">
    <td colspan="7" class="align-right">
      <form action="." enctype="multipart/form-data" method="post">
        <input type="hidden"
          name="refs:list"
          tal:attributes="value python: request['model'].create_ref(request['model'])" />
        <h3 style="float:left;" i18n:translate="">
          publishing actions
        </h3>
        <input class="button transporter"
          type="submit"
          name="../../edit/tab_status_export:method"
          value="export..."
          title="access key: alt-e"
          accesskey="e"
          tal:condition="python:user.has_role(['Manager', 'ChiefEditor'], model)"
          i18n:attributes="value;title"
        />
      </form>
    </td>
  </tr>
</thead>

<tbody>
<span tal:replace="nothing"> _______ messages _______ </span>
<div metal:use-macro="here/tab_status_macros/macros/messages">
  messages
</div>

<span tal:replace="nothing"> _______ Author requests approval _______ </span>
<tal:if condition="python:not may_approve_content and unapproved and not request_pending"
  tal:omit-tag="">
<div metal:use-macro="here/tab_status_macros/macros/request_approval">
  request approval section here
</div>
</tal:if>

<span tal:replace="nothing"> _______ approved, Editor can change settings _______ </span>
<tal:if condition="python:may_approve_content and approved"
  tal:omit-tag="">
<div metal:use-macro="here/tab_status_macros/macros/approved_editor">
  change settings section here
</div>
</tal:if>
</tbody>
</table>

<span tal:replace="nothing"> ______________ sub tables ______________ </span>

<span tal:replace="nothing"> _______ Editor considers approval _______ </span>
<tal:if condition="python:may_approve_content and (unapproved or closed) and not approved"
  tal:omit-tag="">
<metal:block use-macro="here/tab_status_macros/macros/approve_new">
  approval section here
</metal:block>
</tal:if>

<span tal:replace="nothing"> _______ Author/Editor withdraws/rejects request for approval _______ </span>
<tal:if condition="python:may_change_content and unapproved and request_pending"
  tal:omit-tag="">
<div metal:use-macro="here/tab_status_macros/macros/withdraw_request_approval">
  request approval section here
</div>
</tal:if>

<span tal:replace="nothing"> _______ revoke approval _______ </span>
<tal:if condition="python:may_change_content and approved"
  tal:omit-tag="">
<div metal:use-macro="here/tab_status_macros/macros/revoke_approval">
  revoke approval section here
</div>
</tal:if>

<span tal:replace="nothing"> _______ manual close _______ </span>
<tal:if condition="python:may_approve_content and published"
  tal:omit-tag="">
<div metal:use-macro="here/tab_status_macros/macros/manual_close">
_______ manual close section here _______
</div>
</tal:if>

<span tal:replace="nothing">
  Here we insert the additional_status_actions view
</span>
<tal:block replace="structure model/@@additional_status_action" />

<span tal:replace="nothing">
  _____________________ versioning focus box _____________________
</span>
<form class="sublisting" action="." enctype="multipart/form-data" method="post">
<!-- version management -->
<tal:def define="versions here/get_sorted_model_versions">
<input type="hidden"
  name="refs:list"
  tal:attributes="value python: request['model'].create_ref(request['model'])" />
<table class="listing" tal:condition="may_change_content">
  <thead>
    <tr>
      <td class="top" colspan="6">
        <h2 tal:attributes="title string:id: ${model/id}">
          <img tal:replace="structure icon" />
          <tal:block i18n:translate="">
            manage versions of &#xab;<tal:block
            content="string:${model/get_title_or_id}"
            i18n:name="export_id">id</tal:block>&#xbb;
          </tal:block>
         </h2>
      </td>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th class="listing-left"
        tal:define="select_id string:versions">
        <metal:plug use-macro="here/macro_select_all/macros/select_all" />
      </th>
      <th width="10%" i18n:translate="">modification time</th>
      <th width="10%" i18n:translate="">publication time</th>
      <th width="10%" i18n:translate="">expiration time</th>
      <th i18n:translate="">last author</th>
      <th i18n:translate="">version status</th>
    </tr>
    <tr tal:repeat="version versions"
        tal:attributes="class python: test(repeat['version'].odd(), 'odd', 'even')">
      <tal:def define="
        versionid version/id;
        modificationtime python: vmadapter.getVersionModificationTime(versionid);
        publicationtime python: vmadapter.getVersionPublicationTime(versionid);
        expirationtime python: vmadapter.getVersionExpirationTime(versionid);
        lastauthor python: vmadapter.getVersionLastAuthorInfo(versionid).fullname();
        author_avatar python: vmadapter.getVersionLastAuthorInfo(versionid).extra('avatar_tag:16') or '';
        version_status python: vmadapter.getVersionStatus(versionid);
        state python: ((version_status == 'unapproved' and 'draft') or
                        (version_status == 'last_closed' and 'closed') or
                        version_status);
      ">
        <td class="listing-left">
          <input class="min"
            type="checkbox"
            name="versions:list"
            tal:attributes="value version/id; id string:version_${version/id}" />
          <label tal:attributes="for string:version_${version/id}"
            tal:content="version/id">
            id
          </label>
        </td>
        <td tal:content="structure python: modificationtime is not None and mangle.DateTime(modificationtime).toShortStr() or '-'">
          modificationtime
        </td>
        <td tal:content="structure python: publicationtime is not None and mangle.DateTime(publicationtime).toShortStr() or '-'">
          publication time
        </td>
        <td tal:content="structure python: expirationtime is not None and mangle.DateTime(expirationtime).toShortStr() or '-'">
          expiration time
        </td>
        <td>
          <span tal:replace="structure lastauthor" />&nbsp;
          <span tal:replace="structure author_avatar" />
        </td>
        <td>
          <a tal:content="version_status"
             tal:attributes="href version/@@absolute_url/preview;
                             title python:here.tab_status_get_status_link_title(version.get_title());
                             class state"
            i18n:attributes="title"
            i18n:translate="">
            version_status
          </a>
        </td>
      </tal:def>
    </tr>
  </tbody>
  <tfoot>
    <tr tal:condition="python:len(versions) > 1">
      <th class="listing-left"
        tal:define="select_id string:versions">
        <metal:plug use-macro="here/macro_select_all/macros/select_all" />
      </th>
      <th class="listing-right"
        style="padding-right:0.6em"
        colspan="5"
        i18n:translate="">
        version actions
      </th>
    </tr>
    <tr class="controls">
      <td colspan="6">
        <input class="button"
          style="float:right"
          type="submit"
          name="tab_status_revert_to_old:method"
          value="copy for editing"
          title="create a new editable version of the selected old one: alt-f"
          accesskey="f"
          i18n:attributes="value;title"
        />
        <tal:if condition="python:len(versions) > 1">
          <input class="button remover"
            style="float:right"
            type="submit"
            name="tab_status_delete_versions:method"
            value="delete"
            title="there's no undo: alt-d"
            accesskey="d"
            onclick="if (!confirm('Are you sure?')) return false"
            i18n:attributes="value;title"
          />
          <input class="button transporter"
            style="float:right"
            type="submit"
            name="tab_status_view_versions_start:method"
            title="view the selected versions next to each other: alt-="
            value="compare..."
            accesskey="="
            i18n:attributes="value;title"
          />
        </tal:if>
      </td>
    </tr>
  </tfoot>
</table>
</tal:def>

</form>

      </td>
      <tal:block replace="nothing">
        _____________________ right column _____________________
      </tal:block>
      <td class="right">

<span tal:replace="nothing"> ______________ info about doc ______________ </span>
<div class="info"
  style="margin-bottom:1em">
  <h3 i18n:translate="">
    <img tal:replace="structure icon" i18n:name="icon"/>
    document info
  </h3>

  <span tal:replace="nothing"> _______ status: content is a draft, never published _______ </span>
  <tal:if condition="python:unapproved and not published and not closed">
    <p>
      <span class="subhead" style="color:#a00;" i18n:translate="">
        Content is a draft and never published
      </span><br />
      <span tal:condition="may_approve_content"
        tal:omit-tag="" i18n:translate="">Publication settings can be changed.</span>
        <metal:block use-macro="here/tab_status_macros/macros/datetime_info" />
    </p>
  </tal:if>

  <span tal:replace="nothing"> _______ status: content is approved, not published _______ </span>
  <tal:if condition="python:may_change_content and approved">
    <p>
      <span class="subhead" style="color:ForestGreen;" i18n:translate="">
        Content is approved, not published
      </span><br />
      <span tal:condition="may_approve_content"
        tal:omit-tag="" i18n:translate="">
        Publication settings can be changed.
        </span>
        <metal:block use-macro="here/tab_status_macros/macros/datetime_info" />
    </p>
  </tal:if>

  <span tal:replace="nothing"> _______ status: content is published _______ </span>
  <tal:if condition="python:may_change_content and not next and published">
    <p>
      <span class="subhead" i18n:translate="">Content is published</span><br />
      <tal:block i18n:translate="">This content is published (online for the public).</tal:block><br />
      <tal:block i18n:translate="">If you wish you can make an editable copy by going to the <span i18n:name="editor">
      <a href="tab_edit"><tal:block i18n:translate="content-editor">editor</tal:block></a></span>.
      </tal:block>
      <metal:block use-macro="here/tab_status_macros/macros/datetime_info" />
    </p>
  </tal:if>

  <span tal:replace="nothing"> _______ status: warning of new version of published content _______ </span>
  <tal:if condition="python:may_change_content and unapproved and published">
    <p>
      <span class="subhead" i18n:translate="">Published version exists</span><br />
      <span class="warning">
        <tal:block i18n:translate="">Note: an older version of this content is online.</tal:block><br />
        <tal:block i18n:translate="">Publishing this version will replace the public version.</tal:block></span>
      <metal:block use-macro="here/tab_status_macros/macros/datetime_info" />
    </p>
  </tal:if>

  <span tal:replace="nothing"> _______ status: content is closed _______ </span>
  <tal:if condition="python:may_change_content and not next and closed">
    <p>
      <span class="subhead" i18n:translate="">Content is closed</span><br />
      <tal:block i18n:translate="">This content was once published but is now closed.</tal:block><br />
      <tal:block i18n:translate="">If you wish you can make an editable copy in the <a tal:content="string:editor"
        href="tab_edit" i18n:name="editor"><tal:block i18n:translate="content-editor">editor</tal:block></a>.
      </tal:block>
     <metal:block use-macro="here/tab_status_macros/macros/datetime_info" />
    </p>
  </tal:if>
</div>

      </td>
    </tr>
  </tbody>
</table>

</metal:block>
</metal:block>
</html>
