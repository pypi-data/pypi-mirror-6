<html xmlns:tal="http://xml.zope.org/namespaces/tal"
      xmlns:metal="http://xml.zope.org/namespaces/metal"
      metal:use-macro="context/main_template/macros/master"
      i18n:domain="bastionledger">

  <metal:border fill-slot="top_slot">
    <tal:border define="dummy python:request.set('enable_border',1)" />
  </metal:border>
 
<body>
  <div metal:fill-slot="main"
       tal:define="utool context/@@plone_portal_state/portal_url;
                   manager python: context.SecurityCheckPermission('BastionLedger: Manage', context)">
      <h1 class="documentFirstHeading"><img src="" alt="" tal:define="icon python:context.getIcon(1)" 
               tal:attributes="src string:${utool}/${icon}">&nbsp;<span tal:replace="context/Title | context/getId"/> Tags</h1>

      <p class="formHelp">By assigning tags to groups of accounts, we can make make arbitrary 
           logical categorisations.  This is an important feature in creating and generalising 
           ledger processes.</p>

      <table summary="" border="0" cellpadding="2" cellspacing="0">
         <tr class="row">
            <td class="field"><label>Tag</label></td>
            <td class="field"><label>Associates</label></td>
         </tr>
         <tr tal:repeat="assoc context/itsAssociations"
             tal:attributes="class python: repeat['assoc'].odd() and 'odd' or 'even'" >
            <td valign="top">
                 <img src="" alt="" tal:attributes="src string:${utool}/blassociation.gif"/>
                 <a tal:condition="python: not manager and assoc['global']" name="#" 
                    tal:attributes="title assoc/description | assoc/title" 
                    tal:content="assoc/tag"/>
                 <span tal:condition="python: not assoc['global']"
                    tal:replace="assoc/tag"/>
                 <a tal:condition="python: manager and assoc['global']" 
                    tal:attributes="href string:${utool}/portal_bastionledger/associations/${assoc/tag}/edit;
                                    title assoc/description | assoc/title"
                    tal:content="assoc/tag"/>
            </td>
            <td valign="top" 
                tal:define="accts python: assoc['accno'] and context.accountValues(accno=assoc['accno']) or []"
                tal:on-error="string:">
                <div tal:repeat="acct accts">
                     <img src="" alt="" tal:define="icon python: acct.getIcon(1)" 
                          tal:attributes="src string:${utool}/${icon}"/>
                     <a href="" tal:attributes="href acct/absolute_url" 
                                tal:content="acct/prettyTitle"/>
                </div>
                <div style="color: red;" tal:condition="not: accts">
                     <img src="" alt="" tal:attributes="src string:${utool}/blaccount.gif"/>
                     <span tal:repeat="accno assoc/accno" tal:content="accno"/>
                </div>
            </td>
          </tr>
      </table>

      <div tal:replace="structure provider:plone.belowcontentbody">
           Document actions (print, sendto etc)
      </div>

  </div>
 
</body>
</html>
