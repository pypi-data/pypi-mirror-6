<html xmlns:tal="http://xml.zope.org/namespaces/tal"
      xmlns:metal="http://xml.zope.org/namespaces/metal"
      metal:use-macro="context/main_template/macros/master"
      i18n:domain="bastionledger">

  <metal:border fill-slot="top_slot">
    <tal:border define="dummy python:request.set('enable_border',1)" />
  </metal:border>
 
<body>
  <div metal:fill-slot="main" 
       tal:define="start request/start_date | nothing;
                   end request/end_date | nothing;
                   do_it python: start and end;
                   utool context/@@plone_portal_state/portal_url;
                   zero context/zeroAmount;
                   global award zero">
      <h1 class="documentFirstHeading"><img src="" alt="" tal:define="icon python:context.getIcon(1)" 
               tal:attributes="src string:${utool}/${icon}">Superannuation Summary</h1>


      <form action="" name="edit_form">

          <table summary="">
             <tr>
                <td class="label">From</td>
            
                <td tal:define="inputvalue python: context.toLocalizedTime(request.get('start_date', DateTime() - 30), long_format=0);
                                formname string:edit_form;
                                show_hm python: False;
                                inputname string:start_date;">
                   <span metal:use-macro="here/calendar_macros/macros/calendarDatePickerBox"/>
                </td>
                <td class="label">To</td>
                <td tal:define="inputvalue python: context.toLocalizedTime(request.get('end_date', DateTime()), long_format=0);
                                formname string:edit_form;
                                show_hm python: False;
                                inputname string:end_date;">
                   <span metal:use-macro="here/calendar_macros/macros/calendarDatePickerBox"/>
                </td>
                <td>
                   <input class="context"  type="submit" name="form.button.Go"
                          value="  Go  "  i18n:attributes="value" />
                </td>
             </tr>
          </table>

      </form>

      <fieldset tal:condition="do_it">
         <legend><span tal:replace="start"/> to <span tal:replace="end"/></legend>
         <table summary="" 
                tal:define="start python: modules['Products.BastionLedger.utils'].floor_date(start);
                            end python: modules['Products.BastionLedger.utils'].ceiling_date(end);
                            supers python: context.superannuationEmployees(start, end);
                            super_id python: context.Ledger.accountIds(tags='wages_super')[0]"
                tal:condition="supers">
           <tr>
              <td><span class="label" valign="top">Fund</span></td>
              <td><span class="label" valign="top">Employee</span></td>
              <td><span class="label" valign="top" nowrap>Member No.</span></td>
              <td><span class="label"  valign="top">DOB</span></td>
              <td align="right" valign="top"><span class="label">Award</span></td>
              <td/>
              <td align="right" valign="top"><span class="label">Employer Extra</span></td>
              <td/>
              <td align="right" valign="top"><span class="label">Member</span></td>
           </tr>
           <tal:block tal:repeat="employees supers">
              <tr tal:repeat="employee employees">
                 <td rowspan="" valign="top"
                     tal:attributes="rowspan python: len(employees)" 
                     tal:condition="python:repeat['employee'].index == 0" 
                     tal:content="employee/super_details"/>
                 <td  valign="top" tal:content="employee/title"/>
                 <td  valign="top" tal:content="employee/super_number"/>
                 <td  valign="top" tal:content="python: context.toLocalizedTime(employee.date_of_birth)"/>
                 <td  valign="top" align="right" nowrap
                      tal:define="total python: abs(employee.sum(super_id, [start, end]));
                                  global award python: award + total"
                      tal:content="total"/>
                 <td/>
                 <td  valign="top" align="right" nowrap tal:content="zero">0.00</td>
                 <td/>
                 <td  valign="top" align="right" nowrap tal:content="zero">0.00</td>
              </tr>
              <tal:block>
                 <tr>
                    <td colspan="4"/>
                    <td align="right" nowrap><span class="label" tal:content="award"/></td>
                    <td/>
                    <td align="right" nowrap><span class="label" tal:content="zero">0.00</span></td>
                    <td/>
                    <td align="right" nowrap><span class="label" tal:content="zero">0.00</span></td>
                 </tr>
               </tal:block>
           </tal:block>
      </table>
    </fieldset>

      <div tal:replace="structure provider:plone.belowcontentbody">
           Document actions (print, sendto etc)
      </div>

  </div>
 
</body>
</html>
