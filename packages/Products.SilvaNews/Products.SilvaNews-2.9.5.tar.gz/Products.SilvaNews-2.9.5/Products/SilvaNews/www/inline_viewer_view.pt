<html tal:omit-tag=""
      xmlns="http://www.w3.org/1999/xhtml"
      xmlns:metal="http://xml.zope.org/namespaces/metal"
      xmlns:tal="http://xml.zope.org/namespaces/tal"
      xmlns:i18n="http://xml.zope.org/namespaces/i18n"
      i18n:domain="silva_news"
      tal:define="model options/model;
                  viewer options/viewer;
                  viewerobj python:here.get_viewer(viewer, model);
                  ">

  <p class="p newsmessage"
     tal:condition="python: viewerobj is None">
    Sorry, no viewer is available.
  </p>

  <tal:if tal:condition="python: viewerobj is not None"
          tal:define="viewer_url viewerobj/@@absolute_url;
                      limit python:int(options['number_of_articles']);
                      items python:here.get_items(limit, viewer, model);
                      show_link_article python:options['show_link_article'];
                      mangle modules/Products/Silva/mangle;
                      formatdate nocall:here/service_news/format_date;
                      title_level options/title_level
                  ">
    <div tal:attributes="class python:options['inv_div'] or nothing;
                         id python:options['inv_div_id'] or nothing">

      <h3 tal:condition="python:options['show_title']=='1'"
          tal:content="viewerobj/get_title">
        title
      </h3>

      <div class="searchbox" tal:condition="python:options['show_search']=='1'">
        <form tal:attributes="action viewer_url" method="post">
          <input type="text" name="query" />
          <input class="button"
                 type="submit"
                 value="Search"
                 title="Do a full text search: alt-s"
                 accesskey="s"
                 i18n:attributes="title;value"
                 />
        </form>
      </div>

      <tal:loop condition="python:len(items) > 0"
                repeat="item items">
        <div tal:attributes="class python:'newsitem %s'%(repeat['item'].odd() and 'odd' or 'even')">
          <span tal:replace="structure string:<$title_level class='heading newsitemheading'>" />
          <a tal:define="title item/title"
             tal:content="structure title"
             tal:attributes="href python:item.link(request)"
             tal:omit-tag="python:show_link_article != 'heading'"
             >
            title
          </a>
          <span tal:replace="structure string:</$title_level>" />

          <div class="newsiteminfo"
               tal:condition="python:int(options['show_creationdate']) or int(options['show_datetime']) or int(options['show_location'])">
            <p class="p eventdates">
              <tal:block tal:condition="python:(int(options['show_creationdate']) and item.creation_datetime())">
                <tal:translate i18n:translate="">
                  Publication date:
                </tal:translate>
                <span class="newsitemcreationdate"
                      tal:content="structure python: formatdate(item.creation_datetime())" />
                <br />
              </tal:block>
              <tal:block tal:condition="python: item.start_datetime() and options['show_datetime']=='1'">
                <tal:translate i18n:translate="">
                  Start:
                </tal:translate>
                <span class="newsitemstartdate"
                      tal:content="structure python: formatdate(item.start_datetime())" />
                <br />
              </tal:block>
              <tal:block condition="python: item.end_datetime() and options['show_datetime']=='1'">
                <tal:translate i18n:translate="">
                  End:
                </tal:translate>
                <span class="newsitemenddate"
                      tal:content="structure python: formatdate(item.end_datetime())" />
                <br />
              </tal:block>
              <tal:block condition="python: (int(options['show_location']) and item.location())">
                <tal:translate i18n:translate="">Location:</tal:translate>
                <span class="newsitemlocation" tal:content="item/location" />
              </tal:block>
            </p>
          </div>

          <div class="newsimage"
               tal:define="di options/display_image"
               tal:condition="python:di=='thumbnail'">
            <tal:def define="thumb item/thumbnail">
              <img tal:condition="python:di=='thumbnail' and thumb"
                   tal:replace="structure thumb" />
            </tal:def>
          </div>

          <tal:set define="maxchars python: int(options['number_of_characters'])">
            <p class="p newslead">
              <tal:cond condition="python: options['show_intro']=='intro'">
                <tal:insert tal:define="intro python:item.intro(maxchars)"
                  tal:content="structure intro"
                  tal:condition="intro"
                />
              </tal:cond>
              <tal:cond condition="python: options['show_intro']=='description'">
                <tal:insert tal:define="desc python:item.description(maxchars)"
                  tal:content="structure desc"
                  tal:condition="desc"
                />
              </tal:cond>
              <span class="articlelink" tal:condition="python:show_link_article=='separate'">
                <a tal:attributes="href python:item.link(request)"
                  tal:content="structure options/link_text_article" />
              </span>
            </p>
          </tal:set>

        </div>
      </tal:loop>

      <p class="p newsmessage"
         tal:condition="python:len(items) <= 0">
        No articles are available.
      </p>

      <p class="p newsviewer-otherarticles"
         tal:condition="python:options['show_link']=='1'">
        <br />
        <a tal:content="structure options/link_text_viewer"
           tal:attributes="href viewer_url">
          View other articles...
        </a>
      </p>

      <tal:cond tal:condition="python:options['show_footer']=='1'">
        <metal:plug use-macro="here/feed_footer/macros/footer" />
      </tal:cond>

    </div>
  </tal:if>
</html>
