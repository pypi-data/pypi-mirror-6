<html xmlns:tal="http://xml.zope.org/namespaces/tal"
      xmlns:metal="http://xml.zope.org/namespaces/metal"
      metal:use-macro="context/main_template/macros/master"
      i18n:domain="bastionledger">
 
<body>
  <div metal:fill-slot="main"
       tal:define="effective request/effective | python: DateTime();
                   Batch python:modules['Products.CMFPlone'].Batch;
                   b_size request/b_size | python:50;
                   b_start request/b_start | python: 0;
		   sort_on request/sort_on | string:accno;
                   shareholders context/shareholders;
                     utool context/@@plone_portal_state/portal_url;
                   batch python: Batch(shareholders, int(b_size), int(b_start), orphan=1)">

      <h1><img src="" alt="" tal:define="icon python:context.getIcon(1)" 
               tal:attributes="src string:${utool}/${icon}">&nbsp;<span tal:replace="context/Title | context/getId"/>
          Allocations as at <span tal:replace="python: effective.strftime('%Y/%m/%d')"/></h1>

        <!-- Navigation -->
        <div metal:use-macro="context/batch_macros/macros/navigation" />

      <table summary="" tal:condition="nocall: shareholders">
         <tr class="row">
            <td>&nbsp;</td>
            <td class="field"><label>Shareholder</label></td>
            <td class="field" align="right"><label>Quantity</label></td>
            <td class="field" aligh="right"><label>Value</label></td>
         </tr>
         <tal:block tal:repeat="shareholder batch">
             <tr tal:attributes="class python: repeat['shareholder'].odd() and 'odd' or 'even'"
                 tal:repeat="allocation python: shareholder.allocationValues(context.getId(), effective)">
                <td><img src="" alt="" tal:define="icon python: shareholder.getIcon(1)"
                         tal:attributes="src string:${utool}/${icon}"/></td>
                <td><a href="" tal:attributes="href shareholder/absolute_url"
                       tal:content="shareholder/Title"/></td>
                <td align="right" tal:content="allocation/quantity"/>
                <td align="right" tal:content="python: context.face * allocation.quantity"/>
             </tr>
         </tal:block>
      </table>

      <div tal:replace="structure provider:plone.belowcontentbody">
           Document actions (print, sendto etc)
      </div>

  </div>
 
</body>
</html>
