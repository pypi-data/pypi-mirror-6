<!DOCTYPE html>

<html lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=utf-8">
<meta name="generator" content="Docutils 0.5: http://docutils.sourceforge.net/">
<title>Genshi: Genshi Text Template Language</title>
<link rel="stylesheet" href="common/style/edgewall.css" type="text/css">
</head>
<body>
<div class="document" id="genshi-text-template-language">
    <div id="navigation">
      <span class="projinfo">Genshi 0.6</span>
      <a href="index.html">Documentation Index</a>
    </div>
<h1 class="title">Genshi Text Template Language</h1>
<p>In addition to the XML-based template language, Genshi provides a simple
text-based template language, intended for basic plain text generation needs.
The language is similar to the <a class="reference external" href="http://www.djangoproject.com/">Django</a> template language.</p>
<p>This document describes the template language and will be most useful as
reference to those developing Genshi text templates. Templates are text files of
some kind that include processing <a class="reference internal" href="#directives">directives</a> that affect how the template is
rendered, and template expressions that are dynamically substituted by
variable data.</p>
<p>See <a class="reference external" href="templates.html">Genshi Templating Basics</a> for general information on
embedding Python code in templates.</p>
<div class="note">
<p class="first admonition-title">Note</p>
<p class="last">Actually, Genshi currently has two different syntaxes for text
templates languages: One implemented by the class <tt class="docutils literal"><span class="pre">OldTextTemplate</span></tt>
and another implemented by <tt class="docutils literal"><span class="pre">NewTextTemplate</span></tt>. This documentation
concentrates on the latter, which is planned to completely replace the
older syntax. The older syntax is briefly described under <a class="reference internal" href="#legacy">legacy</a>.</p>
</div>
<div class="contents topic" id="contents">
<p class="topic-title first">Contents</p>
<ul class="auto-toc simple">
<li><a class="reference internal" href="#template-directives" id="id8">1   Template Directives</a><ul class="auto-toc">
<li><a class="reference internal" href="#conditional-sections" id="id9">1.1   Conditional Sections</a><ul class="auto-toc">
<li><a class="reference internal" href="#id1" id="id10">1.1.1   <tt class="docutils literal"><span class="pre">{%</span> <span class="pre">if</span> <span class="pre">%}</span></tt></a></li>
<li><a class="reference internal" href="#id2" id="id11">1.1.2   <tt class="docutils literal"><span class="pre">{%</span> <span class="pre">choose</span> <span class="pre">%}</span></tt></a></li>
</ul>
</li>
<li><a class="reference internal" href="#looping" id="id12">1.2   Looping</a><ul class="auto-toc">
<li><a class="reference internal" href="#id3" id="id13">1.2.1   <tt class="docutils literal"><span class="pre">{%</span> <span class="pre">for</span> <span class="pre">%}</span></tt></a></li>
</ul>
</li>
<li><a class="reference internal" href="#snippet-reuse" id="id14">1.3   Snippet Reuse</a><ul class="auto-toc">
<li><a class="reference internal" href="#id4" id="id15">1.3.1   <tt class="docutils literal"><span class="pre">{%</span> <span class="pre">def</span> <span class="pre">%}</span></tt></a></li>
<li><a class="reference internal" href="#id5" id="id16">1.3.2   <tt class="docutils literal"><span class="pre">{%</span> <span class="pre">include</span> <span class="pre">%}</span></tt></a></li>
</ul>
</li>
<li><a class="reference internal" href="#variable-binding" id="id17">1.4   Variable Binding</a><ul class="auto-toc">
<li><a class="reference internal" href="#id6" id="id18">1.4.1   <tt class="docutils literal"><span class="pre">{%</span> <span class="pre">with</span> <span class="pre">%}</span></tt></a></li>
</ul>
</li>
</ul>
</li>
<li><a class="reference internal" href="#white-space-and-line-breaks" id="id19">2   White-space and Line Breaks</a></li>
<li><a class="reference internal" href="#id7" id="id20">3   Comments</a></li>
<li><a class="reference internal" href="#legacy-text-template-syntax" id="id21">4   Legacy Text Template Syntax</a></li>
</ul>
</div>
<div class="section" id="template-directives">
<span id="directives"></span><h1>1   Template Directives</h1>
<p>Directives are template commands enclosed by <tt class="docutils literal"><span class="pre">{%</span> <span class="pre">...</span> <span class="pre">%}</span></tt> characters. They can
affect how the template is rendered in a number of ways: Genshi provides
directives for conditionals and looping, among others.</p>
<p>Each directive must be terminated using an <tt class="docutils literal"><span class="pre">{%</span> <span class="pre">end</span> <span class="pre">%}</span></tt> marker. You can add
a string inside the <tt class="docutils literal"><span class="pre">{%</span> <span class="pre">end</span> <span class="pre">%}</span></tt> marker, for example to document which
directive is being closed, or even the expression associated with  that
directive. Any text after <tt class="docutils literal"><span class="pre">end</span></tt> inside the delimiters is  ignored,  and
effectively treated as a comment.</p>
<p>If you want to include a literal delimiter in the output, you need to escape it
by prepending a backslash character (<tt class="docutils literal"><span class="pre">\</span></tt>).</p>
<div class="section" id="conditional-sections">
<h2>1.1   Conditional Sections</h2>
<div class="section" id="id1">
<span id="if"></span><h3>1.1.1   <tt class="docutils literal"><span class="pre">{%</span> <span class="pre">if</span> <span class="pre">%}</span></tt></h3>
<p>The content is only rendered if the expression evaluates to a truth value:</p>
<div class="system-message">
<p class="system-message-title">System Message: ERROR/3 (<tt class="docutils">doc\text-templates.txt</tt>, line 63)</p>
<p>Unknown directive type "code-block".</p>
<pre class="literal-block">
.. code-block:: genshitext

  {% if foo %}
    ${bar}
  {% end %}

</pre>
</div>
<p>Given the data <tt class="docutils literal"><span class="pre">foo=True</span></tt> and <tt class="docutils literal"><span class="pre">bar='Hello'</span></tt> in the template context, this
would produce:</p>
<pre class="literal-block">
Hello
</pre>
</div>
<div class="section" id="id2">
<span id="otherwise"></span><span id="when"></span><span id="choose"></span><h3>1.1.2   <tt class="docutils literal"><span class="pre">{%</span> <span class="pre">choose</span> <span class="pre">%}</span></tt></h3>
<p>The <tt class="docutils literal"><span class="pre">choose</span></tt> directive, in combination with the directives <tt class="docutils literal"><span class="pre">when</span></tt> and
<tt class="docutils literal"><span class="pre">otherwise</span></tt>, provides advanced contional processing for rendering one of
several alternatives. The first matching <tt class="docutils literal"><span class="pre">when</span></tt> branch is rendered, or, if
no <tt class="docutils literal"><span class="pre">when</span></tt> branch matches, the <tt class="docutils literal"><span class="pre">otherwise</span></tt> branch is be rendered.</p>
<p>If the <tt class="docutils literal"><span class="pre">choose</span></tt> directive has no argument the nested <tt class="docutils literal"><span class="pre">when</span></tt> directives will
be tested for truth:</p>
<div class="system-message">
<p class="system-message-title">System Message: ERROR/3 (<tt class="docutils">doc\text-templates.txt</tt>, line 90)</p>
<p>Unknown directive type "code-block".</p>
<pre class="literal-block">
.. code-block:: genshitext

  The answer is:
  {% choose %}
    {% when 0 == 1 %}0{% end %}
    {% when 1 == 1 %}1{% end %}
    {% otherwise %}2{% end %}
  {% end %}

</pre>
</div>
<p>This would produce the following output:</p>
<pre class="literal-block">
The answer is:
  1
</pre>
<p>If the <tt class="docutils literal"><span class="pre">choose</span></tt> does have an argument, the nested <tt class="docutils literal"><span class="pre">when</span></tt> directives will
be tested for equality to the parent <tt class="docutils literal"><span class="pre">choose</span></tt> value:</p>
<div class="system-message">
<p class="system-message-title">System Message: ERROR/3 (<tt class="docutils">doc\text-templates.txt</tt>, line 107)</p>
<p>Unknown directive type "code-block".</p>
<pre class="literal-block">
.. code-block:: genshitext

  The answer is:
  {% choose 1 %}\
    {% when 0 %}0{% end %}\
    {% when 1 %}1{% end %}\
    {% otherwise %}2{% end %}\
  {% end %}

</pre>
</div>
<p>This would produce the following output:</p>
<pre class="literal-block">
The answer is:
    1
</pre>
</div>
</div>
<div class="section" id="looping">
<h2>1.2   Looping</h2>
<div class="section" id="id3">
<span id="for"></span><h3>1.2.1   <tt class="docutils literal"><span class="pre">{%</span> <span class="pre">for</span> <span class="pre">%}</span></tt></h3>
<p>The content is repeated for every item in an iterable:</p>
<div class="system-message">
<p class="system-message-title">System Message: ERROR/3 (<tt class="docutils">doc\text-templates.txt</tt>, line 132)</p>
<p>Unknown directive type "code-block".</p>
<pre class="literal-block">
.. code-block:: genshitext

  Your items:
  {% for item in items %}\
    * ${item}
  {% end %}

</pre>
</div>
<p>Given <tt class="docutils literal"><span class="pre">items=[1,</span> <span class="pre">2,</span> <span class="pre">3]</span></tt> in the context data, this would produce:</p>
<pre class="literal-block">
Your items
  * 1
  * 2
  * 3
</pre>
</div>
</div>
<div class="section" id="snippet-reuse">
<h2>1.3   Snippet Reuse</h2>
<div class="section" id="id4">
<span id="macros"></span><span id="def"></span><h3>1.3.1   <tt class="docutils literal"><span class="pre">{%</span> <span class="pre">def</span> <span class="pre">%}</span></tt></h3>
<p>The <tt class="docutils literal"><span class="pre">def</span></tt> directive can be used to create macros, i.e. snippets of template
text that have a name and optionally some parameters, and that can be inserted
in other places:</p>
<div class="system-message">
<p class="system-message-title">System Message: ERROR/3 (<tt class="docutils">doc\text-templates.txt</tt>, line 160)</p>
<p>Unknown directive type "code-block".</p>
<pre class="literal-block">
.. code-block:: genshitext

  {% def greeting(name) %}
    Hello, ${name}!
  {% end %}
  ${greeting('world')}
  ${greeting('everyone else')}

</pre>
</div>
<p>The above would be rendered to:</p>
<pre class="literal-block">
Hello, world!
Hello, everyone else!
</pre>
<p>If a macro doesn't require parameters, it can be defined without the
parenthesis. For example:</p>
<div class="system-message">
<p class="system-message-title">System Message: ERROR/3 (<tt class="docutils">doc\text-templates.txt</tt>, line 176)</p>
<p>Unknown directive type "code-block".</p>
<pre class="literal-block">
.. code-block:: genshitext

  {% def greeting %}
    Hello, world!
  {% end %}
  ${greeting()}

</pre>
</div>
<p>The above would be rendered to:</p>
<pre class="literal-block">
Hello, world!
</pre>
</div>
<div class="section" id="id5">
<span id="include"></span><span id="includes"></span><h3>1.3.2   <tt class="docutils literal"><span class="pre">{%</span> <span class="pre">include</span> <span class="pre">%}</span></tt></h3>
<p>To reuse common parts of template text across template files, you can include
other files using the <tt class="docutils literal"><span class="pre">include</span></tt> directive:</p>
<div class="system-message">
<p class="system-message-title">System Message: ERROR/3 (<tt class="docutils">doc\text-templates.txt</tt>, line 197)</p>
<p>Unknown directive type "code-block".</p>
<pre class="literal-block">
.. code-block:: genshitext

  {% include base.txt %}

</pre>
</div>
<p>Any content included this way is inserted into the generated output. The
included template sees the context data as it exists at the point of the
include. <a class="reference internal" href="#macros">Macros</a> in the included template are also available to the including
template after the point it was included.</p>
<p>Include paths are relative to the filename of the template currently being
processed. So if the example above was in the file "<tt class="docutils literal"><span class="pre">myapp/mail.txt</span></tt>"
(relative to the template search path), the include directive would look for
the included file at "<tt class="docutils literal"><span class="pre">myapp/base.txt</span></tt>". You can also use Unix-style
relative paths, for example "<tt class="docutils literal"><span class="pre">../base.txt</span></tt>" to look in the parent directory.</p>
<p>Just like other directives, the argument to the <tt class="docutils literal"><span class="pre">include</span></tt> directive accepts
any Python expression, so the path to the included template can be determined
dynamically:</p>
<div class="system-message">
<p class="system-message-title">System Message: ERROR/3 (<tt class="docutils">doc\text-templates.txt</tt>, line 216)</p>
<p>Unknown directive type "code-block".</p>
<pre class="literal-block">
.. code-block:: genshitext

  {% include ${'%s.txt' % filename} %}

</pre>
</div>
<p>Note that a <tt class="docutils literal"><span class="pre">TemplateNotFound</span></tt> exception is raised if an included file can't
be found.</p>
<div class="note">
<p class="first admonition-title">Note</p>
<p class="last">The include directive for text templates was added in Genshi 0.5.</p>
</div>
</div>
</div>
<div class="section" id="variable-binding">
<h2>1.4   Variable Binding</h2>
<div class="section" id="id6">
<span id="with"></span><h3>1.4.1   <tt class="docutils literal"><span class="pre">{%</span> <span class="pre">with</span> <span class="pre">%}</span></tt></h3>
<p>The <tt class="docutils literal"><span class="pre">{%</span> <span class="pre">with</span> <span class="pre">%}</span></tt> directive lets you assign expressions to variables, which can
be used to make expressions inside the directive less verbose and more
efficient. For example, if you need use the expression <tt class="docutils literal"><span class="pre">author.posts</span></tt> more
than once, and that actually results in a database query, assigning the results
to a variable using this directive would probably help.</p>
<p>For example:</p>
<div class="system-message">
<p class="system-message-title">System Message: ERROR/3 (<tt class="docutils">doc\text-templates.txt</tt>, line 242)</p>
<p>Unknown directive type "code-block".</p>
<pre class="literal-block">
.. code-block:: genshitext

  Magic numbers!
  {% with y=7; z=x+10 %}
    $x $y $z
  {% end %}

</pre>
</div>
<p>Given <tt class="docutils literal"><span class="pre">x=42</span></tt> in the context data, this would produce:</p>
<pre class="literal-block">
Magic numbers!
  42 7 52
</pre>
<p>Note that if a variable of the same name already existed outside of the scope
of the <tt class="docutils literal"><span class="pre">with</span></tt> directive, it will <strong>not</strong> be overwritten. Instead, it will
have the same value it had prior to the <tt class="docutils literal"><span class="pre">with</span></tt> assignment. Effectively,
this means that variables are immutable in Genshi.</p>
</div>
</div>
</div>
<div class="section" id="white-space-and-line-breaks">
<span id="whitespace"></span><h1>2   White-space and Line Breaks</h1>
<p>Note that space or line breaks around directives is never automatically removed.
Consider the following example:</p>
<div class="system-message">
<p class="system-message-title">System Message: ERROR/3 (<tt class="docutils">doc\text-templates.txt</tt>, line 269)</p>
<p>Unknown directive type "code-block".</p>
<pre class="literal-block">
.. code-block:: genshitext

  {% for item in items %}
    {% if item.visible %}
      ${item}
    {% end %}
  {% end %}

</pre>
</div>
<p>This will result in two empty lines above and beneath every item, plus the
spaces used for indentation. If you want to supress a line break, simply end
the line with a backslash:</p>
<div class="system-message">
<p class="system-message-title">System Message: ERROR/3 (<tt class="docutils">doc\text-templates.txt</tt>, line 281)</p>
<p>Unknown directive type "code-block".</p>
<pre class="literal-block">
.. code-block:: genshitext

  {% for item in items %}\
    {% if item.visible %}\
      ${item}
    {% end %}\
  {% end %}\

</pre>
</div>
<p>Now there would be no empty lines between the items in the output. But you still
get the spaces used for indentation, and because the line breaks are removed,
they actually continue and add up between lines. There are numerous ways to
control white-space in the output while keeping the template readable, such as
moving the indentation into the delimiters, or moving the end delimiter on the
next line, and so on.</p>
</div>
<div class="section" id="id7">
<span id="comments"></span><h1>3   Comments</h1>
<p>Parts in templates can be commented out using the delimiters <tt class="docutils literal"><span class="pre">{#</span> <span class="pre">...</span> <span class="pre">#}</span></tt>.
Any content in comments are removed from the output.</p>
<div class="system-message">
<p class="system-message-title">System Message: ERROR/3 (<tt class="docutils">doc\text-templates.txt</tt>, line 306)</p>
<p>Unknown directive type "code-block".</p>
<pre class="literal-block">
.. code-block:: genshitext

  {# This won't end up in the output #}
  This will.

</pre>
</div>
<p>Just like directive delimiters, these can be escaped by prefixing with a
backslash.</p>
<div class="system-message">
<p class="system-message-title">System Message: ERROR/3 (<tt class="docutils">doc\text-templates.txt</tt>, line 314)</p>
<p>Unknown directive type "code-block".</p>
<pre class="literal-block">
.. code-block:: genshitext

  \{# This *will* end up in the output, including delimiters #}
  This too.


</pre>
</div>
</div>
<div class="section" id="legacy-text-template-syntax">
<span id="legacy"></span><h1>4   Legacy Text Template Syntax</h1>
<p>The syntax for text templates was redesigned in version 0.5 of Genshi to make
the language more flexible and powerful. The older syntax is based on line
starting with dollar signs, similar to e.g. <a class="reference external" href="http://cheetahtemplate.org/">Cheetah</a> or <a class="reference external" href="http://jakarta.apache.org/velocity/">Velocity</a>.</p>
<p>A simple template using the old syntax looked like this:</p>
<div class="system-message">
<p class="system-message-title">System Message: ERROR/3 (<tt class="docutils">doc\text-templates.txt</tt>, line 335)</p>
<p>Unknown directive type "code-block".</p>
<pre class="literal-block">
.. code-block:: genshitext

  Dear $name,

  We have the following items for you:
  #for item in items
   * $item
  #end

  All the best,
  Foobar

</pre>
</div>
<p>Beyond the requirement of putting directives on separate lines prefixed with
dollar signs, the language itself is very similar to the new one. Except that
comments are lines that start with two <tt class="docutils literal"><span class="pre">#</span></tt> characters, and a line-break at the
end of a directive is removed automatically.</p>
<div class="note">
<p class="first admonition-title">Note</p>
<p class="last">If you're using this old syntax, it is strongly recommended to
migrate to the new syntax. Simply replace any references to
<tt class="docutils literal"><span class="pre">TextTemplate</span></tt> by <tt class="docutils literal"><span class="pre">NewTextTemplate</span></tt> (and also change the
text templates, of course). On the other hand, if you want to stick
with the old syntax for a while longer, replace references to
<tt class="docutils literal"><span class="pre">TextTemplate</span></tt> by <tt class="docutils literal"><span class="pre">OldTextTemplate</span></tt>; while <tt class="docutils literal"><span class="pre">TextTemplate</span></tt> is
still an alias for the old language at this point, that will change
in a future release. But also note that the old syntax may be
dropped entirely in a future release.</p>
</div>
</div>
    <div id="footer">
      Visit the Genshi open source project at
      <a href="http://genshi.edgewall.org/">http://genshi.edgewall.org/</a>
    </div>
  </div>
</body>
</html>
