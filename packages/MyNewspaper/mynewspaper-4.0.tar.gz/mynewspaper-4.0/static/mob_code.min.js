var wis="s/1",ST_ICONS=["st_all.png","st_unread.png","st_starred.png","st_later.png","st_archived.png"],imgs_state=["st_delete.png","st_unread.png","st_starred.png","st_later.png","st_archived.png"],$tmp=null,scrollY=0,arts=null;function go(a){wis=a;"s"==wis[0]?(a=parseInt(wis.substring(2)),summary(a)):"a"!=wis[0]&&"g"!=wis[0]&&"f"!=wis[0]||show_articles(wis)} function activate_topbar_popups(){$("#topbar").find(".btn_popup").click(function(a){var b=$(this).find("div.popup");if(b.is(":visible"))b.fadeOut();else{var c=b.outerHeight();a=a.clientY+c>window.innerHeight?-c:$(this).innerHeight();b.css("top",a).fadeIn()}}).mouseleave(function(){var a=$(this).find("div.popup");a.is(":visible")&&a.fadeOut()})} function summary(a){$("#contents").empty().append(div_loading);$("#contents").load("/ajax/mob_load_summary/"+a,function(){$("body").addClass("dark");$("#topbar img.st_icon").attr("src","/images/"+ST_ICONS[a]);activate_topbar_popups();$("#popup_show a").click(function(){$("#popup_show").parent().prev().trigger("mouseleave");var b=parseInt($(this).attr("name"));if(a!=b)return $("body").removeClass("dark"),summary(b),!1});$("#summary .group").click(function(){$gfeeds=$(this).next();if("group_children"== $gfeeds.attr("class"))return $(this).find("img.btn").attr("src","/images/btn_"+($gfeeds.is(":hidden")?"expanded":"collapsed")+".png"),$gfeeds.toggle(),!1});$("#summary a.num").click(function(){go($(this).attr("name"));return!1})})}function show_articles(a,b){b=b?1:0;$("body").removeClass("dark");$("#contents").empty().append(div_loading);$("#contents").load("/ajax/mob_load_articles/"+a+"/"+b,function(){bind_articles_actions(a)})} function bind_articles_actions(a){var b=parseInt(a.substr(-1));$("#topbar img.st_icon").attr("src","/images/"+ST_ICONS[b]);activate_topbar_popups();$("#popup_show a").click(function(){$("#popup_show").parent().prev().trigger("mouseleave");var c=parseInt($(this).attr("name"));if(b!=c)return c=a.substring(0,a.length-1)+c,go(c),!1});$("#btn_loadall").click(function(){show_articles(a,!0)});$("#btn_process").click(function(){process_arts(wis)});var c=$("<div class='states'><ul><li><a name='0'><img src='/images/st_delete.png' width='32' height='32'/>Delete</a></li><li><a name='1'><img src='/images/st_unread.png' width='32' height='32'/>Unread</a></li><li><a name='2'><img src='/images/st_starred.png' width='32' height='32'/>Starred</a></li><li><a name='3'><img src='/images/st_later.png' width='32' height='32'/>Later</a></li><li><a name='4'><img src='/images/st_archived.png' width='32' height='32'/>Archived</a></li></ul></div>").popup(!0).appendTo("#articles"); c.find("a").click(function(){var a=$(this).attr("name");c.data("art").find("img.icon").attr({src:"/images/"+imgs_state[a],alt:a});$.popup.off(c);return!1});var d=$("<div class='actions'><ul><li><a id='openlink'>Open link in new tab</a></li><li><a>Send as email</a></li><li><a>Save to Pocket</a></li></ul></div>").popup(!1).appendTo("#articles");d.find("#openlink").click(function(){window.open(d.data("art").find(".mntitle a").attr("href"),"_blank");$.popup.off(d);return!1});$("#articles .mnhdr img.icon").click(function(){$.popup.off(d); $.popup.toggle(c,$(this));return!1});$("#articles .mnhdr img.icon2").click(function(){$.popup.off(c);$.popup.toggle(d,$(this));return!1});$("#articles .mntitle a").click(function(){c.is(":visible")&&$.popup.off(c);d.is(":visible")&&$.popup.off(d);return!1});$("#articles .mntitle").click(function(){if(c.is(":visible")||d.is(":visible"))$.popup.off(c),$.popup.off(d);else{$tmp=$("#contents").clone();scrollY=$(document).scrollTop();arts=[];$("#articles .art:visible .mnhdr img.icon").each(function(a,b){arts[a]= parseInt($(this).attr("name"))});var a=parseInt($(this).parent().find(".mnhdr img.icon").attr("name"));load_article_view(a)}})} function process_arts(a){if(confirm("Process articles?")){var b=[];$("#articles .art:visible .mnhdr img.icon").each(function(a,d){b[a]=$(this).attr("name")+":"+$(this).attr("alt")});if(b=b.join(","))$("#contents").empty().append(div_processing),$.post("/ajax/process_articles",{arts:b}).done(function(){show_articles(a)}).fail(function(){$("#contents").empty().append("<div class='error'>ERROR processing articles</div>")})}} function load_article_view(a){var b=arts.indexOf(a);$("#contents").empty().append(div_loading);$("#contents").load("/ajax/mob_load_article/"+a,function(){$("#topbar span.idx").text(b+1+" of "+arts.length);$("#btn_close").click(function(){$("body").empty().append($tmp);$tmp=null;bind_articles_actions(wis);$(document).scrollTop(scrollY);return!1});$("#btn_prev").click(function(){if(0!=b)return a=arts[b-1],load_article_view(a),!1});$("#btn_next").click(function(){if(b!=arts.length-1)return a=arts[b+ 1],load_article_view(a),!1})})}var div_loading="<div class='loading'><div>Loading...</div><br/><img src='/images/loading2.gif' /></div>",div_processing="<div class='loading'><div>Processing...</div><br/><img src='/images/loading2.gif' /></div>"; (function(a){a.fn.popup=function(b){a(this).data("alignleft",b).mouseleave(function(){a.popup.off(a(this))});return a(this)};a.popup=a.popup||{};a.popup.toggle=function(b,c){b.is(":visible")?a.popup.off(b):a.popup.on(b,c)};a.popup.on=function(b,c){b.data("art",c.parent().parent());var d=b.data("alignleft")?5:a(window).width()-b.outerWidth()-5,e=c.position().top+c.outerHeight()+3;e+b.outerHeight()>+a(window).scrollTop()+a(window).height()&&(e=a(window).scrollTop()+a(window).height()-b.outerHeight()- 5);b.css({left:d,top:e}).fadeIn("fast")};a.popup.off=function(a){a.data("art",null);a.fadeOut()}})(jQuery);
