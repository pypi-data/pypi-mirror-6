<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN"
  "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">


<html xmlns="http://www.w3.org/1999/xhtml">
  <head>
    <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
    
    <title>Initialisation du programme &mdash; documentation EweeStats 0.0dev1</title>
    
    <link rel="stylesheet" href="_static/default.css" type="text/css" />
    <link rel="stylesheet" href="_static/pygments.css" type="text/css" />
    
    <script type="text/javascript">
      var DOCUMENTATION_OPTIONS = {
        URL_ROOT:    './',
        VERSION:     '0.0dev1',
        COLLAPSE_INDEX: false,
        FILE_SUFFIX: '.html',
        HAS_SOURCE:  true
      };
    </script>
    <script type="text/javascript" src="_static/jquery.js"></script>
    <script type="text/javascript" src="_static/underscore.js"></script>
    <script type="text/javascript" src="_static/doctools.js"></script>
    <script type="text/javascript" src="_static/translations.js"></script>
    <link rel="top" title="documentation EweeStats 0.0dev1" href="index.html" />
    <link rel="next" title="Générisation des opérations" href="tech_generisation.html" />
    <link rel="prev" title="Architecture du programme" href="tech_arch.html" /> 
  </head>
  <body>
    <div class="related">
      <h3>Navigation</h3>
      <ul>
        <li class="right" style="margin-right: 10px">
          <a href="genindex.html" title="Index général"
             accesskey="I">index</a></li>
        <li class="right" >
          <a href="py-modindex.html" title="Index des modules Python"
             >modules</a> |</li>
        <li class="right" >
          <a href="tech_generisation.html" title="Générisation des opérations"
             accesskey="N">suivant</a> |</li>
        <li class="right" >
          <a href="tech_arch.html" title="Architecture du programme"
             accesskey="P">précédent</a> |</li>
        <li><a href="index.html">documentation EweeStats 0.0dev1</a> &raquo;</li> 
      </ul>
    </div>  

    <div class="document">
      <div class="documentwrapper">
        <div class="bodywrapper">
          <div class="body">
            
  <div class="section" id="initialisation-du-programme">
<h1>Initialisation du programme<a class="headerlink" href="#initialisation-du-programme" title="Lien permanent vers ce titre">¶</a></h1>
<div class="section" id="initialisation-de-l-ecran-lcd">
<h2>Initialisation de l&#8217;écran LCD<a class="headerlink" href="#initialisation-de-l-ecran-lcd" title="Lien permanent vers ce titre">¶</a></h2>
<p>Il faut créer une variable pour contrôler l&#8217;affichage LCD:</p>
<dl class="function">
<dt id="Adafruit_CharLCDPlate.Adafruit_CharLCDPlate">
<tt class="descclassname">Adafruit_CharLCDPlate.</tt><tt class="descname">Adafruit_CharLCDPlate</tt><big>(</big><big>)</big><a class="headerlink" href="#Adafruit_CharLCDPlate.Adafruit_CharLCDPlate" title="Lien permanent vers cette définition">¶</a></dt>
<dd><table class="docutils field-list" frame="void" rules="none">
<col class="field-name" />
<col class="field-body" />
<tbody valign="top">
<tr class="field-odd field"><th class="field-name">Retourne:</th><td class="field-body">objet</td>
</tr>
<tr class="field-even field"><th class="field-name">Type retourné:</th><td class="field-body">Adafruit_CharLCDPlate()</td>
</tr>
</tbody>
</table>
</dd></dl>

<p>Ici la variable créée est lcd</p>
</div>
<div class="section" id="initialisation-de-l-arduino">
<h2>Initialisation de l&#8217;Arduino<a class="headerlink" href="#initialisation-de-l-arduino" title="Lien permanent vers ce titre">¶</a></h2>
<p>Avec <a class="reference external" href="http://firmata.org">Firmata</a> sur l&#8217;Arduino.
Comme avec l&#8217;écran,
Création de la variable :</p>
<dl class="function">
<dt id="pyfirmata.Arduino">
<tt class="descclassname">pyfirmata.</tt><tt class="descname">Arduino</tt><big>(</big><em>id</em><big>)</big><a class="headerlink" href="#pyfirmata.Arduino" title="Lien permanent vers cette définition">¶</a></dt>
<dd><table class="docutils field-list" frame="void" rules="none">
<col class="field-name" />
<col class="field-body" />
<tbody valign="top">
<tr class="field-odd field"><th class="field-name">Paramètres:</th><td class="field-body"><strong>id</strong> (<em>string</em>) &#8211; identifiant de l&#8217;Arduino dans le répertoire /dev</td>
</tr>
<tr class="field-even field"><th class="field-name">Retourne:</th><td class="field-body">objet Arduino</td>
</tr>
<tr class="field-odd field"><th class="field-name">Type retourné:</th><td class="field-body">Arduino</td>
</tr>
</tbody>
</table>
</dd></dl>

<p>Ici, la variable est appelée board.</p>
<p>Il faut ensuite commencer l&#8217;écoute sur les entrées :</p>
<dl class="function">
<dt>
<tt class="descname">board.analog[i].enable_reporting()</tt></dt>
<dd><table class="docutils field-list" frame="void" rules="none">
<col class="field-name" />
<col class="field-body" />
<tbody valign="top">
<tr class="field-odd field"><th class="field-name">Paramètres:</th><td class="field-body"><strong>i</strong> (<em>integer</em>) &#8211; numéro de l&#8217;entrée analogique</td>
</tr>
<tr class="field-even field"><th class="field-name">Retourne:</th><td class="field-body">None</td>
</tr>
</tbody>
</table>
</dd></dl>

<p>Lorsque la Raspberry Pi commence à écouter, l&#8217;Arduino renvoit comme valeur None au début, il faut donc attendre que l&#8217;Arduino envoit une valeur valide avant de commencer.</p>
</div>
<div class="section" id="initialisation-des-fichiers-de-sauvegarde">
<h2>Initialisation des fichiers de sauvegarde<a class="headerlink" href="#initialisation-des-fichiers-de-sauvegarde" title="Lien permanent vers ce titre">¶</a></h2>
<p>On désire avoir un fichier par capteur et un fichier d&#8217;horodatage.
La création des fichiers se fait en 3 étapes :</p>
<blockquote>
<div><ol class="arabic simple">
<li>définition du répertoire de stockage des fichiers</li>
<li>création des fichiers et d&#8217;une liste</li>
<li>ouverture des fichiers et remplissage de la liste</li>
</ol>
</div></blockquote>
<p>La liste permet de stocker le nom des fichiers.</p>
<p>Pour toutes ces opérations, on utilisera le module os.</p>
<div class="section" id="chemin-des-fichiers">
<h3>Chemin des fichiers<a class="headerlink" href="#chemin-des-fichiers" title="Lien permanent vers ce titre">¶</a></h3>
<p>On lit dans quel dossier on se trouve actuellement avec</p>
<dl class="function">
<dt id="os.getcwd">
<tt class="descclassname">os.</tt><tt class="descname">getcwd</tt><big>(</big><big>)</big><a class="headerlink" href="#os.getcwd" title="Lien permanent vers cette définition">¶</a></dt>
<dd><p>getcwd() -&gt; path</p>
<p>Return a unicode string representing the current working directory.</p>
</dd></dl>

<p>Puis on définit le dossier de sortie par la chaîne de caractères &#8220;data&#8221; et on crée le chemin avec</p>
<dl class="function">
<dt id="os.path.join">
<tt class="descclassname">os.path.</tt><tt class="descname">join</tt><big>(</big><em>currentDir</em>, <em>newDir</em><big>)</big><a class="headerlink" href="#os.path.join" title="Lien permanent vers cette définition">¶</a></dt>
<dd><p>Join two or more pathname components, inserting &#8216;/&#8217; as needed.
If any component is an absolute path, all previous path components
will be discarded.  An empty last part will result in a path that
ends with a separator.</p>
<table class="docutils field-list" frame="void" rules="none">
<col class="field-name" />
<col class="field-body" />
<tbody valign="top">
<tr class="field-odd field"><th class="field-name">Paramètres:</th><td class="field-body"><ul class="first simple">
<li><strong>currentDir</strong> (<em>string</em>) &#8211; chemin initial</li>
<li><strong>newDir</strong> (<em>string</em>) &#8211; chemin à ajouter au currentDir</li>
</ul>
</td>
</tr>
<tr class="field-even field"><th class="field-name">Retourne:</th><td class="field-body"><p class="first">nouveau chemin</p>
</td>
</tr>
<tr class="field-odd field"><th class="field-name">Type retourné:</th><td class="field-body"><p class="first last">string</p>
</td>
</tr>
</tbody>
</table>
</dd></dl>

<p>On obtient alors le chemin du dossier dans lequel seront stockés les fichiers</p>
<p>Si le dossier n&#8217;existait pas, il est créé avec</p>
<dl class="function">
<dt id="os.makedirs">
<tt class="descclassname">os.</tt><tt class="descname">makedirs</tt><big>(</big><em>newpath</em><big>)</big><a class="reference internal" href="_modules/os.html#makedirs"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#os.makedirs" title="Lien permanent vers cette définition">¶</a></dt>
<dd><p>makedirs(path [, mode=0o777][, exist_ok=False])</p>
<p>Super-mkdir; create a leaf directory and all intermediate ones.
Works like mkdir, except that any intermediate path segment (not
just the rightmost) will be created if it does not exist. If the
target directory with the same mode as we specified already exists,
raises an OSError if exist_ok is False, otherwise no exception is
raised.  This is recursive.</p>
<table class="docutils field-list" frame="void" rules="none">
<col class="field-name" />
<col class="field-body" />
<tbody valign="top">
<tr class="field-odd field"><th class="field-name">Paramètres:</th><td class="field-body"><strong>newpath</strong> &#8211; chemin du dossier à créer</td>
</tr>
<tr class="field-even field"><th class="field-name">Retourne:</th><td class="field-body">None</td>
</tr>
</tbody>
</table>
</dd></dl>

<p>L&#8217;existence du dossier est testée avec :</p>
<dl class="function">
<dt id="os.path.exists">
<tt class="descclassname">os.path.</tt><tt class="descname">exists</tt><big>(</big><em>newpath</em><big>)</big><a class="headerlink" href="#os.path.exists" title="Lien permanent vers cette définition">¶</a></dt>
<dd><p>Test whether a path exists.  Returns False for broken symbolic links</p>
<table class="docutils field-list" frame="void" rules="none">
<col class="field-name" />
<col class="field-body" />
<tbody valign="top">
<tr class="field-odd field"><th class="field-name">Paramètres:</th><td class="field-body"><strong>newpath</strong> (<em>string</em>) &#8211; chemin dont on regarde l&#8217;existence</td>
</tr>
<tr class="field-even field"><th class="field-name">Retourne:</th><td class="field-body">booléen indiquant l&#8217;existence ou non du dossier</td>
</tr>
<tr class="field-odd field"><th class="field-name">Type retourné:</th><td class="field-body">boolean</td>
</tr>
</tbody>
</table>
</dd></dl>

</div>
<div class="section" id="creation-des-fichiers">
<h3>Création des fichiers<a class="headerlink" href="#creation-des-fichiers" title="Lien permanent vers ce titre">¶</a></h3>
<p>On crée la liste contenant les fichiers nommée fileList.
On crée les noms de fichiers :</p>
<dl class="function">
<dt>
<tt class="descname">'data_%s'%str(i)</tt></dt>
<dd><table class="docutils field-list" frame="void" rules="none">
<col class="field-name" />
<col class="field-body" />
<tbody valign="top">
<tr class="field-odd field"><th class="field-name">Paramètres:</th><td class="field-body"><strong>i</strong> (<em>integer</em>) &#8211; numéro de l&#8217;entrée analogique correspondant à ce fichier</td>
</tr>
<tr class="field-even field"><th class="field-name">Retourne:</th><td class="field-body">le nom de fichier sous la forme data_i avec i le numéro d&#8217;entrée analogique</td>
</tr>
<tr class="field-odd field"><th class="field-name">Type retourné:</th><td class="field-body">string</td>
</tr>
</tbody>
</table>
</dd></dl>

<p>On crée le chemin du fichier avec</p>
<dl class="function">
<dt>
<tt class="descclassname">os.path.</tt><tt class="descname">join</tt><big>(</big><em>path</em>, <em>filename</em><big>)</big></dt>
<dd><table class="docutils field-list" frame="void" rules="none">
<col class="field-name" />
<col class="field-body" />
<tbody valign="top">
<tr class="field-odd field"><th class="field-name">Retourne:</th><td class="field-body">le chemin complet du fichier</td>
</tr>
</tbody>
</table>
</dd></dl>

<p>Enfin, on ouvre le fichier avec</p>
<dl class="function">
<dt id="io.open">
<tt class="descclassname">io.</tt><tt class="descname">open</tt><big>(</big><em>filepath</em>, <em>mode</em><big>)</big><a class="headerlink" href="#io.open" title="Lien permanent vers cette définition">¶</a></dt>
<dd><dl class="docutils">
<dt>open(file, mode=&#8217;r&#8217;, buffering=-1, encoding=None,</dt>
<dd>errors=None, newline=None, closefd=True, opener=None) -&gt; file object</dd>
</dl>
<p>Open file and return a stream.  Raise IOError upon failure.</p>
<p>file is either a text or byte string giving the name (and the path
if the file isn&#8217;t in the current working directory) of the file to
be opened or an integer file descriptor of the file to be
wrapped. (If a file descriptor is given, it is closed when the
returned I/O object is closed, unless closefd is set to False.)</p>
<p>mode is an optional string that specifies the mode in which the file
is opened. It defaults to &#8216;r&#8217; which means open for reading in text
mode.  Other common values are &#8216;w&#8217; for writing (truncating the file if
it already exists), &#8216;x&#8217; for creating and writing to a new file, and
&#8216;a&#8217; for appending (which on some Unix systems, means that all writes
append to the end of the file regardless of the current seek position).
In text mode, if encoding is not specified the encoding used is platform
dependent: locale.getpreferredencoding(False) is called to get the
current locale encoding. (For reading and writing raw bytes use binary
mode and leave encoding unspecified.) The available modes are:</p>
<table border="1" class="docutils">
<colgroup>
<col width="13%" />
<col width="88%" />
</colgroup>
<tbody valign="top">
<tr class="row-odd"><td>Character</td>
<td>Meaning</td>
</tr>
<tr class="row-even"><td>&#8216;r&#8217;</td>
<td>open for reading (default)</td>
</tr>
<tr class="row-odd"><td>&#8216;w&#8217;</td>
<td>open for writing, truncating the file first</td>
</tr>
<tr class="row-even"><td>&#8216;x&#8217;</td>
<td>create a new file and open it for writing</td>
</tr>
<tr class="row-odd"><td>&#8216;a&#8217;</td>
<td>open for writing, appending to the end of the file if it exists</td>
</tr>
<tr class="row-even"><td>&#8216;b&#8217;</td>
<td>binary mode</td>
</tr>
<tr class="row-odd"><td>&#8216;t&#8217;</td>
<td>text mode (default)</td>
</tr>
<tr class="row-even"><td>&#8216;+&#8217;</td>
<td>open a disk file for updating (reading and writing)</td>
</tr>
<tr class="row-odd"><td>&#8216;U&#8217;</td>
<td>universal newline mode (deprecated)</td>
</tr>
</tbody>
</table>
<p>The default mode is &#8216;rt&#8217; (open for reading text). For binary random
access, the mode &#8216;w+b&#8217; opens and truncates the file to 0 bytes, while
&#8216;r+b&#8217; opens the file without truncation. The &#8216;x&#8217; mode implies &#8216;w&#8217; and
raises an <cite>FileExistsError</cite> if the file already exists.</p>
<p>Python distinguishes between files opened in binary and text modes,
even when the underlying operating system doesn&#8217;t. Files opened in
binary mode (appending &#8216;b&#8217; to the mode argument) return contents as
bytes objects without any decoding. In text mode (the default, or when
&#8216;t&#8217; is appended to the mode argument), the contents of the file are
returned as strings, the bytes having been first decoded using a
platform-dependent encoding or using the specified encoding if given.</p>
<p>&#8216;U&#8217; mode is deprecated and will raise an exception in future versions
of Python.  It has no effect in Python 3.  Use newline to control
universal newlines mode.</p>
<p>buffering is an optional integer used to set the buffering policy.
Pass 0 to switch buffering off (only allowed in binary mode), 1 to select
line buffering (only usable in text mode), and an integer &gt; 1 to indicate
the size of a fixed-size chunk buffer.  When no buffering argument is
given, the default buffering policy works as follows:</p>
<ul class="simple">
<li>Binary files are buffered in fixed-size chunks; the size of the buffer
is chosen using a heuristic trying to determine the underlying device&#8217;s
&#8220;block size&#8221; and falling back on <cite>io.DEFAULT_BUFFER_SIZE</cite>.
On many systems, the buffer will typically be 4096 or 8192 bytes long.</li>
<li>&#8220;Interactive&#8221; text files (files for which isatty() returns True)
use line buffering.  Other text files use the policy described above
for binary files.</li>
</ul>
<p>encoding is the name of the encoding used to decode or encode the
file. This should only be used in text mode. The default encoding is
platform dependent, but any encoding supported by Python can be
passed.  See the codecs module for the list of supported encodings.</p>
<p>errors is an optional string that specifies how encoding errors are to
be handled&#8212;this argument should not be used in binary mode. Pass
&#8216;strict&#8217; to raise a ValueError exception if there is an encoding error
(the default of None has the same effect), or pass &#8216;ignore&#8217; to ignore
errors. (Note that ignoring encoding errors can lead to data loss.)
See the documentation for codecs.register or run &#8216;help(codecs.Codec)&#8217;
for a list of the permitted encoding error strings.</p>
<p>newline controls how universal newlines works (it only applies to text
mode). It can be None, &#8216;&#8217;, &#8216;n&#8217;, &#8216;r&#8217;, and &#8216;rn&#8217;.  It works as
follows:</p>
<ul class="simple">
<li>On input, if newline is None, universal newlines mode is
enabled. Lines in the input can end in &#8216;n&#8217;, &#8216;r&#8217;, or &#8216;rn&#8217;, and
these are translated into &#8216;n&#8217; before being returned to the
caller. If it is &#8216;&#8217;, universal newline mode is enabled, but line
endings are returned to the caller untranslated. If it has any of
the other legal values, input lines are only terminated by the given
string, and the line ending is returned to the caller untranslated.</li>
<li>On output, if newline is None, any &#8216;n&#8217; characters written are
translated to the system default line separator, os.linesep. If
newline is &#8216;&#8217; or &#8216;n&#8217;, no translation takes place. If newline is any
of the other legal values, any &#8216;n&#8217; characters written are translated
to the given string.</li>
</ul>
<p>If closefd is False, the underlying file descriptor will be kept open
when the file is closed. This does not work when a file name is given
and must be True in that case.</p>
<p>A custom opener can be used by passing a callable as <em>opener</em>. The
underlying file descriptor for the file object is then obtained by
calling <em>opener</em> with (<em>file</em>, <em>flags</em>). <em>opener</em> must return an open
file descriptor (passing os.open as <em>opener</em> results in functionality
similar to passing None).</p>
<p>open() returns a file object whose type depends on the mode, and
through which the standard file operations such as reading and writing
are performed. When open() is used to open a file in a text mode (&#8216;w&#8217;,
&#8216;r&#8217;, &#8216;wt&#8217;, &#8216;rt&#8217;, etc.), it returns a TextIOWrapper. When used to open
a file in a binary mode, the returned class varies: in read binary
mode, it returns a BufferedReader; in write binary and append binary
modes, it returns a BufferedWriter, and in read/write mode, it returns
a BufferedRandom.</p>
<p>It is also possible to use a string or bytearray as a file for both
reading and writing. For strings StringIO can be used like a file
opened in a text mode, and for bytes a BytesIO can be used like a file
opened in a binary mode.</p>
</dd></dl>

<p>On procède de même avec le fichier d&#8217;horodatage, sauf que le nom ne sera pas data_i mais timestamp.</p>
</div>
</div>
<div class="section" id="initialisation-de-l-horodatage">
<h2>Initialisation de l&#8217;horodatage<a class="headerlink" href="#initialisation-de-l-horodatage" title="Lien permanent vers ce titre">¶</a></h2>
<p>L&#8217;initialisation de l&#8217;horodatage est faite dans la boucle principale pour avoir le moins d&#8217;écart entre l&#8217;initialisation du temps et la première mesure, i.e pour que
la première mesure ait pour abscisse 0.</p>
<p>Pour cela on crée un booléen timestampInitDone qu&#8217;on met à False au début. On va donc faire l&#8217;initialisation du timestamp  si et seulement si timestampInitDone est à False :</p>
<div class="highlight-python"><div class="highlight"><pre>            <span class="c">#### CREATION DU TIMESTAMP ####</span>
</pre></div>
</div>
<p>On utilise la fonction time.time pour initialiser l&#8217;horodatage :</p>
<dl class="function">
<dt id="time.time">
<tt class="descclassname">time.</tt><tt class="descname">time</tt><big>(</big><big>)</big><a class="headerlink" href="#time.time" title="Lien permanent vers cette définition">¶</a></dt>
<dd><p>time() -&gt; floating point number</p>
<p>Return the current time in seconds since the Epoch.
Fractions of a second may be present if the system clock provides them.</p>
</dd></dl>

<p>On met ensuite le booléen timestampInitDone à True pour indiquer que l&#8217;initialisation de l&#8217;horodatage a été effectuée.</p>
</div>
</div>


          </div>
        </div>
      </div>
      <div class="sphinxsidebar">
        <div class="sphinxsidebarwrapper">
  <h3><a href="index.html">Table des Matières</a></h3>
  <ul>
<li><a class="reference internal" href="#">Initialisation du programme</a><ul>
<li><a class="reference internal" href="#initialisation-de-l-ecran-lcd">Initialisation de l&#8217;écran LCD</a></li>
<li><a class="reference internal" href="#initialisation-de-l-arduino">Initialisation de l&#8217;Arduino</a></li>
<li><a class="reference internal" href="#initialisation-des-fichiers-de-sauvegarde">Initialisation des fichiers de sauvegarde</a><ul>
<li><a class="reference internal" href="#chemin-des-fichiers">Chemin des fichiers</a></li>
<li><a class="reference internal" href="#creation-des-fichiers">Création des fichiers</a></li>
</ul>
</li>
<li><a class="reference internal" href="#initialisation-de-l-horodatage">Initialisation de l&#8217;horodatage</a></li>
</ul>
</li>
</ul>

  <h4>Sujet précédent</h4>
  <p class="topless"><a href="tech_arch.html"
                        title="Chapitre précédent">Architecture du programme</a></p>
  <h4>Sujet suivant</h4>
  <p class="topless"><a href="tech_generisation.html"
                        title="Chapitre suivant">Générisation des opérations</a></p>
  <h3>Cette page</h3>
  <ul class="this-page-menu">
    <li><a href="_sources/tech_init.txt"
           rel="nofollow">Montrer la source</a></li>
  </ul>
<div id="searchbox" style="display: none">
  <h3>Recherche rapide</h3>
    <form class="search" action="search.html" method="get">
      <input type="text" name="q" />
      <input type="submit" value="Go" />
      <input type="hidden" name="check_keywords" value="yes" />
      <input type="hidden" name="area" value="default" />
    </form>
    <p class="searchtip" style="font-size: 90%">
    Saisissez un mot clef ou un nom de module, classe ou fonction.
    </p>
</div>
<script type="text/javascript">$('#searchbox').show(0);</script>
        </div>
      </div>
      <div class="clearer"></div>
    </div>
    <div class="related">
      <h3>Navigation</h3>
      <ul>
        <li class="right" style="margin-right: 10px">
          <a href="genindex.html" title="Index général"
             >index</a></li>
        <li class="right" >
          <a href="py-modindex.html" title="Index des modules Python"
             >modules</a> |</li>
        <li class="right" >
          <a href="tech_generisation.html" title="Générisation des opérations"
             >suivant</a> |</li>
        <li class="right" >
          <a href="tech_arch.html" title="Architecture du programme"
             >précédent</a> |</li>
        <li><a href="index.html">documentation EweeStats 0.0dev1</a> &raquo;</li> 
      </ul>
    </div>
    <div class="footer">
        &copy; Copyright 2014, Gabriel Hondet.
      Créé avec <a href="http://sphinx-doc.org/">Sphinx</a> 1.2.2.
    </div>
  </body>
</html>