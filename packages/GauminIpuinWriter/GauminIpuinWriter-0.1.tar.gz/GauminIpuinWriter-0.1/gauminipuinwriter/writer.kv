#:kivy 1.0.9
#:import name ipuin.uix.StepSpinner
#:import name ipuin.uix.TargetTypeSpinner

<OpenIpuinWidget>:
    orientation: "vertical"
    loadbutton: loadbutton
    filechooser: filechooser
    newipuintextinput: newipuintextinput

    Label:
        text: "Aukeratu editatu nahi duzun ipuina"
        size_hint: 1, 0.1

    Label:
        text: filechooser.path
        size_hint: 1, 0.1

    FileChooserListView:
        id: filechooser
        filters: ['*.ipuin']
        path: '.'
        size_hint: 1, 0.6

    Button:
        id: loadbutton
        text: "Kargatu"
        size_hint: 1, 0.1

        on_release: root.load(filechooser.selection)

    Widget:
        size_hint: 1, 0.1
        canvas:
            Rectangle:
                pos: 0, self.center_y - 10
                size: self.width, 2


    BoxLayout:
        orientation: "horizontal"
        size_hint: 1, 0.1

        TextInput:
            id: newipuintextinput
            text: "ipuin_berria.ipuin"
            size_hint: 0.7, 1

        Button:
            text: "Berria sortu"
            size_hint: 0.3, 1
            on_release: root.new_ipuin_form()

<FileChooserPopup>:
    filechooser: filechooser
    content: popupcontent

    BoxLayout:
        id: popupcontent
        orientation: "vertical"

        FileChooserListView:
            id: filechooser
            filters: root.filters
            path: '.'
            size_hint: 1, 0.9

        BoxLayout:
            orientation: "horizontal"
            size_hint: 1, 0.1

            Button:
                text: 'Ezeztatu'
                on_release: root.dispatch('on_choose', '')

            Button:
                text: 'Aukeratu'
                on_release: root.dispatch('on_choose', filechooser.selection[0])

<IpuinEditorWidget>:
    orientation: "vertical"
    stepeditor: stepeditor
    step_list_view: step_list_view

    BoxLayout:
        orientation: "horizontal"
        size_hint: 1, 0.1

        Button:
            text: 'Editatu'
            size_hint: 0.2, 1

            on_release: root.edit_metadata()

        Label:
            text: root.title
            size_hint: 0.8, 1

    BoxLayout:
        orientation: "horizontal"
        size_hint: 1, 0.8

        BoxLayout:
            orientation: "vertical"
            size_hint: 0.3, 1

            Label:
                text: "Pausuak"
                size_hint: 1, 0.1

            BoxLayout:
                orientation: "horizontal"
                size_hint: 1, 0.1

                Button:
                    text: '+'
                    on_release: root.add_step()

                Button:
                    text: '-'
                    on_release: root.remove_selected_step()

            ListView:
                id: step_list_view
                adapter: root.step_adapter

        StepEditorWidget:
            id: stepeditor
            size_hint: 0.7, 1
            ipuin: root.ipuin

    Button:
        size_hint: 1, 0.1
        text: "gorde"
        on_release: root.save_ipuin()

<StepEditorWidget>:
    cols: 2
    rst: rst
    img: img
    target_list_view: target_list_view

    Label:
        size_hint: 0.3, 0.1
        text: "Izenburua"

    TextInput:
        size_hint: 0.7, 0.1
        text: root.title

        on_text: root.title=args[1]

    BoxLayout:
        size_hint: 0.3, 0.3
        orientation: "vertical"

        Label:
            text: "Irudia"

        Button:
            text: "aldatu"
            on_release: root.choose_image()

    Image:
        size_hint: 0.7, 0.3
        id: img
        source: root.image or 'imgs/empty.png'

    BoxLayout:
        size_hint: 0.3, 0.3
        orientation: "vertical"

        Label:
            text: "Textua"

        Button:
            text: "aldatu"
            on_release: root.choose_text()

    RstDocument:
        size_hint: 0.7, 0.3
        id: rst
        text: root.text

    BoxLayout:
        orientation: "vertical"
        size_hint: 0.3, 0.2

        Label:
            text: "Helburuak"
            size_hint: 1, 0.5

        BoxLayout:
            orientation: "horizontal"
            size_hint: 1, 0.5

            Button:
                text: "+"

                on_release: root.add_target()

            Button:
                text: "-"
                on_release: root.remove_target()
        Button:
            text: "aldatu"
            on_release: root.update_target()

    ListView:
        id: target_list_view
        adapter: root.target_adapter
        size_hint: 0.7, 0.2

<IpuinMetadataEditorPopup>:
    GridLayout:
        cols: 2

        BoxLayout:
            size_hint: 0.3, 0.3
            orientation: "vertical"

            Label:
                text: "Cover"

            Button:
                text: "aldatu"
                on_release: root.choose_cover()

        Image:
            size_hint: 0.7, 0.3
            id: img
            source: root.cover or 'imgs/empty.png'

        Label:
            size_hint: 0.3, 0.1
            text: "Izenburua"

        TextInput:
            size_hint: 0.7, 0.1
            text: root.title

            on_text: root.title=args[1]

        Label:
            size_hint: 0.3, 0.3
            text: "Deskribapena"

        TextInput:
            size_hint: 0.7, 0.3
            text: root.description

            on_text: root.description=args[1]

        Label:
            size_hint: 0.3, 0.1
            text: "Egilea"

        TextInput:
            size_hint: 0.7, 0.1
            text: root.author

            on_text: root.author=args[1]

        Label:
            size_hint: 0.3, 0.1
            text: "Hasiera pausua"

        StepSpinner:
            size_hint: 0.7, 0.1
            key: root.start
            items: root.ipuin.steps

            on_key: root.start=args[0].key

        Button:
            size_hint: 0.5, 0.1
            text: 'Ezeztatu'
            on_release: root.dismiss()

        Button:
            size_hint: 0.5, 0.1
            text: 'Gorde'
            on_release: root.update_ipuin()

<TargetEditorPopup>:
    extraform: extraform
    targettypespinner: targettypespinner
    title_widget: title_widget

    BoxLayout:
        orientation: "vertical"

        GridLayout:
            cols: 2
            size_hint: 1, 0.3

            Label:
                text: "Izenburua"

            TextInput:
                id: title_widget
                text: 'title' in root.target and root.target['title'] or ''

            Label:
                text: "Helburu mota"

            TargetTypeSpinner:
                id: targettypespinner
                key: root.target_type
                items: root.get_games()

        GridLayout:
            id: extraform
            cols: 2
            size_hint: 1, 0.6

        BoxLayout:
            orientation: "horizontal"
            size_hint: 1, 0.1

            Button:
                text: "Ezeztatu"
                on_release: root.dismiss()

            Button:
                text: "Gorde"
                on_release: root.update_target()
