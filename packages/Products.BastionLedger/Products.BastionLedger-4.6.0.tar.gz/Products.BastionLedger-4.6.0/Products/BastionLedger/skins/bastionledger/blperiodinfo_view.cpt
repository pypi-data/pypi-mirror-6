<html xmlns:tal="http://xml.zope.org/namespaces/tal"
      xmlns:metal="http://xml.zope.org/namespaces/metal"
      metal:use-macro="context/main_template/macros/master"
      i18n:domain="bastionledger">

  <div metal:fill-slot="main" 
       tal:define="global opening python: 0;
                   global change python: 0;
                   global balance python: 0;
                   global reported python: 0;
                   utool context/@@plone_portal_state/portal_url;
                   editmode python: context.SecurityCheckPermission('BastionLedger: Manage')">
 
      <h1><img src="" alt="" tal:define="icon python:context.getIcon(1)" 
               tal:attributes="src string:${utool}/${icon}">&nbsp;
          <span tal:replace="context/Title | context/getId"/></h1>

    <table width="100%" summary="">
        <tr>
           <td tal:define="prev context/prevPeriodInfo">
              <a tal:condition="nocall: prev"
                 i18n:attributes="title title_prev_period;"
                 tal:attributes="href prev/absolute_url" title="previous period">&laquo;</a>
           </td>
           <td align="right"  tal:define="next context/nextPeriodInfo">
              <a tal:condition="nocall: next"
                 i18n:attributes="title title_next_period;"
                 tal:attributes="href next/absolute_url" title="next period">&raquo;</a>
           </td>
        </tr>
    </table>      

      <form action="" method="post" tal:attributes="action template/getId">
        <table summary="" border="0" width="100%" cellpadding="2" cellspacing="0">
           <tr class="row">
               <td class="field" width="16">&nbsp;</td>
               <td class="field">
                   <strong>Number</strong>
               </td>
               <td width="40%" class="field">
                   <strong>Description</strong>
               </td>
               <td class="field">
                   <strong>Type</strong>
               </td>
               <td class="field" align="right"><strong>Opening</strong></td>
               <td class="field" align="right"><strong>Change</strong></td>
               <td class="field" align="right"><strong>Balance</strong></td>
               <td class="field" align="right"><strong>Reported</strong></td>
           </tr>
           <tr tal:repeat="item context/getAccountInfos" class=""
               tal:attributes="class python: repeat['item'].odd() and 'odd' or 'even'">
               <td class="field">
                   <img src=""  tal:define="icon item/icon" 
                        tal:attributes="src string:${utool}/${icon}"/>
               </td>
               <td class="field">
                   <a href="" tal:attributes="href string:${item/absolute_url}?date=${context/period_ended}"
                      tal:content="item/accno"/>
               </td>
               <td class="field" nowrap>
                   <a href="" tal:attributes="href string:${item/absolute_url}?date=${context/period_ended}" 
                      tal:content="item/title"/>
               </td>
               <td class="field" tal:content="item/type"/>
               <td class="field" align="right" nowrap 
                   tal:define="amt item/opening;
                               global opening python: amt + opening"
                   tal:content="amt"/> 
               <td class="field" align="right" nowrap 
                   tal:define="amt item/change;
                               global change python: amt + change"
                   tal:content="amt"/> 
               <td class="field" align="right" nowrap 
                   tal:define="amt item/balance;
                               global balance python: amt + balance"
                   tal:content="amt"/> 
               <td class="field" align="right" nowrap 
                   tal:define="amt item/reporting_balance;
                               global reported python: amt + reported">
                   <span tal:condition="not: editmode" tal:replace="amt"/>
                   <input type="text" name="balances.amount:currency:records" value=""
                          size="15" style="text-align: right;"
                          tal:condition="editmode" tal:attributes="value amt">
                   <input type="hidden" name="balances.id:records" tal:attributes="value item/id"
                          tal:condition="editmode"/>
               </td>
           </tr>
              <tr class="row">
                 <td colspan="8"><hr/></td>
              </tr>
              <tr class="row">
                 <td class="field" colspan="3">
                     <input type="submit" class="context" name="form.button.Save" value=" Save "
                            tal:condition="editmode"/>
                 </td>
                 <td class="field" align="right"><strong>Total</strong></td>
                 <td class="field" align="right" nowrap tal:content="opening"/>
                 <td class="field" align="right" nowrap tal:content="change"/>
                 <td class="field" align="right" nowrap tal:content="balance"/>
                 <td class="field" align="right" nowrap tal:content="reported"/>
              </tr>
          </table>
          <input type="hidden" name="form.submitted" value="1"/>
      </form>

  </div>

</html>
