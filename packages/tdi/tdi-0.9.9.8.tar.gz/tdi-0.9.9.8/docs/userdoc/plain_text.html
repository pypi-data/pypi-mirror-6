

<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN"
  "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">


<html xmlns="http://www.w3.org/1999/xhtml">
  <head>
    <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
    
    <title>Plain Text Templates &mdash; TDI 0.9.9.8 documentation</title>
    
    <link rel="stylesheet" href="_static/default.css" type="text/css" />
    <link rel="stylesheet" href="_static/pygments.css" type="text/css" />
    <link rel="stylesheet" href="_static/tdi.css" type="text/css" />
    
    <script type="text/javascript">
      var DOCUMENTATION_OPTIONS = {
        URL_ROOT:    '',
        VERSION:     '0.9.9.8',
        COLLAPSE_INDEX: false,
        FILE_SUFFIX: '.html',
        HAS_SOURCE:  true
      };
    </script>
    <script type="text/javascript" src="_static/jquery.js"></script>
    <script type="text/javascript" src="_static/underscore.js"></script>
    <script type="text/javascript" src="_static/doctools.js"></script>
    <link rel="top" title="TDI 0.9.9.8 documentation" href="index.html" />
    <link rel="up" title="Documentation Topics" href="topics.html" />
    <link rel="next" title="Node Tree Navigation" href="navigation.html" />
    <link rel="prev" title="Simple Content Editing In Python" href="content.html" /> 
  </head>
  <body>
    <div class="related">
      <h3>Navigation</h3>
      <ul>
        <li class="right" style="margin-right: 10px">
          <a href="navigation.html" title="Node Tree Navigation"
             accesskey="N">next</a></li>
        <li class="right" >
          <a href="content.html" title="Simple Content Editing In Python"
             accesskey="P">previous</a> |</li>
        <li><a href="index.html">TDI 0.9.9.8 documentation</a> &raquo;</li>
          <li><a href="topics.html" accesskey="U">Documentation Topics</a> &raquo;</li> 
      </ul>
    </div>  

    <div class="document">
      <div class="documentwrapper">
        <div class="bodywrapper">
          <div class="body">
            
  <div class="section" id="plain-text-templates">
<h1>Plain Text Templates<a class="headerlink" href="#plain-text-templates" title="Permalink to this headline">¶</a></h1>
<p>Plain text &#8211; naturally &#8211; does not provide any markup by itself. <em class="tdi">TDI</em>
accepts some simple markup, which can be used to annotate your
text templates. If you&#8217;re new to <em class="tdi">TDI</em>, please go back two chapters and
learn about the basics first (<a class="reference internal" href="annotations.html"><em>annotations</em></a> and
<a class="reference internal" href="content.html"><em>basic content editing</em></a>). If you&#8217;re not interested in
plain text markup right now, just <a class="reference internal" href="navigation.html"><em>skip this chapter</em></a>
for now.</p>
<p>A text template looks like this:</p>
<div class="highlight-python"><div class="highlight"><pre><span class="kn">from</span> <span class="nn">tdi</span> <span class="kn">import</span> <span class="n">text</span>
<span class="n">template</span> <span class="o">=</span> <span class="n">text</span><span class="o">.</span><span class="n">from_string</span><span class="p">(</span><span class="s">&quot;&quot;&quot;</span>
<span class="s">Hello [[name]],</span>

<span class="s">[item]* some stuff[/item][:item]</span>
<span class="s">[/:item]</span>
<span class="s">&quot;&quot;&quot;</span><span class="o">.</span><span class="n">strip</span><span class="p">())</span>
<span class="n">template</span><span class="o">.</span><span class="n">render</span><span class="p">()</span>
</pre></div>
</div>
<p><tt class="xref py py-meth docutils literal"><span class="pre">template.render()</span></tt> streams the result to <tt class="docutils literal"><span class="pre">sys.stdout</span></tt> by
default. In contrast to HTML/XML templates, it is expected, that the
markup should not be contained in the final output. Therefore, with text
templates all nodes have the <tt class="docutils literal"><span class="pre">'-'</span></tt> flag set by default (which means,
they are stripped).</p>
<p>So the output of this snippet would be:</p>
<div class="highlight-text"><div class="highlight"><pre>Hello ,

* some stuff
</pre></div>
</div>
<p>We have no render logic specified, so the only difference to the original
template is, that the markup is gone.</p>
<div class="section" id="basic-syntax">
<h2>Basic Syntax<a class="headerlink" href="#basic-syntax" title="Permalink to this headline">¶</a></h2>
<p>The text markup looks similar to HTML. The most obvious difference is,
that the tags use square brackets (<tt class="docutils literal"><span class="pre">[</span></tt> and <tt class="docutils literal"><span class="pre">]</span></tt>) instead of angle
brackets (<tt class="docutils literal"><span class="pre">&lt;</span></tt> and <tt class="docutils literal"><span class="pre">&gt;</span></tt>) as delimiters. Standalone tags (self-closing
tags in HTML) are defined using doubled square-brackets (<tt class="docutils literal"><span class="pre">[[</span></tt> and
<tt class="docutils literal"><span class="pre">]]</span></tt>).</p>
<p><em>Literal</em> square brackets in the template content obviously have to be
escaped. They are written as <tt class="docutils literal"><span class="pre">[]</span></tt>.</p>
</div>
<div class="section" id="attributes">
<h2>Attributes<a class="headerlink" href="#attributes" title="Permalink to this headline">¶</a></h2>
<p>Attributes are specified using a <tt class="docutils literal"><span class="pre">key=&quot;value&quot;</span></tt> syntax and are separated
by whitespace. You can also use single quotes or no quotes at all, if
the value does not contain quotes, backslashes or whitespace. Quotes within
attributes need to be escaped using a backslash (<tt class="docutils literal"><span class="pre">\&quot;</span></tt> or <tt class="docutils literal"><span class="pre">\'</span></tt>), if
they match the surrounding quotes.  The backslash itself is also quoted
using a backslash (<tt class="docutils literal"><span class="pre">\\</span></tt>):</p>
<div class="highlight-python"><div class="highlight"><pre><span class="kn">from</span> <span class="nn">tdi</span> <span class="kn">import</span> <span class="n">text</span>
<span class="n">template</span> <span class="o">=</span> <span class="n">text</span><span class="o">.</span><span class="n">from_string</span><span class="p">(</span><span class="s">r&quot;&quot;&quot;</span>
<span class="s">[tdi=&quot;xxx&quot; tdi:overlay=&quot;foo&quot; myown=&quot;hey\\!\&quot;&quot; another=yo!],</span>
<span class="s">&quot;&quot;&quot;</span><span class="o">.</span><span class="n">strip</span><span class="p">())</span>

<span class="k">class</span> <span class="nc">Model</span><span class="p">(</span><span class="nb">object</span><span class="p">):</span>
    <span class="k">def</span> <span class="nf">render_xxx</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">node</span><span class="p">):</span>
        <span class="k">print</span> <span class="n">node</span><span class="p">[</span><span class="s">&#39;myown&#39;</span><span class="p">]</span>
        <span class="k">print</span> <span class="n">node</span><span class="p">[</span><span class="s">&#39;another&#39;</span><span class="p">]</span>

<span class="n">template</span><span class="o">.</span><span class="n">render_string</span><span class="p">(</span><span class="n">Model</span><span class="p">())</span>
</pre></div>
</div>
<p>Note that <em class="tdi">TDI</em> is generally very lazy, when it comes to unescaping
content. So you get the raw output, when you ask for the attributes:</p>
<div class="highlight-text"><div class="highlight"><pre>hey\\!\&quot;
yo!
</pre></div>
</div>
<p>Use the template&#8217;s raw attribute decoder explicitly if you need the
attribute value decoded and unescaped:</p>
<div class="highlight-python"><div class="highlight"><pre><span class="k">class</span> <span class="nc">Model</span><span class="p">(</span><span class="nb">object</span><span class="p">):</span>
    <span class="k">def</span> <span class="nf">render_xxx</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">node</span><span class="p">):</span>
        <span class="n">decode</span> <span class="o">=</span> <span class="n">node</span><span class="o">.</span><span class="n">raw</span><span class="o">.</span><span class="n">decoder</span><span class="o">.</span><span class="n">attribute</span>
        <span class="k">print</span> <span class="n">decode</span><span class="p">(</span><span class="n">node</span><span class="o">.</span><span class="n">raw</span><span class="p">[</span><span class="s">&#39;myown&#39;</span><span class="p">])</span><span class="o">.</span><span class="n">encode</span><span class="p">(</span><span class="s">&#39;utf-8&#39;</span><span class="p">)</span>
        <span class="k">print</span> <span class="n">decode</span><span class="p">(</span><span class="n">node</span><span class="o">.</span><span class="n">raw</span><span class="p">[</span><span class="s">&#39;another&#39;</span><span class="p">])</span><span class="o">.</span><span class="n">encode</span><span class="p">(</span><span class="s">&#39;utf-8&#39;</span><span class="p">)</span>
</pre></div>
</div>
<p>The decoder produces unicode, so for printing we encode it again. And
there it is:</p>
<div class="highlight-text"><div class="highlight"><pre>hey\!&quot;
yo!
</pre></div>
</div>
</div>
<div class="section" id="node-name">
<h2>Node Name<a class="headerlink" href="#node-name" title="Permalink to this headline">¶</a></h2>
<p>Since the markup has no meaning otherwise, the nodes don&#8217;t have
meaningful names per se. <em class="tdi">TDI</em> uses that to allow shortening the markup.
If a tag defines a name, it&#8217;s the same as defining a &#8220;tdi&#8221; attribute.
That&#8217;s what we did in the initial example:</p>
<div class="highlight-text"><div class="highlight"><pre>Hello [[name]],

[item]* some stuff[/item][:item]
[/:item]
</pre></div>
</div>
<p>If you use that feature, note that the endtags must use the same name
(including flags in the same order). If you do <em>not</em> use that feature,
the nodes simply don&#8217;t have a name and the endtags have to be empty
(<tt class="docutils literal"><span class="pre">[/]</span></tt>).</p>
</div>
<div class="section" id="standalone-tags">
<h2>Standalone Tags<a class="headerlink" href="#standalone-tags" title="Permalink to this headline">¶</a></h2>
<p>Also in the initial example, we used a standalone tag already
(<tt class="docutils literal"><span class="pre">[[name]]</span></tt>). Standalone tags do not have an endtag (in HTML that
would be, for example, <tt class="docutils literal"><span class="pre">&lt;br</span> <span class="pre">/&gt;</span></tt>). Any content you set on such a node
is formally placed after the tag. The tag itself is removed by default,
so effectively the tag is replaced by the content assigned later:</p>
<div class="highlight-python"><div class="highlight"><pre><span class="kn">from</span> <span class="nn">tdi</span> <span class="kn">import</span> <span class="n">text</span>
<span class="n">template</span> <span class="o">=</span> <span class="n">text</span><span class="o">.</span><span class="n">from_string</span><span class="p">(</span><span class="s">r&quot;&quot;&quot;</span>
<span class="s">Hello [[name]]!</span>
<span class="s">&quot;&quot;&quot;</span><span class="o">.</span><span class="n">strip</span><span class="p">())</span>

<span class="k">class</span> <span class="nc">Model</span><span class="p">(</span><span class="nb">object</span><span class="p">):</span>
    <span class="k">def</span> <span class="nf">render_name</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">node</span><span class="p">):</span>
        <span class="n">node</span><span class="o">.</span><span class="n">content</span> <span class="o">=</span> <span class="s">u&quot;Andr</span><span class="se">\xe9</span><span class="s">&quot;</span>

<span class="n">template</span><span class="o">.</span><span class="n">render</span><span class="p">(</span><span class="n">Model</span><span class="p">())</span>
</pre></div>
</div>
<div class="highlight-text"><div class="highlight"><pre>Hello André!
</pre></div>
</div>
</div>
<div class="section" id="comments-and-processing-instructions">
<h2>Comments And Processing Instructions<a class="headerlink" href="#comments-and-processing-instructions" title="Permalink to this headline">¶</a></h2>
<p><em class="tdi">TDI</em> allows you to place comments inside your text templates. They
begin with <tt class="docutils literal"><span class="pre">[#</span></tt> and end with <tt class="docutils literal"><span class="pre">#]</span></tt>. Comments cannot be nested. They
are stripped from the output by default.</p>
<p><em class="tdi">TDI</em> also allows for generic &#8220;processing instructions&#8221;. They are
delimited by <tt class="docutils literal"><span class="pre">[?</span></tt> and <tt class="docutils literal"><span class="pre">?]</span></tt> and cannot be nested either. Processing
instructions are stripped from the output by default.</p>
<p>Both comments and processing instructions are mechanisms to place some
meta data in your template. Comments are for humans or external tools
(e.g. editor tags). Processing instructions are intended for internal
processing, i.e. template <a class="reference internal" href="filtering.html"><em>filters</em></a>.</p>
</div>
<div class="section" id="character-encoding">
<h2>Character Encoding<a class="headerlink" href="#character-encoding" title="Permalink to this headline">¶</a></h2>
<p><em class="tdi">TDI</em> assumes the UTF-8 encoding for text templates by default. This can
be changed either by passing a different encoding to the factory method
or by placing an appropriate processing instruction in the template:</p>
<div class="highlight-python"><div class="highlight"><pre><span class="kn">from</span> <span class="nn">tdi</span> <span class="kn">import</span> <span class="n">text</span>
<span class="n">template</span> <span class="o">=</span> <span class="n">text</span><span class="o">.</span><span class="n">from_string</span><span class="p">(</span><span class="s">&quot;&quot;&quot;</span>
<span class="s">[? encoding = cp1252 ?]Hello [[name]]!</span>

<span class="s">Euro Sign: [[euro]]</span>
<span class="s">&quot;&quot;&quot;</span><span class="o">.</span><span class="n">strip</span><span class="p">())</span>

<span class="k">class</span> <span class="nc">Model</span><span class="p">(</span><span class="nb">object</span><span class="p">):</span>
    <span class="k">def</span> <span class="nf">render_name</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">node</span><span class="p">):</span>
        <span class="n">node</span><span class="o">.</span><span class="n">content</span> <span class="o">=</span> <span class="s">u&quot;Andr</span><span class="se">\xe9</span><span class="s">&quot;</span>

    <span class="k">def</span> <span class="nf">render_euro</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">node</span><span class="p">):</span>
        <span class="n">node</span><span class="o">.</span><span class="n">content</span> <span class="o">=</span> <span class="s">u&quot;</span><span class="se">\u20ac</span><span class="s">&quot;</span>

<span class="k">print</span> <span class="nb">repr</span><span class="p">(</span><span class="n">template</span><span class="o">.</span><span class="n">render_string</span><span class="p">(</span><span class="n">Model</span><span class="p">()))</span>
</pre></div>
</div>
<div class="highlight-text"><div class="highlight"><pre>&#39;Hello Andr\xe9!\n\nEuro Sign: \x80&#39;
</pre></div>
</div>
<p>If you assign content, which cannot be encoded using the desired
character encoding, you will get an error.</p>
</div>
</div>


          </div>
        </div>
      </div>
      <div class="sphinxsidebar">
        <div class="sphinxsidebarwrapper">
  <h3><a href="index.html">Table Of Contents</a></h3>
  <ul>
<li><a class="reference internal" href="#">Plain Text Templates</a><ul>
<li><a class="reference internal" href="#basic-syntax">Basic Syntax</a></li>
<li><a class="reference internal" href="#attributes">Attributes</a></li>
<li><a class="reference internal" href="#node-name">Node Name</a></li>
<li><a class="reference internal" href="#standalone-tags">Standalone Tags</a></li>
<li><a class="reference internal" href="#comments-and-processing-instructions">Comments And Processing Instructions</a></li>
<li><a class="reference internal" href="#character-encoding">Character Encoding</a></li>
</ul>
</li>
</ul>

  <h4>Previous topic</h4>
  <p class="topless"><a href="content.html"
                        title="previous chapter">Simple Content Editing In Python</a></p>
  <h4>Next topic</h4>
  <p class="topless"><a href="navigation.html"
                        title="next chapter">Node Tree Navigation</a></p>
<div id="searchbox" style="display: none">
  <h3>Quick search</h3>
    <form class="search" action="search.html" method="get">
      <input type="text" name="q" />
      <input type="submit" value="Go" />
      <input type="hidden" name="check_keywords" value="yes" />
      <input type="hidden" name="area" value="default" />
    </form>
    <p class="searchtip" style="font-size: 90%">
    Enter search terms or a module, class or function name.
    </p>
</div>
<script type="text/javascript">$('#searchbox').show(0);</script>
        </div>
      </div>
      <div class="clearer"></div>
    </div>
    <div class="related">
      <h3>Navigation</h3>
      <ul>
        <li class="right" style="margin-right: 10px">
          <a href="navigation.html" title="Node Tree Navigation"
             >next</a></li>
        <li class="right" >
          <a href="content.html" title="Simple Content Editing In Python"
             >previous</a> |</li>
        <li><a href="index.html">TDI 0.9.9.8 documentation</a> &raquo;</li>
          <li><a href="topics.html" >Documentation Topics</a> &raquo;</li> 
      </ul>
    </div>
    <div class="footer">
        &copy; Copyright 2014 André Malo.
      Created using <a href="http://sphinx.pocoo.org/">Sphinx</a> 1.1.3.
    </div>
  </body>
</html>