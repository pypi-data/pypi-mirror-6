<html xmlns:tal="http://xml.zope.org/namespaces/tal"
      xmlns:metal="http://xml.zope.org/namespaces/metal"
      metal:use-macro="context/main_template/macros/master"
      i18n:domain="bastionledger">
 
  <metal:border fill-slot="top_slot">
    <tal:border define="dummy python:request.set('enable_border',1)" />
  </metal:border>

<body>

  <div metal:fill-slot="main"
       tal:define="sort_on request/sort_on | string:status;
                   sort_order request/sort_order | string:descending;
                   entries python: context.searchObjects(REQUEST=request, 
                                                         sort_on=sort_on, 
                                                         sort_order=sort_order);
                   b_size request/b_size | python: 50;
                   b_start request/b_start | python: 0;
                   utool context/@@plone_portal_state/portal_url;
                   checkperm python: context.SecurityCheckPermission;
                   Batch python:modules['Products.CMFPlone'].Batch;
                   mq python:modules['ZTUtils'].make_query;
                   batch python:Batch(entries, int(b_size), int(b_start), orphan=2)">
      <h1><img src="" alt="" tal:define="icon python:context.getIcon(1)" 
               tal:attributes="src string:${utool}/${icon}">&nbsp;<span tal:replace="context/Title | context/getId"/></h1>

      <div tal:replace="structure provider:plone.belowcontenttitle"/>

      <form name="edit_form" action="" method="post" tal:attributes="action template/getId">
           <div class="reviewHistory">
            <dl id="searching" class="collapsible inline collapsedOnLoad">
              <dt class="collapsibleHeader">Querying and Filtering</dt>
              <dd class="collapsibleContent">

                <table summary="">
                   <tr>
                     <td valign="top">
                        <div class="label">Entered By</div>
                        <select name="entered_by:tokens:ignore_empty" size="2" multiple>
                           <option tal:repeat="by python: context.uniqueValuesFor('Creator')"
                                   tal:content="by"
                                   tal:attributes="selected python: by == request.get('Creator','') and 1 or 0"/>
                        </select>
                     </td>
                     <td valign="top">
                        <div class="label">Status</div>
                        <select name="status:tokens:ignore_empty" size="2" multiple>
                            <option tal:repeat="status python: context.uniqueValuesFor('status')"
                                    tal:content="status"
                                    tal:attributes="selected python: status == request.get('status','') and 1 or 0"/>
                        </select>
                     </td>
                   </tr>
                   <tr>
                      <td valign="top">
                         <span class="label">Batch Size</span>
                         <input type="text" name="b_size:int" align="right" size="4" maxlength="4" 
                                tal:attributes="value b_size"/>
                      </td>
                      <td valign="top" align="right">
                         <span class="formControls">
                             <input class="context" type="submit" value=" Search " name=":method"/>
                         </span>
                      </td>
                    </tr>
                  </table>
               </dd>
             </dl>
          </div>

        <div metal:use-macro="context/batch_macros/macros/navigation" />

          <table summary="" border="0" cellpadding="2" cellspacing="0">
             <tr class="row">
               <td>&nbsp;</td>
               <td>&nbsp;</td>
               <td class="field">
               </td>
               <td class="field" width="40%"><strong>Description</strong></td>
               <td class="field">
                   <strong tal:condition="python: sort_on=='status'">Status</strong>
                   <a tal:condition="python: sort_on != 'status'"
                      tal:define="qs python: mq(request.form, sort_on='status')"
                      href="" tal:attributes="href string:${template/getId}?${qs}"
                      title="sort on Status"
                      i18n:attributes="title sort_on_status;"><strong>Status</strong></a>
               </td>
               <td class="field" align="right"><strong>Amount</strong></td>
               <td>&nbsp;</td>
               <td class="field">
                   <strong tal:condition="python: sort_on=='Creator'">Entered by</strong>
                   <a tal:condition="python: sort_on != 'Creator'"
                      tal:define="qs python: mq(request.form, sort_on='Creator')"
                      href="" tal:attributes="href string:${template/getId}?${qs}"
                      title="sort on Operator"
                      i18n:attributes="title sort_on_operator;"><strong>Entered by</strong></a>
               </td>
             </tr>
           <tr class="" tal:repeat="quote entries"
               tal:attributes="class python: repeat['quote'].odd() and 'odd' or 'even'">
               <td class="field">
                   <input type="checkbox" name="ids:list" tal:attributes="value quote/getId"/>
               </td>
               <td class="field">
                   <img src="" alt="Part"  tal:define="icon python:quote.getIcon(1)" 
                        tal:attributes="src string:${utool}/${icon}"/>
               </td>
               <td class="field" 
                   tal:content="python: quote.orderdate.strftime('%Y/%m/%d')"/>
               <td class="field">
                   <a href="" tal:attributes="href string:${quote/getId}"  
                              tal:content="quote/title_or_id"/>
               </td>
               <td class="field" tal:content="quote/status"/>
               <td class="field" align="right" nowrap tal:content="quote/getGross"/>
               <td>&nbsp;</td>
               <td class="field" tal:content="quote/Creator"/>
           </tr>
           <tr>
               <td class="field" colspan="4">
                         <input class="standalone"
                              type="submit"
                              name="form.button.Delete"
                              value="delete"
                              tal:condition="python:checkperm('Delete objects')"
                              i18n:attributes="value" />

                         <input class="context"
                              type="submit"
                              name="form.button.Copy"
                              value="copy"
                              i18n:attributes="value" />

                         <input class="context"
                              type="submit"
                              name="form.button.Paste"
                              value="paste"
                              tal:condition="here/cb_dataValid"
                              i18n:attributes="value" />
               </td>
               <td colspan="4" align="right">
                         <img src="" alt="mail" tal:attributes="src string:${utool}/mail_icon.png"/>

                         <input type="text" name="email" size="30" value="" 
                                tal:attributes="value request/email | nothing"/>

                         <input class="context"
                                type="submit"
                                name="form.button.Email"
                                value="Email"
                                i18n:attributes="value" />

                </td>
             </tr>
        </table>

        <div metal:use-macro="context/batch_macros/macros/navigation" />

        <input type="hidden" name="form.submitted" value="1"/>

      </form>

      <div tal:replace="structure provider:plone.belowcontentbody">
           Document actions (print, sendto etc)
      </div>

  </div>
 
</body>
</html>
