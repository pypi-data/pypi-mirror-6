<html xmlns:tal="http://xml.zope.org/namespaces/tal"
      xmlns:metal="http://xml.zope.org/namespaces/metal"
      metal:use-macro="context/main_template/macros/master"
      i18n:domain="bastionledger">

<body>
 
    <div metal:fill-slot="main"
         tal:define="errors options/state/getErrors;
                     lockable python:hasattr(context, 'wl_isLocked');
                     utool context/@@plone_portal_state/portal_url;
                     isLocked python:lockable and context.wl_isLocked();
                     callable not: context/fullyPaid;
                     calls context/getCalls">

      <h1><img src="" alt="" tal:define="icon python:context.getIcon(1)" 
               tal:attributes="src string:${utool}/${icon}">&nbsp;<span tal:replace="context/Title | context/getId"/></h1>

      <p class="formHelp" tal:condition="not: callable">This share is fully paid.</p>

      <p class="formHelp" tal:condition="callable">The total callable value is 
            <span tal:replace="context/outstanding"/>.</p>   

      <form name="edit_form"  action="."  method="post"
            tal:attributes="action string:${context/getId}/${template/getId}" >


        <p tal:condition="not: calls" class="formHelp">There are no calls on this share.</p>

        <fieldset tal:condition="callable">
            <legend>Add a call</legend>
            
            <div class="field">
                <label>Percentage</label>
                <input type="text" name="percentage:float" value="" size="7"
                       tal:attributes="value context/maxCallablePercentage"/>
            </div>

            <div class="field"
                 tal:define="error errors/call_date|nothing;
                             Effective_Date request/call_date | python:DateTime();
                             inputvalue Effective_Date;
                             formname string:edit_form;
                             show_hm python: False;
                             inputname string:call_date;">

                <label>Call Date</label>
                <div metal:use-macro="here/calendar_macros/macros/calendarDatePickerBox"/>

            </div>

            <div class="field"
                 tal:define="error errors/required_date|nothing;
                             Effective_Date request/required_date | python:DateTime()+14;
                             inputvalue Effective_Date;
                             formname string:edit_form;
                             show_hm python: False;
                             inputname string:required_date;">

                <label>Required Date</label>
                <div metal:use-macro="here/calendar_macros/macros/calendarDatePickerBox"/>

            </div>

            <input type="submit" class="context" name="form.button.Call" value=" Call "/> 

        </fieldset>

        <input type="hidden" name="form.submitted" value="1" />

      </form>

      <div tal:replace="structure provider:plone.belowcontentbody">
           Document actions (print, sendto etc)
      </div>

    </div>
 
</body>
</html>
