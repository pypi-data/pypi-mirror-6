<html xmlns:tal="http://xml.zope.org/namespaces/tal"
      xmlns:metal="http://xml.zope.org/namespaces/metal"
      metal:use-macro="context/main_template/macros/master"
      i18n:domain="bastionledger">
 
<body>
  <div metal:fill-slot="main"
       tal:define="date request/date | python: DateTime();
                     utool context/@@plone_portal_state/portal_url;
                   balance python: context.balance(effective=date);
                   bms context/getBastionMerchantService | nothing">
      <h1><img src="" alt="" tal:define="icon python:context.getIcon(1)" tal:attributes="src string:${utool}/${icon}">&nbsp;<span tal:replace="context/prettyTitle"/></h1>

      <fieldset tal:condition="python: balance != 0">

        <legend>Make a Payment</legend>

        <form name="pay" action="" method="post" tal:attributes="action template/getId">

          <table summary="" border="0" cellpadding="2" cellspacing="0" width="100%">
             <tr>
               <td valign="top">

                  <div tal:condition="nocall: bms" class="field">
                     <img src="" alt="" tal:attributes="src bms/serviceIcon"/>
                  </div>

                  <div class="field"
                        tal:define="error errors/reference | nothing;"
                        tal:attributes="class python:error and 'field error' or 'field'">

                     <label>Reference</label>

                     <div class="formHelp">Any note you wish to appear on your institution's statement</div>

                     <div tal:content="error">Validation error output</div>

                     <input type="text" name="reference" size="20" value=""
                            tal:attributes="value request/reference | nothing">
                 </div>

                 <div class="field"
                      tal:define="error errors/effective_date | nothing;
                                  Effective_Date request/effective | python: DateTime();
                                  inputvalue Effective_Date;
                                  formname string:pay;
                                  show_hm python: False;
                                  inputname string:effective;"
                      tal:attributes="class python:error and 'field error' or 'field'">

                     <label>Effective Date</label>

                     <div class="formHelp">The date to post payment for (but funds will transfer immediately)</div>

                     <div tal:content="error">Validation error output</div>

                     <div metal:use-macro="here/calendar_macros/macros/calendarDatePickerBox"></div>

                 </div>

                 <div class="field"
                      tal:define="error errors/amount | nothing;"
                      tal:attributes="class python:error and 'field error' or 'field'">

                     <label>Amount</label>

                     <span class="fieldRequired" title="Required"
                           i18n:attributes="title"
                           i18n:translate="label_required">(Required)</span>

                     <div class="formHelp">The amount you wish to pay</div>

                     <div tal:content="error">Validation error output</div>

                     <input type="text" name="amount:currency" size="12" value=""
                            tal:attributes="value reqest/amount | balance">
                 </div>

               </td>

               <td valign="top"
                   tal:condition="python: balance > 0 and bms">
                   <fieldset tal:define="widget  bms/service/widget | nothing"
                             tal:condition="widget">
                      <legend>Card Details</legend>

                      <div class="bl-credit-card" tal:content="structure widget"/>
                   </fieldset>
               </td>
             </tr>
          </table>

          <div>
             <input class="context"
                   
                   type="submit"
                   name="form.button.Pay"
                   value="Pay"
                   i18n:attributes="value label_pay;" />
          </div>
          <input type="hidden" name="form.submitted" value="1" />

        </form>

      </fieldset>

  </div>
 
</body>
</html>
