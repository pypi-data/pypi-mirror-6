<dl class="portlet portletRelatedItems"
    i18n:domain="collective.portlet.relateditems">

    <dt class="portletHeader relatedHeader">
        <span class="portletTopLeft"></span>
	<span class="downArrow">&darr; </span>
        <span tal:content="view/getPortletTitle">Related Items</span>
        <span class="portletTopRight"></span>
    </dt>

    <tal:rep tal:define="related_items view/getRelatedItems;"
             tal:repeat="item related_items">
        <dd tal:define="oddrow repeat/item/odd;
                        plone_view context/@@plone;
                        obj python:item.getObject();
                        getIcon nocall:plone_view/getIcon;
                        toLocalizedTime nocall:plone_view/toLocalizedTime;
                        item_object item/getObject;"
            tal:attributes="class python:oddrow and 'portletItem even' or 'portletItem odd'">
                
		<a class="imagelink" tal:condition="item/hasMedia" href="" tal:attributes="href string:${item/getURL}/view;">
		    <tal:image replace="structure python:view.getLeadMediaTag(item, scale='crop')"></tal:image>
		</a>
		
		<a href="" tal:attributes="href string:${item/getURL}/view; title item/Description" class="relatedTitle" tal:content="item/Title"></a>

		<div id="eventBooking" tal:condition="python: item.portal_type == 'Event' or item.portal_type == 'Media Event'">  
		    <p class="dates" tal:replace="structure python: view.getFormattedEventDate(item.getObject())">
			  Thursday 14 February 2013, 7.30 to 9.30pm
		    </p>,
		    <p class="booking" tal:condition="python:not item.getObject().getBooking() and not view.isEventPast(item.getObject())">
					  <span class="price">Free</span>
				    </p>
		    
		    <p class="booking" tal:define="price python: item.getObject().getPrice()" tal:condition="python: item.getObject().getBooking() and not view.isEventPast(item.getObject())">
					  <span class="price" tal:condition="python: item.getObject().getPrice() != ''" tal:content="python: item.getObject().getPrice()">Free</span>
					  <span class="arrow" tal:condition="python: item.getObject().getLink() != ''">&rarr;</span>
					  <a href="" class="bookLink" tal:condition="python: item.getObject().getLink() != ''"
					     tal:attributes="href python:view.getEventBookingLink(item.getObject());
								  onCLick string: return Arnolfini.trackEcommerce('${item/Title}', '0.00', 'Event')">Book</a>
		    </p>
		  
	        </div>
		
		<div class="buyable" tal:condition="python: view.isBuyable(item.getObject())">
		    <div class="buyableInfo">
			  <span tal:define="price python:getattr(view.payable(item.getObject()),'price',0) or 0">&pound;<span tal:replace="price">29.00</span> &rarr; <span tal:replace="structure python:view.addPaypalButton('Buy' ,item.Title, price)"></span></span>
		    </div>
		</div>
		
		<p class="relatedDiscription"
			tal:condition="view/displayDescription"
			tal:content="python:view.trimDescription(item.Description)">Description </p>
    
		<div class="visualClear"></div>
        </dd>
    </tal:rep>

    <dd class="portletFooter"
        tal:condition="view/showRelatedItemsLink">
        <span class="portletBotomLeft"></span>
        <span>
           <a href="" tal:attributes="href view/getAllRelatedItemsLink" i18n:translate="more_url">meer ...</a>
        </span>
        <span class="portletBottomRight"></span>
    </dd>

</dl>
