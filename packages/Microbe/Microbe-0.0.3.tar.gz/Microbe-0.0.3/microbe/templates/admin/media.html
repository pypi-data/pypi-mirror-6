{% extends "admin/base.html" %}

{% block head %}
  {{ super() }}
  <script src = "{{ url_for('static', filename = 'js/jquery.js') }}"></script>
  <script src = "{{ url_for('static', filename = 'js/jquery.filedrop.js') }}"></script>
  <script>
  $(function(){

    var dropbox = $( '#dropbox' ),
    message = $( '.message', dropbox),
    regular_form = $( '#regular_form'),
    list = $( '.model' );

    // hide regular form
    // show it only if browser does not support drag and drop
    dropbox.show();
    regular_form.hide();    

    dropbox.filedrop({
        paramname: 'file',
        maxfiles: 10,
        maxfilesize: 5,
        url: "{{ url_for('admin.upload') }}",
        error: function(err, file) {
           switch(err) {
              case 'BrowserNotSupported':
                  // show regular_form
                  dropbox.hide();
                  regular_form.show();
                  break;
              case 'TooManyFiles':
                  alert("{{ _('Too much files : Maximum uploaded files at once : ') }}"  + this.maxfiles);
                  break;
              case 'FileTooLarge':
                  alert("{{ _('File too big : Maximum size (in Mo) : ') }}" + this.maxfilesize);
                  break;
              default:
                  break;
            }
        },
    });
  });
  </script>
{% endblock %}

{% block content %}
<h3>{{ _('Media') }}</h3>
<table class  ="model">
  <tr>
    <th>{{ _('Name') }}</th>
    <th><!-- action --></th>
  </tr>
  {% for file in files %}
    <tr>
      <td><a href = "{{ file.url }}">{{ file.name }}</a></td>
      <td class = "action">
        <form action = "{{ url_for('admin.delete_media', slug = file.slug) }}" method = "POST">
          <input type = "image" title = "{{ _('Delete') }}" src = "{{ url_for('admin.silkicon', filename = 'pencil_delete.png') }}">
        </form>
      </td>
    </tr>
  {% endfor %}
</table>
<div class = "pagination-centered">
  {{ pagination.links | safe }}
</div>
<div id = "dropbox">
  <span class = "message">{{ _('Drop your files here') }}</span>
</div>
<fieldset id = "regular_form">
  <form action = "{{ url_for('admin.upload') }}" enctype = "multipart/form-data" method = "POST">
    <input type="hidden" name="MAX_FILE_SIZE" value="5122">
    <input type = "file" name = "file" >
    <input class = "button radius small right" value = "{{ _('Upload') }}" type = "submit">
  </form>
</fieldset>
{% endblock %}
