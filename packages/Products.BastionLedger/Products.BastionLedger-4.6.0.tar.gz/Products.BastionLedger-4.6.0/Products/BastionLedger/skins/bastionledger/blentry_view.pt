<html xmlns:tal="http://xml.zope.org/namespaces/tal"
      xmlns:metal="http://xml.zope.org/namespaces/metal"
      metal:use-macro="context/main_template/macros/master"
      i18n:domain="bastionledger">
 
<body>
  <div metal:fill-slot="main"
       tal:define="utool context/@@plone_portal_state/portal_url">
      <h1 class="documentFirstHeading"><img src="" alt="" tal:define="icon python:context.getIcon(1)" 
               tal:attributes="src string:${utool}/${icon}">&nbsp;<span tal:replace="context/Title | context/getId"/></h1>

      <div tal:replace="structure provider:plone.belowcontenttitle"/>

         <div class="label">Status</div>
         <div class="field" tal:content="context/status"/>

         <div class="label">Effective Date</div>
         <div class="field" 
              tal:content="python: context.meta_type=='BLControlEntry' and context.lastTransactionDate() or context.effective()"/>

         <div class="label">Description</div>
         <div class="field" tal:content="context/title | string:N/a"/>

         <div class="label">Amount</div>
         <div class="field" tal:content="context/amount"/>

         <tal:block tal:define="ref context/reference" tal:condition="python: ref">
              <div class="label">Reference</div>
              <div class="field" tal:define="obj context/referenceObject">
                  <span tal:condition="python: not obj" tal:content="ref"/>
                  <a tal:condition="nocall: obj" border="0"
                     tal:attributes="href obj/absolute_url">
                     <img src="" tal:define="icon python: obj.getIcon(1)"
                          tal:attributes="src string:${utool}/${icon}"/>
                     <span tal:replace="obj/title_or_id"/>
                  </a>
               </div>
         </tal:block>

         <tal:block tal:define="ledger context/blLedger">
               <div class="label">Ledger</div>
               <div class="field">
                  <img src="" tal:define="icon python: ledger.getIcon(1)"
                              tal:attributes="src string:${utool}/${icon}"/>
                  <a href="" tal:attributes="href ledger/absolute_url"
                             tal:content="ledger/getId"/>
               </div>
         </tal:block>

         <tal:block tal:define="account context/blAccount" tal:condition="nocall: account">
               <div class="label">Account</div>
               <div class="field">
                  <img src="" tal:define="icon python: account.getIcon(1)"
                              tal:attributes="src string:${utool}/${icon}"/>
                  <a href="" tal:attributes="href account/absolute_url"
                             tal:content="account/prettyTitle"/>
               </div>
         </tal:block>

         <tal:block tal:define="txn context/blTransaction" tal:condition="nocall: txn">
               <div class="label">Transaction</div>
               <div class="field">
                  <img src="" tal:define="icon python: txn.getIcon(1)"
                              tal:attributes="src string:${utool}/${icon}"/>
                  <a href="" tal:attributes="href txn/absolute_url"
                             tal:content="txn/getId"/>
               </div>
         </tal:block>

         <tal:block tal:condition="context/fx_rate | nothing">
               <div class="label">FX Conversion Rate</div>
               <div class="field" tal:content="context/fx_rate"/>
         </tal:block>

      <div tal:replace="structure provider:plone.belowcontentbody">
           Document actions (print, sendto etc)
      </div>

  </div>
 
</body>
</html>
