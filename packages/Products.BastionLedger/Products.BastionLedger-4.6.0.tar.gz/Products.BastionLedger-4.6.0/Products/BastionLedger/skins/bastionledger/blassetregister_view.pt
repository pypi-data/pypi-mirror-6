<html xmlns="http://www.w3.org/1999/xhtml" xml:lang="en"
      lang="en"
      metal:use-macro="context/main_template/macros/master"
      i18n:domain="bastionledger">

  <metal:border fill-slot="top_slot">
    <tal:border define="dummy python:request.set('enable_border',1)" />
  </metal:border>

<body>

    <div metal:fill-slot="main" 
         tal:define="global purchase_cost python: 0;
                     global dep_to_date python: 0;
                     utool context/@@plone_portal_state/portal_url;
                     global book_value python: 0">
        <h1 class="documentFirstHeading"><img src="" alt="" tal:define="icon python:context.getIcon(1)"
                 tal:attributes="src string:${utool}/${icon}"/>&nbsp;
            <span tal:replace="context/Title | context/getId"/>
        </h1>

      <div tal:replace="structure provider:plone.belowcontenttitle"/>

        <div class="documentDescription" tal:content="structure context/Description">
            description
        </div>

        <div class="formHelp">Depreciations have been applied from <span tal:replace="context/applied_from"/>
            to <span tal:replace="context/applied_to"/></div>

        <metal:listingmacro define-macro="listing">
        <tal:foldercontents define="folderContents context/objectValues">
        <tal:listing condition="folderContents"
                     define="global getObjSize nocall:context/getObjSize;
                             global toLocalizedTime nocall:context/toLocalizedTime;">

           <table summary="" cellpadding="2" cellspacing="0" width="100%">
             <tr>
                <td/>
                <td/>
                <td><label>Description</label></td>
                <td><label>Account</label></td>
                <td><label>Purchase Date</label></td>
                <td><label>Dep. Method</label></td>
                <td align="right"><label>Purchase Cost</label></td>
                <td align="right"><label>Dep. To Date</label></td>
                <td align="right"><label>Book Value</label></td>
              </tr>
              <tr tal:repeat="obj folderContents"
                  tal:attributes="class python: repeat['obj'].odd() and 'odd' or 'even'">

                <tal:block metal:define-macro="listitem"
                    tal:define="url obj/absolute_url;
                                icon python: obj.getIcon(1);
                                global purchase_cost python: obj.purchase_price + purchase_cost;
                                global dep_to_date python: obj.depreciation_to_date + dep_to_date;
                                global book_value python: obj.bookValue() + book_value">
                   <td>
                       <a href="#" tal:attributes="href url">
                          <img src="" alt=""
                               tal:attributes="src string:${utool}/${icon};alt context/pretty_title_or_id" />
                       </a>
                   </td>
                   <td>
                       <a href="#"  tal:attributes="href url"
                          tal:content="obj/pretty_title_or_id" />
                   </td>
                   <td>
                       <span tal:content="structure python:obj.Description() and obj.Description() or '&nbsp;'"/>
                   </td>
                   <td tal:define="account obj/blAccount">
                       <a tal:condition="nocall: account"
                          tal:attributes="href account/absolute_url"
                          tal:content="account/Title"/>
                   </td>
                   <td tal:content="python: toLocalizedTime(obj.purchase_date)"/>
                   <td tal:content="obj/depreciation_method"/>
                   <td align="right" nowrap tal:content="obj/purchase_price"/>
                   <td align="right" nowrap tal:content="obj/depreciation_to_date"/>
                   <td align="right" nowrap tal:content="obj/bookValue"/>
		 </tal:block>
            </tr>
            <tr>
               <td colspan="9"><hr/></td>
            </tr>
            <tr>
               <td colspan="7" align="right" nowrap>
                  <span class="label" tal:content="purchase_cost"/>
               </td>
               <td align="right" nowrap>
                  <span class="label" tal:content="dep_to_date"/>
               </td>
               <td align="right" nowrap>
                  <span class="label" tal:content="book_value"/>
               </td>
            </tr>
          </table>

        </tal:listing>
        
        <p class="discreet"
           tal:condition="not: folderContents" i18n:translate="description_no_items_in_asset_register">
         There are currently no items in this Asset Register.
        </p>

        </tal:foldercontents>
        </metal:listingmacro>

      <div tal:replace="structure provider:plone.belowcontentbody">
           Document actions (print, sendto etc)
      </div>

    </div>

</body>
</html>
