## -*- coding: utf-8 -*-
<%inherit file="base.mako" />

<%def name="comments_for_item()" cached="True">
<%
result = data['result'] 
media_prefix = data['MEDIA_URL']
comments = data['comments']
comment_count = len(comments)
u_comment_count = data['u_comments_count']
comments.sort(lambda x, y: cmp(x.pub_date, y.pub_date))
settings = data['request'].session.settings
##comments.reverse()
%>

<div id="commentPanel" class="ui-comment-thread">
% if comments:

<h2 class="message pinkbg">Latests comments (${comment_count})</h2>
##(${u_comment_count} comment waiting in line)
% for comment in comments:
<% comment_id = comment.s.oid %>
<div class="ui-comment-hd" id="#comment${comment_id}">
<a href="#comment${comment_id}">${comment.sender_name} posted a reply on ${comment.pub_date.strftime("%Y-%m-%d")}</a>
</div>
<div class="ui-comment">
##<a href="#" title="View comment">View comment</a>
<div class="ui-comment-bd">
 ${comment.convert_to_html()}
## <%include file="blogentry_comment_footer.mako" />
</div>
</div>
% endfor
<br/>
% else:
<h2 class="message pinkbg">
No comments yet.
</h2>
% endif
</div>

## logo - blogengine
<a href="/projects/blogengine/" title="Powered by BlogEngine - A Free and Secure Blogging API for Python">
 <img src="${media_prefix}img/powered-by-blogengine.png" alt="Powered by
 BlogEngine" border="0" />
</a>
## badges
% if 'ADDTHIS_USERNAME' in settings:
<%include file="addthis_widget.mako" />
% endif
##<script src="http://ejohn.org/files/retweet.js"></script>
##<div id="retweet_button">
##<a class="retweet vert self" href=""></a>
##</div>

## retweet button Cool factor +1
<script type="text/javascript" src="http://tweetmeme.com/i/scripts/button.js">
</script>

<%include file="blogentry_comment_form.mako" />


<script src="${media_prefix}js/tm_api-2.0/src/formpreview.js"></script>
<script src="${media_prefix}js/tm_api-2.0/src/comment.js"></script>
<script>
$(function(){
    // emulates color lists..
    $('#commentPanel').find('.ui-comment-hd:odd').each(function(){
         $(this).css('background-color', '#fceccc');
         $(this).css('border-bottom', '1px solid #fc8222');
         $(this).css('border-top', '1px solid #fc8222');
         var w = $(this).next('.ui-comment-bd').eq(0).width();
         $(this).css('width', w);
    });
    // toggle on comment visibility
    $('.ui-comment-hd').bind('click', function(){
            //var yesno = confirm('Do you want a receipt?')
            //alert('you choosed:' + foo);
            $(this).next('.ui-comment').slideToggle().toggleClass('ui-slide-up');
            return false;
    });
    $('.ui-comment').each(function(){$(this).slideToggle('ui-slide up');});

//show the ajax-enabled comment form 
$.get('comment/', function(data){ return $('#'+'ui-comment-form').replaceWith(data); });

}); 
</script>
</%def>
##${headline(result, nolinks=True)}
