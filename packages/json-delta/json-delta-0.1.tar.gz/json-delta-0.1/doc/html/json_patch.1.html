
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN"
  "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">


<html xmlns="http://www.w3.org/1999/xhtml">
  <head>
    <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
    
    <title>json_patch &mdash; JSON-delta 0.1 documentation</title>
    
    <link rel="stylesheet" href="_static/pyramid.css" type="text/css" />
    <link rel="stylesheet" href="_static/pygments.css" type="text/css" />
    
    <script type="text/javascript">
      var DOCUMENTATION_OPTIONS = {
        URL_ROOT:    '',
        VERSION:     '0.1',
        COLLAPSE_INDEX: false,
        FILE_SUFFIX: '.html',
        HAS_SOURCE:  true
      };
    </script>
    <script type="text/javascript" src="_static/jquery.js"></script>
    <script type="text/javascript" src="_static/underscore.js"></script>
    <script type="text/javascript" src="_static/doctools.js"></script>
    <link rel="top" title="JSON-delta 0.1 documentation" href="index.html" />
    <link rel="next" title="json_cat" href="json_cat.1.html" />
    <link rel="prev" title="json_diff" href="json_diff.1.html" />
<link rel="stylesheet" href="http://fonts.googleapis.com/css?family=Neuton&amp;subset=latin" type="text/css" media="screen" charset="utf-8" />
<link rel="stylesheet" href="http://fonts.googleapis.com/css?family=Nobile:regular,italic,bold,bolditalic&amp;subset=latin" type="text/css" media="screen" charset="utf-8" />
<!--[if lte IE 6]>
<link rel="stylesheet" href="_static/ie6.css" type="text/css" media="screen" charset="utf-8" />
<![endif]-->

  </head>
  <body>

    <div class="related">
      <h3>Navigation</h3>
      <ul>
        <li class="right" style="margin-right: 10px">
          <a href="genindex.html" title="General Index"
             accesskey="I">index</a></li>
        <li class="right" >
          <a href="py-modindex.html" title="Python Module Index"
             >modules</a> |</li>
        <li class="right" >
          <a href="json_cat.1.html" title="json_cat"
             accesskey="N">next</a> |</li>
        <li class="right" >
          <a href="json_diff.1.html" title="json_diff"
             accesskey="P">previous</a> |</li>
        <li><a href="index.html">JSON-delta 0.1 documentation</a> &raquo;</li> 
      </ul>
    </div>  

    <div class="document">
      <div class="documentwrapper">
        <div class="bodywrapper">
          <div class="body">
            
  <div class="section" id="json-patch">
<h1>json_patch<a class="headerlink" href="#json-patch" title="Permalink to this headline">¶</a></h1>
<div class="section" id="synopsis">
<h2>Synopsis<a class="headerlink" href="#synopsis" title="Permalink to this headline">¶</a></h2>
<div class="highlight-python"><pre>json_diff [--output FILE] [--unified | --normal]
          [--strip NUM] [--reverse] [originalfile] [patchfile]
json_diff [--version]
json_diff [--help]</pre>
</div>
</div>
<div class="section" id="description">
<h2>Description<a class="headerlink" href="#description" title="Permalink to this headline">¶</a></h2>
<p>json_patch applies diffs in the format produced by
<em class="manpage">json_diff(1)</em> to JSON-serialized data structures.</p>
<p>The program attempts to mimic the interface of the <em class="manpage">patch(1)</em>
utility as far as possible, while also remaining compatible with the
script functionality of the <cite>json_delta.py</cite> library on which it
relies.  There are, therefore, at least four different ways its input
can be specified.</p>
<ol class="arabic simple">
<li>The simplest, of course, is if the filenames are both specified as
positional arguments.</li>
<li>Closely following in terms of simplicity, the inputs can be fed as
a JSON array <tt class="docutils literal"><span class="pre">[&lt;structure&gt;,</span> <span class="pre">&lt;patch&gt;]</span></tt> to standard input.</li>
<li>If only one positional argument is specified, it is read as the
filename of the original data structure, and the patch is expected
to appear on stdin.</li>
<li>Finally, if there are no positional arguments, and stdin cannot be
parsed as JSON, it can alternatively be a udiff, as output by
<tt class="docutils literal"><span class="pre">json_diff</span> <span class="pre">-u</span></tt>.  In this case, json_patch will read the name of
the file containing the structure to modify out of the first header
line of the udiff (the one beginning with <tt class="docutils literal"><span class="pre">---</span></tt>).</li>
</ol>
<p>The most salient departure from the behavior of <em class="manpage">patch(1)</em> is
that, by default, json_patch will <strong>not</strong> modify files in place.
Instead, the patched structure is written as JSON to stdout.  Frankly,
this is to save having to implement backup filename options, getting
it wrong, and having angry hackers blame me for their lost data.</p>
<p>However, the input structure is read into memory before the output
file handle is opened, so an in-place modification can be accomplished
by setting the option <tt class="docutils literal"><span class="pre">--output</span></tt> to point to <tt class="docutils literal"><span class="pre">&lt;originalfile&gt;</span></tt>.</p>
<p>Also, note that json_diff and json_patch can only manipulate a single
file at a time: even the output of <tt class="docutils literal"><span class="pre">json_diff</span> <span class="pre">-u</span></tt> is not a &#8220;unified&#8221;
diff <em>sensu stricto</em>.</p>
</div>
<div class="section" id="options">
<h2>Options<a class="headerlink" href="#options" title="Permalink to this headline">¶</a></h2>
<table class="docutils option-list" frame="void" rules="none">
<col class="option" />
<col class="description" />
<tbody valign="top">
<tr><td class="option-group" colspan="2">
<kbd><span class="option">--output <var>FILE</var></span>, <span class="option">-o <var>FILE</var></span></kbd></td>
</tr>
<tr><td>&nbsp;</td><td>Write output to FILE instead of stdout.</td></tr>
<tr><td class="option-group">
<kbd><span class="option">--unified</span>, <span class="option">-u</span></kbd></td>
<td>Force the patch to be interpreted as a udiff.</td></tr>
<tr><td class="option-group">
<kbd><span class="option">--normal</span>, <span class="option">-n</span></kbd></td>
<td>Force the patch to be interpreted as a normal
(i.e. JSON-format) patch</td></tr>
<tr><td class="option-group">
<kbd><span class="option">--reverse</span></kbd></td>
<td>Assume the patch was created with old and new
files swapped.</td></tr>
<tr><td class="option-group">
<kbd><span class="option">--string <var>NUM</var></span></kbd></td>
<td>Strip NUM leading components from file names
read out of udiff headers.</td></tr>
<tr><td class="option-group">
<kbd><span class="option">--version</span></kbd></td>
<td>Show the program&#8217;s version number and exit.</td></tr>
<tr><td class="option-group">
<kbd><span class="option">--help</span>, <span class="option">-h</span></kbd></td>
<td>Show a brief help message and exit.</td></tr>
</tbody>
</table>
</div>
<div class="section" id="udiff-format">
<h2>Udiff Format<a class="headerlink" href="#udiff-format" title="Permalink to this headline">¶</a></h2>
<p>The program has strict requirements of the format of &#8220;unified&#8221; diffs.
It works by discarding header lines, then creating two strings: one by
discarding every line beginning with <tt class="docutils literal"><span class="pre">-</span></tt>, then discarding the first
character of every remaining line, and one following the same
procedure, but with lines beginnig with <tt class="docutils literal"><span class="pre">+</span></tt> discarded.  For
json_patch to function, these strings must be interpretable according
to a superset of the JSON spec, which I will now describe:</p>
<ul class="simple">
<li>Within objects, the string <tt class="docutils literal"><span class="pre">...</span></tt> may appear in any context where a
<tt class="docutils literal"><span class="pre">&quot;property&quot;:</span> <span class="pre">&lt;object&gt;</span></tt> construction would be valid JSON.  This
indicates that one or more properties have been omitted from the
representation of the object.</li>
<li>Within arrays, the string <tt class="docutils literal"><span class="pre">...</span></tt> may appear as an array element.
It may optionally be followed by an integer in parentheses,
e.g. <tt class="docutils literal"><span class="pre">(1)</span></tt>, <tt class="docutils literal"><span class="pre">(15)</span></tt>.  This indicates that that number of elements
have been omitted from the array, or that one element has, if no
parenthesized number is present.</li>
</ul>
<p>By interpreting the strings extracted from the udiff according to this
format, json_patch arrives at a subset of each of the structures that
it expresses the delta between.  To construct its output, it then
replaces the <tt class="docutils literal"><span class="pre">...</span></tt> constructions with object properties and/or array
elements from the structure to be patched (if they are not present in
the other subset, which would indicate that the diff expects that that
node in the structure is to be deleted).</p>
</div>
</div>


          </div>
        </div>
      </div>
      <div class="sphinxsidebar">
        <div class="sphinxsidebarwrapper">
  <h3><a href="index.html">Table Of Contents</a></h3>
  <ul>
<li><a class="reference internal" href="#">json_patch</a><ul>
<li><a class="reference internal" href="#synopsis">Synopsis</a></li>
<li><a class="reference internal" href="#description">Description</a></li>
<li><a class="reference internal" href="#options">Options</a></li>
<li><a class="reference internal" href="#udiff-format">Udiff Format</a></li>
</ul>
</li>
</ul>

  <h4>Previous topic</h4>
  <p class="topless"><a href="json_diff.1.html"
                        title="previous chapter">json_diff</a></p>
  <h4>Next topic</h4>
  <p class="topless"><a href="json_cat.1.html"
                        title="next chapter">json_cat</a></p>
<div id="searchbox" style="display: none">
  <h3>Quick search</h3>
    <form class="search" action="search.html" method="get">
      <input type="text" name="q" />
      <input type="submit" value="Go" />
      <input type="hidden" name="check_keywords" value="yes" />
      <input type="hidden" name="area" value="default" />
    </form>
    <p class="searchtip" style="font-size: 90%">
    Enter search terms or a module, class or function name.
    </p>
</div>
<script type="text/javascript">$('#searchbox').show(0);</script>
        </div>
      </div>
      <div class="clearer"></div>
    </div>
    <div class="related">
      <h3>Navigation</h3>
      <ul>
        <li class="right" style="margin-right: 10px">
          <a href="genindex.html" title="General Index"
             >index</a></li>
        <li class="right" >
          <a href="py-modindex.html" title="Python Module Index"
             >modules</a> |</li>
        <li class="right" >
          <a href="json_cat.1.html" title="json_cat"
             >next</a> |</li>
        <li class="right" >
          <a href="json_diff.1.html" title="json_diff"
             >previous</a> |</li>
        <li><a href="index.html">JSON-delta 0.1 documentation</a> &raquo;</li> 
      </ul>
    </div>
    <div class="footer">
        &copy; Copyright 2014, Philip J. Roberts.
      Created using <a href="http://sphinx.pocoo.org/">Sphinx</a> 1.1.3.
    </div>
  </body>
</html>