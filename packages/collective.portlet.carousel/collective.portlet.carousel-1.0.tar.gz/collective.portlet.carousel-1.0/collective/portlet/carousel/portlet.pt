<html xmlns="http://www.w3.org/1999/xhtml"
      xmlns:tal="http://xml.zope.org/namespaces/tal"
      xmlns:i18n="http://xml.zope.org/namespaces/i18n"
      tal:omit-tag=""
      tal:define="items view/items">
  <div class="portletCarousel">

    <script type="text/javascript">
        jQuery(function($){
            var timeout;
            next = function(index, auto) {
                clearTimeout(timeout);
                x = parseInt(index);
                p = $('.portletCarousel ul li');
                i = $('.portletCarousel dl dd.carouselPortletItem');
                p.removeClass('current');
                i.removeClass('current').animate({opacity:0});
                i.hide();
                x%=i.length;
                ci = i.eq(x);
                cp = p.eq(x);
                cp.addClass('current');
                ci.addClass('current').animate({opacity:1});
                ci.show();
                if(auto) {
                    timeout = setTimeout("next("+(++x)+", " + auto + ")", 8000);
                }
            }
        });
    </script>

    <dl class="portlet">
      <dt class="portletHeader" tal:condition="not:view/omit_border">
        <span class="portletTopLeft"></span>
        <span class="tile" tal:content="view/title" />
        <span class="portletTopRight"></span>
      </dt>
      <dt tal:condition="view/omit_border"></dt>

      <tal:block repeat="item items">
         <metal:block use-macro="item/@@carousel-renderer/macros/carouselItem"/>
      </tal:block>
    </dl>
    <ul>
      <tal:block repeat="item items">
         <metal:block use-macro="item/@@carousel-renderer/macros/carouselTitle"/>
      </tal:block>
    </ul>

    <script type="text/javascript" tal:condition="view/rotate">
        jQuery(function($){
            $('.portletCarousel ul li').click(function(){
                cp = $(this);
                if (cp.is('.current'))
                    return false;
                x = cp.index('.portletCarousel ul li');
                next(x, true);
                return false;
            });

            $(document).ready(function() {
                timeout = setTimeout("next(1,true)", 8000);
            });
        })
    </script>
    <script type="text/javascript" tal:condition="not:view/rotate">
        jQuery(function($){
            $('.portletCarousel ul li').click(function(){
                cp = $(this);
                if (cp.is('.current'))
                    return false;
                x = cp.index('.portletCarousel ul li');
                next(x, false);
                return false;
            });
        })
    </script>

    <span class="showPrevious">
    </span>
  </div>
</html>
