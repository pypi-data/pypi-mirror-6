<html xmlns:tal="http://xml.zope.org/namespaces/tal"
      xmlns:metal="http://xml.zope.org/namespaces/metal"
      metal:use-macro="here/main_template/macros/master"
      i18n:domain="bastionledger">

<tal:css metal:fill-slot="css-slot">
<!-- TODO - fix styles -->
<style type="text/css">
.qq-uploader
.qq-upload-button
.qq-upload-button-hover {
}
</style>
</tal:css>

<tal:js metal:fill-slot="javascript_head_slot">
<script type="text/javascript">
<!-- reload on AJAX/upload so files appear in listing -->
  var Browser = {};
  Browser.onUploadComplete = function() {
      window.location.reload();
  }

</script>

</tal:js>

<body>
  <div metal:fill-slot="main" 
       tal:define="errors options/state/getErrors;
                   utool context/@@plone_portal_state/portal_url;
                   attachments context/attachmentValues">
      <h1><img src="" alt="" tal:define="icon python:context.getIcon(1)"
               tal:attributes="src string:${utool}/${icon}">&nbsp;
           <span tal:replace="context/getId"/> - <span tal:replace="context/Title | context/getId"/></h1>

      <form name="edit" action="" enctype="multipart/form-data" method="post" 
            tal:attributes="action template/getId"
            tal:define="b_size b_size|request/b_size|python:100;
                        b_start request/b_start | python: 0;
                        view_title view_title|request/view_title|string:;
                        Batch python:modules['Products.CMFPlone'].Batch;
                        batch batch|python: Batch(attachments,int(b_size), int(b_start), orphan=2);
                        full_view full_view|request/full_view|python:True;">

        <p class="discreet"
           tal:condition="not: batch"
           i18n:translate="description_no_attachments">
           There are no attachments.  Upload via the button below.
        </p>

        <div metal:use-macro="context/batch_macros/macros/navigation" />

        <table summary="" border="0" cellpadding="2" cellspacing="0" width="100%"
               tal:condition="attachments">
            <tr class="row">
               <td width="25">&nbsp;</td>
               <td width="16">&nbsp;</td>
               <td class="field"><strong>Created</strong></td>
               <td class="field"><strong>File Name</strong></td>
               <td>&nbsp;</td>
               <td class="field" align="right"><strong>Size</strong></td>
               <td class="field"><strong>Type</strong></td>
               <td class="field"><strong>Entered by</strong></td>
            </tr>
            <tr class="" tal:repeat="item  batch"
                tal:attributes="class python: repeat['item'].odd() and 'odd' or 'even'">
                <td class="field">
                  <input type="checkbox" name="ids:list" value="" 
                         tal:attributes="value item/getId">
                </td>
                <td class="field">
                   <img src="" alt="" tal:attributes="src string:${utool}/trombone.gif"/>
                </td>
                <td class="field" tal:content="item/bobobase_modification_time"/>
                <td class="field">
                   <a href="" target="_blank"
                      tal:attributes="href string:attachments/${item/getId}"  
                      tal:content="item/title_or_id"/>
                </td>
                <td>&nbsp;</td>
                <td class="field" align="right" tal:content="item/get_size"/>
                <td class="field" tal:content="item/getContentType"/>
                <td class="field" tal:content="item/Creator"/>
            </tr>
            <tr>
                <td  colspan="3" class="formControls">
                   <input type="submit" class="standalone" value=" Delete " 
                          name="form.button.Delete"/>
                </td>
                <td colspan="5" align="right">
                   <img src="" tal:attributes="src string:${utool}/mail_icon.png"/>
                   <input type="text" size="30" name="email"/>
                   <input type="submit" class="context" value=" Email " 
                          name="form.button.Email"/>
                </td>
            </tr>
        </table>

        <div metal:use-macro="context/batch_macros/macros/navigation" />

        <br/>
        <br/>
 
        <input type="hidden" name="form.submitted" value="1"/>
    </form>
 
    <div class="quick-uploader" tal:define="uploader_id context/attachmentUploaderId">

      <!-- uploader comes here -->
      <div id="uploader"
           class="main-uploader"
           tal:attributes="id uploader_id">
      </div>

      <!-- upload button -->
      <input type="hidden"
             id="uploadify_label_file_title"
             i18n:domain="plone"
             value="Title"
             i18n:attributes="value Title" />
      <input type="hidden"
             id="uploadify_label_file_description"
             i18n:domain="plone"
             value="Description"
             i18n:attributes="value Description" />

      <div class="uploadifybuttons">
        <input type="button"
               id="uploadify-upload"
               class="context"
               value="Upload Attachments"
               i18n:attributes="value label_upload_files"
               tal:attributes="onclick string:sendDataAndUpload_${uploader_id}()" />
        <input type="button"
               id="uploadify-clear-queue"
               class="context"
               value="Clear Queue"
               i18n:attributes="value label_clear_queue"
               tal:attributes="onclick string:clearQueue_${uploader_id}()" />
      </div>

      <script type="text/javascript" tal:on-error="string:"
              tal:content="structure python:context.attachmentJS(uploader_id)"/>
   </div>

  </div>
 
</body>
</html>
