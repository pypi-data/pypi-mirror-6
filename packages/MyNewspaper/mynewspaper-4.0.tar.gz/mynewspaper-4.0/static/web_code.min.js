var viewtype=0,view_imgs=1,wis="h/0/0",offset=DEFAULT_OFFSET=0,limit=DEFAULT_LIMIT=50,sorttype=1,num_arts=0; function mn_load(a){$("#img_sb").css("cursor","pointer").click(function(){sidebar_toggle($(this))});$("#img_refresh").css("cursor","pointer").click(function(){sidebar_load();go(wis)});$("#sidebar").css({height:$(window).height()-42+"px"});sidebar_load();go(a);$(window).keydown(function(a){if(a.altKey)return!0;var d=$("#articles .cursor:eq(0)");return 1==d.length?handle_arts_keys(a,d):handle_global_keys(a)});$(window).resize(function(){$("#sidebar").css({height:$(window).height()-42+"px"});1==$("#articles .cursor:eq(0)").length&& calc_art_titlewrap_width()})}function go(a){wis=a;"h"==wis[0]?"0"==wis[2]&&home():"t"==wis[0]?(a=parseInt(wis.substring(4)),"0"==wis[2]?summary_group(a):"1"==wis[2]&&summary_feed(a)):"a"==wis[0]||"g"==wis[0]||"f"==wis[0]?show_articles(wis):"s"==wis[0]&&search()} function handle_global_keys(a){var b=!1;if(a.ctrlKey||a.altKey)return!0;switch(a.keyCode){case 27:sidebar_toggle();break;case 72:home();break;case 70:summary_group(-1);break;case 55:search();break;case 82:sidebar_load();go(wis);break;case 85:goto_unread();break;case 222:case 191:help_keys();break;case 38:$("#contents").scrollTop($("#contents").scrollTop()-25);break;case 40:$("#contents").scrollTop($("#contents").scrollTop()+25);break;case 33:$("#contents").scrollTop($("#contents").scrollTop()-$("#contents").height()); break;case 34:$("#contents").scrollTop($("#contents").scrollTop()+$("#contents").height());break;default:b=!0}return b} function sidebar_load(a){$("#sidebar").empty();$("#sidebar").load("/ajax/sidebar_load",function(){$("#sidebar .group img.btn").click(function(){$gfeeds=$(this).parent().next();$(this).attr("src","/images/btn_"+($gfeeds.is(":hidden")?"expanded":"collapsed")+".png");$gfeeds.toggle();return!1});$("#sidebar a").click(function(){$("#sidebar .item").removeClass("selected");$(this).parent().addClass("selected")});"undefined"!==typeof a&&$('#sidebar .item > a[onclick="'+a.replace(/'/g,"\\'")+'"]').parent().addClass("selected")})} function sidebar_toggle(a){a=a||$("#img_sb");$("#sidebar").is(":hidden")?($("#sidebar").fadeIn("slow",function(){a.attr({src:"/images/sidebar_off.png"})}),$("#contents").css({marginLeft:"230px"})):($("#sidebar").fadeOut("slow",function(){$("#contents").css({marginLeft:"0px"});a.attr({src:"/images/sidebar_on.png"})}),$("#contents").css({marginLeft:"0px"}));calc_art_titlewrap_width()} function home(){wis="h/0/0";$("#sidebar .item").removeClass("selected");$("#sidebar .item:eq(0)").addClass("selected");$("#contents").empty().append(div_loading);$("#contents").load("/ajax/home")} function summary_group(a){wis="t/0/"+a;$("#sidebar .item").removeClass("selected");$("#sidebar .item:eq(1)").addClass("selected");$("#contents").empty().append(div_loading);$("#contents").load("/ajax/summary_group/"+a,function(){$("#summary_tbl tbody").sortable({containment:$("#summary_tbl"),axis:"y",cursor:"move",distance:10,placeholder:"sort-highlight",opacity:0.5,update:function(b,d){$("#summary_tbl tr").css({opacity:1});var c=[];$("#summary_tbl tbody td.name a").each(function(a,b){c[a]=b.name}); c=c.join(",");$.post("/ajax/sort_items",{gid:a,order:c}).done(function(){sidebar_load();summary_group(a)}).fail(function(){$("#contents").empty().append("<div class='error'>ERROR sorting</div>")})}}).disableSelection()})}function summary_feed(a){wis="t/1/"+a;$("#sidebar .item").removeClass("selected");$("#sidebar .item:eq(1)").addClass("selected");$("#contents").empty().append(div_loading);$("#contents").load("/ajax/summary_feed/"+a)} function search(){wis="s/0/0";$("#sidebar .item").removeClass("selected");$("#sidebar .item:eq(3)").addClass("selected");$("#contents").empty().append("<div class='message'>Search</div>")}function goto_unread(){$("#sidebar .item").removeClass("selected");$("#sidebar .item:eq(4)").addClass("selected");show_articles("a/0/1");window.scroll(0,0)} function import_opml(){var a=$("<div class='title'>Import OPML</div><form id='import_opml' action='/import_opml' method='post' enctype='multipart/form-data'><table><tbody><tr> <td>OPML file:</td><td><input type='file' name='opmlfile'/></td></tr></tbody></table><br/><span class='comment'>Select the OPML file with your feeds subscriptions</span><hr/><div class='btns'><input type='submit' name='btn_import_opml' value='Import'/><input type='submit' name='cancel' value='Cancel''/></div></form>").modaldialog().attr("title","Import OPML"); a.find("input[name='btn_import_opml']").click(function(){if(""==$("#dialog input[name='opmlfile']").val())return alert("Please, select a file"),!1;$.modaldialog.end(a);$("#contents").empty().append(div_importing);return!0})} function export_opml_db(){var a=$("<div class='title'>Export</div><form id='export' action='/export' method='post' enctype='multipart/form-data'><table><tbody><tr><td><input type='radio' name='export' value='opml' checked />&nbsp;Export subscriptions as an OPML file</td></tr><tr><td><input type='radio' name='export' value='db' />&nbsp;Export Database with all information</td></tr></tbody></table><br/><span class='comment'>Select what data you want to export</span><hr/><div class='btns'><input type='submit' name='btn_export' value='Export'/><input type='submit' name='cancel' value='Cancel''/></div></form>").modaldialog().attr("title","Export"); a.find("input[name='btn_export']").click(function(){$.modaldialog.end(a);return!0})} function clean_data(){var a=$("<div class='title'>Clean data</div><form id='export' action='/clean_data' method='post' enctype='multipart/form-data'><table><tbody><tr><td><input type='radio' name='clean' value='vacuum' checked/>&nbsp;Compact database (vacuum)</td></tr><tr><td><input type='radio' name='clean' value='cache' />&nbsp;Remove old entries from cache (> 3 months)</td></tr></tbody></table><br/><span class='comment'>Select what data you want to clean</span><hr/><div class='btns'><input type='submit' name='btn_clean' value='Clean'/><input type='submit' name='cancel' value='Cancel''/></div></form>").modaldialog().attr("title","Clean data"); a.find("input[name='btn_clean']").click(function(){if(!confirm("Are you sure?"))return $.modaldialog.end(a),!1;var b=$("#dialog input[name='clean']:checked").val();$.modaldialog.end(a);$("#contents").empty().append(div_processing);$.post("/clean/"+b).done(function(){sidebar_load();home()}).fail(function(a){$("#contents").empty().append("<div class='error'>ERROR cleaning</div>")});return!1})} function help_keys(){$("<div id='help_keys' tabindex='3'/>").load("/ajax/help_keys",function(){var a=$(this).modaldialog3().attr("title","Keyboard Shortcuts");$(this).find("a.btn_close").click(function(){$.modaldialog3.end(a)})})}function update_feeds(a){confirm("This may take a long time. Are you sure?")&&$.post("/ajax/update_feeds/"+a).done(function(){sidebar_load()}).fail(function(){$("#contents").empty().append("<div class='error'>ERROR updating feeds</div>")})} function update_feed(a){$("#contents").empty().append(div_updating);$.post("/ajax/update_feed/"+a).done(function(){sidebar_load();summary_feed(a)}).fail(function(){$("#contents").empty().append("<div class='error'>ERROR updating feed</div>")})} function group_new(){var a=$("<div class='title'>New Folder</div><form id='group_new' action='' method='post'><table><tbody><tr> <td>Name:</td><td><input type='text' name='groupname' size='30'/></td></tr></tbody></table><br/><span class='comment'>Type the name for the new folder</span><hr/><div class='btns'><input type='submit' name='group_new' value='Add folder'/><input type='submit' name='cancel' value='Cancel''/></div></form>").modaldialog().attr("title","New folder");a.find("input[name='group_new']").click(function(){var b= $("#dialog input[name='groupname']").val();if(""==b)return $.modaldialog.error(a,"Please specify a name for the folder"),!1;$.modaldialog.end(a);$("#contents").empty().append(div_processing);$.post("/ajax/group_new",{groupname:b}).done(function(){sidebar_load();summary_group(-1)}).fail(function(){$("#contents").empty().append("<div class='error'>ERROR adding new folder</div>")});return!1})} function group_edit(a,b){if(0==a)return alert("You should not rename this folder"),!1;var d=$("<div class='title'>Rename Folder</div><form id='group_edit' action='' method='post'><table><tbody><tr> <td>Name:</td><td><input type='text' name='groupname' value='"+b+"' size='30'/></td></tr></tbody></table><br/><span class='comment'>Type the new name for the folder</span><hr/><div class='btns'><input type='submit' name='group_edit' value='Rename folder'/><input type='submit' name='cancel' value='Cancel''/></div></form>").modaldialog().attr("title", "Rename folder");d.find("input[name='group_edit']").click(function(){var c=$("#dialog input[name='groupname']").val();if(c==b)return $.modaldialog.end(d),!1;if(""==c)return $.modaldialog.error(d,"Please specify the new name for the folder"),!1;$.modaldialog.end(d);$("#contents").empty().append(div_processing);$.post("/ajax/group_edit",{gid:a,groupname:c}).done(function(d){d.errmsg?(summary_group(a),alert("Error renaming folder!\n"+c+" "+d.errmsg+"."),group_edit(a,b)):(sidebar_load(),summary_group(a))}).fail(function(){$("#contents").empty().append("<div class='error'>ERROR renaming folder</div>")}); return!1})} function group_delete(a){if(0==a)return alert("You should not delete this folder"),!1;var b=$("<div class='title'>Delete Folder</div><form id='group_delete' action='' method='post'><table><tbody><tr> <td><input type='checkbox' name='move_arts' checked>&nbsp;&nbsp;Move articles to Archive folder</td></tr></tbody></table><br/><span class='comment'>Deleting the folder will remove all feeds as well</span><br/><span class='comment'>Mark above option to save the posts in the special <b>Archive</b> folder</span><hr/><div class='btns'><input type='submit' name='group_delete' value='Delete folder'/><input type='submit' name='cancel' value='Cancel''/></div></form>").modaldialog().attr("title","Delete folder"); b.find("input[name='group_delete']").click(function(){var d=$("#dialog :checkbox").get(0).checked?1:0;$.modaldialog.end(b);$("#contents").empty().append(div_processing);$.post("/ajax/group_delete",{gid:a,move_arts:d}).done(function(){sidebar_load();summary_group(-1)}).fail(function(){$("#contents").empty().append("<div class='error'>ERROR deleting folder</div>")});return!1})} function feed_new(a){var b=$("<div class='title'>Add Subscription</div><form id='feed_new' action='' method='post'><table><tbody><tr> <td>URL:</td><td><input type='text' name='feedurl' size='50'/></td></tr></tbody></table><br/><span class='comment'>Type the URL for the new feed</span><hr/><div class='btns'><input type='submit' name='feed_new' value='Add subscription'/><input type='submit' name='cancel' value='Cancel''/></div></form>").modaldialog().attr("title","Add subscription");b.find("input[name='feed_new']").click(function(){var d= $("#dialog input[name='feedurl']").val();if(""==d)return $.modaldialog.error(b,"Please specify feed URL"),!1;$.modaldialog.end(b);$("#contents").empty().append(div_processing);$.post("/ajax/feed_new",{feedurl:d,gid:a}).done(function(b){b.errmsg?(-1==a?home():summary_group(a),alert("Error adding subscription!\n"+b.errmsg+".")):(sidebar_load(),summary_feed(b.fid))}).fail(function(){$("#contents").empty().append("<div class='error'>ERROR adding new subscription</div>")});return!1})} function feed_edit(a){if(0==a)return alert("You should not edit this 'Archive' feed"),!1;$.getJSON("/ajax/get_feed_edit_info/"+a).done(function(b){var d=$("<div class='title'>Edit Feed</div><form id='feed_edit' action='' method='post'><table><tbody><tr><td>Name:</td><td><input type='text' name='feedname' value='"+b.feedname+"' size='50'/></td></tr><tr><td>URL:</td><td><input type='text' name='url' value='"+b.url+"' size='50'/></td></tr><tr><td>Home page:</td><td><input type='text' name='link' value='"+ b.link+"' size='50'/></td></tr><tr><td>Folder:</td><td><select name='group'></select></td></tr><tr><td>Enabled:</td><td><input type='checkbox' name='enabled' checked></td></tr></tbody></table><br/><span class='comment'>Type the new information for the feed</span><hr/><div class='btns'><input type='submit' name='feed_edit' value='Edit feed'/><input type='submit' name='cancel' value='Cancel''/></div></form>").modaldialog().attr("title","Edit feed");$.each(b.groups,function(a,b){$("<option value='"+ b.gid+"'>"+b.name+"</option>").appendTo("#dialog select[name='group']")});$("#dialog select[name='group'] option[value='"+b.gid+"']").attr("selected","selected");$("#dialog :checkbox").get(0).checked=1==b.state?!0:!1;d.find("input[name='feed_edit']").click(function(){var c=$("#dialog input[name='feedname']").val(),e=$("#dialog input[name='url']").val(),f=$("#dialog input[name='link']").val(),g=$("#dialog select[name='group']").val(),h=$("#dialog :checkbox").get(0).checked?1:0;if(c==b.feedname&&e== b.url&&f==b.link&&g==b.gid&&h==b.state)return $.modaldialog.end(d),!1;if(""==c)return $.modaldialog.error(d,"Please specify the new name for the feed"),!1;if(""==e)return $.modaldialog.error(d,"Please specify a URL for the feed"),!1;if(""==f)return $.modaldialog.error(d,"Please specify the home page of the feed"),!1;$.modaldialog.end(d);$("#contents").empty().append(div_processing);$.post("/ajax/feed_edit",{fid:a,feedname:c,url:e,link:f,gid:g,state:h}).done(function(b){b.errmsg?(summary_feed(a),alert("Error editing feed!\n"+ b.errmsg+"."),feed_edit(a)):(sidebar_load(),summary_feed(a))}).fail(function(){$("#contents").empty().append("<div class='error'>ERROR editing feed</div>")});return!1})}).fail(function(){$("#contents").empty().append("<div class='error'>ERROR editing feed</div>");return!1})} function feed_delete(a,b){if(0==a)return alert("You should not delete this feed"),!1;var d=$("<div class='title'>Delete Feed</div><form id='feed_delete' action='' method='post'><table><tbody><tr> <td><input type='checkbox' name='move_arts' checked>&nbsp;&nbsp;Move articles to Archive folder</td></tr></tbody></table><br/><span class='comment'>Mark above option to save the posts in the special <b>Archive</b> folder</span><hr/><div class='btns'><input type='submit' name='feed_delete' value='Delete feed'/><input type='submit' name='cancel' value='Cancel''/></div></form>").modaldialog().attr("title","Delete feed"); d.find("input[name='feed_delete']").click(function(){var c=$("#dialog :checkbox").get(0).checked?1:0;$.modaldialog.end(d);$("#contents").empty().append(div_processing);$.post("/ajax/feed_delete",{fid:a,move_arts:c}).done(function(){sidebar_load();summary_group(b)}).fail(function(){$("#contents").empty().append("<div class='error'>ERROR deleting feed</div>")});return!1})} function calc_art_titlewrap_width(){var a=$("#articles .mnhdr").width()-4-52-$("#articles .icon").width()-$("#articles .feedname").width()-$("#articles .date1").width();$("#articles .wrapper").css("width",a)} function build_actionbar(){var a=$('<div id="actionbar"><a id="btn_process" class="btn">&nbsp;Process&nbsp;</a><span class="btn_popup">Show&nbsp;[<span id="lbl_show"></span>]<img src="/images/popup.png"/><div class="popup"><ul id="popup_show"><li name="0"><img src="/images/st_all.png"/>All items</li><li name="1"><img src="/images/st_unread.png"/>Unread</li><li name="2"><img src="/images/st_starred.png"/>Starred</li><li name="3"><img src="/images/st_later.png"/>Later</li><li name="4"><img src="/images/st_archived.png"/>Archived</li></ul></div></span><span class="btn_popup">Filter by&nbsp;[<span id="lbl_filter"></span>]<img src="/images/popup.png"/><div class="popup"><ul id="popup_filter"><li name="0"><img src="/images/st_all.png"/>No filter</li><li name="1"><img src="/images/st_delete.png"/>To delete</li><li name="2"><img src="/images/st_unread.png"/>Unread</li><li name="3"><img src="/images/st_starred.png"/>Starred</li><li name="4"><img src="/images/st_later.png"/>Later</li><li name="5"><img src="/images/st_archived.png"/>Archived</li></ul></div></span><span class="btn_popup">Sort by&nbsp;[<span id="lbl_sort"></span>]<img src="/images/popup.png"/><div class="popup"><ul id="popup_sort"><li name="0">No sort</li><li name="1">Newer, then feed</li><li name="2">Older, then feed</li><li name="3">Feed, then newer</li><li name="4">Feed, then older</li></ul></div></span><span class="btns"><a id="btn_view" class="btn"><img /></a><a id="btn_imgs" class="btn"><img /></a></span><span class="btn_popup">Mark all as<img src="/images/popup.png"/><div class="popup"><ul id="popup_mark"><li name="0"><img src="/images/st_delete.png"/>To delete</li><li name="1"><img src="/images/st_unread.png"/>Unread</li><li name="2"><img src="/images/st_starred.png"/>Starred</li><li name="3"><img src="/images/st_later.png"/>Later</li><li name="4"><img src="/images/st_archived.png"/>Archived</li><li name="5"><img src="/images/st_restore.png"/>Restore state</li></ul></div></span></div>');a.find(".btn_popup").click(function(a){var d= $(this).find("div.popup");d.hide();var c=d.outerHeight();a=a.clientY+c>window.innerHeight?-c:$(this).innerHeight();d.css("top",a).toggle();$(this).addClass("btn_popup_selected")}).mouseleave(function(){$(this).removeClass("btn_popup_hover btn_popup_selected");var a=$(this).find("div.popup");a.is(":visible")&&a.fadeOut("slow")}).mouseenter(function(){$(this).addClass("btn_popup_hover")});return a}var imgs_state=["st_delete.png","st_unread.png","st_starred.png","st_later.png","st_archived.png"]; function wis2st_str(a){return["All items","Unread","Starred","Later","Archived"][a.substr(-1)]}function filter2str(a){return"No filter;To delete;Unread;Starred;Later;Archived".split(";")[a]}function sort2str(a){return["No sort","Newer then feed","Older, then feed","Feed, then newer","Feed, then older"][a]}function change_sort(a){sorttype=a} function change_view(a){viewtype=a;0==viewtype?($("#actionbar #btn_view img").attr("src","/images/btn_view_contents.png"),$("#articles .content_container").hide(),$("#articles .mnhdr1").removeClass("expanded")):($("#actionbar #btn_view img").attr("src","/images/btn_view_list.png"),$("#articles .content_container").show(),$("#articles .mnhdr1").addClass("expanded"))} function change_filter(a){if(0==a)$("#articles .art").show(),$("#articles .mnhdr .num_hidden").empty();else{var b=0;$("#articles .mnhdr1 img.icon").each(function(){parseInt($(this).attr("alt"))==a-1?$(this).parent().parent().show():($(this).parent().parent().hide(),b+=1)});$("#articles .mnhdr .num_hidden").text(" ("+b+" filtered)")}$("#actionbar #lbl_filter").text(filter2str(a));$("#articles .art").removeClass("cursor");$("#articles .art:visible:first").focus().addClass("cursor")} function change_view_imgs(a){view_imgs=a;0==view_imgs?($("#actionbar #btn_imgs img").attr("src","/images/btn_imgs_on.png"),$("#articles .content_container img").hide()):($("#actionbar #btn_imgs img").attr("src","/images/btn_imgs_off.png"),$("#articles .content_container img").show())}function toggle_art(a){a=a.toggleClass("expanded").next();a.is(":visible")?a.fadeOut("fast"):a.fadeIn("fast")} function cycle_art_state(a){var b=parseInt(a.attr("alt"));0<=b&&4>=b&&(b=4==b?0:b+1,a.attr({src:"/images/"+imgs_state[b],alt:b}))}function open_art_link(a){window.open(a.attr("href"));art_focus(a.parent().parent().parent().parent())} function process_arts(){var a=[];$("#articles .art:visible .mnhdr1 img.icon").each(function(b,d){a[b]=$(this).attr("name")+":"+$(this).attr("alt")});if(a=a.join(","))$("#contents").empty().append(div_loading),sel=$("#sidebar .selected").find("a").attr("onclick"),$.post("/ajax/process_articles",{arts:a}).done(function(){sidebar_load(sel);show_articles(wis)}).fail(function(){$("#contents").empty().append("<div class='error'>ERROR processing articles</div>")})} function load_arts(a,b,d){$("#articles .mnhdr .details .num_arts").text(a+" of "+b+" articles");a<b?($("#articles .mnhdr a.showmore").show(),$("#articles .mnhdr a.showall").show()):($("#articles .mnhdr a.showmore").hide(),$("#articles .mnhdr a.showall").hide());$arts.append(d);if(0<a){var c=$("<div class='popup_states'><ul><li><a name='0'><img src='/images/st_delete.png'/>Delete</a></li><li><a name='1'><img src='/images/st_unread.png'/>Unread</a></li><li><a name='2'><img src='/images/st_starred.png'/>Starred</a></li><li><a name='3'><img src='/images/st_later.png'/>Later</a></li><li><a name='4'><img src='/images/st_archived.png'/>Archived</a></li></ul></div>").popup().appendTo("#articles"); c.find("a").click(function(){var a=$(this).attr("name");c.data("art").find(".mnhdr1 img.icon").attr({src:"/images/"+imgs_state[a],alt:a});$.popup.off(c);return!1});calc_art_titlewrap_width();$("#articles .mnhdr1").css("cursor","pointer").unbind().click(function(){toggle_art($(this))});$("#articles .mnhdr1 img.icon").unbind().mouseenter(function(){$.popup.toggle(c,$(this));return!1});$("#articles .mnhdr1 a.title").unbind().click(function(){open_art_link($(this));return!1});$("#articles .art").unbind().click(function(){art_focus($(this))}); 0==$("#articles .cursor:eq(0)").length&&$("#articles .art:visible:first").focus().addClass("cursor")}change_view_imgs(view_imgs);change_view(viewtype)} function show_articles(a){wis=a;offset=DEFAULT_OFFSET;limit=DEFAULT_LIMIT;$("#contents").empty().append(div_loading);$.getJSON("/ajax/articles/"+wis+"/"+sorttype+"/"+offset+"/"+limit).done(function(a){$("#contents").empty().append(build_actionbar());$("#actionbar #lbl_show").text(wis2st_str(wis));$("#actionbar #popup_show li").click(function(){var a=$(this).attr("name");show_articles(wis.slice(0,-1)+a)});$("#actionbar #lbl_filter").text(filter2str(0));$("#actionbar #popup_filter li").click(function(){change_filter(parseInt($(this).attr("name")))}); $("#actionbar #lbl_sort").text(sort2str(sorttype));$("#actionbar #popup_sort li").click(function(){change_sort($(this).attr("name"));show_articles(wis)});$("#actionbar #btn_view").click(function(){change_view(0==viewtype?1:0)});$("#actionbar #btn_imgs").click(function(){change_view_imgs(0==view_imgs?1:0)});$("#actionbar #popup_mark li").click(function(){var a=parseInt($(this).attr("name"));0<=a&&5>a?$("#articles .art:visible .mnhdr1 img.icon").each(function(){$(this).attr({src:"/images/"+imgs_state[a], alt:a})}):show_articles(wis)});$("#actionbar #btn_process").click(function(){process_arts(wis)});num_arts=a.num_query;$arts=$("<div id='articles'>").appendTo("#contents");$arts.append("<div class='mnhdr'>"+a.title+"<span class='details'><span class='num_arts'/><span class='num_hidden'/><a class='showmore'>load more</a><a class='showall'>load all</a></span></div>");$("#articles .mnhdr a.showmore").click(function(){load_more_arts()});$("#articles .mnhdr a.showall").click(function(){load_all_arts()}); load_arts(a.num_query,a.num_total,a.arts)}).fail(function(){$("#contents").empty().append("<div class='error'>ERROR loading articles</div>")})}function art_focus(a){$("#articles .art").removeClass("cursor");a.focus().addClass("cursor");(a.position().top+a.height()>$("#articles").height()||0>a.position().top)&&$("#articles").scrollTop(a.get(0).offsetTop);a.find(".mnhdr1 img.icon").attr("name")==$("#articles .art:visible:first .mnhdr1 img.icon").attr("name")&&$("#articles").scrollTop(0)} function next_visible_art(a){for(;!a.is(":last-child");)if(a=a.next(),a.is(":visible"))return a}function prev_visible_art(a){for(;!a.prev().is($("#articles .mnhdr"));)if(a=a.prev(),a.is(":visible"))return a} function load_more_arts(){var a=$("").modaldialog2().attr("title","Loading articles");offset+=limit;$.getJSON("/ajax/articles/"+wis+"/"+sorttype+"/"+offset+"/"+limit).done(function(b){num_arts+=b.num_query;load_arts(num_arts,b.num_total,b.arts);$.modaldialog2.end(a)}).fail(function(){$("#contents").empty().append("<div class='error'>ERROR loading articles</div>")})} function load_all_arts(){var a=$("").modaldialog2().attr("title","Loading articles");offset=limit=0;$.getJSON("/ajax/articles/"+wis+"/"+sorttype+"/"+offset+"/"+limit).done(function(b){var d=$(".art").index($(".cursor"));$(".art").remove();num_arts=b.num_total;load_arts(num_arts,b.num_total,b.arts);art_focus($(".art:eq("+d+")"));$.modaldialog2.end(a)}).fail(function(){$("#contents").empty().append("<div class='error'>ERROR loading articles</div>")})} function handle_arts_keys(a,b){var d=!1;if(a.ctrlKey)return!0;switch(a.keyCode||a.altKey){case 27:sidebar_toggle();break;case 72:home();break;case 70:summary_group(-1);break;case 55:search();break;case 82:sidebar_load();go(wis);break;case 85:goto_unread();break;case 222:case 191:help_keys();break;case 74:var c=next_visible_art(b);void 0!=c&&art_focus(c);break;case 32:for(var e=c=b;;){c=next_visible_art(c);if(void 0==c||c.position().top+c.height()>$("#articles").height())break;e=c}void 0!=c?art_focus(c): void 0!=e&&art_focus(e);break;case 75:c=prev_visible_art(b);void 0!=c&&art_focus(c);break;case 8:e=$("#articles").scrollTop()-$("#articles").height();for(c=$("#articles .art:visible:first");!(void 0==c||c.get(0).offsetTop>e);)c=next_visible_art(c);void 0!=c&&art_focus(c);break;case 78:c=next_visible_art(b);void 0!=c&&(b.find(".mnhdr1").removeClass("expanded").next().hide(),c.find(".mnhdr1").addClass("expanded").next().show(),art_focus(c));break;case 80:c=prev_visible_art(b);void 0!=c&&(b.find(".mnhdr1").removeClass("expanded").next().hide(), c.find(".mnhdr1").addClass("expanded").next().show(),art_focus(c));break;case 36:art_focus($("#articles .art:visible:first"));$("#articles").scrollTop(0);break;case 35:art_focus($("#articles .art:visible:last"));window.scroll(0,window.scrollMaxY);break;case 38:$("#articles").scrollTop($("#articles").scrollTop()-25);break;case 40:$("#articles").scrollTop($("#articles").scrollTop()+25);break;case 33:$("#articles").scrollTop($("#articles").scrollTop()-$("#articles").height());break;case 34:$("#articles").scrollTop($("#articles").scrollTop()+ $("#articles").height());break;case 49:change_view(1);break;case 50:change_view(0);break;case 73:change_view_imgs(0==view_imgs?1:0);break;case 13:case 86:toggle_art(b.find(".mnhdr1"));art_focus(b);break;case 83:cycle_art_state(b.find(".mnhdr1 img.icon"));break;case 79:open_art_link(b.find(".mnhdr1 a.title"));break;case 65:a.shiftKey&&confirm("Process articles?")&&process_arts();break;case 77:a.shiftKey&&$("#articles .mnhdr a.showmore").is(":visible")&&load_more_arts();break;case 84:a.shiftKey&&$("#articles .mnhdr a.showall").is(":visible")&& load_all_arts();break;default:d=!0}return d}var div_loading="<div class='loading'><div>Loading...</div><br/><img src='/images/loading.gif' /></div>",div_updating="<div class='loading'><div>Updating feeds...</div><br/><img src='/images/loading.gif' /></div>",div_processing="<div class='loading'><div>Processing...</div><br/><img src='/images/loading.gif' /></div>",div_importing="<div class='loading'><div>Importing...</div><br/><img src='/images/loading.gif' /></div>"; (function(a){a.fn.modaldialog=function(){var b=a(document).height(),d=a(window).height(),c=a(window).width(),e=a("#dialog").empty(),f=a("#overlay").css({top:0,left:0,height:b,width:c,opacity:0}).show().animate({opacity:0.8});a(this).appendTo(e);a("#page").css({opacity:0.4});var b=e.width(),g=e.height(),d=d/2-Math.floor(g/2)+"px",c=c/2-Math.floor(b/2)+"px";e.fadeIn().css("top",d).css("left",c).keydown(function(a){a.stopPropagation()}).find("input:first").focus();e.find("input[name='cancel']").click(function(){e.fadeOut(); f.hide();a("#page").css({opacity:1});return!1});return e};a.modaldialog=a.modaldialog||{};a.modaldialog.error=function(b,d){b.find("div.dlgerr").remove();a("<div class='dlgerr'><img src='/images/error.png'/>&nbsp;&nbsp;"+d+"</div>").insertBefore(b.find("form table")).effect("highlight",{color:"#eeeecc"},1E3);b.find("input:first").focus()};a.modaldialog.end=function(b){b.fadeOut();a("#overlay").hide();a("#page").css({opacity:1})};a.fn.modaldialog2=function(){var b=a(document).height(),d=a(window).height(), c=a(window).width(),e=a("#dlg_loading").empty();a("#overlay").css({top:0,left:0,height:b,width:c,opacity:0.8}).show();a(this).appendTo(e);a("#page").css({opacity:0.4});var f=e.width(),b=e.height(),c=c/2-Math.floor(f/2)+"px";e.css("top",d/2-Math.floor(b/2)+"px").css("left",c).fadeIn().focus().keydown(function(a){a.stopPropagation()});return e};a.modaldialog2=a.modaldialog2||{};a.modaldialog2.end=function(b){b.fadeOut();a("#overlay").hide();a("#page").css({opacity:1})};a.fn.modaldialog3=function(){var b= a(document).height(),d=a(window).height(),c=a(window).width(),e=a("#dlg_help").empty();a("#overlay").css({top:0,left:0,height:b,width:c,opacity:0.8}).show();a(this).appendTo(e);a("#page").css({opacity:0.4});var f=e.width(),b=e.height(),c=c/2-Math.floor(f/2)+"px";e.css("top",d/2-Math.floor(b/2)+"px").css("left",c).fadeIn().focus().keydown(function(b){27==b.keyCode&&a.modaldialog3.end(a(this));b.stopPropagation()});return e};a.modaldialog3=a.modaldialog3||{};a.modaldialog3.end=function(b){b.fadeOut(); a("#overlay").hide();a("#page").css({opacity:1})};a.fn.popup=function(){a(this).mouseleave(function(){a.popup.off(a(this))});return a(this)};a.popup=a.popup||{};a.popup.toggle=function(b,d){b.is(":visible")?a.popup.off(b):a.popup.on(b,d)};a.popup.on=function(b,d){b.data("art",d.parent().parent());var c=d.position().left-8,e=d.position().top+d.outerHeight()+5,e=e+b.outerHeight()>a("#articles").height()?a("#articles").scrollTop()+a("#articles").height()-b.outerHeight()+8:e+a("#articles").scrollTop(); b.css({left:c,top:e}).fadeIn("fast")};a.popup.off=function(a){a.data("art",null);a.fadeOut()}})(jQuery);
