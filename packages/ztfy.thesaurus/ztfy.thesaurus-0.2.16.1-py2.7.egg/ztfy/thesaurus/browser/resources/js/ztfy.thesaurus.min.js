(function(a){if(typeof(a.ZTFY)=="undefined"){a.ZTFY={}}a.ZTFY.thesaurus={remove:function(c,d){jConfirm(a.ZTFY.I18n.CONFIRM_REMOVE,a.ZTFY.I18n.CONFIRM,function(f){if(f){var e={oid:c};a.ZTFY.ajax.post(window.location.href+"/@@ajax/ajaxRemove",e,function(){window.location.reload()},function(i,g,h){jAlert(i.responseText,a.ZTFY.I18n.ERROR_OCCURED,window.location.reload)})}})},tree:{showHideExtract:function(d){var d=this;var c=a(d).data("ztfy-extract-name");if(a(d).hasClass("hide")){a('DIV.tree SPAN.square[data-ztfy-extract-name="'+c+'"]').css("visibility","visible").each(function(){if(a(this).hasClass("used")){a(this).css("background-color","#"+a(d).data("ztfy-extract-color")).click(function(){a.ZTFY.thesaurus.tree.switchExtract(this)})}else{var e=a(this).parents("DIV").get(2);if(a(e).hasClass("form")||a('SPAN[data-ztfy-extract-name="'+c+'"]:first',e).hasClass("used")){a(this).css("background-color","white").click(function(){a.ZTFY.thesaurus.tree.switchExtract(this)})}else{a(this).css("background-color","silver")}}});a(d).css("background-image","url('/--static--/ztfy.thesaurus/img/visible.gif')").removeClass("hide")}else{a('DIV.tree SPAN.square[data-ztfy-extract-name="'+c+'"]').css("visibility","hidden").unbind("click");a(d).css("background-image","url('/--static--/ztfy.thesaurus/img/hidden.gif')").addClass("hide")}},_displayTermSubnodes:function(i,d){var c=a.data(a.ZTFY.thesaurus.tree,"source");if(c){c=c[i]}else{c=a("A:econtains("+i.replace("&#039;","'")+")").siblings("IMG.plminus")}var p=a(c).closest("DIV").get(0);var q=a(c).closest("DIV.tree");var o=q.data("ztfy-tree-details")!="off";var e=a("DIV.subnodes",a(c).closest("DIV").get(0));e.empty();for(var k in d){var g=d[k];var m=a("<div></div>");a("<img />").addClass("plminus").attr("src",g.expand?"/--static--/ztfy.thesaurus/img/plus.png":"/--static--/ztfy.thesaurus/img/lline.png").click(function(){a.ZTFY.thesaurus.tree.expand(this)}).appendTo(m);a("<a></a>").addClass(o?"label":"").addClass(g.cssClass).click(function(){a.ZTFY.thesaurus.tree.openTerm(this)}).html(g.label).appendTo(m);a("<span> </span>").appendTo(m);for(var h in g.extensions){var n=g.extensions[h];a("<img />").addClass("extension").attr("src",n.icon).data("ztfy-view",n.view).click(function(){a.ZTFY.thesaurus.tree.openExtension(this)}).appendTo(m)}g.extracts.reverse();for(var h in g.extracts){var j=g.extracts[h];var f=a('DIV.extract SPAN.showhide[data-ztfy-extract-name="'+j.name+'"]');var l=a("<span></span>").addClass("square").addClass(j.used?"used":null).attr("title",j.title).attr("data-ztfy-extract-name",j.name);if(a(f).hasClass("hide")){l.css("visibility","hidden")}else{if(a('SPAN[data-ztfy-extract-name="'+j.name+'"]:first',p).hasClass("used")){l.css("background-color",j.used?"#"+j.color:"white");l.click(function(){a.ZTFY.thesaurus.tree.switchExtract(this)})}else{l.css("background-color","silver")}}l.appendTo(m)}a("<div></div>").addClass("subnodes").appendTo(m);m.appendTo(e);if(g.subnodes){a.ZTFY.thesaurus.tree._displayTermSubnodes(g.label,g.subnodes)}}a(c).attr("src","/--static--/ztfy.thesaurus/img/minus.png")},expand:function(f){if(a(f).attr("src")=="/--static--/ztfy.thesaurus/img/plus.png"){a(f).attr("src","/--static--/ztfy.thesaurus/img/loader.gif");var d=a(f).closest("DIV.tree").data("ztfy-base");var c=a("A",a(f).closest("DIV").get(0)).text();var e=a.data(a.ZTFY.thesaurus.tree,"source")||new Array();e[c]=f;a.data(a.ZTFY.thesaurus.tree,"source",e);a.ZTFY.ajax.post(d+"/@@terms.html/@@ajax/getNodes",{term:c},a.ZTFY.thesaurus.tree._expandCallback)}else{a.ZTFY.thesaurus.tree.collapse(f)}},_expandCallback:function(c,d){if(d=="success"){a.ZTFY.thesaurus.tree._displayTermSubnodes(c.term,c.nodes);a.removeData(a.ZTFY.thesaurus.tree,"source")}},collapse:function(c){a("DIV.subnodes",a(c).closest("DIV").get(0)).empty();a(c).attr("src","/--static--/ztfy.thesaurus/img/plus.png")},openTerm:function(e){var c=a(e).closest("DIV.tree");if(c.data("ztfy-tree-details")=="off"){return}var d=a(e).text().replace(/ /g,"%20").replace(/&/g,"%26");if(a.browser.msie){d=a.UTF8.encode(d)}a.ZTFY.dialog.open("++terms++/"+d+"/@@properties.html")},openTermFromSearch:function(d){if(d instanceof a.Event){var d=d.srcElement||d.target}var c=a(d).text().replace(/ /g,"%20").replace(/&/g,"%26");if(c){if(a.browser.msie){c=a.UTF8.encode(c)}a.ZTFY.dialog.open("++terms++/"+c+"/@@properties.html")}},findTerm:function(e){if(e instanceof a.Event){var e=e.srcElement||e.target}var d=a(e).siblings("INPUT").val();if(d){if(a.browser.msie){d=a.UTF8.encode(d)}var c=a(e).parents("FIELDSET.search").siblings("DIV.tree").data("ztfy-base");a.ZTFY.ajax.post(c+"/@@terms.html/@@ajax/getParentNodes",{term:d},a.ZTFY.thesaurus.tree._findCallback)}},_findCallback:function(c,d){if(d=="success"){var d=c.status;if(d=="OK"){a.ZTFY.thesaurus.tree._displayTermSubnodes(c.parent,c.nodes);var e=a("A:econtains("+c.term.replace("&#039;","'")+")","DIV.tree");a("html,body").animate({scrollTop:e.offset().top-100},1000);e.css("background-color","yellow").on("mouseover",function(){a(this).animate({"background-color":a.Color("white")},2000)})}}},openExtension:function(d){var c=a(d).data("ztfy-view").replace("/ /g","%20");if(a.browser.msie){c=a.UTF8.encode(c)}a.ZTFY.dialog.open(c)},reloadTerm:function(d){a.ZTFY.dialog.close();var e=d.source;var c=a("IMG.plminus:first",a("A:econtains("+e.replace("&#039;","'")+")").closest("DIV"));a.ZTFY.thesaurus.tree.collapse(c);a.ZTFY.thesaurus.tree.expand(c)},switchExtract:function(f){if(f instanceof a.Event){a.ZTFY.skin.stopEvent(f);var f=f.srcElement||f.target}var e=a(f).data("ztfy-extract-name");var d=a('DIV.extract SPAN.showhide[data-ztfy-extract-name="'+e+'"]');if(d.data("ztfy-enabled")==false){return}var c=a("A.label",a(f).closest("DIV")).get(0);if(a.ZTFY.rgb2hex(a(f).css("background-color"))=="#ffffff"){a.ZTFY.thesaurus.tree._switchExtract(c,e)}else{if(a(c).closest("DIV").children("IMG").attr("src").endsWith("/lline.png")){a.ZTFY.thesaurus.tree._switchExtract(c,e)}else{jConfirm(a.ZTFY.thesaurus.I18n.CONFIRM_UNSELECT_WITH_CHILD,a.ZTFY.I18n.CONFIRM,function(g){if(g){a.ZTFY.thesaurus.tree._switchExtract(c,e)}})}}},_switchExtract:function(c,e){var d=a(c).text();a.ZTFY.ajax.post("@@terms.html/@@ajax/switchExtract",{term:d,extract:e},a.ZTFY.thesaurus.tree._switchExtractCallback)},_switchExtractCallback:function(c,d){if(d=="success"){var f=c.term;var e=a("A.label:withtext("+f+")");var g=a(e).closest("DIV").get(0);if(c.used){a("DIV.subnodes:first > DIV",g).children('SPAN[data-ztfy-extract-name="'+c.extract+'"]',g).css("background-color","white").unbind("click").click(function(){a.ZTFY.thesaurus.tree.switchExtract(this)});a('SPAN[data-ztfy-extract-name="'+c.extract+'"]:first',g).addClass("used").css("background-color","#"+c.color)}else{a('SPAN[data-ztfy-extract-name="'+c.extract+'"]',g).removeClass("used").css("background-color","silver").off("click");a('SPAN[data-ztfy-extract-name="'+c.extract+'"]:first',g).css("background-color","white").on("click",function(){a.ZTFY.thesaurus.tree.switchExtract(this)})}}},openSelector:function(d,c){a.ZTFY.dialog.open(d,function(g,f,e){a.ZTFY.dialog.openCallback(g,f,e);var h=a("FORM",a.ZTFY.dialog.getCurrent());h.data("thesaurus-selector-source",c);var i=a('INPUT[name="'+c+'"]');a(i.val().split("|")).each(function(){a('INPUT[type="checkbox"][value="'+this+'"]').attr("checked",true)})})},openSelectorAction:function(d){var f=a(d).data("thesaurus-selector-source");var g=a('INPUT[name="'+f+'"]');var e=a("DIV.jquery-multiselect",g.closest("DIV.widget"));var c=a("A.bit-input INPUT",e).data("multiselect");a(g.val().split("|")).each(function(){c.remove([String(this),String(this)])});a('INPUT[type="checkbox"]:checked',d).each(function(){c.add([a(this).val(),a(this).val()])});a.ZTFY.dialog.close()}},findTerms:function(g,d,f){var c;var e={url:a.ZTFY.ajax.getAddr(),type:"POST",method:"findTerms",async:false,params:{query:g,thesaurus_name:d||"",extract_name:f||""},success:function(i,h){c=i.result},error:function(j,h,i){jAlert(j.responseText,"Error !",window.location.reload)}};a.jsonRpc(e);return c},findTermsWithLabel:function(g,d,f){var c;var e={url:a.ZTFY.ajax.getAddr(),type:"POST",method:"findTermsWithLabel",async:false,params:{query:g,thesaurus_name:d||"",extract_name:f||""},success:function(i,h){c=i.result},error:function(j,h,i){jAlert(j.responseText,"Error !",window.location.reload)}};a.jsonRpc(e);return c},download:function(c){a.ZTFY.form.check(function(){a.ZTFY.thesaurus._download(c)});return false},_download:function(d){var e=a(d).attr("action");var f=e+"/@@ajax/ajaxDownload";var c=a("<iframe></iframe>").hide().attr("name","downloadFrame").appendTo(a(d));a(d).attr("action",f).attr("target","downloadFrame").ajaxSubmit({iframe:true,iframeTarget:c,success:function(){a.ZTFY.dialog.close()}});a(d).attr("action",e)}};a.ZTFY.thesaurus.I18n={CONFIRM_UNSELECT_WITH_CHILD:"Removing this term from this extract will also remove all it's specific terms and their synonyms. Are you sure?"};var b=a("HTML").attr("lang")||a("HTML").attr("xml:lang");if(b&&(b!="en")){a.ZTFY.getScript("/--static--/ztfy.thesaurus/js/i18n/"+b+".js")}a(document).ready(function(){a("DIV.extract").on("click","SPAN.showhide",a.ZTFY.thesaurus.tree.showHideExtract);a("DIV.tree SPAN.square").click(a.ZTFY.thesaurus.tree.switchExtract);a("FIELDSET.search").on("click","A.bit-box",a.ZTFY.thesaurus.tree.openTermFromSearch)})})(jQuery);