

<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN"
  "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">


<html xmlns="http://www.w3.org/1999/xhtml">
  <head>
    <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
    
    <title>CSS Tools &mdash; TDI 0.9.9.8 documentation</title>
    
    <link rel="stylesheet" href="_static/default.css" type="text/css" />
    <link rel="stylesheet" href="_static/pygments.css" type="text/css" />
    <link rel="stylesheet" href="_static/tdi.css" type="text/css" />
    
    <script type="text/javascript">
      var DOCUMENTATION_OPTIONS = {
        URL_ROOT:    '',
        VERSION:     '0.9.9.8',
        COLLAPSE_INDEX: false,
        FILE_SUFFIX: '.html',
        HAS_SOURCE:  true
      };
    </script>
    <script type="text/javascript" src="_static/jquery.js"></script>
    <script type="text/javascript" src="_static/underscore.js"></script>
    <script type="text/javascript" src="_static/doctools.js"></script>
    <link rel="top" title="TDI 0.9.9.8 documentation" href="index.html" />
    <link rel="up" title="Documentation Topics" href="topics.html" />
    <link rel="next" title="Template Tools" href="template_tools.html" />
    <link rel="prev" title="Javascript Tools" href="javascript_tools.html" /> 
  </head>
  <body>
    <div class="related">
      <h3>Navigation</h3>
      <ul>
        <li class="right" style="margin-right: 10px">
          <a href="template_tools.html" title="Template Tools"
             accesskey="N">next</a></li>
        <li class="right" >
          <a href="javascript_tools.html" title="Javascript Tools"
             accesskey="P">previous</a> |</li>
        <li><a href="index.html">TDI 0.9.9.8 documentation</a> &raquo;</li>
          <li><a href="topics.html" accesskey="U">Documentation Topics</a> &raquo;</li> 
      </ul>
    </div>  

    <div class="document">
      <div class="documentwrapper">
        <div class="bodywrapper">
          <div class="body">
            
  <div class="section" id="css-tools">
<h1>CSS Tools<a class="headerlink" href="#css-tools" title="Permalink to this headline">¶</a></h1>
<p>The tools described here can be found in the <tt class="docutils literal"><a class="reference external" href="../apidoc/tdi.tools.css-module.html"><span class="pre">→&nbsp;tdi.tools.css</span></a></tt>
module. The CSS tools mainly provide a minifier for now.</p>
<div class="section" id="minifying-css">
<h2>Minifying CSS<a class="headerlink" href="#minifying-css" title="Permalink to this headline">¶</a></h2>
<p>Minifying reduces the size of a document by removing redundant or
irrelevant content. Typically this includes whitespace and comments.
Some minifiers also try semantic reduction by collapsing rules,
modifying color notations and so on.</p>
<p><em class="tdi">TDI</em> ships with the latest version of the <a class="reference external" href="http://opensource.perlig.de/rcssmin/">rCSSmin</a> minifier, which only
removes spaces, comments and finishing semicolons &#8211; but does that very fast.</p>
<p>There are two use cases here:</p>
<ol class="arabic simple">
<li>Minify style blocks within HTML templates during the loading phase</li>
<li>Minify some standalone piece of CSS</li>
</ol>
<p>The first case is handled by hooking the
<tt class="docutils literal"><a class="reference external" href="../apidoc/tdi.tools.css-module.html#MinifyFilter"><span class="pre">→&nbsp;tdi.tools.css.MinifyFilter</span></a></tt> into the template loader. See the
<a class="reference internal" href="filtering.html"><em>filters documentation</em></a> for a description how to do that.</p>
<p>For the second case there&#8217;s the <tt class="docutils literal"><a class="reference external" href="../apidoc/tdi.tools.css-module.html#minify"><span class="pre">→&nbsp;tdi.tools.css.minify</span></a></tt> function:</p>
<div class="highlight-python"><div class="highlight"><pre><span class="kn">from</span> <span class="nn">tdi.tools</span> <span class="kn">import</span> <span class="n">css</span>

<span class="k">print</span> <span class="n">css</span><span class="o">.</span><span class="n">minify</span><span class="p">(</span><span class="s">u&quot;&quot;&quot;</span>
<span class="s">fieldset p {</span>
<span class="s">    margin: 0.5em;</span>
<span class="s">}</span>
<span class="s">fieldset p span {</span>
<span class="s">    float: right;</span>
<span class="s">    display: inline-block;</span>
<span class="s">    font-size: 0.8em;</span>
<span class="s">}</span>
<span class="s">&quot;&quot;&quot;</span><span class="o">.</span><span class="n">lstrip</span><span class="p">())</span>
</pre></div>
</div>
<div class="highlight-css"><div class="highlight"><pre><span class="nt">fieldset</span> <span class="nt">p</span><span class="p">{</span><span class="k">margin</span><span class="o">:</span><span class="m">0.5em</span><span class="p">}</span><span class="nt">fieldset</span> <span class="nt">p</span> <span class="nt">span</span><span class="p">{</span><span class="k">float</span><span class="o">:</span><span class="k">right</span><span class="p">;</span><span class="k">display</span><span class="o">:</span><span class="k">inline</span><span class="o">-</span><span class="k">block</span><span class="p">;</span><span class="k">font-size</span><span class="o">:</span><span class="m">0.8em</span><span class="p">}</span>
</pre></div>
</div>
</div>
<div class="section" id="masking-style-blocks">
<h2>Masking Style Blocks<a class="headerlink" href="#masking-style-blocks" title="Permalink to this headline">¶</a></h2>
<p>HTML has a long history of adding new elements all the time.
Conceptually this is possible, because browsers simply ignore the
tags of unknown elements and apply no semantics. That&#8217;s forward
compatibility. Now if you place something inside these new elements,
which is not HTML content, you get a backwards compatibility problem.</p>
<div class="section" id="cdata-and-cleanup">
<span id="css-cdata"></span><h3>cdata and cleanup<a class="headerlink" href="#cdata-and-cleanup" title="Permalink to this headline">¶</a></h3>
<p>Style elements (and <a class="reference internal" href="javascript_tools.html#javascript-cdata"><em>script elements</em></a> for that
matter) suffer from this problem since they were invented. The first
solution was to enclose them with comment markers, but add special rules
for browsers to accept these markers as part of the content:</p>
<div class="highlight-html"><div class="highlight"><pre><span class="nt">&lt;style&gt;</span><span class="o">&lt;!</span><span class="nt">--</span>
   <span class="nt">body</span> <span class="p">{</span><span class="k">background-color</span><span class="o">:</span> <span class="m">#fff</span><span class="p">;</span> <span class="k">color</span><span class="o">:</span> <span class="m">#000</span><span class="p">;}</span>
<span class="nt">--</span><span class="o">&gt;</span><span class="nt">&lt;/style&gt;</span>
</pre></div>
</div>
<p>Then XHTML was invented. The XML parser cannot be tricked into such
special rules. It would start throwing away the comment again, so people
gave up backwards compliance and wrote:</p>
<div class="highlight-html"><div class="highlight"><pre><span class="nt">&lt;style&gt;</span><span class="o">&lt;![</span><span class="nt">CDATA</span><span class="o">[</span>
   <span class="nt">body</span> <span class="p">{</span><span class="k">background-color</span><span class="o">:</span> <span class="m">#fff</span><span class="p">;</span> <span class="k">color</span><span class="o">:</span> <span class="m">#000</span><span class="p">;}</span>
<span class="o">]]&gt;</span><span class="nt">&lt;/style&gt;</span>
</pre></div>
</div>
<p>and then, to be compatible with HTML again:</p>
<div class="highlight-html"><div class="highlight"><pre><span class="nt">&lt;style&gt;</span><span class="c">/*&lt;![CDATA[*/</span>
   <span class="nt">body</span> <span class="p">{</span><span class="k">background-color</span><span class="o">:</span> <span class="m">#fff</span><span class="p">;</span> <span class="k">color</span><span class="o">:</span> <span class="m">#000</span><span class="p">;}</span>
<span class="c">/*]]&gt;*/</span><span class="nt">&lt;/style&gt;</span>
</pre></div>
</div>
<p>Then someone finally figured out <a class="footnote-reference" href="#id2" id="id1">[1]</a> a mix of CDATA and comments
completely compatible with all HTML/TagSoup parsers, and it looks like
this:</p>
<table class="docutils footnote" frame="void" id="id2" rules="none">
<colgroup><col class="label" /><col /></colgroup>
<tbody valign="top">
<tr><td class="label"><a class="fn-backref" href="#id1">[1]</a></td><td><a class="reference external" href="http://lists.w3.org/Archives/Public/www-html/2002Apr/0053.html">http://lists.w3.org/Archives/Public/www-html/2002Apr/0053.html</a></td></tr>
</tbody>
</table>
<div class="highlight-html"><div class="highlight"><pre><span class="nt">&lt;style&gt;</span><span class="o">&lt;!</span><span class="nt">--</span><span class="c">/*--&gt;&lt;![CDATA[/*&gt;&lt;!--*/</span>
  <span class="nt">body</span> <span class="p">{</span><span class="k">background-color</span><span class="o">:</span> <span class="m">#fff</span><span class="p">;</span> <span class="k">color</span><span class="o">:</span> <span class="m">#000</span><span class="p">;}</span>
<span class="c">/*]]&gt;*/</span><span class="nt">--</span><span class="o">&gt;</span><span class="nt">&lt;/style&gt;</span>
</pre></div>
</div>
<p>This is funny stuff, but you wouldn&#8217;t want to write it all the time. You
should consider applying that, however, because browsers are typically
not the <em>only</em> applications parsing your HTML.</p>
<p>The functions <tt class="docutils literal"><a class="reference external" href="../apidoc/tdi.tools.css-module.html#cdata"><span class="pre">→&nbsp;css.cdata</span></a></tt> and
<tt class="docutils literal"><a class="reference external" href="../apidoc/tdi.tools.css-module.html#cleanup"><span class="pre">→&nbsp;css.cleanup</span></a></tt> can do that for you.  <tt class="xref py py-func docutils literal"><span class="pre">cdata()</span></tt>
takes a style block and encloses it in such an all-compatible
CDATA/comment-mix-container. <tt class="xref py py-func docutils literal"><span class="pre">cleanup()</span></tt> does the reverse. It
looks for common containers (like the ones described above) and <em>strips</em>
them. In fact, the <tt class="xref py py-func docutils literal"><span class="pre">cdata()</span></tt> function calls <tt class="xref py py-func docutils literal"><span class="pre">cleanup()</span></tt>
itself in order to avoid doubling itself:</p>
<div class="highlight-python"><div class="highlight"><pre><span class="kn">from</span> <span class="nn">tdi.tools</span> <span class="kn">import</span> <span class="n">css</span>

<span class="k">print</span> <span class="n">css</span><span class="o">.</span><span class="n">cdata</span><span class="p">(</span><span class="s">&quot;&quot;&quot;</span>
<span class="s">/*&lt;![CDATA[*/</span>
<span class="s">    body {font-family: sans-serif;}</span>
<span class="s">/*]]&gt;*/</span>
<span class="s">&quot;&quot;&quot;</span><span class="o">.</span><span class="n">strip</span><span class="p">())</span>
</pre></div>
</div>
<div class="highlight-python"><pre>&lt;!--/*--&gt;&lt;![CDATA[/*&gt;&lt;!--*/
body {font-family: sans-serif;}
/*]]&gt;*/--&gt;
</pre>
</div>
<p>The <tt class="xref py py-func docutils literal"><span class="pre">cdata()</span></tt> function can be applied automatically to all style
blocks of a template by hooking the
<tt class="docutils literal"><a class="reference external" href="../apidoc/tdi.tools.css-module.html#CDATAFilter"><span class="pre">→&nbsp;tdi.tools.css.CDATAFilter</span></a></tt> into the template loader. See
the <a class="reference internal" href="filtering.html"><em>filters documentation</em></a> for a description how to do
that.</p>
</div>
</div>
</div>


          </div>
        </div>
      </div>
      <div class="sphinxsidebar">
        <div class="sphinxsidebarwrapper">
  <h3><a href="index.html">Table Of Contents</a></h3>
  <ul>
<li><a class="reference internal" href="#">CSS Tools</a><ul>
<li><a class="reference internal" href="#minifying-css">Minifying CSS</a></li>
<li><a class="reference internal" href="#masking-style-blocks">Masking Style Blocks</a><ul>
<li><a class="reference internal" href="#cdata-and-cleanup">cdata and cleanup</a></li>
</ul>
</li>
</ul>
</li>
</ul>

  <h4>Previous topic</h4>
  <p class="topless"><a href="javascript_tools.html"
                        title="previous chapter">Javascript Tools</a></p>
  <h4>Next topic</h4>
  <p class="topless"><a href="template_tools.html"
                        title="next chapter">Template Tools</a></p>
<div id="searchbox" style="display: none">
  <h3>Quick search</h3>
    <form class="search" action="search.html" method="get">
      <input type="text" name="q" />
      <input type="submit" value="Go" />
      <input type="hidden" name="check_keywords" value="yes" />
      <input type="hidden" name="area" value="default" />
    </form>
    <p class="searchtip" style="font-size: 90%">
    Enter search terms or a module, class or function name.
    </p>
</div>
<script type="text/javascript">$('#searchbox').show(0);</script>
        </div>
      </div>
      <div class="clearer"></div>
    </div>
    <div class="related">
      <h3>Navigation</h3>
      <ul>
        <li class="right" style="margin-right: 10px">
          <a href="template_tools.html" title="Template Tools"
             >next</a></li>
        <li class="right" >
          <a href="javascript_tools.html" title="Javascript Tools"
             >previous</a> |</li>
        <li><a href="index.html">TDI 0.9.9.8 documentation</a> &raquo;</li>
          <li><a href="topics.html" >Documentation Topics</a> &raquo;</li> 
      </ul>
    </div>
    <div class="footer">
        &copy; Copyright 2014 André Malo.
      Created using <a href="http://sphinx.pocoo.org/">Sphinx</a> 1.1.3.
    </div>
  </body>
</html>