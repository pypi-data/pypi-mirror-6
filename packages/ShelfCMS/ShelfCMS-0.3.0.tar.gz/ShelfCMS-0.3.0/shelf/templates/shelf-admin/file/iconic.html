{% extends 'admin/master.html' %}
{% import 'shelf-admin/lib.html' as lib with context %}

{% block body %}
    <div class="row" style="margin-top: 50px; background-color: #ffffff">
        <div class="col-xs-12" style="padding: 0px; padding-bottom: 15px; padding-top: 5px; padding-left: 25px;">
            {% if dir_path %}
            <h1>/{{ dir_path.upper() }}</h1>
            {% else %}
            <h1>{{ admin_view.name.upper() }}</h1>
            {% endif %}
        </div>
        <div class="col-xs-12" style="padding: 0px; padding-bottom: 15px; overflow: hidden; display: table; border-collapse: collapse">
            <div class="row files"; style="display: table-row">
                {% set icons_by_mime = {'image': 'fa-picture-o', 'text': 'fa-file-text', 'video': 'fa-film', 'other': 'fa-file', 'archive': 'fa-save'} %}
                {% for name, path, is_dir, size in items %}
                <div style="text-align: center; border: 1px solid #ddd; display: table-cell; height: 160px" class="col-lg-2 col-md-3 col-sm-4 col-xs-6">
                    {%- if admin_view.can_delete and path -%}
                    {% if is_dir %}
                        {% if name != '..' and admin_view.can_delete_dirs %}
                            <form class="pull-right icon" method="POST" action="{{ url_for('.delete') }}">
                                <input type="hidden" name="path" value="{{ path }}"></input>
                                <button onclick="return confirm('{{ _gettext('Are you sure you want to delete \\\'%(name)s\\\' recursively?', name=name) }}')">
                                    <i class="fa fa-times-circle fa-lg"></i>
                                </button>
                            </form>
                            {% endif %}
                        {% else %}
                        <form class="pull-right icon" method="POST" action="{{ url_for('.delete') }}">
                            <input type="hidden" name="path" value="{{ path }}"></input>
                            <button onclick="return confirm('{{ _gettext('Are you sure you want to delete \\\'%(name)s\\\'?', name=name) }}')">
                                <i class="fa fa-times-circle fa-lg"></i>
                            </button>
                        </form>
                        {% endif %}
                    {% endif %}
                    {% if admin_view.can_rename and path and name != '..' %}
                    <a class="icon pull-right" href="{{ url_for('.rename', path=path) }}">
                            <i class="fa fa-pencil fa-lg"></i>
                    </a>
                    {% endif %}
                    <br>
                    {% if is_dir %}
                            <i class="fa {% if name == ".." %}fa-arrow-circle-up{% else %}fa-folder{% endif %} fa-4x"></i>
                            <a class="link-dir" href="{{ get_dir_url('.iconic_index', path)|safe }}"><span>{{ name }}</span></a>
                    {% else %}
                        {% if mimes[path] == "image" %}
                            <img src="{{ get_file_url(path)|safe }}" style="max-width: 100px; max-height: 56px"/>
                            <a class="link-file" href="{{ get_file_url(path)|safe }}" target="_new"><span>{{ name }}</span></a>
                        {% else %}
                            <i class="fa {{ icons_by_mime[mimes[path]] }} fa-4x"></i>
                            <a class="link-file" href="{{ get_file_url(path)|safe }}" target="_new"><span>{{ name }}</span></a>
                        {% endif %}  
                    {% endif %}
                </div>
            {% endfor %}
            </div>
        </div>
    </div>

{% endblock %}

{% block bottom %}
    <div class="navbar navbar-default navbar-fixed-bottom">
        <div class="container">
            <div class="navbar-header">
                <button type="button" class="navbar-toggle" data-toggle="collapse" data-target=".navbar-collapse">
                  <span class="icon-bar"></span>
                  <span class="icon-bar"></span>
                  <span class="icon-bar"></span>
                </button>
                {% if dir_path %}
                <a class="navbar-brand" href="javascript:void()">/{{ dir_path.upper() }} ({{ count }})</a>
                {% else %}
                <a class="navbar-brand" href="javascript:void()">{{ admin_view.name.upper() }} ({{ count }})</a>
                {% endif %}
            </div>
            <div class="collapse navbar-collapse">
                {% block model_menu_bar %}
                <ul class="nav navbar-nav">
                    <li class="dropdown">
                        <a class="dropdown-toggle" href="#" data-toggle="dropdown"><i class="fa fa-th fa-lg"></i>  Layout</a>
                        <ul class="dropdown-menu">
                            {% if dir_path %}
                            <li><a href="{{ url_for('.index', path=dir_path) }}">List</a></li>
                            <li><a href="{{ url_for('.iconic_index', path=dir_path) }}">Icons</a></li>
                            {% else %}
                            <li><a href="{{ url_for('.index') }}">List</a></li>
                            <li><a href="{{ url_for('.iconic_index') }}">Icons</a></li>
                            {% endif %}
                        </ul>
                    </li>
                </ul>
                <ul class="nav navbar-nav navbar-right">
                    <li class="actions">
                        <a href="{{ get_dir_url('.upload', path=dir_path) }}"><i class="fa fa-download"></i>  Upload File</a>
                    </li>
                    <li class="actions">
                        <a><i class="fa fa-folder"></i>  New directory</a>
                    </li>
                    <li class="actions">
                        <a><i class="fa fa-trash-o"></i>  Delete</a>
                    </li>
                    
                </ul>
                {% endblock %}
            </div>
        </div>
    </div>
{% endblock %}

{% block tail %}
    {{ super() }}
    <script src="{{ url_for('admin.static', filename='datetimepicker/bootstrap-datetimepicker.js') }}"></script>
    <script src="{{ url_for('admin.static', filename='admin/js/form.js') }}"></script>
    <script src="{{ url_for('admin.static', filename='admin/js/filters.js') }}"></script>

    <script language="javascript">
        (function($) {
            $(".files > div").click(function () {
                if ($(this).find(".link-dir").length == 0)
                {
                    $(this).toggleClass("selected");
                    return false;
                }                
            });
        })(jQuery);
    </script>
{% endblock %}
