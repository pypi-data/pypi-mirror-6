(function(){var a,b;window.WEB_SOCKET_SWF_LOCATION="/static/main/WebSocketMain.swf";window.Stream=(function(){function c(){}c.prototype.start=function(){this.socket=ajentiConnectSocket("/stream");this.socket.on("connect",function(){return $("#connection-error").hide()});this.socket.on("auth-error",function(){console.log("Authentication lost!");return location.reload()});this.socket.on("disconnect",function(){return $("#connection-error").show()});this.socket.on("init",function(d){d=JSON.parse(d);console.group("Welcome to Ajenti");console.log("version",d.version);console.log("running on",d.platform);console.log("your session:",d.session);$("title").text(d.hostname);console.groupEnd();Feedback.configure(d.feedback,d.platform,d.version,d.edition);return Feedback.emit("Login")});this.socket.on("ui",function(d){console.group("Received update");console.log("Transfer size",d.length);profiler.start("Decompressing");d=RawDeflate.inflate(RawDeflate.Base64.decode(d));profiler.stop();console.log("Payload size",d.length);d=JSON.parse(d);console.log("JSON data:",d);UI.clear();profiler.start("Cumulative UI inflating");d=UI.inflate(d);profiler.stop();profiler.start("Cumulative UI update");UI.replace(d);profiler.stop();console.log("Total elements:",UI._total_elements);console.groupEnd();return Loading.hide()});this.socket.on("ack",function(){return Loading.hide()});this.socket.on("update-request",function(){UI.checkForUpdates();UI.sendUpdates(true);return Loading.show()});this.socket.on("progress-message",function(d){console.log("...",d);Loading.show();return Loading.setMessage(d)});this.socket.on("crash",function(d){d=JSON.parse(d);console.log("CRASH:",d);ajentiCrash(d);return Loading.hide()});this.socket.on("security-error",function(){console.log("SECURITY ERROR");ajentiSecurityError();return Loading.hide()});this.socket.on("notify",function(d){d=JSON.parse(d);return Notificator.notify(d.type,d.text)});this.socket.on("openTab",function(d){d=JSON.parse(d);return Tabs.addTab(d.url,d.title)});this.socket.on("closeTab",function(d){d=JSON.parse(d);return Tabs.closeTab(d.url)});this.socket.on("debug",function(e){var f;e=JSON.parse(e);console.group("Server-side profiling");for(f in e.profiles){console.log(f,e.profiles[f].toFixed(3),"s")}return console.groupEnd()});return $("#connection-error").hide()};c.prototype.send=function(d){console.log("Sending updates",d);this.socket.send(JSON.stringify(d));return Loading.show()};c.prototype.emit_ui_update=function(d){return this.send({type:"ui_update",content:d})};return c})();window.UIManager=(function(){function c(d){this.stream=d;this.ui=null;this.pendingUpdates=[];this.updaterTimeout=null}c.prototype.inflate=function(k){var d,e,l,j,f,g,i,h;e=[];this._total_elements+=1;if(k.visible===true){h=k.children;f=(function(m){return function(n){return e.push(m.inflate(n))}})(this);for(g=0,i=h.length;g<i;g++){d=h[g];f(d)}}j=k.typeid.replace(":","__");l=Controls[j];if(!l){l=Controls["default"]}return new l(this,k,e)};c.prototype.clear=function(){this._total_elements=0;if(this.ui){this.ui.broadcast("destruct")}$(".root *").unbind();$.cleanData($(".root *"));$(".root *").safeRemove();return delete this.ui};c.prototype.replace=function(d){var e;$(".ui-tooltip").remove();this.ui=d;e=$$(d.html);$(".root").append(e);profiler.start("DOM setup");profiler.setupDomStats={};d.setupDom(e);console.log(profiler.setupDomStats);profiler.stop();return aoConnector.reportHeight($("body")[0].scrollHeight)};c.prototype.extractUpdates=function(j,i){var k,h,g,e,f,d;h=j.extractUpdates();if(h){i.push(h)}f=j.children;d=[];for(g=0,e=f.length;g<e;g++){k=f[g];d.push((function(l){return function(m){return l.extractUpdates(m,i)}})(this)(k))}return d};c.prototype.checkForUpdates=function(){var h,g,f,e,d;g=[];this.extractUpdates(this.ui,g);d=[];for(f=0,e=g.length;f<e;f++){h=g[f];d.push((function(i){return function(j){return i.queueUpdate(j)}})(this)(h))}return d};c.prototype.queueUpdate=function(d){return this.pendingUpdates.push(d)};c.prototype.sendUpdates=function(d){if(d==null){d=false}if(this.updaterTimeout){clearTimeout(this.updaterTimeout)}return this.updaterTimeout=setTimeout((function(e){return function(){if(d||e.pendingUpdates.length>0){e.stream.emit_ui_update(e.pendingUpdates)}e.pendingUpdates=[];return e.updaterTimeout=null}})(this),50)};c.prototype.event=function(e,d,f){var g;this.checkForUpdates();g={type:"event",uid:e.uid,event:d,params:f!=null?f:null};this.queueUpdate(g);return this.sendUpdates()};c.prototype.restoreTheme=function(){if(getCookie("ajenti-theme")==="dark"){return this.toggleTheme()}};c.prototype.toggleTheme=function(){$("html").toggleClass("ui-dark");$("html").toggleClass("ui-light");if($("html").hasClass("ui-dark")){return setCookie("ajenti-theme","dark")}else{return setCookie("ajenti-theme","light")}};return c})();window.LoadingDim=(function(){function c(d){this.dom=d;this.visible=true;this.dom.show();this.follow=this.dom.find(".wrapper");this.dom.mousemove((function(e){return function(f){if(e.visible){e.follow.show();return e.follow.css({left:(f.clientX+20)+"px",top:(f.clientY+20)+"px"})}}})(this))}c.prototype.hide=function(){this.visible=false;this.setMessage("");$(".hide-when-loaded").hide();$("body").removeClass("loading");this.dom.hide();return this.follow.hide()};c.prototype.show=function(){this.visible=true;$("body").addClass("loading");return this.dom.show()};c.prototype.setMessage=function(d){return this.dom.find(".message").text(d)};return c})();a=(function(){function c(){this.mainTab=$("#tab-ajenti");this.tabHeadersDom=$("#tab-headers");this.tabsDom=$("#tabs");this.tabHeadersDom.find("a").click((function(d){return function(){return d.goHome()}})(this));this.goHome();this.openTabs={}}c.prototype.goHome=function(){this.tabsDom.find(">*").hide();this.mainTab.show();this.tabHeadersDom.find("a").removeClass("active");return this.tabHeadersDom.find("a:first").addClass("active")};c.prototype.addTab=function(d,g){var f,e;if(this.openTabs[d]){this.openTabs[d].click();return}f=$('<div class="tab"><iframe src="'+d+'" /></div>');this.tabsDom.append(f);e=$('<a href="#">'+g+'<span class="close"><i class="icon-remove"></span></a></a>');this.tabHeadersDom.append(e);this.openTabs[d]=e;this.openTabs[d].dom=f;e.click((function(h){return function(){h.tabsDom.find(">*").hide();f.show();setTimeout(function(){return f.find("iframe")[0].contentWindow.focus()},100);h.tabHeadersDom.find("a").removeClass("active");return e.addClass("active")}})(this));e.find(".close").click((function(h){return function(){return h.closeTab(d)}})(this));return e.click()};c.prototype.closeTab=function(d){this.openTabs[d].dom.remove();this.openTabs[d].remove();delete this.openTabs[d];return this.goHome()};return c})();$(function(){window.Loading=new LoadingDim($("#loading"));window.Tabs=new a();if(window.UI){UI.restoreTheme();return $("#ui-theme-toggle").click(function(){return UI.toggleTheme()})}});window.Controls={};window.Control=(function(){function c(j,i,f){var e,g,l,d,h,k;this.ui=j;this.properties=i;if((l=window.Control).lastUID==null){l.lastUID=-1}if(this.properties==null){this.properties={}}if((d=this.properties).visible==null){d.visible=true}if(this.properties.uid){this.uid=this.properties.uid}else{this.uid=window.Control.lastUID--}this.dom=null;this.children=[];this.changed=false;profiler.start("Generating DOM");this.html=this.createDom();if(this.dom){console.log("Bad control:",this)}if(!this.html.trim){this.html="";return}this.html=this.html.trim();if(!this.noUID){this.html=this.html.insert(this.html.indexOf(">"),' id="uid-'+this.uid+'"')}profiler.stop();g="";if(f){for(h=0,k=f.length;h<k;h++){e=f[h];if(e.properties.visible||this.requiresAllChildren){this.children.push(e);if(!e.dom){g+=this.wrapChild(e)}}}}this.html=this.html.replace("<children>",g)}c.prototype.s=function(d){return(""+d).replace(/&/g,"&amp;").replace(/'/g,"&apos;").replace(/"/g,"&quot;").replace(/</g,"&lt;").replace(/>/g,"&gt;")};c.prototype.createDom=function(){return""};c.prototype.setupDom=function(j){var k,d,f,g,i,e,h;if(this.dom){return}if(!j&&!this.noUID){j=$$(this.html)}this.dom=j;if(this.properties.visible!==true&&this.dom&&this.dom.style){this.dom.style.display="none";return this}h=this.children;for(i=0,e=h.length;i<e;i++){k=h[i];if(k.properties.visible||this.requiresAllChildren){if(k.dom){this.append(k)}else{if(c.prototype.setupDom!==k.constructor.prototype.setupDom){f=k.constructor.name;if((g=profiler.setupDomStats)[f]==null){g[f]=0}profiler.setupDomStats[f]+=1}d=document.getElementById("uid-"+k.properties.uid);if(!d&&!k.noUID){console.error("Pre-generated DOM not found for",k)}k.setupDom(d)}}}return this};c.prototype.destruct=function(){};c.prototype.detectUpdates=function(){return{}};c.prototype.markChanged=function(){if(!this.changed){$(this.dom).before('<div class="changed-badge">\n    <span title="Not saved yet">*</span>\n</div>')}this.changed=true;return $(this.dom).addClass("changed")};c.prototype.wrapChild=function(d){return d.html};c.prototype.wrapChildLive=function(d){return d.dom};c.prototype.onBroadcast=function(d){};c.prototype.broadcast=function(h){var i,g,e,f,d;this.onBroadcast(h);f=this.children;d=[];for(g=0,e=f.length;g<e;g++){i=f[g];d.push((function(j){return function(k){return k.broadcast(h)}})(this)(i))}return d};c.prototype.extractUpdates=function(){var d,e,f;e=this.detectUpdates();if(!this.uid||$.isEmptyObject(e)){return null}f=(function(g){return function(h){return g.properties[h]=e[h]}})(this);for(d in e){f(d)}return{type:"update",uid:this.uid,properties:e}};c.prototype.append=function(e){var d;if(!this.childContainer){this.childContainer=$($(this.dom).find2(".--child-container")[0])}d=this.wrapChildLive(e);if(d instanceof jQuery){d=d[0]}if(d){return this.childContainer.append(d)}};c.prototype.publish=function(){this.ui.checkForUpdates();return this.ui.sendUpdates()};c.prototype.event=function(d,f){var e;this.ui.checkForUpdates();e=this["on_"+d];if(e){if(!e(f)){return false}}if(!this.uid||this.properties.client){return false}this.ui.event(this,d,f);return true};c.prototype._int_to_px=function(d){if(/^[0-9]+$/.test(d)){return d+"px"}if(d===null||d==="auto"){return"auto"}return d+""};c.prototype.cancel=function(d){d.preventDefault();return d.stopPropagation()};return c})();b=function(c){return c.replace(/</g,"&lt;")};window.ajentiConnectSocket=function(c){return io.connect(c,{resource:"ajenti:socket"})};window.ajentiCrash=function(c){$("#crash").fadeIn();$("#crash-traceback").html(b(c.message+"\n"+c.traceback));return $("#crash-report textarea").val(c.report)};window.ajentiCrashResume=function(c){return $("#crash").fadeOut()};window.ajentiCrashShowReport=function(){$("#crash-traceback").toggle("blind");$("#crash-report").toggle("blind");return setTimeout((function(c){return function(){return $("#crash-report textarea").focus()[0].select()}})(this),1000)};window.ajentiSecurityError=function(){return $("#security-error").fadeIn()};window.ajentiSecurityResume=function(c){return $("#security-error").fadeOut()};$.fn.safeRemove=function(){return this.each(function(c,d){if(d.parentNode){return d.parentNode.removeChild(d)}})};$.fn.find2=function(c){return this.find(c).add(this.filter(c))};String.prototype.trim=function(){return String(this).replace(/^\s+|\s+$/g,"")};String.prototype.insert=function(d,c){if(d>0){return this.substring(0,d)+c+this.substring(d,this.length)}else{return c+this}};$(function(){if(location.protocol==="https:"||location.hostname==="localhost"){return $("#ssl-alert").hide()}});if(/Android|webOS|iPad|IEMobile/i.test(navigator.userAgent)){$(function(){$("html").addClass("mode-tablet");return FastClick.attach(document.body)})}window.$$=function(d,c){var e;if(c==null){c="div"}e=document.createElement(c);e.innerHTML=d;return e.childNodes[0]}}).call(this);