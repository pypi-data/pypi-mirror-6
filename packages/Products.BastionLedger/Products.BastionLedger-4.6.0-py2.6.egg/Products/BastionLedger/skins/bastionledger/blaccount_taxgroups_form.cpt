<html xmlns:tal="http://xml.zope.org/namespaces/tal"
      xmlns:metal="http://xml.zope.org/namespaces/metal"
      metal:use-macro="here/main_template/macros/master"
      i18n:domain="bastionledger">

    <div metal:fill-slot="main"
         tal:define="errors options/state/getErrors;
                     utool context/@@plone_portal_state/portal_url;
                     lockable python:hasattr(here, 'wl_isLocked');
                     isLocked python:lockable and here.wl_isLocked();
                     tax_codes context/tax_codes;">


      <h1><img src="" alt="" tal:define="icon python:context.getIcon(1)" 
               tal:attributes="src string:${utool}/${icon}">&nbsp;
          <span tal:replace="here/prettyTitle"/></h1>

      <form name="edit_form"  action="."  method="post"
            tal:attributes="action string:${template/getId}" >

       <table border="0" cellpadding="2" cellspacing="0" summary="">
           <tr tal:condition="tax_codes/keys">
              <td class="field"/>
              <td class="field"><span class="label">Group</span></td>
              <td class="field"><span class="label">Codes</span></td>
           </tr>
           <tr tal:condition="not: tax_codes/keys">
              <td colspan="3">
                 <span class="formHelp">This account has no tax groups</span>
              </td>
           </tr>
           <tr tal:repeat="k tax_codes/keys">
              <td class="field" valign="top">
                  <input type="checkbox" name="ids:list" value="" tal:attributes="value k"/>
              </td>
              <tal:block tal:define="tt python: context.taxTable(k)">
                  <td class="field" valign="top" tal:content="tt/title_or_id"/>
                  <td class="field" valign="top" 
                      tal:define="codes python: tax_codes[k];
                                  all tt/taxCodes">
                     <select name="tax_codes.:list" multiple size="3" 
                             tal:condition="all"
                             tal:attributes="name string:tax_codes.${k}:list:record">
                         <option tal:repeat="c all"
                                 tal:content="c"
                                 tal:attributes="selected python: c in codes and 1 or 0"/>
                     </select>
                 </td>
              </tal:block>
           </tr>
           <tr>
              <td colspan="3" tal:condition="tax_codes/keys">
                  <input class="context"
                         
                         type="submit"
                         name="form.button.Delete"
                         value=" Delete "
                         i18n:attributes="value"
                         tal:attributes="disabled python:isLocked and 'disabled' or None;" />
                  <input class="context"
                         
                         type="submit"
                         name="form.button.Edit"
                         value=" Edit "
                         i18n:attributes="value"
                         tal:attributes="disabled python:isLocked and 'disabled' or None;" />
              </td>
           </tr>
           <tr tal:define="available context/availableTaxTables"
               tal:condition="available">
               <td colspan="3">
                  <select name="id">
                      <option tal:repeat="a available" 
                              tal:content="a/title_or_id"
                              tal:attributes="value a/getId"/>
                  </select>
                  <input class="context"
                         
                         type="submit"
                         name="form.button.Add"
                         value=" Add "
                         i18n:attributes="value"
                         tal:attributes="disabled python:isLocked and 'disabled' or None;" />


               </td>
           </tr>
        </table>

        <input type="hidden" name="form.submitted" value="1" />

      </form>

    </div>
 
</html>
