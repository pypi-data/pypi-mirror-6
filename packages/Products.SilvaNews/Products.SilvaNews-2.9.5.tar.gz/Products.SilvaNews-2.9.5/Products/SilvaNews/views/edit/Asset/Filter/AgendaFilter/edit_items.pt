<html tal:omit-tag=""
  xml:lang="en"
  xmlns="http://www.w3.org/1999/xhtml"
  xmlns:metal="http://xml.zope.org/namespaces/metal"
  xmlns:tal="http://xml.zope.org/namespaces/tal"
  xmlns:i18n="http://xml.zope.org/namespaces/i18n"
  i18n:domain="silva_news"
  tal:define="
    view here;
    model request/model;
    root_url model/get_root_url;
    user_role view/get_user_role;
    title model/get_title_editable;
    vein string:items;
    dummy model/security_trigger;
    months view/get_months;
    currentmonth request/month | options/month | view/currentmonth;
    currentyear request/year | options/year | view/currentyear;
    results python:model.backend_get_items_by_date(currentmonth, currentyear);
    objects python:view.prepare_objects(results);
    mangle modules/Products/Silva/mangle;
    ct python:mangle.String.centeredTruncate;
">

<table class="columns columns2">
  <tbody>
    <tr>
      <tal:block replace="nothing">
        _____________________ sidebar _____________________
      </tal:block>
      <td class="left"
        tal:define="template_id string:tab_edit">
        <metal:block use-macro="view/macro_vein_navigation/macros/vein" />
      </td>

      <tal:block replace="nothing">
        _____________________ main _____________________
      </tal:block>
      <td class="main">

<form action="." name="silvaObjects" method="POST">

  <tal:comment condition="nothing">______________ date table ______________</tal:comment>
  <table class="listing"
    style="margin-bottom:0;">
    <thead>
      <tal:block replace="nothing">
        _______ vein + title row _______
      </tal:block>
      <tr>
        <td class="top"
          colspan="14">
          <h2>
            <img tal:replace="structure python:view.render_icon(model)" />
            <span style="text-transform:lowercase;"
              tal:content="model/meta_type">Meta type</span> 
            &#xab;<tal:block content="model/get_title_or_id" />&#xbb;
          </h2>
        </td>
      </tr>
    </thead>
    <tbody>
      <tal:block replace="nothing">
        _______ calendar navigation _______
      </tal:block>
      <tr class="even"
        metal:define-macro="calendar">
        <td>
          <a href="3"
            tal:content="python: '< %s' % str(int(currentyear) - 1)"
            tal:attributes="href python:'tab_edit_items?month=%s&year=%s&view=view_archive' % (currentmonth, int(currentyear) - 1)">
            2001
          </a>
        </td>
        <tal:repeat repeat="month months">
          <tal:define define="id repeat/month/index">
            <td class="align-center"
              tal:attributes="style python:test(id == int(currentmonth) - 1, 'background-color:#f3f3d9', '');">
              <a tal:content="month"
                tal:attributes="href python: 'tab_edit_items?month=%s&year=%s&view=view_archive' % (id + 1, currentyear)">
                month
              </a>
            </td>
          </tal:define>
        </tal:repeat>
        <td class="align-right">
          <a href="3" tal:content="python: '%s >' % str(int(currentyear) + 1)" tal:attributes="href python:'tab_edit_items?month=%s&year=%s&view=view_archive' % (currentmonth, int(currentyear) + 1)">
            2003
          </a>
        </td>
      </tr>
    </tbody>
  </table>

  <tal:comment condition="nothing"><!-- begin items table --></tal:comment>

  <table class="listing"
    style="margin-top:0; margin-bottom:0;">

    <span tal:replace="nothing"> ______________ table header ______________ </span>
    <tr tal:condition="python:len(objects) != 0">
      <th i18n:translate="" width="3%">type</th>
      <th i18n:translate="">modify</th>
      <th i18n:translate="">view</th>
      <th i18n:translate="">publication&nbsp;due&nbsp;</th>
      <th i18n:translate="">expiration&nbsp;due</th>
    </tr>

    <span tal:replace="nothing"> ______________ listing iteration ______________ </span>
    <toc_entry tal:omit-tag=""
      tal:repeat="object objects">
    <tal:define define="
      obj python:object['object'].getObject();
      id object/index;
      object_status obj/version_status;
      object_path python: '/'.join(obj.object_path());
      object_url python: obj.get_content().absolute_url();
      meta_type python: obj.get_content().meta_type;
    ">
    <cycle tal:define="oddrow repeat/object/odd" tal:omit-tag="">
    <tr tal:attributes="class python: test(oddrow, 'odd', 'even')">

    <span tal:replace="nothing"> _______ checkbox + icon _______ </span>
    <td nowrap="1">
      <input type="checkbox" name="cb:list" value="value"
       tal:attributes="value string:cb_${id}; checked object/check_checkbox" />
      <img tal:replace="structure python:view.render_icon(obj.get_content())" />
    </td>

    <span tal:replace="nothing"> _______ id cell _______ </span>
    <td>
      <a title="Edit this item"
        tal:attributes="
          href string:${object_url}/edit;
          title meta_type"
        tal:content="python: ct(object_path, 30)">
        id
      </a>
    </td>

    <span tal:replace="nothing"> _______ title cell _______ </span>
    <td>
      <tal:block condition="python:obj.get_title != ''">
        <a title="Preview this item" i18n:attributes="title"
          tal:attributes="href string:${object_url}">
        <span tal:replace="structure string:${obj/get_title}">title</span>
        </a>
      </tal:block>
      <tal:block condition="python:obj.get_title == ''">
        &nbsp;
      </tal:block>
    </td>

    <span tal:replace="nothing"> _______ publish date cell _______ </span>
    <td>
    <tal:block define="publication_dt obj/publication_datetime">
      <tal:block condition="publication_dt">
        <span tal:replace="structure python: mangle.DateTime(publication_dt).toStr()">21 oct 2001 18:18</span>
      </tal:block>
      <tal:block condition="not: publication_dt">
        &nbsp;
      </tal:block>
    </tal:block>
    </td>

    <span tal:replace="nothing"> _______ expiration date cell _______ </span>
    <td>
    <span tal:condition="object_status">
      <tal:block define="expiration_dt python: obj.expiration_datetime()">
        <tal:block condition="expiration_dt">
          <span tal:replace="structure python: mangle.DateTime(expiration_dt).toStr()" tal:omit-tag="">21 oct 2001 18:18</span>
        </tal:block>
        <tal:block condition="not: expiration_dt">
          &nbsp;
        </tal:block>
      </tal:block>
    </span>
    <span tal:condition="not: object_status"
      tal:omit-tag="">&nbsp;</span>
    &nbsp;
    </td>

    </tr>

    </cycle>
    </tal:define>
    </toc_entry>

    <span tal:replace="nothing"> ______________ if no records ______________ </span>
    <tal:block tal:condition="python:len(objects) == 0">
    <tr>
      <th colspan="6">&nbsp;</th>
    </tr>
    <tr class="odd">
      <td colspan="6">
      <i i18n:translate="">There are no news items for this period. Check that news sources are activated (go to the edit screen) and items in the sources are published.</i>
      </td>
    </tr>
    <tr>
      <th colspan="6">&nbsp;</th>
    </tr>
    </tal:block>
    <!-- /iteration -->


    <check tal:condition="python:len(objects) != 0">

    <span tal:replace="nothing"> ______________ controls for chief ______________ </span>
    <tr class="controls"
      tal:condition="python:user_role == 'Editor'">
    <td colspan="3">
      <input style="
        display: none"
        id="select_all_button"
        class="button" 
        type="submit" 
        name="selectButton" 
        value="deselect all" 
        sel_value="select all"
        desel_value="deselect all"
        title="select all items: alt-a" 
        accesskey="a" 
        onClick="toggleSelect(this); return false"
        i18n:attributes="value;sel_value;desel_value;title">
      <script type="text/javascript">
      // <![CDATA[

        if (document.forms[0]) {
          document.getElementById('select_all_button').style.display = 'inline';
        }

        isSelected = true;

        function toggleSelect(button) {
          var form = button.form;
          var check = true;
          if (isSelected) {
            check = false;
            isSelected = false;
          } else {
            isSelected = true;
          };
          var inputs = form.getElementsByTagName('input');
          for (var i=0; i < inputs.length; i++) {
            var child = inputs[i];
            var type = child.getAttribute('type');
            if (type != 'radio' && type != 'checkbox') {
              continue;
            };
            if (check) {
              child.setAttribute('checked', true);
            } else {
              // make very sure the checkbox is unchecked, the 
              // setAttribute works on IE but not on Moz, the 
              // removeAttribute the other way round, this doesn't
              // seem to clash and who knows IE 8 will require both ;)
              child.setAttribute('checked', null);
              child.removeAttribute('checked');
            };
          };
          var newvalue = isSelected ? button.getAttribute('desel_value') :
                          button.getAttribute('sel_value');
          button.setAttribute('value', newvalue);
        };
        
      // ]]>
      </script>
      &nbsp;
      <input type="hidden" name="year" value="" tal:attributes="value currentyear">
      <input type="hidden" name="month" value="" tal:attributes="value currentmonth">
      <input class="button" type="submit" name="use_items:method" value="update" title="use selected items in this filter: alt-u" accesskey="u" i18n:attributes="title;value"/>
      &nbsp;
    </td>
    <td align="right" colspan="3" nowrap="1">
      &nbsp;
    </td>
    </tr>

  </check>

  </table>

  <tal:comment condition="nothing"> __________ date table __________ </tal:comment>
  <table class="listing"
    style="margin-top:0; border-bottom-width:2px;">
    <tbody>
      <tr class="even"
        metal:use-macro="here/edit_items/macros/calendar">
      </tr>
    </tbody>
  </table>

</form>

</html>
