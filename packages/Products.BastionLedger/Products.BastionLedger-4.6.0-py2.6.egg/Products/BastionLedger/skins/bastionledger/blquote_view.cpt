<html xmlns:tal="http://xml.zope.org/namespaces/tal"
      xmlns:metal="http://xml.zope.org/namespaces/metal"
      metal:use-macro="context/main_template/macros/master"
      i18n:domain="bastionledger">

<body>
  <div metal:fill-slot="main" 
       tal:define="errors options/state/getErrors;
                   discount context/discount;
                   utool context/@@plone_portal_state/portal_url;
                   freight context/blorder_freight;
                   taxincluded context/taxincluded;">

      <h1><img src="" alt="" tal:define="icon python:context.getIcon(1)" 
               tal:attributes="src string:${utool}/${icon}">&nbsp;<span tal:replace="context/Title | context/getId"/></h1>

       <tal:byline tal:on-error="string:">
         <div tal:replace="structure provider:plone.belowcontenttitle"/>
       </tal:byline>

    <metal:quote metal:define-macro="quote">
       <table summary="" border="0" cellspacing="0" cellpadding="2" width="100%"
              tal:define="utool context/@@plone_portal_state/portal_url;
                          items context/orderItemValues;
                          newline_to_br python: modules['Products.PythonScripts.standard'].newline_to_br">
           <tr>
              <td colspan="3">
                  <table summary="" border="0" cellspacing="0" cellpadding="2" width="100%">
                      <tr><td class="field" align="center"><label>Quotation</label></td></tr>
                      <tr><td class="field" align="center">
                              <label tal:content="python: context.getLedgerProperty('title')"/></td></tr>
                      <tr tal:define="tax_no python: context.getLedgerProperty('tax_number')"
                          tal:condition="tax_no">
                         <td class="field" align="center">
                              <label>Tax No. <span tal:replace="tax_no"/></label>
                         </td>
                      </tr>
                      <tr><td class="field" align="center">
                              <span style="font-size: 8pt;" 
                                    tal:content="python: ','.join(context.getLedgerProperty('address', '').split('\n'))"/></td></tr>
                      <tr><td>&nbsp;</td></tr>
                      <tr><td class="field" align="center">
                              <label>Quotation Ref</label>&nbsp;
                              <a href="" tal:attributes="href context/absolute_url"
                                 ><strong tal:content="context/getId"/></a>
                          </td>
                      </tr>
                  </table>
              </td>
           </tr>
           <tr><td>&nbsp;</td><td>&nbsp;</td><td width="50%">&nbsp;</td></tr>
           <tr tal:define="account context/blAccount"
               tal:condition="nocall: account">
               <td class="label">Account</td>
               <td class="field" nowrap>
                 <a href="" tal:attributes="href account/absolute_url"
                            tal:content="account/prettyTitle"/>
               </td>
           </tr>
           <tr tal:define="order context/blOrder"
               tal:condition="nocall: order">
               <td class="label">Order</td>
               <td class="field" nowrap>
                 <a href="" tal:attributes="href order/absolute_url"
                            tal:content="order/getId"/>
               </td>
           </tr>
           <tr>
               <td class="label">Contact</td>
               <td class="field" tal:content="context/contact | context/aq_parent/contact | nothing"/>
           </tr>
           <tr>
               <td class="label">Company</td>
               <td class="field" tal:content="context/company | nothing"/>
           </tr>
           <tr tal:define="email context/email"
               tal:condition="email">
               <td class="label">Email</td>
               <td class="field">
                  <a href="" tal:attributes="href string:mailto:${email}"
                             tal:content="email"/>
           </tr>
           <tr tal:define="phone context/phone"
               tal:condition="phone">
               <td class="label">Phone</td>
               <td class="field" tal:content="phone"/>
           </tr>
           <tr><td>&nbsp;</td></tr>
           <tr tal:on-error="string:">
               <td class="label" nowrap>Offer Effective</td>
               <td class="field" tal:content="python: context.orderdate.strftime('%Y/%m/%d')"/>
           </tr>
           <tr tal:on-error="string:">
               <td class="label" nowrap>Offer Expires</td>
               <td class="field" tal:content="python: context.reqdate.strftime('%Y/%m/%d')"/>
           </tr>
           <tr tal:define="notes context/notes" tal:condition="notes">
               <td class="label" valign="top">Notes</td>
               <td class="field" colspan="3" tal:content="structure python: newline_to_br(notes)"/>
           </tr>
           <tr><td>&nbsp;</td></tr>
           <tr>
              <td colspan="3">
                  <div metal:use-macro="context/blorder_view/macros/orderlines"/>
              </td>
           </tr>
     </table>
  </metal:quote>

     <metal:attachments metal:use-macro="context/blorder_view/macros/orderattachments"/>

     <br/>
     <br/>

     <form name="order_actions"  action="."  method="post"   class="visualNoPrint"
           tal:define="errors options/state/getErrors;"
           tal:attributes="action string:${template/getId}">

        <div tal:define="error errors/email|nothing;
                         Email request/email | context/email | context/aq_parent/email | nothing;"
             tal:attributes="class python:error and 'field error' or 'field'">

           <div tal:content="error">Validation error output</div>

           <input type="text" name="email" size="50" value=""
                  tal:attributes="value Email"/>

           <input class="context"
                         
                         type="submit"
                         name="form.button.Email"
                         value="Email"
                         i18n:attributes="value" />

        </div>

        <input type="hidden" name="form.submitted" value="1" />
     </form>

      <div tal:replace="structure provider:plone.belowcontentbody">
           Document actions (print, sendto etc)
      </div>

  </div>
 
</body>
</html>
