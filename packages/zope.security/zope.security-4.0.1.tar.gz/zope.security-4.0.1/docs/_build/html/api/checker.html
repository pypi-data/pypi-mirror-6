

<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN"
  "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">


<html xmlns="http://www.w3.org/1999/xhtml">
  <head>
    <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
    
    <title>zope.security.checker &mdash; zope.security 4.0dev documentation</title>
    
    <link rel="stylesheet" href="../_static/default.css" type="text/css" />
    <link rel="stylesheet" href="../_static/pygments.css" type="text/css" />
    
    <script type="text/javascript">
      var DOCUMENTATION_OPTIONS = {
        URL_ROOT:    '../',
        VERSION:     '4.0dev',
        COLLAPSE_INDEX: false,
        FILE_SUFFIX: '.html',
        HAS_SOURCE:  true
      };
    </script>
    <script type="text/javascript" src="../_static/jquery.js"></script>
    <script type="text/javascript" src="../_static/underscore.js"></script>
    <script type="text/javascript" src="../_static/doctools.js"></script>
    <link rel="top" title="zope.security 4.0dev documentation" href="../index.html" />
    <link rel="next" title="zope.security.decorator" href="decorator.html" />
    <link rel="prev" title="zope.security.adapter" href="adapter.html" /> 
  </head>
  <body>
    <div class="related">
      <h3>Navigation</h3>
      <ul>
        <li class="right" style="margin-right: 10px">
          <a href="../genindex.html" title="General Index"
             accesskey="I">index</a></li>
        <li class="right" >
          <a href="../py-modindex.html" title="Python Module Index"
             >modules</a> |</li>
        <li class="right" >
          <a href="decorator.html" title="zope.security.decorator"
             accesskey="N">next</a> |</li>
        <li class="right" >
          <a href="adapter.html" title="zope.security.adapter"
             accesskey="P">previous</a> |</li>
        <li><a href="../index.html">zope.security 4.0dev documentation</a> &raquo;</li> 
      </ul>
    </div>  

    <div class="document">
      <div class="documentwrapper">
        <div class="bodywrapper">
          <div class="body">
            
  <div class="section" id="module-zope.security.checker">
<span id="zope-security-checker"></span><h1><a class="reference internal" href="#module-zope.security.checker" title="zope.security.checker"><tt class="xref py py-mod docutils literal"><span class="pre">zope.security.checker</span></tt></a><a class="headerlink" href="#module-zope.security.checker" title="Permalink to this headline">¶</a></h1>
<p>Security Checkers</p>
<p>You can set the environment variable ZOPE_WATCH_CHECKERS to get additional
security checker debugging output on the standard error.</p>
<p>Setting ZOPE_WATCH_CHECKERS to 1 will display messages about unauthorized or
forbidden attribute access.  Setting it to a larger number will also display
messages about granted attribute access.</p>
<p>Note that the ZOPE_WATCH_CHECKERS mechanism will eventually be
replaced with a more general security auditing mechanism.</p>
<dl class="function">
<dt id="zope.security.checker.ProxyFactory">
<tt class="descclassname">zope.security.checker.</tt><tt class="descname">ProxyFactory</tt><big>(</big><em>object</em>, <em>checker=None</em><big>)</big><a class="reference internal" href="../_modules/zope/security/checker.html#ProxyFactory"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#zope.security.checker.ProxyFactory" title="Permalink to this definition">¶</a></dt>
<dd><p>Factory function that creates a proxy for an object</p>
<p>The proxy checker is looked up if not provided.</p>
</dd></dl>

<dl class="function">
<dt id="zope.security.checker.canWrite">
<tt class="descclassname">zope.security.checker.</tt><tt class="descname">canWrite</tt><big>(</big><em>obj</em>, <em>name</em><big>)</big><a class="reference internal" href="../_modules/zope/security/checker.html#canWrite"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#zope.security.checker.canWrite" title="Permalink to this definition">¶</a></dt>
<dd><p>Check whether the interaction may write an attribute named name on obj.</p>
<p>Convenience method.  Rather than using checkPermission in high level code,
use canWrite and canAccess to avoid binding code to permissions.</p>
</dd></dl>

<dl class="function">
<dt id="zope.security.checker.canAccess">
<tt class="descclassname">zope.security.checker.</tt><tt class="descname">canAccess</tt><big>(</big><em>obj</em>, <em>name</em><big>)</big><a class="reference internal" href="../_modules/zope/security/checker.html#canAccess"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#zope.security.checker.canAccess" title="Permalink to this definition">¶</a></dt>
<dd><p>Check whether the interaction may access an attribute named name on obj.</p>
<p>Convenience method.  Rather than using checkPermission in high level code,
use canWrite and canAccess to avoid binding code to permissions.</p>
</dd></dl>

<dl class="class">
<dt id="zope.security.checker.Global">
<em class="property">class </em><tt class="descclassname">zope.security.checker.</tt><tt class="descname">Global</tt><big>(</big><em>name</em>, <em>module=None</em><big>)</big><a class="reference internal" href="../_modules/zope/security/checker.html#Global"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#zope.security.checker.Global" title="Permalink to this definition">¶</a></dt>
<dd><p>Bases: <tt class="xref py py-class docutils literal"><span class="pre">builtins.object</span></tt></p>
<p>A global object that behaves like a string.</p>
<p>We want this to behave as a global, meaning it&#8217;s pickled
by name, rather than value. We need to arrange that it has a suitable
__reduce__.</p>
</dd></dl>

<dl class="function">
<dt id="zope.security.checker.NamesChecker">
<tt class="descclassname">zope.security.checker.</tt><tt class="descname">NamesChecker</tt><big>(</big><em>names=()</em>, <em>permission_id=Global(CheckerPublic</em>, <em>zope.security.checker)</em>, <em>**__kw__</em><big>)</big><a class="reference internal" href="../_modules/zope/security/checker.html#NamesChecker"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#zope.security.checker.NamesChecker" title="Permalink to this definition">¶</a></dt>
<dd><p>Return a checker that grants access to a set of names.</p>
<p>A sequence of names is given as the first argument. If a second
argument, permission_id, is given, it is the permission required
to access the names.  Additional names and permission ids can be
supplied as keyword arguments.</p>
</dd></dl>

<dl class="function">
<dt id="zope.security.checker.MultiChecker">
<tt class="descclassname">zope.security.checker.</tt><tt class="descname">MultiChecker</tt><big>(</big><em>specs</em><big>)</big><a class="reference internal" href="../_modules/zope/security/checker.html#MultiChecker"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#zope.security.checker.MultiChecker" title="Permalink to this definition">¶</a></dt>
<dd><p>Create a checker from a sequence of specifications</p>
<p>A specification is:</p>
<ul>
<li><p class="first">A two-tuple with:</p>
<p>o a sequence of names or an interface</p>
<p>o a permission id</p>
<p>All the names in the sequence of names or the interface are
protected by the permission.</p>
</li>
<li><p class="first">A dictionoid (having an items method), with items that are
name/permission-id pairs.</p>
</li>
</ul>
</dd></dl>

<dl class="function">
<dt id="zope.security.checker.selectCheckerPy">
<tt class="descclassname">zope.security.checker.</tt><tt class="descname">selectCheckerPy</tt><big>(</big><em>object</em><big>)</big><a class="reference internal" href="../_modules/zope/security/checker.html#selectCheckerPy"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#zope.security.checker.selectCheckerPy" title="Permalink to this definition">¶</a></dt>
<dd><p>Get a checker for the given object</p>
<p>The appropriate checker is returned or None is returned. If the
return value is None, then object should not be wrapped in a proxy.</p>
</dd></dl>

<dl class="function">
<dt id="zope.security.checker.defineChecker">
<tt class="descclassname">zope.security.checker.</tt><tt class="descname">defineChecker</tt><big>(</big><em>type_</em>, <em>checker</em><big>)</big><a class="reference internal" href="../_modules/zope/security/checker.html#defineChecker"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#zope.security.checker.defineChecker" title="Permalink to this definition">¶</a></dt>
<dd><p>Define a checker for a given type of object</p>
<p>The checker can be a Checker, or a function that, when called with
an object, returns a Checker.</p>
</dd></dl>

<dl class="class">
<dt id="zope.security.checker.CheckerLoggingMixin">
<em class="property">class </em><tt class="descclassname">zope.security.checker.</tt><tt class="descname">CheckerLoggingMixin</tt><a class="reference internal" href="../_modules/zope/security/checker.html#CheckerLoggingMixin"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#zope.security.checker.CheckerLoggingMixin" title="Permalink to this definition">¶</a></dt>
<dd><p>Bases: <tt class="xref py py-class docutils literal"><span class="pre">builtins.object</span></tt></p>
<p>Debugging mixin for checkers.</p>
<p>Prints verbose debugging information about every performed check to
sys.stderr.</p>
<p>If verbosity is set to 1, only displays Unauthorized and Forbidden messages.
If verbosity is set to a larger number, displays all messages.</p>
</dd></dl>

<dl class="class">
<dt id="zope.security.checker.Checker">
<em class="property">class </em><tt class="descclassname">zope.security.checker.</tt><tt class="descname">Checker</tt><a class="reference internal" href="../_modules/zope/security/checker.html#Checker"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#zope.security.checker.Checker" title="Permalink to this definition">¶</a></dt>
<dd><p>Bases: <tt class="xref py py-class docutils literal"><span class="pre">builtins.object</span></tt></p>
<p>Security checker</p>
<dl class="method">
<dt id="zope.security.checker.Checker.check">
<tt class="descname">check</tt><big>(</big><big>)</big><a class="headerlink" href="#zope.security.checker.Checker.check" title="Permalink to this definition">¶</a></dt>
<dd><p>check(object, opname) &#8211; Check whether an operation is allowes</p>
</dd></dl>

<dl class="method">
<dt id="zope.security.checker.Checker.check_getattr">
<tt class="descname">check_getattr</tt><big>(</big><big>)</big><a class="headerlink" href="#zope.security.checker.Checker.check_getattr" title="Permalink to this definition">¶</a></dt>
<dd><p>check_getattr(object, name) &#8211; Check whether a getattr is allowes</p>
</dd></dl>

<dl class="method">
<dt id="zope.security.checker.Checker.check_setattr">
<tt class="descname">check_setattr</tt><big>(</big><big>)</big><a class="headerlink" href="#zope.security.checker.Checker.check_setattr" title="Permalink to this definition">¶</a></dt>
<dd><p>check_setattr(object, name) &#8211; Check whether a setattr is allowes</p>
</dd></dl>

<dl class="attribute">
<dt id="zope.security.checker.Checker.get_permissions">
<tt class="descname">get_permissions</tt><a class="headerlink" href="#zope.security.checker.Checker.get_permissions" title="Permalink to this definition">¶</a></dt>
<dd><p>getattr name to permission dictionary</p>
</dd></dl>

<dl class="method">
<dt id="zope.security.checker.Checker.permission_id">
<tt class="descname">permission_id</tt><big>(</big><big>)</big><a class="headerlink" href="#zope.security.checker.Checker.permission_id" title="Permalink to this definition">¶</a></dt>
<dd><p>permission_id(name) &#8211; Return the permission neded to get the name</p>
</dd></dl>

<dl class="method">
<dt id="zope.security.checker.Checker.proxy">
<tt class="descname">proxy</tt><big>(</big><big>)</big><a class="headerlink" href="#zope.security.checker.Checker.proxy" title="Permalink to this definition">¶</a></dt>
<dd><p>proxy(object) &#8211; Security-proxy an object</p>
</dd></dl>

<dl class="attribute">
<dt id="zope.security.checker.Checker.set_permissions">
<tt class="descname">set_permissions</tt><a class="headerlink" href="#zope.security.checker.Checker.set_permissions" title="Permalink to this definition">¶</a></dt>
<dd><p>setattr name to permission dictionary</p>
</dd></dl>

<dl class="method">
<dt id="zope.security.checker.Checker.setattr_permission_id">
<tt class="descname">setattr_permission_id</tt><big>(</big><big>)</big><a class="headerlink" href="#zope.security.checker.Checker.setattr_permission_id" title="Permalink to this definition">¶</a></dt>
<dd><p>setattr_permission_id(name) &#8211; Return the permission neded to set the name</p>
</dd></dl>

</dd></dl>

<dl class="class">
<dt id="zope.security.checker.CombinedChecker">
<em class="property">class </em><tt class="descclassname">zope.security.checker.</tt><tt class="descname">CombinedChecker</tt><big>(</big><em>checker1</em>, <em>checker2</em><big>)</big><a class="reference internal" href="../_modules/zope/security/checker.html#CombinedChecker"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#zope.security.checker.CombinedChecker" title="Permalink to this definition">¶</a></dt>
<dd><p>Bases: <a class="reference internal" href="#zope.security.checker.Checker" title="zope.security.checker.Checker"><tt class="xref py py-class docutils literal"><span class="pre">zope.security.checker.Checker</span></tt></a></p>
<p>A checker that combines two other checkers in a logical-or fashion.</p>
<p>The following table describes the result of a combined checker in detail.</p>
<p>checker1           checker2           CombinedChecker(checker1, checker2)
&#8212;&#8212;&#8212;&#8212;&#8212;&#8212; &#8212;&#8212;&#8212;&#8212;&#8212;&#8212; &#8212;&#8212;&#8212;&#8212;&#8212;&#8212;&#8212;&#8212;&#8212;&#8212;&#8212;&#8211;
ok                 anything           ok (checker2 is never called)
Unauthorized       ok                 ok
Unauthorized       Unauthorized       Unauthorized
Unauthorized       ForbiddenAttribute Unauthorized
ForbiddenAttribute ok                 ok
ForbiddenAttribute Unauthorized       Unauthorized
ForbiddenAttribute ForbiddenAttribute ForbiddenAttribute
&#8212;&#8212;&#8212;&#8212;&#8212;&#8212; &#8212;&#8212;&#8212;&#8212;&#8212;&#8212; &#8212;&#8212;&#8212;&#8212;&#8212;&#8212;&#8212;&#8212;&#8212;&#8212;&#8212;&#8211;</p>
<dl class="function">
<dt id="zope.security.checker.CombinedChecker.check">
<tt class="descname">check</tt><big>(</big><em>self</em>, <em>object</em>, <em>name</em><big>)</big><a class="reference internal" href="../_modules/zope/security/checker.html#CombinedChecker.check"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#zope.security.checker.CombinedChecker.check" title="Permalink to this definition">¶</a></dt>
<dd><p>See IChecker</p>
</dd></dl>

<dl class="function">
<dt id="zope.security.checker.CombinedChecker.check_getattr">
<tt class="descname">check_getattr</tt><big>(</big><em>self</em>, <em>object</em>, <em>name</em><big>)</big><a class="headerlink" href="#zope.security.checker.CombinedChecker.check_getattr" title="Permalink to this definition">¶</a></dt>
<dd><p>See IChecker</p>
</dd></dl>

<dl class="function">
<dt id="zope.security.checker.CombinedChecker.check_setattr">
<tt class="descname">check_setattr</tt><big>(</big><em>self</em>, <em>object</em>, <em>name</em><big>)</big><a class="reference internal" href="../_modules/zope/security/checker.html#CombinedChecker.check_setattr"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#zope.security.checker.CombinedChecker.check_setattr" title="Permalink to this definition">¶</a></dt>
<dd><p>See IChecker</p>
</dd></dl>

</dd></dl>

<div class="section" id="protections-for-modules">
<h2>Protections for Modules<a class="headerlink" href="#protections-for-modules" title="Permalink to this headline">¶</a></h2>
<p>The <tt class="xref py py-func docutils literal"><span class="pre">zope.secuirty.checker.moduleChecker()</span></tt> API can be used to
determine whether a module has been protected: Initially, there&#8217;s no checker
defined for the module:</p>
<div class="highlight-python"><div class="highlight"><pre><span class="gp">&gt;&gt;&gt; </span><span class="kn">from</span> <span class="nn">zope.security.checker</span> <span class="kn">import</span> <span class="n">moduleChecker</span>
<span class="gp">&gt;&gt;&gt; </span><span class="kn">from</span> <span class="nn">zope.security.tests</span> <span class="kn">import</span> <span class="n">test_zcml_functest</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">moduleChecker</span><span class="p">(</span><span class="n">test_zcml_functest</span><span class="p">)</span> <span class="ow">is</span> <span class="bp">None</span>
<span class="go">True</span>
</pre></div>
</div>
<p>We can add a checker using <tt class="xref py py-func docutils literal"><span class="pre">zope.security.metaconfigure.protectModule()</span></tt>:</p>
<div class="highlight-python"><div class="highlight"><pre><span class="gp">&gt;&gt;&gt; </span><span class="kn">from</span> <span class="nn">zope.component</span> <span class="kn">import</span> <span class="n">provideUtility</span>
<span class="gp">&gt;&gt;&gt; </span><span class="kn">from</span> <span class="nn">zope.security.metaconfigure</span> <span class="kn">import</span> <span class="n">protectModule</span>
<span class="gp">&gt;&gt;&gt; </span><span class="kn">from</span> <span class="nn">zope.security.permission</span> <span class="kn">import</span> <span class="n">Permission</span>
<span class="gp">&gt;&gt;&gt; </span><span class="kn">from</span> <span class="nn">zope.security.interfaces</span> <span class="kn">import</span> <span class="n">IPermission</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">TEST_PERM</span> <span class="o">=</span> <span class="s">&#39;zope.security.metaconfigure.test&#39;</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">perm</span> <span class="o">=</span> <span class="n">Permission</span><span class="p">(</span><span class="n">TEST_PERM</span><span class="p">,</span> <span class="s">&#39;&#39;</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">provideUtility</span><span class="p">(</span><span class="n">perm</span><span class="p">,</span> <span class="n">IPermission</span><span class="p">,</span> <span class="n">TEST_PERM</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">protectModule</span><span class="p">(</span><span class="n">test_zcml_functest</span><span class="p">,</span> <span class="s">&#39;foo&#39;</span><span class="p">,</span> <span class="n">TEST_PERM</span><span class="p">)</span>
</pre></div>
</div>
<p>Now, the checker should exist and have an access dictionary with the
name and permission:</p>
<div class="highlight-python"><div class="highlight"><pre><span class="gp">&gt;&gt;&gt; </span><span class="k">def</span> <span class="nf">pprint</span><span class="p">(</span><span class="n">ob</span><span class="p">,</span> <span class="n">width</span><span class="o">=</span><span class="mi">70</span><span class="p">):</span>
<span class="gp">... </span>    <span class="kn">from</span> <span class="nn">pprint</span> <span class="kn">import</span> <span class="n">PrettyPrinter</span>
<span class="gp">... </span>    <span class="n">PrettyPrinter</span><span class="p">(</span><span class="n">width</span><span class="o">=</span><span class="n">width</span><span class="p">)</span><span class="o">.</span><span class="n">pprint</span><span class="p">(</span><span class="n">ob</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">checker</span> <span class="o">=</span> <span class="n">moduleChecker</span><span class="p">(</span><span class="n">test_zcml_functest</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">cdict</span> <span class="o">=</span> <span class="n">checker</span><span class="o">.</span><span class="n">get_permissions</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">pprint</span><span class="p">(</span><span class="n">cdict</span><span class="p">)</span>
<span class="go">{&#39;foo&#39;: &#39;zope.security.metaconfigure.test&#39;}</span>

<span class="go">If we define additional names, they will be added to the dict:</span>

<span class="gp">&gt;&gt;&gt; </span><span class="n">protectModule</span><span class="p">(</span><span class="n">test_zcml_functest</span><span class="p">,</span> <span class="s">&#39;bar&#39;</span><span class="p">,</span> <span class="n">TEST_PERM</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">protectModule</span><span class="p">(</span><span class="n">test_zcml_functest</span><span class="p">,</span> <span class="s">&#39;baz&#39;</span><span class="p">,</span> <span class="n">TEST_PERM</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">pprint</span><span class="p">(</span><span class="n">cdict</span><span class="p">)</span>
<span class="go">{&#39;bar&#39;: &#39;zope.security.metaconfigure.test&#39;,</span>
<span class="go"> &#39;baz&#39;: &#39;zope.security.metaconfigure.test&#39;,</span>
<span class="go"> &#39;foo&#39;: &#39;zope.security.metaconfigure.test&#39;}</span>
</pre></div>
</div>
<p>The allow directive creates actions for each named defined
directly, or via interface:</p>
<div class="highlight-python"><div class="highlight"><pre><span class="gp">&gt;&gt;&gt; </span><span class="kn">from</span> <span class="nn">zope.interface</span> <span class="kn">import</span> <span class="n">Interface</span>
<span class="gp">&gt;&gt;&gt; </span><span class="kn">from</span> <span class="nn">zope.interface</span> <span class="kn">import</span> <span class="n">Attribute</span>
<span class="gp">&gt;&gt;&gt; </span><span class="kn">from</span> <span class="nn">zope.security.metaconfigure</span> <span class="kn">import</span> <span class="n">allow</span>
<span class="gp">&gt;&gt;&gt; </span><span class="k">class</span> <span class="nc">I1</span><span class="p">(</span><span class="n">Interface</span><span class="p">):</span>
<span class="gp">... </span>    <span class="k">def</span> <span class="nf">x</span><span class="p">():</span> <span class="k">pass</span>
<span class="gp">... </span>    <span class="n">y</span> <span class="o">=</span> <span class="n">Attribute</span><span class="p">(</span><span class="s">&quot;Y&quot;</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="k">class</span> <span class="nc">I2</span><span class="p">(</span><span class="n">I1</span><span class="p">):</span>
<span class="gp">... </span>    <span class="k">def</span> <span class="nf">a</span><span class="p">():</span> <span class="k">pass</span>
<span class="gp">... </span>    <span class="n">b</span> <span class="o">=</span> <span class="n">Attribute</span><span class="p">(</span><span class="s">&quot;B&quot;</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="k">class</span> <span class="nc">AContext</span><span class="p">(</span><span class="nb">object</span><span class="p">):</span>
<span class="gp">... </span>    <span class="k">def</span> <span class="nf">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="gp">... </span>        <span class="bp">self</span><span class="o">.</span><span class="n">actions</span> <span class="o">=</span> <span class="p">[]</span>
<span class="gp">...</span>
<span class="gp">... </span>    <span class="k">def</span> <span class="nf">action</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">discriminator</span><span class="p">,</span> <span class="nb">callable</span><span class="p">,</span> <span class="n">args</span><span class="p">):</span>
<span class="gp">... </span>        <span class="bp">self</span><span class="o">.</span><span class="n">actions</span><span class="o">.</span><span class="n">append</span><span class="p">(</span>
<span class="gp">... </span>            <span class="p">{</span><span class="s">&#39;discriminator&#39;</span><span class="p">:</span> <span class="n">discriminator</span><span class="p">,</span>
<span class="gp">... </span>             <span class="s">&#39;callable&#39;</span><span class="p">:</span> <span class="nb">int</span><span class="p">(</span><span class="nb">callable</span> <span class="ow">is</span> <span class="n">protectModule</span><span class="p">),</span>
<span class="gp">... </span>             <span class="s">&#39;args&#39;</span><span class="p">:</span> <span class="n">args</span><span class="p">})</span>
<span class="gp">... </span>    <span class="n">module</span><span class="o">=</span><span class="s">&#39;testmodule&#39;</span>

<span class="gp">&gt;&gt;&gt; </span><span class="n">context</span> <span class="o">=</span> <span class="n">AContext</span><span class="p">()</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">allow</span><span class="p">(</span><span class="n">context</span><span class="p">,</span> <span class="n">attributes</span><span class="o">=</span><span class="p">[</span><span class="s">&#39;foo&#39;</span><span class="p">,</span> <span class="s">&#39;bar&#39;</span><span class="p">],</span> <span class="n">interface</span><span class="o">=</span><span class="p">[</span><span class="n">I1</span><span class="p">,</span> <span class="n">I2</span><span class="p">])</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">context</span><span class="o">.</span><span class="n">actions</span><span class="o">.</span><span class="n">sort</span><span class="p">(</span><span class="n">key</span><span class="o">=</span><span class="k">lambda</span> <span class="n">a</span><span class="p">:</span> <span class="n">a</span><span class="p">[</span><span class="s">&#39;discriminator&#39;</span><span class="p">])</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">pprint</span><span class="p">(</span><span class="n">context</span><span class="o">.</span><span class="n">actions</span><span class="p">)</span>
<span class="go">[{&#39;args&#39;: (&#39;testmodule&#39;, &#39;a&#39;, &#39;zope.Public&#39;),</span>
<span class="go">  &#39;callable&#39;: 1,</span>
<span class="go">  &#39;discriminator&#39;: (&#39;http://namespaces.zope.org/zope:module&#39;,</span>
<span class="go">                    &#39;testmodule&#39;,</span>
<span class="go">                    &#39;a&#39;)},</span>
<span class="go"> {&#39;args&#39;: (&#39;testmodule&#39;, &#39;b&#39;, &#39;zope.Public&#39;),</span>
<span class="go">  &#39;callable&#39;: 1,</span>
<span class="go">  &#39;discriminator&#39;: (&#39;http://namespaces.zope.org/zope:module&#39;,</span>
<span class="go">                    &#39;testmodule&#39;,</span>
<span class="go">                    &#39;b&#39;)},</span>
<span class="go"> {&#39;args&#39;: (&#39;testmodule&#39;, &#39;bar&#39;, &#39;zope.Public&#39;),</span>
<span class="go">  &#39;callable&#39;: 1,</span>
<span class="go">  &#39;discriminator&#39;: (&#39;http://namespaces.zope.org/zope:module&#39;,</span>
<span class="go">                    &#39;testmodule&#39;,</span>
<span class="go">                    &#39;bar&#39;)},</span>
<span class="go"> {&#39;args&#39;: (&#39;testmodule&#39;, &#39;foo&#39;, &#39;zope.Public&#39;),</span>
<span class="go">  &#39;callable&#39;: 1,</span>
<span class="go">  &#39;discriminator&#39;: (&#39;http://namespaces.zope.org/zope:module&#39;,</span>
<span class="go">                    &#39;testmodule&#39;,</span>
<span class="go">                    &#39;foo&#39;)},</span>
<span class="go"> {&#39;args&#39;: (&#39;testmodule&#39;, &#39;x&#39;, &#39;zope.Public&#39;),</span>
<span class="go">  &#39;callable&#39;: 1,</span>
<span class="go">  &#39;discriminator&#39;: (&#39;http://namespaces.zope.org/zope:module&#39;,</span>
<span class="go">                    &#39;testmodule&#39;,</span>
<span class="go">                    &#39;x&#39;)},</span>
<span class="go"> {&#39;args&#39;: (&#39;testmodule&#39;, &#39;y&#39;, &#39;zope.Public&#39;),</span>
<span class="go">  &#39;callable&#39;: 1,</span>
<span class="go">  &#39;discriminator&#39;: (&#39;http://namespaces.zope.org/zope:module&#39;,</span>
<span class="go">                    &#39;testmodule&#39;,</span>
<span class="go">                    &#39;y&#39;)}]</span>
</pre></div>
</div>
<p>The provide directive creates actions for each named defined
directly, or via interface:</p>
<div class="highlight-python"><div class="highlight"><pre><span class="gp">&gt;&gt;&gt; </span><span class="kn">from</span> <span class="nn">zope.security.metaconfigure</span> <span class="kn">import</span> <span class="n">require</span>
<span class="gp">&gt;&gt;&gt; </span><span class="k">class</span> <span class="nc">RContext</span><span class="p">(</span><span class="nb">object</span><span class="p">):</span>
<span class="gp">... </span>    <span class="k">def</span> <span class="nf">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="gp">... </span>        <span class="bp">self</span><span class="o">.</span><span class="n">actions</span> <span class="o">=</span> <span class="p">[]</span>
<span class="gp">... </span>    <span class="k">def</span> <span class="nf">action</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">discriminator</span><span class="p">,</span> <span class="nb">callable</span><span class="p">,</span> <span class="n">args</span><span class="p">):</span>
<span class="gp">... </span>        <span class="bp">self</span><span class="o">.</span><span class="n">actions</span><span class="o">.</span><span class="n">append</span><span class="p">(</span>
<span class="gp">... </span>            <span class="p">{</span><span class="s">&#39;discriminator&#39;</span><span class="p">:</span> <span class="n">discriminator</span><span class="p">,</span>
<span class="gp">... </span>             <span class="s">&#39;callable&#39;</span><span class="p">:</span> <span class="nb">int</span><span class="p">(</span><span class="nb">callable</span> <span class="ow">is</span> <span class="n">protectModule</span><span class="p">),</span>
<span class="gp">... </span>             <span class="s">&#39;args&#39;</span><span class="p">:</span> <span class="n">args</span><span class="p">})</span>
<span class="gp">... </span>    <span class="n">module</span><span class="o">=</span><span class="s">&#39;testmodule&#39;</span>

<span class="gp">&gt;&gt;&gt; </span><span class="n">context</span> <span class="o">=</span> <span class="n">RContext</span><span class="p">()</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">require</span><span class="p">(</span><span class="n">context</span><span class="p">,</span> <span class="n">attributes</span><span class="o">=</span><span class="p">[</span><span class="s">&#39;foo&#39;</span><span class="p">,</span> <span class="s">&#39;bar&#39;</span><span class="p">],</span>
<span class="gp">... </span>        <span class="n">interface</span><span class="o">=</span><span class="p">[</span><span class="n">I1</span><span class="p">,</span> <span class="n">I2</span><span class="p">],</span> <span class="n">permission</span><span class="o">=</span><span class="s">&#39;p&#39;</span><span class="p">)</span>

<span class="gp">&gt;&gt;&gt; </span><span class="n">context</span><span class="o">.</span><span class="n">actions</span><span class="o">.</span><span class="n">sort</span><span class="p">(</span><span class="n">key</span><span class="o">=</span><span class="k">lambda</span> <span class="n">a</span><span class="p">:</span> <span class="n">a</span><span class="p">[</span><span class="s">&#39;discriminator&#39;</span><span class="p">])</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">pprint</span><span class="p">(</span><span class="n">context</span><span class="o">.</span><span class="n">actions</span><span class="p">)</span>
<span class="go">[{&#39;args&#39;: (&#39;testmodule&#39;, &#39;a&#39;, &#39;p&#39;),</span>
<span class="go">  &#39;callable&#39;: 1,</span>
<span class="go">  &#39;discriminator&#39;: (&#39;http://namespaces.zope.org/zope:module&#39;,</span>
<span class="go">                    &#39;testmodule&#39;,</span>
<span class="go">                    &#39;a&#39;)},</span>
<span class="go"> {&#39;args&#39;: (&#39;testmodule&#39;, &#39;b&#39;, &#39;p&#39;),</span>
<span class="go">  &#39;callable&#39;: 1,</span>
<span class="go">  &#39;discriminator&#39;: (&#39;http://namespaces.zope.org/zope:module&#39;,</span>
<span class="go">                    &#39;testmodule&#39;,</span>
<span class="go">                    &#39;b&#39;)},</span>
<span class="go"> {&#39;args&#39;: (&#39;testmodule&#39;, &#39;bar&#39;, &#39;p&#39;),</span>
<span class="go">  &#39;callable&#39;: 1,</span>
<span class="go">  &#39;discriminator&#39;: (&#39;http://namespaces.zope.org/zope:module&#39;,</span>
<span class="go">                    &#39;testmodule&#39;,</span>
<span class="go">                    &#39;bar&#39;)},</span>
<span class="go"> {&#39;args&#39;: (&#39;testmodule&#39;, &#39;foo&#39;, &#39;p&#39;),</span>
<span class="go">  &#39;callable&#39;: 1,</span>
<span class="go">  &#39;discriminator&#39;: (&#39;http://namespaces.zope.org/zope:module&#39;,</span>
<span class="go">                    &#39;testmodule&#39;,</span>
<span class="go">                    &#39;foo&#39;)},</span>
<span class="go"> {&#39;args&#39;: (&#39;testmodule&#39;, &#39;x&#39;, &#39;p&#39;),</span>
<span class="go">  &#39;callable&#39;: 1,</span>
<span class="go">  &#39;discriminator&#39;: (&#39;http://namespaces.zope.org/zope:module&#39;,</span>
<span class="go">                    &#39;testmodule&#39;,</span>
<span class="go">                    &#39;x&#39;)},</span>
<span class="go"> {&#39;args&#39;: (&#39;testmodule&#39;, &#39;y&#39;, &#39;p&#39;),</span>
<span class="go">  &#39;callable&#39;: 1,</span>
<span class="go">  &#39;discriminator&#39;: (&#39;http://namespaces.zope.org/zope:module&#39;,</span>
<span class="go">                    &#39;testmodule&#39;,</span>
<span class="go">                    &#39;y&#39;)}]</span>
</pre></div>
</div>
</div>
<div class="section" id="protections-for-standard-objects">
<h2>Protections for standard objects<a class="headerlink" href="#protections-for-standard-objects" title="Permalink to this headline">¶</a></h2>
<div class="highlight-python"><div class="highlight"><pre><span class="gp">&gt;&gt;&gt; </span><span class="kn">from</span> <span class="nn">zope.security.checker</span> <span class="kn">import</span> <span class="n">ProxyFactory</span>
<span class="gp">&gt;&gt;&gt; </span><span class="kn">from</span> <span class="nn">zope.security.interfaces</span> <span class="kn">import</span> <span class="n">ForbiddenAttribute</span>
<span class="gp">&gt;&gt;&gt; </span><span class="k">def</span> <span class="nf">check_forbidden_get</span><span class="p">(</span><span class="nb">object</span><span class="p">,</span> <span class="n">attr</span><span class="p">):</span>
<span class="gp">... </span>    <span class="kn">from</span> <span class="nn">zope.security.interfaces</span> <span class="kn">import</span> <span class="n">ForbiddenAttribute</span>
<span class="gp">... </span>    <span class="k">try</span><span class="p">:</span>
<span class="gp">... </span>        <span class="k">return</span> <span class="nb">getattr</span><span class="p">(</span><span class="nb">object</span><span class="p">,</span> <span class="n">attr</span><span class="p">)</span>
<span class="gp">... </span>    <span class="k">except</span> <span class="n">ForbiddenAttribute</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
<span class="gp">... </span>        <span class="k">return</span> <span class="s">&#39;ForbiddenAttribute: </span><span class="si">%s</span><span class="s">&#39;</span> <span class="o">%</span> <span class="n">e</span><span class="o">.</span><span class="n">args</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
<span class="gp">&gt;&gt;&gt; </span><span class="k">def</span> <span class="nf">check_forbidden_setitem</span><span class="p">(</span><span class="nb">object</span><span class="p">,</span> <span class="n">item</span><span class="p">,</span> <span class="n">value</span><span class="p">):</span>
<span class="gp">... </span>    <span class="kn">from</span> <span class="nn">zope.security.interfaces</span> <span class="kn">import</span> <span class="n">ForbiddenAttribute</span>
<span class="gp">... </span>    <span class="k">try</span><span class="p">:</span>
<span class="gp">... </span>        <span class="nb">object</span><span class="p">[</span><span class="n">item</span><span class="p">]</span> <span class="o">=</span> <span class="n">value</span>
<span class="gp">... </span>    <span class="k">except</span> <span class="n">ForbiddenAttribute</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
<span class="gp">... </span>        <span class="k">return</span> <span class="s">&#39;ForbiddenAttribute: </span><span class="si">%s</span><span class="s">&#39;</span> <span class="o">%</span> <span class="n">e</span><span class="o">.</span><span class="n">args</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
<span class="gp">&gt;&gt;&gt; </span><span class="k">def</span> <span class="nf">check_forbidden_delitem</span><span class="p">(</span><span class="nb">object</span><span class="p">,</span> <span class="n">item</span><span class="p">):</span>
<span class="gp">... </span>    <span class="kn">from</span> <span class="nn">zope.security.interfaces</span> <span class="kn">import</span> <span class="n">ForbiddenAttribute</span>
<span class="gp">... </span>    <span class="k">try</span><span class="p">:</span>
<span class="gp">... </span>        <span class="k">del</span> <span class="nb">object</span><span class="p">[</span><span class="n">item</span><span class="p">]</span>
<span class="gp">... </span>    <span class="k">except</span> <span class="n">ForbiddenAttribute</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
<span class="gp">... </span>        <span class="k">return</span> <span class="s">&#39;ForbiddenAttribute: </span><span class="si">%s</span><span class="s">&#39;</span> <span class="o">%</span> <span class="n">e</span><span class="o">.</span><span class="n">args</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
<span class="gp">&gt;&gt;&gt; </span><span class="k">def</span> <span class="nf">check_forbidden_call</span><span class="p">(</span><span class="nb">callable</span><span class="p">,</span> <span class="o">*</span><span class="n">args</span><span class="p">):</span> <span class="c"># **</span>
<span class="gp">... </span>    <span class="kn">from</span> <span class="nn">zope.security.interfaces</span> <span class="kn">import</span> <span class="n">ForbiddenAttribute</span>
<span class="gp">... </span>    <span class="k">try</span><span class="p">:</span>
<span class="gp">... </span>        <span class="k">return</span> <span class="nb">callable</span><span class="p">(</span><span class="o">*</span><span class="n">args</span><span class="p">)</span> <span class="c"># **</span>
<span class="gp">... </span>    <span class="k">except</span> <span class="n">ForbiddenAttribute</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
<span class="gp">... </span>        <span class="k">return</span> <span class="s">&#39;ForbiddenAttribute: </span><span class="si">%s</span><span class="s">&#39;</span> <span class="o">%</span> <span class="n">e</span><span class="o">.</span><span class="n">args</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
</pre></div>
</div>
<div class="section" id="rocks">
<h3>Rocks<a class="headerlink" href="#rocks" title="Permalink to this headline">¶</a></h3>
<p>Rocks are immuatle, non-callable objects without interesting methods.  They
<em>don&#8217;t</em> get proxied.</p>
<div class="highlight-python"><div class="highlight"><pre><span class="gp">&gt;&gt;&gt; </span><span class="nb">int</span><span class="p">(</span><span class="nb">type</span><span class="p">(</span><span class="n">ProxyFactory</span><span class="p">(</span>  <span class="nb">object</span><span class="p">()</span>  <span class="p">))</span> <span class="ow">is</span> <span class="nb">object</span><span class="p">)</span>
<span class="go">1</span>
<span class="gp">&gt;&gt;&gt; </span><span class="nb">int</span><span class="p">(</span><span class="nb">type</span><span class="p">(</span><span class="n">ProxyFactory</span><span class="p">(</span>  <span class="mi">1</span>  <span class="p">))</span> <span class="ow">is</span> <span class="nb">int</span><span class="p">)</span>
<span class="go">1</span>
<span class="gp">&gt;&gt;&gt; </span><span class="nb">int</span><span class="p">(</span><span class="nb">type</span><span class="p">(</span><span class="n">ProxyFactory</span><span class="p">(</span>  <span class="mf">1.0</span>  <span class="p">))</span> <span class="ow">is</span> <span class="nb">float</span><span class="p">)</span>
<span class="go">1</span>
<span class="gp">&gt;&gt;&gt; </span><span class="nb">int</span><span class="p">(</span><span class="nb">type</span><span class="p">(</span><span class="n">ProxyFactory</span><span class="p">(</span>  <span class="mi">1j</span>  <span class="p">))</span> <span class="ow">is</span> <span class="nb">complex</span><span class="p">)</span>
<span class="go">1</span>
<span class="gp">&gt;&gt;&gt; </span><span class="nb">int</span><span class="p">(</span><span class="nb">type</span><span class="p">(</span><span class="n">ProxyFactory</span><span class="p">(</span>  <span class="bp">None</span>  <span class="p">))</span> <span class="ow">is</span> <span class="nb">type</span><span class="p">(</span><span class="bp">None</span><span class="p">))</span>
<span class="go">1</span>
<span class="gp">&gt;&gt;&gt; </span><span class="nb">int</span><span class="p">(</span><span class="nb">type</span><span class="p">(</span><span class="n">ProxyFactory</span><span class="p">(</span>  <span class="s">&#39;xxx&#39;</span>  <span class="p">))</span> <span class="ow">is</span> <span class="nb">str</span><span class="p">)</span>
<span class="go">1</span>
<span class="gp">&gt;&gt;&gt; </span><span class="nb">int</span><span class="p">(</span><span class="nb">type</span><span class="p">(</span><span class="n">ProxyFactory</span><span class="p">(</span>  <span class="bp">True</span>  <span class="p">))</span> <span class="ow">is</span> <span class="nb">type</span><span class="p">(</span><span class="bp">True</span><span class="p">))</span>
<span class="go">1</span>
</pre></div>
</div>
<p>Datetime-reltatd instances are rocks, too:</p>
<div class="highlight-python"><div class="highlight"><pre><span class="gp">&gt;&gt;&gt; </span><span class="kn">from</span> <span class="nn">datetime</span> <span class="kn">import</span> <span class="n">timedelta</span><span class="p">,</span> <span class="n">datetime</span><span class="p">,</span> <span class="n">date</span><span class="p">,</span> <span class="n">time</span><span class="p">,</span> <span class="n">tzinfo</span>
<span class="gp">&gt;&gt;&gt; </span><span class="nb">int</span><span class="p">(</span><span class="nb">type</span><span class="p">(</span><span class="n">ProxyFactory</span><span class="p">(</span>  <span class="n">timedelta</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span>  <span class="p">))</span> <span class="ow">is</span> <span class="n">timedelta</span><span class="p">)</span>
<span class="go">1</span>
<span class="gp">&gt;&gt;&gt; </span><span class="nb">int</span><span class="p">(</span><span class="nb">type</span><span class="p">(</span><span class="n">ProxyFactory</span><span class="p">(</span>  <span class="n">datetime</span><span class="p">(</span><span class="mi">2000</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">)</span>  <span class="p">))</span> <span class="ow">is</span> <span class="n">datetime</span><span class="p">)</span>
<span class="go">1</span>
<span class="gp">&gt;&gt;&gt; </span><span class="nb">int</span><span class="p">(</span><span class="nb">type</span><span class="p">(</span><span class="n">ProxyFactory</span><span class="p">(</span>  <span class="n">date</span><span class="p">(</span><span class="mi">2000</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">)</span>  <span class="p">))</span> <span class="ow">is</span> <span class="n">date</span><span class="p">)</span>
<span class="go">1</span>
<span class="gp">&gt;&gt;&gt; </span><span class="nb">int</span><span class="p">(</span><span class="nb">type</span><span class="p">(</span><span class="n">ProxyFactory</span><span class="p">(</span>  <span class="n">time</span><span class="p">()</span>  <span class="p">))</span> <span class="ow">is</span> <span class="n">time</span><span class="p">)</span>
<span class="go">1</span>
<span class="gp">&gt;&gt;&gt; </span><span class="nb">int</span><span class="p">(</span><span class="nb">type</span><span class="p">(</span><span class="n">ProxyFactory</span><span class="p">(</span>  <span class="n">tzinfo</span><span class="p">()</span> <span class="p">))</span> <span class="ow">is</span> <span class="n">tzinfo</span><span class="p">)</span>
<span class="go">1</span>
<span class="gp">&gt;&gt;&gt; </span><span class="k">try</span><span class="p">:</span>
<span class="gp">... </span>    <span class="kn">from</span> <span class="nn">pytz</span> <span class="kn">import</span> <span class="n">UTC</span>
<span class="gp">... </span><span class="k">except</span> <span class="ne">ImportError</span><span class="p">:</span>  <span class="c"># pytz checker only if pytz is present.</span>
<span class="gp">... </span>    <span class="mi">1</span>
<span class="gp">... </span><span class="k">else</span><span class="p">:</span>
<span class="gp">... </span>     <span class="nb">int</span><span class="p">(</span><span class="nb">type</span><span class="p">(</span><span class="n">ProxyFactory</span><span class="p">(</span>  <span class="n">UTC</span> <span class="p">))</span> <span class="ow">is</span> <span class="nb">type</span><span class="p">(</span><span class="n">UTC</span><span class="p">))</span>
<span class="go">1</span>
</pre></div>
</div>
</div>
<div class="section" id="dicts">
<h3>dicts<a class="headerlink" href="#dicts" title="Permalink to this headline">¶</a></h3>
<p>We can do everything we expect to be able to do with proxied dicts.</p>
<div class="highlight-python"><div class="highlight"><pre><span class="gp">&gt;&gt;&gt; </span><span class="n">d</span> <span class="o">=</span> <span class="n">ProxyFactory</span><span class="p">({</span><span class="s">&#39;a&#39;</span><span class="p">:</span> <span class="mi">1</span><span class="p">,</span> <span class="s">&#39;b&#39;</span><span class="p">:</span> <span class="mi">2</span><span class="p">})</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">check_forbidden_get</span><span class="p">(</span><span class="n">d</span><span class="p">,</span> <span class="s">&#39;clear&#39;</span><span class="p">)</span> <span class="c"># Verify that we are protected</span>
<span class="go">&#39;ForbiddenAttribute: clear&#39;</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">check_forbidden_setitem</span><span class="p">(</span><span class="n">d</span><span class="p">,</span> <span class="mi">3</span><span class="p">,</span> <span class="mi">4</span><span class="p">)</span> <span class="c"># Verify that we are protected</span>
<span class="go">&#39;ForbiddenAttribute: __setitem__&#39;</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">d</span><span class="p">[</span><span class="s">&#39;a&#39;</span><span class="p">]</span>
<span class="go">1</span>
<span class="gp">&gt;&gt;&gt; </span><span class="nb">len</span><span class="p">(</span><span class="n">d</span><span class="p">)</span>
<span class="go">2</span>
<span class="gp">&gt;&gt;&gt; </span><span class="nb">sorted</span><span class="p">(</span><span class="nb">list</span><span class="p">(</span><span class="n">d</span><span class="p">))</span>
<span class="go">[&#39;a&#39;, &#39;b&#39;]</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">d</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s">&#39;a&#39;</span><span class="p">)</span>
<span class="go">1</span>
<span class="gp">&gt;&gt;&gt; </span><span class="nb">int</span><span class="p">(</span><span class="s">&#39;a&#39;</span> <span class="ow">in</span> <span class="n">d</span><span class="p">)</span>
<span class="go">1</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">c</span> <span class="o">=</span> <span class="n">d</span><span class="o">.</span><span class="n">copy</span><span class="p">()</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">check_forbidden_get</span><span class="p">(</span><span class="n">c</span><span class="p">,</span> <span class="s">&#39;clear&#39;</span><span class="p">)</span>
<span class="go">&#39;ForbiddenAttribute: clear&#39;</span>
<span class="gp">&gt;&gt;&gt; </span><span class="nb">int</span><span class="p">(</span><span class="nb">str</span><span class="p">(</span><span class="n">c</span><span class="p">)</span> <span class="ow">in</span> <span class="p">(</span><span class="s">&quot;{&#39;a&#39;: 1, &#39;b&#39;: 2}&quot;</span><span class="p">,</span> <span class="s">&quot;{&#39;b&#39;: 2, &#39;a&#39;: 1}&quot;</span><span class="p">))</span>
<span class="go">1</span>
<span class="gp">&gt;&gt;&gt; </span><span class="nb">int</span><span class="p">(</span><span class="nb">repr</span><span class="p">(</span><span class="n">c</span><span class="p">)</span> <span class="ow">in</span> <span class="p">(</span><span class="s">&quot;{&#39;a&#39;: 1, &#39;b&#39;: 2}&quot;</span><span class="p">,</span> <span class="s">&quot;{&#39;b&#39;: 2, &#39;a&#39;: 1}&quot;</span><span class="p">))</span>
<span class="go">1</span>
<span class="gp">&gt;&gt;&gt; </span><span class="k">def</span> <span class="nf">sorted</span><span class="p">(</span><span class="n">x</span><span class="p">):</span>
<span class="gp">... </span>   <span class="n">x</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="n">x</span><span class="p">)</span>
<span class="gp">... </span>   <span class="n">x</span><span class="o">.</span><span class="n">sort</span><span class="p">()</span>
<span class="gp">... </span>   <span class="k">return</span> <span class="n">x</span>
<span class="gp">&gt;&gt;&gt; </span><span class="nb">sorted</span><span class="p">(</span><span class="n">d</span><span class="o">.</span><span class="n">keys</span><span class="p">())</span>
<span class="go">[&#39;a&#39;, &#39;b&#39;]</span>
<span class="gp">&gt;&gt;&gt; </span><span class="nb">sorted</span><span class="p">(</span><span class="n">d</span><span class="o">.</span><span class="n">values</span><span class="p">())</span>
<span class="go">[1, 2]</span>
<span class="gp">&gt;&gt;&gt; </span><span class="nb">sorted</span><span class="p">(</span><span class="n">d</span><span class="o">.</span><span class="n">items</span><span class="p">())</span>
<span class="go">[(&#39;a&#39;, 1), (&#39;b&#39;, 2)]</span>
</pre></div>
</div>
<p>Always available (note, that dicts in python-3.x are not orderable, so we are
not checking that under python &gt; 2):</p>
<div class="highlight-python"><div class="highlight"><pre><span class="gp">&gt;&gt;&gt; </span><span class="nb">int</span><span class="p">(</span><span class="n">d</span> <span class="o">!=</span> <span class="n">d</span><span class="p">)</span>
<span class="go">0</span>
<span class="gp">&gt;&gt;&gt; </span><span class="nb">int</span><span class="p">(</span><span class="nb">bool</span><span class="p">(</span><span class="n">d</span><span class="p">))</span>
<span class="go">1</span>
<span class="gp">&gt;&gt;&gt; </span><span class="nb">int</span><span class="p">(</span><span class="n">d</span><span class="o">.</span><span class="n">__class__</span> <span class="o">==</span> <span class="nb">dict</span><span class="p">)</span>
<span class="go">1</span>
</pre></div>
</div>
</div>
<div class="section" id="lists">
<h3>lists<a class="headerlink" href="#lists" title="Permalink to this headline">¶</a></h3>
<p>We can do everything we expect to be able to do with proxied lists.</p>
<div class="highlight-python"><div class="highlight"><pre><span class="gp">&gt;&gt;&gt; </span><span class="n">l</span> <span class="o">=</span> <span class="n">ProxyFactory</span><span class="p">([</span><span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">])</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">check_forbidden_delitem</span><span class="p">(</span><span class="n">l</span><span class="p">,</span> <span class="mi">0</span><span class="p">)</span>
<span class="go">&#39;ForbiddenAttribute: __delitem__&#39;</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">check_forbidden_setitem</span><span class="p">(</span><span class="n">l</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">3</span><span class="p">)</span>
<span class="go">&#39;ForbiddenAttribute: __setitem__&#39;</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">l</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
<span class="go">1</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">l</span><span class="p">[</span><span class="mi">0</span><span class="p">:</span><span class="mi">1</span><span class="p">]</span>
<span class="go">[1]</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">check_forbidden_setitem</span><span class="p">(</span><span class="n">l</span><span class="p">[:</span><span class="mi">1</span><span class="p">],</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">2</span><span class="p">)</span>
<span class="go">&#39;ForbiddenAttribute: __setitem__&#39;</span>
<span class="gp">&gt;&gt;&gt; </span><span class="nb">len</span><span class="p">(</span><span class="n">l</span><span class="p">)</span>
<span class="go">2</span>
<span class="gp">&gt;&gt;&gt; </span><span class="nb">tuple</span><span class="p">(</span><span class="n">l</span><span class="p">)</span>
<span class="go">(1, 2)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="nb">int</span><span class="p">(</span><span class="mi">1</span> <span class="ow">in</span> <span class="n">l</span><span class="p">)</span>
<span class="go">1</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">l</span><span class="o">.</span><span class="n">index</span><span class="p">(</span><span class="mi">2</span><span class="p">)</span>
<span class="go">1</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">l</span><span class="o">.</span><span class="n">count</span><span class="p">(</span><span class="mi">2</span><span class="p">)</span>
<span class="go">1</span>
<span class="gp">&gt;&gt;&gt; </span><span class="nb">str</span><span class="p">(</span><span class="n">l</span><span class="p">)</span>
<span class="go">&#39;[1, 2]&#39;</span>
<span class="gp">&gt;&gt;&gt; </span><span class="nb">repr</span><span class="p">(</span><span class="n">l</span><span class="p">)</span>
<span class="go">&#39;[1, 2]&#39;</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">l</span> <span class="o">+</span> <span class="n">l</span>
<span class="go">[1, 2, 1, 2]</span>
</pre></div>
</div>
<p>Always available:</p>
<div class="highlight-python"><div class="highlight"><pre><span class="gp">&gt;&gt;&gt; </span><span class="nb">int</span><span class="p">(</span><span class="n">l</span> <span class="o">&lt;</span> <span class="n">l</span><span class="p">)</span>
<span class="go">0</span>
<span class="gp">&gt;&gt;&gt; </span><span class="nb">int</span><span class="p">(</span><span class="n">l</span> <span class="o">&gt;</span> <span class="n">l</span><span class="p">)</span>
<span class="go">0</span>
<span class="gp">&gt;&gt;&gt; </span><span class="nb">int</span><span class="p">(</span><span class="n">l</span> <span class="o">&lt;=</span> <span class="n">l</span><span class="p">)</span>
<span class="go">1</span>
<span class="gp">&gt;&gt;&gt; </span><span class="nb">int</span><span class="p">(</span><span class="n">l</span> <span class="o">&gt;=</span> <span class="n">l</span><span class="p">)</span>
<span class="go">1</span>
<span class="gp">&gt;&gt;&gt; </span><span class="nb">int</span><span class="p">(</span><span class="n">l</span> <span class="o">==</span> <span class="n">l</span><span class="p">)</span>
<span class="go">1</span>
<span class="gp">&gt;&gt;&gt; </span><span class="nb">int</span><span class="p">(</span><span class="n">l</span> <span class="o">!=</span> <span class="n">l</span><span class="p">)</span>
<span class="go">0</span>
<span class="gp">&gt;&gt;&gt; </span><span class="nb">int</span><span class="p">(</span><span class="nb">bool</span><span class="p">(</span><span class="n">l</span><span class="p">))</span>
<span class="go">1</span>
<span class="gp">&gt;&gt;&gt; </span><span class="nb">int</span><span class="p">(</span><span class="n">l</span><span class="o">.</span><span class="n">__class__</span> <span class="o">==</span> <span class="nb">list</span><span class="p">)</span>
<span class="go">1</span>
</pre></div>
</div>
</div>
<div class="section" id="tuples">
<h3>tuples<a class="headerlink" href="#tuples" title="Permalink to this headline">¶</a></h3>
<p>We can do everything we expect to be able to do with proxied tuples.</p>
<div class="highlight-python"><div class="highlight"><pre><span class="gp">&gt;&gt;&gt; </span><span class="kn">from</span> <span class="nn">zope.security.checker</span> <span class="kn">import</span> <span class="n">ProxyFactory</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">l</span> <span class="o">=</span> <span class="n">ProxyFactory</span><span class="p">((</span><span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">))</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">l</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
<span class="go">1</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">l</span><span class="p">[</span><span class="mi">0</span><span class="p">:</span><span class="mi">1</span><span class="p">]</span>
<span class="go">(1,)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="nb">len</span><span class="p">(</span><span class="n">l</span><span class="p">)</span>
<span class="go">2</span>
<span class="gp">&gt;&gt;&gt; </span><span class="nb">list</span><span class="p">(</span><span class="n">l</span><span class="p">)</span>
<span class="go">[1, 2]</span>
<span class="gp">&gt;&gt;&gt; </span><span class="nb">int</span><span class="p">(</span><span class="mi">1</span> <span class="ow">in</span> <span class="n">l</span><span class="p">)</span>
<span class="go">1</span>
<span class="gp">&gt;&gt;&gt; </span><span class="nb">str</span><span class="p">(</span><span class="n">l</span><span class="p">)</span>
<span class="go">&#39;(1, 2)&#39;</span>
<span class="gp">&gt;&gt;&gt; </span><span class="nb">repr</span><span class="p">(</span><span class="n">l</span><span class="p">)</span>
<span class="go">&#39;(1, 2)&#39;</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">l</span> <span class="o">+</span> <span class="n">l</span>
<span class="go">(1, 2, 1, 2)</span>
</pre></div>
</div>
<p>Always available:</p>
<div class="highlight-python"><div class="highlight"><pre><span class="gp">&gt;&gt;&gt; </span><span class="nb">int</span><span class="p">(</span><span class="n">l</span> <span class="o">&lt;</span> <span class="n">l</span><span class="p">)</span>
<span class="go">0</span>
<span class="gp">&gt;&gt;&gt; </span><span class="nb">int</span><span class="p">(</span><span class="n">l</span> <span class="o">&gt;</span> <span class="n">l</span><span class="p">)</span>
<span class="go">0</span>
<span class="gp">&gt;&gt;&gt; </span><span class="nb">int</span><span class="p">(</span><span class="n">l</span> <span class="o">&lt;=</span> <span class="n">l</span><span class="p">)</span>
<span class="go">1</span>
<span class="gp">&gt;&gt;&gt; </span><span class="nb">int</span><span class="p">(</span><span class="n">l</span> <span class="o">&gt;=</span> <span class="n">l</span><span class="p">)</span>
<span class="go">1</span>
<span class="gp">&gt;&gt;&gt; </span><span class="nb">int</span><span class="p">(</span><span class="n">l</span> <span class="o">==</span> <span class="n">l</span><span class="p">)</span>
<span class="go">1</span>
<span class="gp">&gt;&gt;&gt; </span><span class="nb">int</span><span class="p">(</span><span class="n">l</span> <span class="o">!=</span> <span class="n">l</span><span class="p">)</span>
<span class="go">0</span>
<span class="gp">&gt;&gt;&gt; </span><span class="nb">int</span><span class="p">(</span><span class="nb">bool</span><span class="p">(</span><span class="n">l</span><span class="p">))</span>
<span class="go">1</span>
<span class="gp">&gt;&gt;&gt; </span><span class="nb">int</span><span class="p">(</span><span class="n">l</span><span class="o">.</span><span class="n">__class__</span> <span class="o">==</span> <span class="nb">tuple</span><span class="p">)</span>
<span class="go">1</span>
</pre></div>
</div>
</div>
<div class="section" id="sets">
<h3>sets<a class="headerlink" href="#sets" title="Permalink to this headline">¶</a></h3>
<p>we can do everything we expect to be able to do with proxied sets.</p>
<div class="highlight-python"><div class="highlight"><pre><span class="gp">&gt;&gt;&gt; </span><span class="n">us</span> <span class="o">=</span> <span class="nb">set</span><span class="p">((</span><span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">))</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">s</span> <span class="o">=</span> <span class="n">ProxyFactory</span><span class="p">(</span><span class="n">us</span><span class="p">)</span>

<span class="gp">&gt;&gt;&gt; </span><span class="n">check_forbidden_get</span><span class="p">(</span><span class="n">s</span><span class="p">,</span> <span class="s">&#39;add&#39;</span><span class="p">)</span> <span class="c"># Verify that we are protected</span>
<span class="go">&#39;ForbiddenAttribute: add&#39;</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">check_forbidden_get</span><span class="p">(</span><span class="n">s</span><span class="p">,</span> <span class="s">&#39;remove&#39;</span><span class="p">)</span> <span class="c"># Verify that we are protected</span>
<span class="go">&#39;ForbiddenAttribute: remove&#39;</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">check_forbidden_get</span><span class="p">(</span><span class="n">s</span><span class="p">,</span> <span class="s">&#39;discard&#39;</span><span class="p">)</span> <span class="c"># Verify that we are protected</span>
<span class="go">&#39;ForbiddenAttribute: discard&#39;</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">check_forbidden_get</span><span class="p">(</span><span class="n">s</span><span class="p">,</span> <span class="s">&#39;pop&#39;</span><span class="p">)</span> <span class="c"># Verify that we are protected</span>
<span class="go">&#39;ForbiddenAttribute: pop&#39;</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">check_forbidden_get</span><span class="p">(</span><span class="n">s</span><span class="p">,</span> <span class="s">&#39;clear&#39;</span><span class="p">)</span> <span class="c"># Verify that we are protected</span>
<span class="go">&#39;ForbiddenAttribute: clear&#39;</span>

<span class="gp">&gt;&gt;&gt; </span><span class="nb">len</span><span class="p">(</span><span class="n">s</span><span class="p">)</span>
<span class="go">2</span>

<span class="gp">&gt;&gt;&gt; </span><span class="mi">1</span> <span class="ow">in</span> <span class="n">s</span>
<span class="go">True</span>

<span class="gp">&gt;&gt;&gt; </span><span class="mi">1</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">s</span>
<span class="go">False</span>

<span class="gp">&gt;&gt;&gt; </span><span class="n">s</span><span class="o">.</span><span class="n">issubset</span><span class="p">(</span><span class="nb">set</span><span class="p">((</span><span class="mi">1</span><span class="p">,</span><span class="mi">2</span><span class="p">,</span><span class="mi">3</span><span class="p">)))</span>
<span class="go">True</span>

<span class="gp">&gt;&gt;&gt; </span><span class="n">s</span><span class="o">.</span><span class="n">issuperset</span><span class="p">(</span><span class="nb">set</span><span class="p">((</span><span class="mi">1</span><span class="p">,</span><span class="mi">2</span><span class="p">,</span><span class="mi">3</span><span class="p">)))</span>
<span class="go">False</span>

<span class="gp">&gt;&gt;&gt; </span><span class="n">c</span> <span class="o">=</span> <span class="n">s</span><span class="o">.</span><span class="n">union</span><span class="p">(</span><span class="nb">set</span><span class="p">((</span><span class="mi">2</span><span class="p">,</span> <span class="mi">3</span><span class="p">)))</span>
<span class="gp">&gt;&gt;&gt; </span><span class="nb">sorted</span><span class="p">(</span><span class="n">c</span><span class="p">)</span>
<span class="go">[1, 2, 3]</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">check_forbidden_get</span><span class="p">(</span><span class="n">c</span><span class="p">,</span> <span class="s">&#39;add&#39;</span><span class="p">)</span>
<span class="go">&#39;ForbiddenAttribute: add&#39;</span>

<span class="gp">&gt;&gt;&gt; </span><span class="n">c</span> <span class="o">=</span> <span class="n">s</span> <span class="o">|</span> <span class="nb">set</span><span class="p">((</span><span class="mi">2</span><span class="p">,</span> <span class="mi">3</span><span class="p">))</span>
<span class="gp">&gt;&gt;&gt; </span><span class="nb">sorted</span><span class="p">(</span><span class="n">c</span><span class="p">)</span>
<span class="go">[1, 2, 3]</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">check_forbidden_get</span><span class="p">(</span><span class="n">c</span><span class="p">,</span> <span class="s">&#39;add&#39;</span><span class="p">)</span>
<span class="go">&#39;ForbiddenAttribute: add&#39;</span>

<span class="gp">&gt;&gt;&gt; </span><span class="n">c</span> <span class="o">=</span> <span class="n">s</span> <span class="o">|</span> <span class="n">ProxyFactory</span><span class="p">(</span><span class="nb">set</span><span class="p">((</span><span class="mi">2</span><span class="p">,</span> <span class="mi">3</span><span class="p">)))</span>
<span class="gp">&gt;&gt;&gt; </span><span class="nb">sorted</span><span class="p">(</span><span class="n">c</span><span class="p">)</span>
<span class="go">[1, 2, 3]</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">check_forbidden_get</span><span class="p">(</span><span class="n">c</span><span class="p">,</span> <span class="s">&#39;add&#39;</span><span class="p">)</span>
<span class="go">&#39;ForbiddenAttribute: add&#39;</span>

<span class="gp">&gt;&gt;&gt; </span><span class="n">c</span> <span class="o">=</span> <span class="nb">set</span><span class="p">((</span><span class="mi">2</span><span class="p">,</span> <span class="mi">3</span><span class="p">))</span> <span class="o">|</span> <span class="n">s</span>
<span class="gp">&gt;&gt;&gt; </span><span class="nb">sorted</span><span class="p">(</span><span class="n">c</span><span class="p">)</span>
<span class="go">[1, 2, 3]</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">check_forbidden_get</span><span class="p">(</span><span class="n">c</span><span class="p">,</span> <span class="s">&#39;add&#39;</span><span class="p">)</span>
<span class="go">&#39;ForbiddenAttribute: add&#39;</span>

<span class="gp">&gt;&gt;&gt; </span><span class="n">c</span> <span class="o">=</span> <span class="n">s</span><span class="o">.</span><span class="n">intersection</span><span class="p">(</span><span class="nb">set</span><span class="p">((</span><span class="mi">2</span><span class="p">,</span> <span class="mi">3</span><span class="p">)))</span>
<span class="gp">&gt;&gt;&gt; </span><span class="nb">sorted</span><span class="p">(</span><span class="n">c</span><span class="p">)</span>
<span class="go">[2]</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">check_forbidden_get</span><span class="p">(</span><span class="n">c</span><span class="p">,</span> <span class="s">&#39;add&#39;</span><span class="p">)</span>
<span class="go">&#39;ForbiddenAttribute: add&#39;</span>

<span class="gp">&gt;&gt;&gt; </span><span class="n">c</span> <span class="o">=</span> <span class="n">s</span> <span class="o">&amp;</span> <span class="nb">set</span><span class="p">((</span><span class="mi">2</span><span class="p">,</span> <span class="mi">3</span><span class="p">))</span>
<span class="gp">&gt;&gt;&gt; </span><span class="nb">sorted</span><span class="p">(</span><span class="n">c</span><span class="p">)</span>
<span class="go">[2]</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">check_forbidden_get</span><span class="p">(</span><span class="n">c</span><span class="p">,</span> <span class="s">&#39;add&#39;</span><span class="p">)</span>
<span class="go">&#39;ForbiddenAttribute: add&#39;</span>

<span class="gp">&gt;&gt;&gt; </span><span class="n">c</span> <span class="o">=</span> <span class="n">s</span> <span class="o">&amp;</span> <span class="n">ProxyFactory</span><span class="p">(</span><span class="nb">set</span><span class="p">((</span><span class="mi">2</span><span class="p">,</span> <span class="mi">3</span><span class="p">)))</span>
<span class="gp">&gt;&gt;&gt; </span><span class="nb">sorted</span><span class="p">(</span><span class="n">c</span><span class="p">)</span>
<span class="go">[2]</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">check_forbidden_get</span><span class="p">(</span><span class="n">c</span><span class="p">,</span> <span class="s">&#39;add&#39;</span><span class="p">)</span>
<span class="go">&#39;ForbiddenAttribute: add&#39;</span>

<span class="gp">&gt;&gt;&gt; </span><span class="n">c</span> <span class="o">=</span> <span class="nb">set</span><span class="p">((</span><span class="mi">2</span><span class="p">,</span> <span class="mi">3</span><span class="p">))</span> <span class="o">&amp;</span> <span class="n">s</span>
<span class="gp">&gt;&gt;&gt; </span><span class="nb">sorted</span><span class="p">(</span><span class="n">c</span><span class="p">)</span>
<span class="go">[2]</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">check_forbidden_get</span><span class="p">(</span><span class="n">c</span><span class="p">,</span> <span class="s">&#39;add&#39;</span><span class="p">)</span>
<span class="go">&#39;ForbiddenAttribute: add&#39;</span>

<span class="gp">&gt;&gt;&gt; </span><span class="n">c</span> <span class="o">=</span> <span class="n">s</span><span class="o">.</span><span class="n">difference</span><span class="p">(</span><span class="nb">set</span><span class="p">((</span><span class="mi">2</span><span class="p">,</span> <span class="mi">3</span><span class="p">)))</span>
<span class="gp">&gt;&gt;&gt; </span><span class="nb">sorted</span><span class="p">(</span><span class="n">c</span><span class="p">)</span>
<span class="go">[1]</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">check_forbidden_get</span><span class="p">(</span><span class="n">c</span><span class="p">,</span> <span class="s">&#39;add&#39;</span><span class="p">)</span>
<span class="go">&#39;ForbiddenAttribute: add&#39;</span>

<span class="gp">&gt;&gt;&gt; </span><span class="n">c</span> <span class="o">=</span> <span class="n">s</span> <span class="o">-</span> <span class="n">ProxyFactory</span><span class="p">(</span><span class="nb">set</span><span class="p">((</span><span class="mi">2</span><span class="p">,</span> <span class="mi">3</span><span class="p">)))</span>
<span class="gp">&gt;&gt;&gt; </span><span class="nb">sorted</span><span class="p">(</span><span class="n">c</span><span class="p">)</span>
<span class="go">[1]</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">check_forbidden_get</span><span class="p">(</span><span class="n">c</span><span class="p">,</span> <span class="s">&#39;add&#39;</span><span class="p">)</span>
<span class="go">&#39;ForbiddenAttribute: add&#39;</span>

<span class="gp">&gt;&gt;&gt; </span><span class="n">c</span> <span class="o">=</span> <span class="n">s</span> <span class="o">-</span> <span class="nb">set</span><span class="p">((</span><span class="mi">2</span><span class="p">,</span> <span class="mi">3</span><span class="p">))</span>
<span class="gp">&gt;&gt;&gt; </span><span class="nb">sorted</span><span class="p">(</span><span class="n">c</span><span class="p">)</span>
<span class="go">[1]</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">check_forbidden_get</span><span class="p">(</span><span class="n">c</span><span class="p">,</span> <span class="s">&#39;add&#39;</span><span class="p">)</span>
<span class="go">&#39;ForbiddenAttribute: add&#39;</span>

<span class="gp">&gt;&gt;&gt; </span><span class="n">c</span> <span class="o">=</span> <span class="nb">set</span><span class="p">((</span><span class="mi">2</span><span class="p">,</span> <span class="mi">3</span><span class="p">))</span> <span class="o">-</span> <span class="n">s</span>
<span class="gp">&gt;&gt;&gt; </span><span class="nb">sorted</span><span class="p">(</span><span class="n">c</span><span class="p">)</span>
<span class="go">[3]</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">check_forbidden_get</span><span class="p">(</span><span class="n">c</span><span class="p">,</span> <span class="s">&#39;add&#39;</span><span class="p">)</span>
<span class="go">&#39;ForbiddenAttribute: add&#39;</span>

<span class="gp">&gt;&gt;&gt; </span><span class="n">c</span> <span class="o">=</span> <span class="n">s</span><span class="o">.</span><span class="n">symmetric_difference</span><span class="p">(</span><span class="nb">set</span><span class="p">((</span><span class="mi">2</span><span class="p">,</span> <span class="mi">3</span><span class="p">)))</span>
<span class="gp">&gt;&gt;&gt; </span><span class="nb">sorted</span><span class="p">(</span><span class="n">c</span><span class="p">)</span>
<span class="go">[1, 3]</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">check_forbidden_get</span><span class="p">(</span><span class="n">c</span><span class="p">,</span> <span class="s">&#39;add&#39;</span><span class="p">)</span>
<span class="go">&#39;ForbiddenAttribute: add&#39;</span>

<span class="gp">&gt;&gt;&gt; </span><span class="n">c</span> <span class="o">=</span> <span class="n">s</span> <span class="o">^</span> <span class="nb">set</span><span class="p">((</span><span class="mi">2</span><span class="p">,</span> <span class="mi">3</span><span class="p">))</span>
<span class="gp">&gt;&gt;&gt; </span><span class="nb">sorted</span><span class="p">(</span><span class="n">c</span><span class="p">)</span>
<span class="go">[1, 3]</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">check_forbidden_get</span><span class="p">(</span><span class="n">c</span><span class="p">,</span> <span class="s">&#39;add&#39;</span><span class="p">)</span>
<span class="go">&#39;ForbiddenAttribute: add&#39;</span>

<span class="gp">&gt;&gt;&gt; </span><span class="n">c</span> <span class="o">=</span> <span class="n">s</span> <span class="o">^</span> <span class="n">ProxyFactory</span><span class="p">(</span><span class="nb">set</span><span class="p">((</span><span class="mi">2</span><span class="p">,</span> <span class="mi">3</span><span class="p">)))</span>
<span class="gp">&gt;&gt;&gt; </span><span class="nb">sorted</span><span class="p">(</span><span class="n">c</span><span class="p">)</span>
<span class="go">[1, 3]</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">check_forbidden_get</span><span class="p">(</span><span class="n">c</span><span class="p">,</span> <span class="s">&#39;add&#39;</span><span class="p">)</span>
<span class="go">&#39;ForbiddenAttribute: add&#39;</span>

<span class="gp">&gt;&gt;&gt; </span><span class="n">c</span> <span class="o">=</span> <span class="nb">set</span><span class="p">((</span><span class="mi">2</span><span class="p">,</span> <span class="mi">3</span><span class="p">))</span> <span class="o">^</span> <span class="n">s</span>
<span class="gp">&gt;&gt;&gt; </span><span class="nb">sorted</span><span class="p">(</span><span class="n">c</span><span class="p">)</span>
<span class="go">[1, 3]</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">check_forbidden_get</span><span class="p">(</span><span class="n">c</span><span class="p">,</span> <span class="s">&#39;add&#39;</span><span class="p">)</span>
<span class="go">&#39;ForbiddenAttribute: add&#39;</span>

<span class="gp">&gt;&gt;&gt; </span><span class="n">c</span> <span class="o">=</span> <span class="n">s</span><span class="o">.</span><span class="n">copy</span><span class="p">()</span>
<span class="gp">&gt;&gt;&gt; </span><span class="nb">sorted</span><span class="p">(</span><span class="n">c</span><span class="p">)</span>
<span class="go">[1, 2]</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">check_forbidden_get</span><span class="p">(</span><span class="n">c</span><span class="p">,</span> <span class="s">&#39;add&#39;</span><span class="p">)</span>
<span class="go">&#39;ForbiddenAttribute: add&#39;</span>

<span class="gp">&gt;&gt;&gt; </span><span class="nb">str</span><span class="p">(</span><span class="n">s</span><span class="p">)</span> <span class="o">==</span> <span class="nb">str</span><span class="p">(</span><span class="n">us</span><span class="p">)</span>
<span class="go">True</span>

<span class="gp">&gt;&gt;&gt; </span><span class="nb">repr</span><span class="p">(</span><span class="n">s</span><span class="p">)</span> <span class="o">==</span> <span class="nb">repr</span><span class="p">(</span><span class="n">us</span><span class="p">)</span>
<span class="go">True</span>

<span class="go">Always available:</span>

<span class="gp">&gt;&gt;&gt; </span><span class="n">s</span> <span class="o">&lt;</span> <span class="n">us</span>
<span class="go">False</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">s</span> <span class="o">&gt;</span> <span class="n">us</span>
<span class="go">False</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">s</span> <span class="o">&lt;=</span> <span class="n">us</span>
<span class="go">True</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">s</span> <span class="o">&gt;=</span> <span class="n">us</span>
<span class="go">True</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">s</span> <span class="o">==</span> <span class="n">us</span>
<span class="go">True</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">s</span> <span class="o">!=</span> <span class="n">us</span>
<span class="go">False</span>
</pre></div>
</div>
<p>Note that you can&#8217;t compare proxied sets with other proxied sets
due a limitaion in the set comparison functions which won&#8217;t work
with any kind of proxy.</p>
<div class="highlight-python"><div class="highlight"><pre><span class="gp">&gt;&gt;&gt; </span><span class="nb">bool</span><span class="p">(</span><span class="n">s</span><span class="p">)</span>
<span class="go">True</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">s</span><span class="o">.</span><span class="n">__class__</span> <span class="o">==</span> <span class="nb">set</span>
<span class="go">True</span>
</pre></div>
</div>
</div>
<div class="section" id="frozensets">
<h3>frozensets<a class="headerlink" href="#frozensets" title="Permalink to this headline">¶</a></h3>
<p>we can do everything we expect to be able to do with proxied frozensets.</p>
<div class="highlight-python"><div class="highlight"><pre><span class="gp">&gt;&gt;&gt; </span><span class="k">def</span> <span class="nf">check_forbidden_get</span><span class="p">(</span><span class="nb">object</span><span class="p">,</span> <span class="n">attr</span><span class="p">):</span>
<span class="gp">... </span>    <span class="kn">from</span> <span class="nn">zope.security.interfaces</span> <span class="kn">import</span> <span class="n">ForbiddenAttribute</span>
<span class="gp">... </span>    <span class="k">try</span><span class="p">:</span>
<span class="gp">... </span>        <span class="k">return</span> <span class="nb">getattr</span><span class="p">(</span><span class="nb">object</span><span class="p">,</span> <span class="n">attr</span><span class="p">)</span>
<span class="gp">... </span>    <span class="k">except</span> <span class="n">ForbiddenAttribute</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
<span class="gp">... </span>        <span class="k">return</span> <span class="s">&#39;ForbiddenAttribute: </span><span class="si">%s</span><span class="s">&#39;</span> <span class="o">%</span> <span class="n">e</span><span class="o">.</span><span class="n">args</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
<span class="gp">&gt;&gt;&gt; </span><span class="kn">from</span> <span class="nn">zope.security.checker</span> <span class="kn">import</span> <span class="n">ProxyFactory</span>
<span class="gp">&gt;&gt;&gt; </span><span class="kn">from</span> <span class="nn">zope.security.interfaces</span> <span class="kn">import</span> <span class="n">ForbiddenAttribute</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">us</span> <span class="o">=</span> <span class="nb">frozenset</span><span class="p">((</span><span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">))</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">s</span> <span class="o">=</span> <span class="n">ProxyFactory</span><span class="p">(</span><span class="n">us</span><span class="p">)</span>

<span class="gp">&gt;&gt;&gt; </span><span class="n">check_forbidden_get</span><span class="p">(</span><span class="n">s</span><span class="p">,</span> <span class="s">&#39;add&#39;</span><span class="p">)</span> <span class="c"># Verify that we are protected</span>
<span class="go">&#39;ForbiddenAttribute: add&#39;</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">check_forbidden_get</span><span class="p">(</span><span class="n">s</span><span class="p">,</span> <span class="s">&#39;remove&#39;</span><span class="p">)</span> <span class="c"># Verify that we are protected</span>
<span class="go">&#39;ForbiddenAttribute: remove&#39;</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">check_forbidden_get</span><span class="p">(</span><span class="n">s</span><span class="p">,</span> <span class="s">&#39;discard&#39;</span><span class="p">)</span> <span class="c"># Verify that we are protected</span>
<span class="go">&#39;ForbiddenAttribute: discard&#39;</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">check_forbidden_get</span><span class="p">(</span><span class="n">s</span><span class="p">,</span> <span class="s">&#39;pop&#39;</span><span class="p">)</span> <span class="c"># Verify that we are protected</span>
<span class="go">&#39;ForbiddenAttribute: pop&#39;</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">check_forbidden_get</span><span class="p">(</span><span class="n">s</span><span class="p">,</span> <span class="s">&#39;clear&#39;</span><span class="p">)</span> <span class="c"># Verify that we are protected</span>
<span class="go">&#39;ForbiddenAttribute: clear&#39;</span>

<span class="gp">&gt;&gt;&gt; </span><span class="nb">len</span><span class="p">(</span><span class="n">s</span><span class="p">)</span>
<span class="go">2</span>

<span class="gp">&gt;&gt;&gt; </span><span class="mi">1</span> <span class="ow">in</span> <span class="n">s</span>
<span class="go">True</span>

<span class="gp">&gt;&gt;&gt; </span><span class="mi">1</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">s</span>
<span class="go">False</span>

<span class="gp">&gt;&gt;&gt; </span><span class="n">s</span><span class="o">.</span><span class="n">issubset</span><span class="p">(</span><span class="nb">frozenset</span><span class="p">((</span><span class="mi">1</span><span class="p">,</span><span class="mi">2</span><span class="p">,</span><span class="mi">3</span><span class="p">)))</span>
<span class="go">True</span>

<span class="gp">&gt;&gt;&gt; </span><span class="n">s</span><span class="o">.</span><span class="n">issuperset</span><span class="p">(</span><span class="nb">frozenset</span><span class="p">((</span><span class="mi">1</span><span class="p">,</span><span class="mi">2</span><span class="p">,</span><span class="mi">3</span><span class="p">)))</span>
<span class="go">False</span>

<span class="gp">&gt;&gt;&gt; </span><span class="n">c</span> <span class="o">=</span> <span class="n">s</span><span class="o">.</span><span class="n">union</span><span class="p">(</span><span class="nb">frozenset</span><span class="p">((</span><span class="mi">2</span><span class="p">,</span> <span class="mi">3</span><span class="p">)))</span>
<span class="gp">&gt;&gt;&gt; </span><span class="nb">sorted</span><span class="p">(</span><span class="n">c</span><span class="p">)</span>
<span class="go">[1, 2, 3]</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">check_forbidden_get</span><span class="p">(</span><span class="n">c</span><span class="p">,</span> <span class="s">&#39;add&#39;</span><span class="p">)</span>
<span class="go">&#39;ForbiddenAttribute: add&#39;</span>

<span class="gp">&gt;&gt;&gt; </span><span class="n">c</span> <span class="o">=</span> <span class="n">s</span> <span class="o">|</span> <span class="nb">frozenset</span><span class="p">((</span><span class="mi">2</span><span class="p">,</span> <span class="mi">3</span><span class="p">))</span>
<span class="gp">&gt;&gt;&gt; </span><span class="nb">sorted</span><span class="p">(</span><span class="n">c</span><span class="p">)</span>
<span class="go">[1, 2, 3]</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">check_forbidden_get</span><span class="p">(</span><span class="n">c</span><span class="p">,</span> <span class="s">&#39;add&#39;</span><span class="p">)</span>
<span class="go">&#39;ForbiddenAttribute: add&#39;</span>

<span class="gp">&gt;&gt;&gt; </span><span class="n">c</span> <span class="o">=</span> <span class="n">s</span> <span class="o">|</span> <span class="n">ProxyFactory</span><span class="p">(</span><span class="nb">frozenset</span><span class="p">((</span><span class="mi">2</span><span class="p">,</span> <span class="mi">3</span><span class="p">)))</span>
<span class="gp">&gt;&gt;&gt; </span><span class="nb">sorted</span><span class="p">(</span><span class="n">c</span><span class="p">)</span>
<span class="go">[1, 2, 3]</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">check_forbidden_get</span><span class="p">(</span><span class="n">c</span><span class="p">,</span> <span class="s">&#39;add&#39;</span><span class="p">)</span>
<span class="go">&#39;ForbiddenAttribute: add&#39;</span>

<span class="gp">&gt;&gt;&gt; </span><span class="n">c</span> <span class="o">=</span> <span class="nb">frozenset</span><span class="p">((</span><span class="mi">2</span><span class="p">,</span> <span class="mi">3</span><span class="p">))</span> <span class="o">|</span> <span class="n">s</span>
<span class="gp">&gt;&gt;&gt; </span><span class="nb">sorted</span><span class="p">(</span><span class="n">c</span><span class="p">)</span>
<span class="go">[1, 2, 3]</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">check_forbidden_get</span><span class="p">(</span><span class="n">c</span><span class="p">,</span> <span class="s">&#39;add&#39;</span><span class="p">)</span>
<span class="go">&#39;ForbiddenAttribute: add&#39;</span>

<span class="gp">&gt;&gt;&gt; </span><span class="n">c</span> <span class="o">=</span> <span class="n">s</span><span class="o">.</span><span class="n">intersection</span><span class="p">(</span><span class="nb">frozenset</span><span class="p">((</span><span class="mi">2</span><span class="p">,</span> <span class="mi">3</span><span class="p">)))</span>
<span class="gp">&gt;&gt;&gt; </span><span class="nb">sorted</span><span class="p">(</span><span class="n">c</span><span class="p">)</span>
<span class="go">[2]</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">check_forbidden_get</span><span class="p">(</span><span class="n">c</span><span class="p">,</span> <span class="s">&#39;add&#39;</span><span class="p">)</span>
<span class="go">&#39;ForbiddenAttribute: add&#39;</span>

<span class="gp">&gt;&gt;&gt; </span><span class="n">c</span> <span class="o">=</span> <span class="n">s</span> <span class="o">&amp;</span> <span class="nb">frozenset</span><span class="p">((</span><span class="mi">2</span><span class="p">,</span> <span class="mi">3</span><span class="p">))</span>
<span class="gp">&gt;&gt;&gt; </span><span class="nb">sorted</span><span class="p">(</span><span class="n">c</span><span class="p">)</span>
<span class="go">[2]</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">check_forbidden_get</span><span class="p">(</span><span class="n">c</span><span class="p">,</span> <span class="s">&#39;add&#39;</span><span class="p">)</span>
<span class="go">&#39;ForbiddenAttribute: add&#39;</span>

<span class="gp">&gt;&gt;&gt; </span><span class="n">c</span> <span class="o">=</span> <span class="n">s</span> <span class="o">&amp;</span> <span class="n">ProxyFactory</span><span class="p">(</span><span class="nb">frozenset</span><span class="p">((</span><span class="mi">2</span><span class="p">,</span> <span class="mi">3</span><span class="p">)))</span>
<span class="gp">&gt;&gt;&gt; </span><span class="nb">sorted</span><span class="p">(</span><span class="n">c</span><span class="p">)</span>
<span class="go">[2]</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">check_forbidden_get</span><span class="p">(</span><span class="n">c</span><span class="p">,</span> <span class="s">&#39;add&#39;</span><span class="p">)</span>
<span class="go">&#39;ForbiddenAttribute: add&#39;</span>

<span class="gp">&gt;&gt;&gt; </span><span class="n">c</span> <span class="o">=</span> <span class="nb">frozenset</span><span class="p">((</span><span class="mi">2</span><span class="p">,</span> <span class="mi">3</span><span class="p">))</span> <span class="o">&amp;</span> <span class="n">s</span>
<span class="gp">&gt;&gt;&gt; </span><span class="nb">sorted</span><span class="p">(</span><span class="n">c</span><span class="p">)</span>
<span class="go">[2]</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">check_forbidden_get</span><span class="p">(</span><span class="n">c</span><span class="p">,</span> <span class="s">&#39;add&#39;</span><span class="p">)</span>
<span class="go">&#39;ForbiddenAttribute: add&#39;</span>

<span class="gp">&gt;&gt;&gt; </span><span class="n">c</span> <span class="o">=</span> <span class="n">s</span><span class="o">.</span><span class="n">difference</span><span class="p">(</span><span class="nb">frozenset</span><span class="p">((</span><span class="mi">2</span><span class="p">,</span> <span class="mi">3</span><span class="p">)))</span>
<span class="gp">&gt;&gt;&gt; </span><span class="nb">sorted</span><span class="p">(</span><span class="n">c</span><span class="p">)</span>
<span class="go">[1]</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">check_forbidden_get</span><span class="p">(</span><span class="n">c</span><span class="p">,</span> <span class="s">&#39;add&#39;</span><span class="p">)</span>
<span class="go">&#39;ForbiddenAttribute: add&#39;</span>

<span class="gp">&gt;&gt;&gt; </span><span class="n">c</span> <span class="o">=</span> <span class="n">s</span> <span class="o">-</span> <span class="n">ProxyFactory</span><span class="p">(</span><span class="nb">frozenset</span><span class="p">((</span><span class="mi">2</span><span class="p">,</span> <span class="mi">3</span><span class="p">)))</span>
<span class="gp">&gt;&gt;&gt; </span><span class="nb">sorted</span><span class="p">(</span><span class="n">c</span><span class="p">)</span>
<span class="go">[1]</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">check_forbidden_get</span><span class="p">(</span><span class="n">c</span><span class="p">,</span> <span class="s">&#39;add&#39;</span><span class="p">)</span>
<span class="go">&#39;ForbiddenAttribute: add&#39;</span>

<span class="gp">&gt;&gt;&gt; </span><span class="n">c</span> <span class="o">=</span> <span class="n">s</span> <span class="o">-</span> <span class="nb">frozenset</span><span class="p">((</span><span class="mi">2</span><span class="p">,</span> <span class="mi">3</span><span class="p">))</span>
<span class="gp">&gt;&gt;&gt; </span><span class="nb">sorted</span><span class="p">(</span><span class="n">c</span><span class="p">)</span>
<span class="go">[1]</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">check_forbidden_get</span><span class="p">(</span><span class="n">c</span><span class="p">,</span> <span class="s">&#39;add&#39;</span><span class="p">)</span>
<span class="go">&#39;ForbiddenAttribute: add&#39;</span>

<span class="gp">&gt;&gt;&gt; </span><span class="n">c</span> <span class="o">=</span> <span class="nb">frozenset</span><span class="p">((</span><span class="mi">2</span><span class="p">,</span> <span class="mi">3</span><span class="p">))</span> <span class="o">-</span> <span class="n">s</span>
<span class="gp">&gt;&gt;&gt; </span><span class="nb">sorted</span><span class="p">(</span><span class="n">c</span><span class="p">)</span>
<span class="go">[3]</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">check_forbidden_get</span><span class="p">(</span><span class="n">c</span><span class="p">,</span> <span class="s">&#39;add&#39;</span><span class="p">)</span>
<span class="go">&#39;ForbiddenAttribute: add&#39;</span>

<span class="gp">&gt;&gt;&gt; </span><span class="n">c</span> <span class="o">=</span> <span class="n">s</span><span class="o">.</span><span class="n">symmetric_difference</span><span class="p">(</span><span class="nb">frozenset</span><span class="p">((</span><span class="mi">2</span><span class="p">,</span> <span class="mi">3</span><span class="p">)))</span>
<span class="gp">&gt;&gt;&gt; </span><span class="nb">sorted</span><span class="p">(</span><span class="n">c</span><span class="p">)</span>
<span class="go">[1, 3]</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">check_forbidden_get</span><span class="p">(</span><span class="n">c</span><span class="p">,</span> <span class="s">&#39;add&#39;</span><span class="p">)</span>
<span class="go">&#39;ForbiddenAttribute: add&#39;</span>

<span class="gp">&gt;&gt;&gt; </span><span class="n">c</span> <span class="o">=</span> <span class="n">s</span> <span class="o">^</span> <span class="nb">frozenset</span><span class="p">((</span><span class="mi">2</span><span class="p">,</span> <span class="mi">3</span><span class="p">))</span>
<span class="gp">&gt;&gt;&gt; </span><span class="nb">sorted</span><span class="p">(</span><span class="n">c</span><span class="p">)</span>
<span class="go">[1, 3]</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">check_forbidden_get</span><span class="p">(</span><span class="n">c</span><span class="p">,</span> <span class="s">&#39;add&#39;</span><span class="p">)</span>
<span class="go">&#39;ForbiddenAttribute: add&#39;</span>

<span class="gp">&gt;&gt;&gt; </span><span class="n">c</span> <span class="o">=</span> <span class="n">s</span> <span class="o">^</span> <span class="n">ProxyFactory</span><span class="p">(</span><span class="nb">frozenset</span><span class="p">((</span><span class="mi">2</span><span class="p">,</span> <span class="mi">3</span><span class="p">)))</span>
<span class="gp">&gt;&gt;&gt; </span><span class="nb">sorted</span><span class="p">(</span><span class="n">c</span><span class="p">)</span>
<span class="go">[1, 3]</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">check_forbidden_get</span><span class="p">(</span><span class="n">c</span><span class="p">,</span> <span class="s">&#39;add&#39;</span><span class="p">)</span>
<span class="go">&#39;ForbiddenAttribute: add&#39;</span>

<span class="gp">&gt;&gt;&gt; </span><span class="n">c</span> <span class="o">=</span> <span class="nb">frozenset</span><span class="p">((</span><span class="mi">2</span><span class="p">,</span> <span class="mi">3</span><span class="p">))</span> <span class="o">^</span> <span class="n">s</span>
<span class="gp">&gt;&gt;&gt; </span><span class="nb">sorted</span><span class="p">(</span><span class="n">c</span><span class="p">)</span>
<span class="go">[1, 3]</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">check_forbidden_get</span><span class="p">(</span><span class="n">c</span><span class="p">,</span> <span class="s">&#39;add&#39;</span><span class="p">)</span>
<span class="go">&#39;ForbiddenAttribute: add&#39;</span>

<span class="gp">&gt;&gt;&gt; </span><span class="n">c</span> <span class="o">=</span> <span class="n">s</span><span class="o">.</span><span class="n">copy</span><span class="p">()</span>
<span class="gp">&gt;&gt;&gt; </span><span class="nb">sorted</span><span class="p">(</span><span class="n">c</span><span class="p">)</span>
<span class="go">[1, 2]</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">check_forbidden_get</span><span class="p">(</span><span class="n">c</span><span class="p">,</span> <span class="s">&#39;add&#39;</span><span class="p">)</span>
<span class="go">&#39;ForbiddenAttribute: add&#39;</span>

<span class="gp">&gt;&gt;&gt; </span><span class="nb">str</span><span class="p">(</span><span class="n">s</span><span class="p">)</span> <span class="o">==</span> <span class="nb">str</span><span class="p">(</span><span class="n">us</span><span class="p">)</span>
<span class="go">True</span>

<span class="gp">&gt;&gt;&gt; </span><span class="nb">repr</span><span class="p">(</span><span class="n">s</span><span class="p">)</span> <span class="o">==</span> <span class="nb">repr</span><span class="p">(</span><span class="n">us</span><span class="p">)</span>
<span class="go">True</span>

<span class="go">Always available:</span>

<span class="gp">&gt;&gt;&gt; </span><span class="n">s</span> <span class="o">&lt;</span> <span class="n">us</span>
<span class="go">False</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">s</span> <span class="o">&gt;</span> <span class="n">us</span>
<span class="go">False</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">s</span> <span class="o">&lt;=</span> <span class="n">us</span>
<span class="go">True</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">s</span> <span class="o">&gt;=</span> <span class="n">us</span>
<span class="go">True</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">s</span> <span class="o">==</span> <span class="n">us</span>
<span class="go">True</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">s</span> <span class="o">!=</span> <span class="n">us</span>
<span class="go">False</span>
</pre></div>
</div>
<p>Note that you can&#8217;t compare proxied sets with other proxied sets
due a limitaion in the frozenset comparison functions which won&#8217;t work
with any kind of proxy.</p>
<div class="highlight-python"><div class="highlight"><pre><span class="gp">&gt;&gt;&gt; </span><span class="nb">bool</span><span class="p">(</span><span class="n">s</span><span class="p">)</span>
<span class="go">True</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">s</span><span class="o">.</span><span class="n">__class__</span> <span class="o">==</span> <span class="nb">frozenset</span>
<span class="go">True</span>
</pre></div>
</div>
</div>
<div class="section" id="iterators">
<h3>iterators<a class="headerlink" href="#iterators" title="Permalink to this headline">¶</a></h3>
<div class="highlight-python"><div class="highlight"><pre><span class="gp">&gt;&gt;&gt; </span><span class="p">[</span><span class="n">a</span> <span class="k">for</span> <span class="n">a</span> <span class="ow">in</span> <span class="n">ProxyFactory</span><span class="p">(</span><span class="nb">iter</span><span class="p">([</span><span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">]))]</span>
<span class="go">[1, 2]</span>
<span class="gp">&gt;&gt;&gt; </span><span class="nb">list</span><span class="p">(</span><span class="n">ProxyFactory</span><span class="p">(</span><span class="nb">iter</span><span class="p">([</span><span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">])))</span>
<span class="go">[1, 2]</span>
<span class="gp">&gt;&gt;&gt; </span><span class="nb">list</span><span class="p">(</span><span class="n">ProxyFactory</span><span class="p">(</span><span class="nb">iter</span><span class="p">((</span><span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">))))</span>
<span class="go">[1, 2]</span>
<span class="gp">&gt;&gt;&gt; </span><span class="nb">list</span><span class="p">(</span><span class="n">ProxyFactory</span><span class="p">(</span><span class="nb">iter</span><span class="p">({</span><span class="mi">1</span><span class="p">:</span><span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">:</span><span class="mi">2</span><span class="p">})))</span>
<span class="go">[1, 2]</span>
<span class="gp">&gt;&gt;&gt; </span><span class="k">def</span> <span class="nf">f</span><span class="p">():</span>
<span class="gp">... </span>    <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">:</span>
<span class="gp">... </span>            <span class="k">yield</span> <span class="n">i</span>
<span class="gp">...</span>
<span class="gp">&gt;&gt;&gt; </span><span class="nb">list</span><span class="p">(</span><span class="n">ProxyFactory</span><span class="p">(</span><span class="n">f</span><span class="p">()))</span>
<span class="go">[1, 2]</span>
<span class="gp">&gt;&gt;&gt; </span><span class="nb">list</span><span class="p">(</span><span class="n">ProxyFactory</span><span class="p">(</span><span class="n">f</span><span class="p">)())</span>
<span class="go">[1, 2]</span>
</pre></div>
</div>
<p>We can iterate over custom sequences, too:</p>
<div class="highlight-python"><div class="highlight"><pre><span class="gp">&gt;&gt;&gt; </span><span class="k">class</span> <span class="nc">X</span><span class="p">(</span><span class="nb">object</span><span class="p">):</span>
<span class="gp">... </span>  <span class="n">d</span> <span class="o">=</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">3</span>
<span class="gp">... </span>  <span class="k">def</span> <span class="nf">__getitem__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">i</span><span class="p">):</span>
<span class="gp">... </span>     <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">d</span><span class="p">[</span><span class="n">i</span><span class="p">]</span>
<span class="gp">...</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">x</span> <span class="o">=</span> <span class="n">X</span><span class="p">()</span>
</pre></div>
</div>
<p>We can iterate over sequences</p>
<div class="highlight-python"><div class="highlight"><pre><span class="gp">&gt;&gt;&gt; </span><span class="nb">list</span><span class="p">(</span><span class="n">x</span><span class="p">)</span>
<span class="go">[1, 2, 3]</span>

<span class="gp">&gt;&gt;&gt; </span><span class="kn">from</span> <span class="nn">zope.security.checker</span> <span class="kn">import</span> <span class="n">NamesChecker</span>
<span class="gp">&gt;&gt;&gt; </span><span class="kn">from</span> <span class="nn">zope.security.checker</span> <span class="kn">import</span> <span class="n">ProxyFactory</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">c</span> <span class="o">=</span> <span class="n">NamesChecker</span><span class="p">([</span><span class="s">&#39;__getitem__&#39;</span><span class="p">,</span> <span class="s">&#39;__len__&#39;</span><span class="p">])</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">p</span> <span class="o">=</span> <span class="n">ProxyFactory</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">c</span><span class="p">)</span>
</pre></div>
</div>
<p>Even if they are proxied</p>
<div class="highlight-python"><div class="highlight"><pre><span class="gp">&gt;&gt;&gt; </span><span class="nb">list</span><span class="p">(</span><span class="n">p</span><span class="p">)</span>
<span class="go">[1, 2, 3]</span>
</pre></div>
</div>
<p>But if the class has an iter:</p>
<div class="highlight-python"><div class="highlight"><pre><span class="gp">&gt;&gt;&gt; </span><span class="n">X</span><span class="o">.</span><span class="n">__iter__</span> <span class="o">=</span> <span class="k">lambda</span> <span class="bp">self</span><span class="p">:</span> <span class="nb">iter</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">d</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="nb">list</span><span class="p">(</span><span class="n">x</span><span class="p">)</span>
<span class="go">[1, 2, 3]</span>
</pre></div>
</div>
<p>We shouldn&#8217;t be able to iterate if we don&#8217;t have an assertion:</p>
<div class="highlight-python"><div class="highlight"><pre><span class="gp">&gt;&gt;&gt; </span><span class="n">check_forbidden_call</span><span class="p">(</span><span class="nb">list</span><span class="p">,</span> <span class="n">p</span><span class="p">)</span>
<span class="go">&#39;ForbiddenAttribute: __iter__&#39;</span>
</pre></div>
</div>
</div>
<div class="section" id="new-style-classes">
<h3>New-style classes<a class="headerlink" href="#new-style-classes" title="Permalink to this headline">¶</a></h3>
<div class="highlight-python"><div class="highlight"><pre><span class="gp">&gt;&gt;&gt; </span><span class="kn">from</span> <span class="nn">zope.security.checker</span> <span class="kn">import</span> <span class="n">NamesChecker</span>
<span class="gp">&gt;&gt;&gt; </span><span class="k">class</span> <span class="nc">C</span><span class="p">(</span><span class="nb">object</span><span class="p">):</span>
<span class="gp">... </span>   <span class="n">x</span> <span class="o">=</span> <span class="mi">1</span>
<span class="gp">... </span>   <span class="n">y</span> <span class="o">=</span> <span class="mi">2</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">C</span> <span class="o">=</span> <span class="n">ProxyFactory</span><span class="p">(</span><span class="n">C</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">check_forbidden_call</span><span class="p">(</span><span class="n">C</span><span class="p">)</span>
<span class="go">&#39;ForbiddenAttribute: __call__&#39;</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">check_forbidden_get</span><span class="p">(</span><span class="n">C</span><span class="p">,</span> <span class="s">&#39;__dict__&#39;</span><span class="p">)</span>
<span class="go">&#39;ForbiddenAttribute: __dict__&#39;</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">s</span> <span class="o">=</span> <span class="nb">str</span><span class="p">(</span><span class="n">C</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">s</span> <span class="o">=</span> <span class="nb">repr</span><span class="p">(</span><span class="n">C</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="nb">int</span><span class="p">(</span><span class="n">C</span><span class="o">.</span><span class="n">__module__</span> <span class="o">==</span> <span class="n">__name__</span><span class="p">)</span>
<span class="go">1</span>
<span class="gp">&gt;&gt;&gt; </span><span class="nb">len</span><span class="p">(</span><span class="n">C</span><span class="o">.</span><span class="n">__bases__</span><span class="p">)</span>
<span class="go">1</span>
<span class="gp">&gt;&gt;&gt; </span><span class="nb">len</span><span class="p">(</span><span class="n">C</span><span class="o">.</span><span class="n">__mro__</span><span class="p">)</span>
<span class="go">2</span>
</pre></div>
</div>
<p>Always available:</p>
<div class="highlight-python"><div class="highlight"><pre><span class="gp">&gt;&gt;&gt; </span><span class="nb">int</span><span class="p">(</span><span class="n">C</span> <span class="o">==</span> <span class="n">C</span><span class="p">)</span>
<span class="go">1</span>
<span class="gp">&gt;&gt;&gt; </span><span class="nb">int</span><span class="p">(</span><span class="n">C</span> <span class="o">!=</span> <span class="n">C</span><span class="p">)</span>
<span class="go">0</span>
<span class="gp">&gt;&gt;&gt; </span><span class="nb">int</span><span class="p">(</span><span class="nb">bool</span><span class="p">(</span><span class="n">C</span><span class="p">))</span>
<span class="go">1</span>
<span class="gp">&gt;&gt;&gt; </span><span class="nb">int</span><span class="p">(</span><span class="n">C</span><span class="o">.</span><span class="n">__class__</span> <span class="o">==</span> <span class="nb">type</span><span class="p">)</span>
<span class="go">1</span>
</pre></div>
</div>
</div>
<div class="section" id="new-style-instances">
<h3>New-style Instances<a class="headerlink" href="#new-style-instances" title="Permalink to this headline">¶</a></h3>
<div class="highlight-python"><div class="highlight"><pre><span class="gp">&gt;&gt;&gt; </span><span class="k">class</span> <span class="nc">C</span><span class="p">(</span><span class="nb">object</span><span class="p">):</span>
<span class="gp">... </span>   <span class="n">x</span> <span class="o">=</span> <span class="mi">1</span>
<span class="gp">... </span>   <span class="n">y</span> <span class="o">=</span> <span class="mi">2</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">c</span> <span class="o">=</span> <span class="n">ProxyFactory</span><span class="p">(</span><span class="n">C</span><span class="p">(),</span> <span class="n">NamesChecker</span><span class="p">([</span><span class="s">&#39;x&#39;</span><span class="p">]))</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">check_forbidden_get</span><span class="p">(</span><span class="n">c</span><span class="p">,</span> <span class="s">&#39;y&#39;</span><span class="p">)</span>
<span class="go">&#39;ForbiddenAttribute: y&#39;</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">check_forbidden_get</span><span class="p">(</span><span class="n">c</span><span class="p">,</span> <span class="s">&#39;z&#39;</span><span class="p">)</span>
<span class="go">&#39;ForbiddenAttribute: z&#39;</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">c</span><span class="o">.</span><span class="n">x</span>
<span class="go">1</span>
<span class="gp">&gt;&gt;&gt; </span><span class="nb">int</span><span class="p">(</span><span class="n">c</span><span class="o">.</span><span class="n">__class__</span> <span class="o">==</span> <span class="n">C</span><span class="p">)</span>
<span class="go">1</span>
</pre></div>
</div>
<p>Always available:</p>
<div class="highlight-python"><div class="highlight"><pre><span class="gp">&gt;&gt;&gt; </span><span class="nb">int</span><span class="p">(</span><span class="n">c</span> <span class="o">==</span> <span class="n">c</span><span class="p">)</span>
<span class="go">1</span>
<span class="gp">&gt;&gt;&gt; </span><span class="nb">int</span><span class="p">(</span><span class="n">c</span> <span class="o">!=</span> <span class="n">c</span><span class="p">)</span>
<span class="go">0</span>
<span class="gp">&gt;&gt;&gt; </span><span class="nb">int</span><span class="p">(</span><span class="nb">bool</span><span class="p">(</span><span class="n">c</span><span class="p">))</span>
<span class="go">1</span>
<span class="gp">&gt;&gt;&gt; </span><span class="nb">int</span><span class="p">(</span><span class="n">c</span><span class="o">.</span><span class="n">__class__</span> <span class="o">==</span> <span class="n">C</span><span class="p">)</span>
<span class="go">1</span>
</pre></div>
</div>
</div>
<div class="section" id="classic-classes">
<h3>Classic Classes<a class="headerlink" href="#classic-classes" title="Permalink to this headline">¶</a></h3>
<div class="highlight-python"><div class="highlight"><pre><span class="gp">&gt;&gt;&gt; </span><span class="k">class</span> <span class="nc">C</span><span class="p">:</span>
<span class="gp">... </span>   <span class="n">x</span> <span class="o">=</span> <span class="mi">1</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">C</span> <span class="o">=</span> <span class="n">ProxyFactory</span><span class="p">(</span><span class="n">C</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">check_forbidden_call</span><span class="p">(</span><span class="n">C</span><span class="p">)</span>
<span class="go">&#39;ForbiddenAttribute: __call__&#39;</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">check_forbidden_get</span><span class="p">(</span><span class="n">C</span><span class="p">,</span> <span class="s">&#39;__dict__&#39;</span><span class="p">)</span>
<span class="go">&#39;ForbiddenAttribute: __dict__&#39;</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">s</span> <span class="o">=</span> <span class="nb">str</span><span class="p">(</span><span class="n">C</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">s</span> <span class="o">=</span> <span class="nb">repr</span><span class="p">(</span><span class="n">C</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="nb">int</span><span class="p">(</span><span class="n">C</span><span class="o">.</span><span class="n">__module__</span> <span class="o">==</span> <span class="n">__name__</span><span class="p">)</span>
<span class="go">1</span>
<span class="gp">&gt;&gt;&gt; </span><span class="nb">len</span><span class="p">(</span><span class="n">C</span><span class="o">.</span><span class="n">__bases__</span><span class="p">)</span>
<span class="go">1</span>
</pre></div>
</div>
<p>Always available:</p>
<div class="highlight-python"><div class="highlight"><pre><span class="gp">&gt;&gt;&gt; </span><span class="nb">int</span><span class="p">(</span><span class="n">C</span> <span class="o">==</span> <span class="n">C</span><span class="p">)</span>
<span class="go">1</span>
<span class="gp">&gt;&gt;&gt; </span><span class="nb">int</span><span class="p">(</span><span class="n">C</span> <span class="o">!=</span> <span class="n">C</span><span class="p">)</span>
<span class="go">0</span>
<span class="gp">&gt;&gt;&gt; </span><span class="nb">int</span><span class="p">(</span><span class="nb">bool</span><span class="p">(</span><span class="n">C</span><span class="p">))</span>
<span class="go">1</span>
</pre></div>
</div>
</div>
<div class="section" id="classic-instances">
<h3>Classic Instances<a class="headerlink" href="#classic-instances" title="Permalink to this headline">¶</a></h3>
<div class="highlight-python"><div class="highlight"><pre><span class="gp">&gt;&gt;&gt; </span><span class="k">class</span> <span class="nc">C</span><span class="p">(</span><span class="nb">object</span><span class="p">):</span>
<span class="gp">... </span>   <span class="n">x</span><span class="p">,</span> <span class="n">y</span> <span class="o">=</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">2</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">c</span> <span class="o">=</span> <span class="n">ProxyFactory</span><span class="p">(</span><span class="n">C</span><span class="p">(),</span> <span class="n">NamesChecker</span><span class="p">([</span><span class="s">&#39;x&#39;</span><span class="p">]))</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">check_forbidden_get</span><span class="p">(</span><span class="n">c</span><span class="p">,</span> <span class="s">&#39;y&#39;</span><span class="p">)</span>
<span class="go">&#39;ForbiddenAttribute: y&#39;</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">check_forbidden_get</span><span class="p">(</span><span class="n">c</span><span class="p">,</span> <span class="s">&#39;z&#39;</span><span class="p">)</span>
<span class="go">&#39;ForbiddenAttribute: z&#39;</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">c</span><span class="o">.</span><span class="n">x</span>
<span class="go">1</span>
<span class="gp">&gt;&gt;&gt; </span><span class="nb">int</span><span class="p">(</span><span class="n">c</span><span class="o">.</span><span class="n">__class__</span> <span class="o">==</span> <span class="n">C</span><span class="p">)</span>
<span class="go">1</span>
</pre></div>
</div>
<p>Always available:</p>
<div class="highlight-python"><div class="highlight"><pre><span class="gp">&gt;&gt;&gt; </span><span class="nb">int</span><span class="p">(</span><span class="n">c</span> <span class="o">==</span> <span class="n">c</span><span class="p">)</span>
<span class="go">1</span>
<span class="gp">&gt;&gt;&gt; </span><span class="nb">int</span><span class="p">(</span><span class="n">c</span> <span class="o">!=</span> <span class="n">c</span><span class="p">)</span>
<span class="go">0</span>
<span class="gp">&gt;&gt;&gt; </span><span class="nb">int</span><span class="p">(</span><span class="nb">bool</span><span class="p">(</span><span class="n">c</span><span class="p">))</span>
<span class="go">1</span>
<span class="gp">&gt;&gt;&gt; </span><span class="nb">int</span><span class="p">(</span><span class="n">c</span><span class="o">.</span><span class="n">__class__</span> <span class="o">==</span> <span class="n">C</span><span class="p">)</span>
<span class="go">1</span>
</pre></div>
</div>
</div>
<div class="section" id="interfaces-and-declarations">
<h3>Interfaces and declarations<a class="headerlink" href="#interfaces-and-declarations" title="Permalink to this headline">¶</a></h3>
<p>We can still use interfaces though proxies:</p>
<div class="highlight-python"><div class="highlight"><pre><span class="gp">&gt;&gt;&gt; </span><span class="kn">from</span> <span class="nn">zope.interface</span> <span class="kn">import</span> <span class="n">directlyProvides</span>
<span class="gp">&gt;&gt;&gt; </span><span class="kn">from</span> <span class="nn">zope.interface</span> <span class="kn">import</span> <span class="n">implementer</span>
<span class="gp">&gt;&gt;&gt; </span><span class="kn">from</span> <span class="nn">zope.interface</span> <span class="kn">import</span> <span class="n">provider</span>
<span class="gp">&gt;&gt;&gt; </span><span class="k">class</span> <span class="nc">I</span><span class="p">(</span><span class="n">Interface</span><span class="p">):</span>
<span class="gp">... </span>    <span class="k">pass</span>
<span class="gp">&gt;&gt;&gt; </span><span class="k">class</span> <span class="nc">IN</span><span class="p">(</span><span class="n">Interface</span><span class="p">):</span>
<span class="gp">... </span>    <span class="k">pass</span>
<span class="gp">&gt;&gt;&gt; </span><span class="k">class</span> <span class="nc">II</span><span class="p">(</span><span class="n">Interface</span><span class="p">):</span>
<span class="gp">... </span>    <span class="k">pass</span>
<span class="gp">&gt;&gt;&gt; </span><span class="nd">@implementer</span><span class="p">(</span><span class="n">I</span><span class="p">)</span>
<span class="gp">... </span><span class="nd">@provider</span><span class="p">(</span><span class="n">IN</span><span class="p">)</span>
<span class="gp">... </span><span class="k">class</span> <span class="nc">N</span><span class="p">(</span><span class="nb">object</span><span class="p">):</span>
<span class="gp">... </span>    <span class="k">pass</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">n</span> <span class="o">=</span> <span class="n">N</span><span class="p">()</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">directlyProvides</span><span class="p">(</span><span class="n">n</span><span class="p">,</span> <span class="n">II</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">N</span> <span class="o">=</span> <span class="n">ProxyFactory</span><span class="p">(</span><span class="n">N</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">n</span> <span class="o">=</span> <span class="n">ProxyFactory</span><span class="p">(</span><span class="n">n</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">I</span><span class="o">.</span><span class="n">implementedBy</span><span class="p">(</span><span class="n">N</span><span class="p">)</span>
<span class="go">True</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">IN</span><span class="o">.</span><span class="n">providedBy</span><span class="p">(</span><span class="n">N</span><span class="p">)</span>
<span class="go">True</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">I</span><span class="o">.</span><span class="n">providedBy</span><span class="p">(</span><span class="n">n</span><span class="p">)</span>
<span class="go">True</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">II</span><span class="o">.</span><span class="n">providedBy</span><span class="p">(</span><span class="n">n</span><span class="p">)</span>
<span class="go">True</span>
</pre></div>
</div>
</div>
<div class="section" id="abstract-base-classes">
<h3>abstract Base Classes<a class="headerlink" href="#abstract-base-classes" title="Permalink to this headline">¶</a></h3>
<p>We work with the ABCMeta meta class:</p>
<div class="highlight-python"><div class="highlight"><pre><span class="gp">&gt;&gt;&gt; </span><span class="kn">import</span> <span class="nn">abc</span>
<span class="gp">&gt;&gt;&gt; </span><span class="k">class</span> <span class="nc">MyABC</span><span class="p">:</span>
<span class="gp">... </span>    <span class="n">__metaclass__</span> <span class="o">=</span> <span class="n">abc</span><span class="o">.</span><span class="n">ABCMeta</span>
<span class="gp">&gt;&gt;&gt; </span><span class="k">class</span> <span class="nc">Foo</span><span class="p">(</span><span class="n">MyABC</span><span class="p">):</span> <span class="k">pass</span>
<span class="gp">&gt;&gt;&gt; </span><span class="k">class</span> <span class="nc">Bar</span><span class="p">(</span><span class="n">Foo</span><span class="p">):</span> <span class="k">pass</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">PBar</span> <span class="o">=</span> <span class="n">ProxyFactory</span><span class="p">(</span><span class="n">Bar</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="p">[</span><span class="n">c</span><span class="o">.</span><span class="n">__name__</span> <span class="k">for</span> <span class="n">c</span> <span class="ow">in</span> <span class="n">PBar</span><span class="o">.</span><span class="n">__mro__</span><span class="p">]</span>
<span class="go">[&#39;Bar&#39;, &#39;Foo&#39;, &#39;MyABC&#39;, &#39;object&#39;]</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">check_forbidden_call</span><span class="p">(</span><span class="n">PBar</span><span class="p">)</span>
<span class="go">&#39;ForbiddenAttribute: __call__&#39;</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">check_forbidden_get</span><span class="p">(</span><span class="n">PBar</span><span class="p">,</span> <span class="s">&#39;__dict__&#39;</span><span class="p">)</span>
<span class="go">&#39;ForbiddenAttribute: __dict__&#39;</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">s</span> <span class="o">=</span> <span class="nb">str</span><span class="p">(</span><span class="n">PBar</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">s</span> <span class="o">=</span> <span class="nb">repr</span><span class="p">(</span><span class="n">PBar</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="nb">int</span><span class="p">(</span><span class="n">PBar</span><span class="o">.</span><span class="n">__module__</span> <span class="o">==</span> <span class="n">__name__</span><span class="p">)</span>
<span class="go">1</span>
<span class="gp">&gt;&gt;&gt; </span><span class="nb">len</span><span class="p">(</span><span class="n">PBar</span><span class="o">.</span><span class="n">__bases__</span><span class="p">)</span>
<span class="go">1</span>
</pre></div>
</div>
<p>Always available:</p>
<div class="highlight-python"><div class="highlight"><pre><span class="gp">&gt;&gt;&gt; </span><span class="nb">int</span><span class="p">(</span><span class="n">PBar</span> <span class="o">==</span> <span class="n">PBar</span><span class="p">)</span>
<span class="go">1</span>
<span class="gp">&gt;&gt;&gt; </span><span class="nb">int</span><span class="p">(</span><span class="n">PBar</span> <span class="o">!=</span> <span class="n">PBar</span><span class="p">)</span>
<span class="go">0</span>
<span class="gp">&gt;&gt;&gt; </span><span class="nb">int</span><span class="p">(</span><span class="nb">bool</span><span class="p">(</span><span class="n">PBar</span><span class="p">))</span>
<span class="go">1</span>
<span class="gp">&gt;&gt;&gt; </span><span class="nb">int</span><span class="p">(</span><span class="n">PBar</span><span class="o">.</span><span class="n">__class__</span> <span class="o">==</span> <span class="nb">type</span><span class="p">)</span>
<span class="go">1</span>
</pre></div>
</div>
</div>
</div>
</div>


          </div>
        </div>
      </div>
      <div class="sphinxsidebar">
        <div class="sphinxsidebarwrapper">
  <h3><a href="../index.html">Table Of Contents</a></h3>
  <ul>
<li><a class="reference internal" href="#"><tt class="docutils literal"><span class="pre">zope.security.checker</span></tt></a><ul>
<li><a class="reference internal" href="#protections-for-modules">Protections for Modules</a></li>
<li><a class="reference internal" href="#protections-for-standard-objects">Protections for standard objects</a><ul>
<li><a class="reference internal" href="#rocks">Rocks</a></li>
<li><a class="reference internal" href="#dicts">dicts</a></li>
<li><a class="reference internal" href="#lists">lists</a></li>
<li><a class="reference internal" href="#tuples">tuples</a></li>
<li><a class="reference internal" href="#sets">sets</a></li>
<li><a class="reference internal" href="#frozensets">frozensets</a></li>
<li><a class="reference internal" href="#iterators">iterators</a></li>
<li><a class="reference internal" href="#new-style-classes">New-style classes</a></li>
<li><a class="reference internal" href="#new-style-instances">New-style Instances</a></li>
<li><a class="reference internal" href="#classic-classes">Classic Classes</a></li>
<li><a class="reference internal" href="#classic-instances">Classic Instances</a></li>
<li><a class="reference internal" href="#interfaces-and-declarations">Interfaces and declarations</a></li>
<li><a class="reference internal" href="#abstract-base-classes">abstract Base Classes</a></li>
</ul>
</li>
</ul>
</li>
</ul>

  <h4>Previous topic</h4>
  <p class="topless"><a href="adapter.html"
                        title="previous chapter"><tt class="docutils literal docutils literal"><span class="pre">zope.security.adapter</span></tt></a></p>
  <h4>Next topic</h4>
  <p class="topless"><a href="decorator.html"
                        title="next chapter"><tt class="docutils literal"><span class="pre">zope.security.decorator</span></tt></a></p>
  <h3>This Page</h3>
  <ul class="this-page-menu">
    <li><a href="../_sources/api/checker.txt"
           rel="nofollow">Show Source</a></li>
  </ul>
<div id="searchbox" style="display: none">
  <h3>Quick search</h3>
    <form class="search" action="../search.html" method="get">
      <input type="text" name="q" />
      <input type="submit" value="Go" />
      <input type="hidden" name="check_keywords" value="yes" />
      <input type="hidden" name="area" value="default" />
    </form>
    <p class="searchtip" style="font-size: 90%">
    Enter search terms or a module, class or function name.
    </p>
</div>
<script type="text/javascript">$('#searchbox').show(0);</script>
        </div>
      </div>
      <div class="clearer"></div>
    </div>
    <div class="related">
      <h3>Navigation</h3>
      <ul>
        <li class="right" style="margin-right: 10px">
          <a href="../genindex.html" title="General Index"
             >index</a></li>
        <li class="right" >
          <a href="../py-modindex.html" title="Python Module Index"
             >modules</a> |</li>
        <li class="right" >
          <a href="decorator.html" title="zope.security.decorator"
             >next</a> |</li>
        <li class="right" >
          <a href="adapter.html" title="zope.security.adapter"
             >previous</a> |</li>
        <li><a href="../index.html">zope.security 4.0dev documentation</a> &raquo;</li> 
      </ul>
    </div>
    <div class="footer">
        &copy; Copyright 2012, Zope Foundation Contributors &lt;zope-dev@zope.org&gt;.
      Created using <a href="http://sphinx.pocoo.org/">Sphinx</a> 1.1.3.
    </div>
  </body>
</html>