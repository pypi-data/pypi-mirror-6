

<!DOCTYPE html>



<html xmlns="http://www.w3.org/1999/xhtml">
  <head>
    <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
    
    <title>Macro Atom &mdash; TARDIS v0.9.dev692</title>
    
    <link rel="stylesheet" href="../_static/basic.css" type="text/css" />
    <link rel="stylesheet" href="../_static/pygments.css" type="text/css" />
    <link rel="stylesheet" href="../_static/css/bootstrap-2.2.1.min.css" type="text/css" />
    <link rel="stylesheet" href="../_static/bootstrap-sphinx.css" type="text/css" />
    <link rel="stylesheet" href="../_static/css/bootstrap-responsive-2.2.1.min.css" type="text/css" />
    
    <script type="text/javascript">
      var DOCUMENTATION_OPTIONS = {
        URL_ROOT:    '../',
        VERSION:     '0.9.dev692',
        COLLAPSE_INDEX: false,
        FILE_SUFFIX: '.html',
        HAS_SOURCE:  true
      };
    </script>
    <script type="text/javascript" src="../_static/jquery.js"></script>
    <script type="text/javascript" src="../_static/underscore.js"></script>
    <script type="text/javascript" src="../_static/doctools.js"></script>
    <script type="text/javascript" src="http://cdn.mathjax.org/mathjax/latest/MathJax.js?config=TeX-AMS-MML_HTMLorMML"></script>
    <script type="text/javascript" src="../_static/js/bootstrap-2.2.1.min.js"></script>
    <script type="text/javascript" src="../_static/bootstrap-sphinx.js"></script>
    <link rel="shortcut icon" href="../_static/tardis_logo.ico"/>
    <link rel="top" title="TARDIS v0.9.dev692" href="../index.html" />
<meta charset='utf-8'>
<meta http-equiv='X-UA-Compatible' content='IE=edge,chrome=1'>
<meta name='viewport' content='width=device-width, initial-scale=1.0, maximum-scale=1'>
<meta name="apple-mobile-web-app-capable" content="yes">

  </head>
  <body>
  
  <a href="http://github.com/wkerzendorf/tardis"><img style="position: fixed; top: 0px; right: 0; border: 0; z-index: 100000;image-orientation: 90deg;" src="https://s3.amazonaws.com/github/ribbons/forkme_left_darkblue_121621.png" alt="Fork me on GitHub"/></a>

<div class="container">
  
  <div id="navbar" class="navbar navbar-fixed-top">
    <div class="navbar-inner">
      <!-- .btn-navbar is used as the toggle for collapsed navbar content -->
      <button class="btn btn-navbar" data-toggle="collapse" data-target=".nav-collapse">
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
      </button>

      <a class="brand" href="../index.html">TARDIS</a>
      <span class="navbar-text pull-left"><b>0.9.dev692</b></span>

      <div class="nav-collapse">
        <ul class="nav">
          <li class="divider-vertical"></li>
          
            <li class="dropdown">
  <a href="../index.html"
     class="dropdown-toggle"
     data-toggle="dropdown">Site <b class="caret"></b></a>
  <ul class="dropdown-menu globaltoc"
    ><ul>
<li class="toctree-l1"><a class="reference internal" href="../installation.html">Installation</a></li>
<li class="toctree-l1"><a class="reference internal" href="../running.html">Running TARDIS</a></li>
<li class="toctree-l1"><a class="reference internal" href="../gui.html">Graphical User Interface</a></li>
<li class="toctree-l1"><a class="reference internal" href="../atomic.html">Atomic Data</a></li>
<li class="toctree-l1"><a class="reference internal" href="../plasma.html">Plasma</a></li>
<li class="toctree-l1"><a class="reference internal" href="../montecarlo.html">Radiative Monte Carlo</a></li>
<li class="toctree-l1"><a class="reference internal" href="../glossary.html">Glossary</a></li>
<li class="toctree-l1"><a class="reference internal" href="../zreferences.html">References</a></li>
<li class="toctree-l1"><a class="reference internal" href="../credits.html">Credits</a></li>
</ul>
</ul>
</li>
            <li class="dropdown">
  <a href="#" class="dropdown-toggle" data-toggle="dropdown">Page <b class="caret"></b></a>
  <ul class="dropdown-menu localtoc"><ul>
<li><a class="reference internal" href="#">Macro Atom</a></li>
</ul>
</ul>
</li>
          
          
            
          
          
            <li></li>
          
        </ul>

        
          
<form class="navbar-search pull-right" style="margin-bottom:-3px;" action="../search.html" method="get">
  <input type="text" name="q" placeholder="Search" />
  <input type="hidden" name="check_keywords" value="yes" />
  <input type="hidden" name="area" value="default" />
</form>
        
      </div>
    </div>
  </div>

  
  <div class="section" id="macro-atom">
<h1>Macro Atom<a class="headerlink" href="#macro-atom" title="Permalink to this headline">Â¶</a></h1>
<p>The macro atom is described in detail in <a class="reference internal" href="../zreferences.html#a-a-384-725l">[1]</a>. The basic principal is that when an energy packet
is absorbed that the macro atom is on a certain level. Three probabilities govern the next step the P<sub>up</sub>,
P<sub>down</sub> and P<sub>down emission</sub> being the probability for going to a higher level, a lower level and a lower
level and emitting a photon while doing this respectively (see Figure 1 in <a class="reference internal" href="../zreferences.html#a-a-384-725l">[1]</a> ).</p>
<p>The macro atom is the most complex idea to implement as a data structure. The setup is done in <cite>~tardisatomic</cite>, but
we will nonetheless discuss it here (as <cite>~tardisatomic</cite> is even less documented than this one).</p>
<p>For each level we look at the line list to see what transitions (upwards or downwards are possible). We create a two arrays,
the first is a long one-dimensional array containing the probabilities. Each level contains a set of probabilities, The first
part of each set contains the upwards probabilities (internal upward), the second part the downwards probabilities
(internal downward), and the last part is the downward and emission probability.</p>
<p>each set is stacked after the other one to make one long one dimensional <cite>~numpy.ndarray</cite>.</p>
<p>The second array is for book-keeping it has exactly the length as levels (with an example for the Si II level 15):</p>
<table border="1" class="docutils">
<colgroup>
<col width="11%" />
<col width="25%" />
<col width="17%" />
<col width="23%" />
<col width="24%" />
</colgroup>
<thead valign="bottom">
<tr class="row-odd"><th class="head">Level ID</th>
<th class="head">Probability index</th>
<th class="head">N<sub>up</sub></th>
<th class="head">N<sub>down</sub></th>
<th class="head">N<sub>total</sub></th>
</tr>
</thead>
<tbody valign="top">
<tr class="row-even"><td>14001015</td>
<td>???</td>
<td>17</td>
<td>5</td>
<td>17 + 5*2 = 27</td>
</tr>
</tbody>
</table>
<p>We now will calculate the transition probabilites, using the radiative rates in Equation 20, 21, and 22
in <a class="reference internal" href="../zreferences.html#a-a-384-725l">[1]</a>. Then we calculate the downward emission probability from Equation 5, the downward and
upward internal transition probabilities in <a class="reference internal" href="../zreferences.html#a-a-403-261l">[2]</a>.</p>
<div class="math">
\[\begin{split}p_\textrm{emission down}&amp;= {\cal R}_{\textrm{i}\rightarrow\textrm{lower}}\,(\epsilon_\textrm{upper} - \epsilon_\textrm{lower}) / {\cal D}_{i}\\
p_\textrm{internal down}&amp;= {\cal R}_{\textrm{i}\rightarrow\textrm{lower}}\,\epsilon_\textrm{lower}/{\cal D}_{i}\\,
p_\textrm{internal up}&amp;={\cal R}_{\textrm{i}\rightarrow\textrm{upper}}\,\epsilon_{i}/{\cal D}_{i}\\,\end{split}\]</div>
<dl class="docutils">
<dt>where <span class="math">\(i\)</span> is the current level, <span class="math">\(\epsilon\)</span> is the energy of the level, and <span class="math">\({\cal R}\)</span> is the radiative</dt>
<dd>rates.</dd>
</dl>
<p>We ignore the probability to emit a k-packet as TARDIS only works with photon packets.
Next we calculate the radidative
rates using equation 10 in <a class="reference internal" href="../zreferences.html#a-a-403-261l">[2]</a>.</p>
<div class="math">
\[\begin{split}{\cal R}_{\textrm{upper}\rightarrow\textrm{lower}} &amp;=
A_{\textrm{upper}\rightarrow\textrm{lower}}\beta_\textrm{Sobolev}n_\textrm{upper}\\
{\cal R}_{\textrm{lower}\rightarrow\textrm{upper}} &amp;=
(B_{\textrm{lower}\rightarrow\textrm{upper}}n_\textrm{lower}-
B_{\textrm{upper}\rightarrow\textrm{lower}}n_\textrm{upper})
\beta_\textrm{Sobolev} J_{\nu}^{b}\\,\end{split}\]</div>
<p>with <span class="math">\(\beta_\textrm{Sobolev} = \frac{1}{\tau_\textrm{Sobolev}}(1-e^{-\tau_\textrm{Sobolev}})\)</span> .</p>
<p>using the Einstein coefficients</p>
<div class="math">
\[\begin{split}A_{\textrm{upper}\rightarrow\textrm{lower}} &amp;= \frac{8 \nu^2 \pi^2 e^2}{m_e c^3}~
    \frac{g_\textrm{lower}}{g_\textrm{upper}}~f_{\textrm{lower}\rightarrow\textrm{upper}}\\
A_{\textrm{upper}\rightarrow\textrm{lower}} &amp;= \underbrace{\frac{4 \pi^2 e^2}{m_e c}}_{C_\textrm{Einstein}}~ \frac{2\nu^2}{c^2}
        \frac{g_\textrm{lower}}{g_\textrm{upper}}~f_{\textrm{lower}\rightarrow\textrm{upper}}\\
B_{\textrm{lower}\rightarrow\textrm{upper}} &amp;= \frac{4\pi^2 e^2}{m_e h\nu c}\,f_{\textrm{lower}\rightarrow\textrm{upper}}\\
B_{\textrm{lower}\rightarrow\textrm{upper}} &amp;= \underbrace{\frac{4 \pi^2 e^2}{m_e c}}_{C_\textrm{Einstein}}\frac{1}{h\nu} f_{\textrm{lower}\rightarrow\textrm{upper}}\\\end{split}\]\[\begin{split}B_{\textrm{upper}\rightarrow\textrm{lower}} &amp;= \frac{4\pi^2 e^2}{m_e h\nu c}\,f_{\textrm{lower}\rightarrow\textrm{upper}}\\
B_{\textrm{upper}\rightarrow\textrm{lower}} &amp;= \underbrace{\frac{4 \pi^2 e^2}{m_e c}}_{C_\textrm{Einstein}}\frac{1}{h\nu}\frac{g_\textrm{lower}}{g_\textrm{upper}}f_{\textrm{lower}\rightarrow\textrm{upper}}\\\end{split}\]</div>
<p>we get</p>
<div class="math">
\[\begin{split}{\cal R}_{\textrm{upper}\rightarrow\textrm{lower}} &amp;=
    C_\textrm{Einstein} \frac{2\nu^2}{c^2} \frac{g_\textrm{lower}}{g_\textrm{upper}}~f_{\textrm{lower}\rightarrow\textrm{upper}}
    \beta_\textrm{Sobolev}n_\textrm{upper}\\\end{split}\]\[\begin{split}{\cal R}_{\textrm{lower}\rightarrow\textrm{upper}} &amp;=
        C_\textrm{Einstein}\frac{1}{h\nu} f_{\textrm{lower}\rightarrow\textrm{upper}}
        (n_\textrm{lower}-\frac{g_\textrm{lower}}{g_\textrm{upper}}n_\textrm{upper})
                    \beta_\textrm{Sobolev} J_{\nu}^{b}\\\end{split}\]</div>
<p>This results in the transition probabilities:</p>
<div class="math">
\[\begin{split}p_\textrm{emission down}&amp;= C_\textrm{Einstein} \frac{2\nu^2}{c^2} \frac{g_\textrm{lower}}{g_\textrm{i}}~f_{\textrm{lower}\rightarrow\textrm{i}}
                                   \beta_\textrm{Sobolev}n_\textrm{i}\,(\epsilon_\textrm{i} - \epsilon_\textrm{lower}) / {\cal D}_{i}\\
p_\textrm{internal down}&amp;= C_\textrm{Einstein} \frac{2\nu^2}{c^2} \frac{g_\textrm{lower}}{g_\textrm{i}}~f_{\textrm{lower}\rightarrow\textrm{i}}
                                   \beta_\textrm{Sobolev}n_\textrm{i}\,\epsilon_\textrm{lower}/{\cal D}_{i}\\
p_\textrm{internal up}&amp;=C_\textrm{Einstein}\frac{1}{h\nu} f_{\textrm{i}\rightarrow\textrm{upper}}
                                    (n_\textrm{i}-\frac{g_\textrm{i}}{g_\textrm{upper}}n_\textrm{upper})
                                                \beta_\textrm{Sobolev} J_{\nu}^{b}\,\epsilon_{i}/{\cal D}_{i}\\,\end{split}\]</div>
<dl class="docutils">
<dt>and as we will normalise the transition probabilities numerically later,  we can get rid of <span class="math">\(C_\textrm{Einstein}\)</span>,</dt>
<dd><span class="math">\(\frac{1}{{\cal D}_i}\)</span> and number densities.</dd>
</dl>
<div class="math">
\[\begin{split}p_\textrm{emission down}&amp;= \frac{2\nu^2}{c^2} \frac{g_\textrm{lower}}{g_\textrm{i}}~f_{\textrm{lower}\rightarrow\textrm{i}}
                                   \beta_\textrm{Sobolev}\,(\epsilon_\textrm{i} - \epsilon_\textrm{lower})\\
p_\textrm{internal down}&amp;=  \frac{2\nu^2}{c^2} \frac{g_\textrm{lower}}{g_\textrm{i}}~f_{\textrm{lower}\rightarrow\textrm{i}}
                                   \beta_\textrm{Sobolev}\,\epsilon_\textrm{lower}\\
p_\textrm{internal up}&amp;=\frac{1}{h\nu} f_{\textrm{i}\rightarrow\textrm{upper}}
                                    \underbrace{(1-\frac{g_\textrm{i}}{g_\textrm{upper}}\frac{n_\textrm{upper}}{n_i})}
                                    _\textrm{stimulated emission}
                                                \beta_\textrm{Sobolev} J_{\nu}^{b}\,\epsilon_{i}\\,\end{split}\]</div>
<p>There are two parts for each of the probabilities, one that is pre-computed by <cite>~tardisatomic</cite> and is in the HDF5 File,
and one that is computed during the plasma calculations:</p>
<div class="math">
\[\begin{split}p_\textrm{emission down}&amp;= \underbrace{\frac{2\nu^2}{c^2} \frac{g_\textrm{lower}}{g_\textrm{i}}~f_{\textrm{lower}\rightarrow\textrm{i}}
                                   (\epsilon_\textrm{i} - \epsilon_\textrm{lower})}_\textrm{pre-computed}
                                   \,\beta_\textrm{Sobolev}\\
p_\textrm{internal down} &amp;= \underbrace{\frac{2\nu^2}{c^2} \frac{g_\textrm{lower}}{g_\textrm{i}}~f_{\textrm{lower}\rightarrow\textrm{i}}
                                   \epsilon_\textrm{lower}}_\textrm{pre-computed}\,\beta_\textrm{Sobolev}\\
p_\textrm{internal up} &amp;= \underbrace{\frac{1}{h\nu} f_{\textrm{i}\rightarrow\textrm{upper}}}_\textrm{pre-computed}
                                                \beta_\textrm{Sobolev} J_{\nu}^{b}\,
                                                (1-\frac{g_\textrm{i}}{g_\textrm{upper}}\frac{n_\textrm{upper}}{n_i})
                                                \,\epsilon_{i}.\end{split}\]</div>
</div>


</div>
<footer class="footer">
  <div class="container">
    <p class="pull-right">
      <a href="#">Back to top</a>
      
    </p>
    <p>
        &copy; Copyright 2013, TARDIS team.<br/>
      Created using <a href="http://sphinx.pocoo.org/">Sphinx</a> 1.1.3.<br/>
    </p>
  </div>
</footer>
  </body>
</html>