##parameters=account,args=[],kw={}
##title=Dividend Payable
from Products.BastionBanking.ZCurrency import ZCurrency
from Products.BastionLedger.BLSubsidiaryEntry import BLSubsidiaryEntry

ledger = context.blLedger()
ledger_id = ledger.getId()

share_type = kw['share_type']
allotted = getattr(ledger, share_type).allotted(kw['effective'])
quantity = account.allocationQuantity(share_type, kw['effective'])

# avoid divide by zero
if allotted:
    return [ BLSubsidiaryEntry(account.getId(),
                               script.title_or_id(),
                               '%s/%s' % (ledger_id, account.getId()),
                               -kw['total_amount'] * quantity / allotted,
                               script.getId()) ]

return []
