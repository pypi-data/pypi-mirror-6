{% extends 'admin/master.html' %}
{% import 'shelf-admin/lib.html' as lib with context %}

{% block body %}
    <h1>UPLOAD FILES</h1>
    <div class="row" style="margin-top: 50px; background-color: #ffffff">
        <div class="col-xs-12" style="border-bottom: 1px solid black;">
            <h1>{{ admin_view.name.upper() }}</h1>
        </div>
        <div class="col-xs-12"  style="padding-top: 25px; padding-bottom: 20px">
                <form role="form" method="post" enctype="multipart/form-data" id="dropfile"  style="background-color: black; padding: 10px">
                    <div class="form-group" style="text-align: center">
                        <i class="fa fa-arrow-circle-down"></i><br>
                        <label for="file">DÃ©poser ou charger depuis votre ordinateur</label>
                        <input type="file" name="file" id="file" size="chars">
                        
                    </div>
                </form>
        </div>
    </div>
    <div class="row" style="margin-top: 50px; background-color: #ffffff">
        <div class="col-xs-12" style="border-bottom: 1px solid black;">
            <h1>UPLOADING...</h1>
         </div>    
         <div class="col-xs-12"  style="padding-top: 25px">   
                <ul class="media-list">
                  <li class="media">
                    <p class="pull-left" style="padding-top: 5px">
                      <i class="media-object fa fa-list fa-2x" style="width: 50px"></i>
                    </a>
                    <div class="media-body">
                      <h4 class="media-heading">Tous</h4>
                        <div class="progress progress-striped active" style="height: 10px; width: 50%">
                            <div class="progress-bar progress-bar-success" role="progressbar" aria-valuenow="60" aria-valuemin="0" aria-valuemax="100" style="width: 90%;">
                            <span class="sr-only">60% Complete</span>
                            </div>
                        </div>
                        <p class="pull-right">
                                        <i class="fa fa-times-circle fa-lg"></i>
                                    </p>
                        <div class="clearfix"></div>
                        <ul class="media-list">
                            <li class="media">
                                <p class="pull-left" style="padding-top: 5px">
                                  <i class="media-object fa fa-picture-o fa-2x" style="width: 50px"></i>
                                </p>
                                <div class="media-body">
                                  <h4 class="media-heading">machin.png</h4>
                                    <div class="progress progress-striped active" style="height: 10px; width: 50%">
                                        <div class="progress-bar progress-bar-success" role="progressbar" aria-valuenow="60" aria-valuemin="0" aria-valuemax="100" style="width: 60%;">
                                            <span class="sr-only">60% Complete</span>
                                        </div>                                    
                                    </div>
                                    <p class="pull-right">
                                        <i class="fa fa-times-circle fa-lg"></i>
                                    </p>
                                    <div class="clearfix"></div>
                                </div>
                            </li>
                            <li class="media">
                                <p class="pull-left" style="padding-top: 5px">
                                  <i class="media-object fa fa-file-text fa-2x" style="width: 50px"></i>
                                </p>
                                <div class="media-body">
                                  <h4 class="media-heading">machin.pdf</h4>
                                    <div class="progress progress-striped active" style="height: 10px; width: 50%">
                                        <div class="progress-bar progress-bar-success" role="progressbar" aria-valuenow="60" aria-valuemin="0" aria-valuemax="100" style="width: 60%;">
                                            <span class="sr-only">60% Complete</span>
                                        </div>                                    
                                    </div>
                                    <p class="pull-right">
                                        <i class="fa fa-times-circle fa-lg"></i>
                                    </p>
                                    <div class="clearfix"></div>
                                </div>
                            </li>
                            <li class="media">
                                <p class="pull-left" style="padding-top: 5px">
                                  <i class="media-object fa fa-film fa-2x" style="width: 50px"></i>
                                </p>
                                <div class="media-body">
                                  <h4 class="media-heading">machin.mov</h4>
                                    <div class="progress progress-striped active" style="height: 10px; width: 50%">
                                        <div class="progress-bar progress-bar-success" role="progressbar" aria-valuenow="60" aria-valuemin="0" aria-valuemax="100" style="width: 60%;">
                                            <span class="sr-only">60% Complete</span>
                                        </div>                                    
                                    </div>
                                    <p class="pull-right">
                                        <i class="fa fa-times-circle fa-lg"></i>
                                    </p>
                                    <div class="clearfix"></div>
                                </div>
                            </li>
                            <li class="media">
                                <p class="pull-left" style="padding-top: 5px">
                                  <i class="media-object fa fa-save fa-2x" style="width: 50px"></i>
                                </p>
                                <div class="media-body">
                                  <h4 class="media-heading">machin.zip</h4>
                                    <div class="progress progress-striped active" style="height: 10px; width: 50%">
                                        <div class="progress-bar progress-bar-success" role="progressbar" aria-valuenow="60" aria-valuemin="0" aria-valuemax="100" style="width: 60%;">
                                            <span class="sr-only">60% Complete</span>
                                        </div>                                    
                                    </div>
                                    <p class="pull-right">
                                        <i class="fa fa-times-circle fa-lg"></i>
                                    </p>
                                    <div class="clearfix"></div>
                                </div>
                            </li>
                        </ul>
                    </div>
                  </li>
                </ul>
        </div>
    </div>

{% endblock %}

{% block bottom %}
    <div class="navbar navbar-default navbar-fixed-bottom">
        <div class="container">
            <div class="navbar-header">
                <button type="button" class="navbar-toggle" data-toggle="collapse" data-target=".navbar-collapse">
                  <span class="icon-bar"></span>
                  <span class="icon-bar"></span>
                  <span class="icon-bar"></span>
                </button>
                <a class="navbar-brand" href="#">{{ admin_view.name }}</a>
            </div>
            <div class="collapse navbar-collapse">
                <ul class="nav navbar-nav navbar-left">
                    <li class="dropdown">
                        <a class="dropdown-toggle" data-toggle="dropdown">Presentation</a>
                        <ul class="dropdown-menu">
                            {% if dir_path %}
                            <li><a href="{{ url_for('.index', path=dir_path) }}">List</a></li>
                            <li><a href="{{ url_for('.iconic_index', path=dir_path) }}">Icons</a></li>
                            {% else %}
                            <li><a href="{{ url_for('.index') }}">List</a></li>
                            <li><a href="{{ url_for('.iconic_index') }}">Icons</a></li>
                            {% endif %}
                        </ul>
                    </li>
                    <li class="dropdown">
                        <a class="dropdown-toggle" data-toggle="dropdown">Filter</a>
                        <ul class="dropdown-menu">
                            <li><a href="#">List</a></li>
                            <li><a href="#">Icons</a></li>
                        </ul>
                    </li>
                </ul>
                <ul class="nav navbar-nav navbar-right">
                    <li>
                        <a>Validate</a>
                    </li>
                    <li>
                        <a>Cancel</a>
                    </li>
                </ul>
            </div>
        </div>
    </div>
{% endblock %}

{% block tail %}
    {{ super() }}
    <script src="{{ url_for('admin.static', filename='datetimepicker/bootstrap-datetimepicker.js') }}"></script>
    <script src="{{ url_for('admin.static', filename='admin/js/form.js') }}"></script>
    <script src="{{ url_for('admin.static', filename='admin/js/filters.js') }}"></script>

    <script language="javascript">
            function upload(files) {
                 var f = files[0] ;
                 // Only process image files.
                 if (!f.type.match('image/jpeg')) {
                    alert('The file must be a jpeg image') ;
                    return false ;
                 }

                 var reader = new FileReader();
              
                 // When the image is loaded,
                 // run handleReaderLoad function
                 reader.onload = function (evt) {
                    var pic = {};
                    pic.file = evt.target.result.split(',')[1];
                    //pic.filename = evt.target.result.split(',')[0];
                    alert(f.name);
                    var str = jQuery.param(pic);
                 
                    $.ajax({
                        type: 'POST',
                        url: '{{ url_for(".async_upload") }}',
                        data: str,
                        success: function(data) {
                            alert('yes') ;
                        }
                    });
                 }
              
                 // Read in the image file as a data URL.
                 reader.readAsDataURL(f);            
            }

        (function($) {
            $(document).on('dragenter', '#dropfile', function() {
                $(this).css('border', '3px dashed red');
                return false;
            });
             
            $(document).on('dragover', '#dropfile', function(e){
                e.preventDefault();
                e.stopPropagation();
                $(this).css('border', '3px dashed red');
                return false;
            });
             
            $(document).on('dragleave', '#dropfile', function(e) {
                e.preventDefault();
                e.stopPropagation();
                $(this).css('border', '3px dashed #BBBBBB');
                return false;
            });

            

            $(document).on('drop', '#dropfile', function(e) {
                if(e.originalEvent.dataTransfer){
                    if(e.originalEvent.dataTransfer.files.length) {
                       // Stop the propagation of the event
                       e.preventDefault();
                       e.stopPropagation();
                       $(this).css('border', '3px dashed green');
                       // Main function to upload
                       upload(e.originalEvent.dataTransfer.files);
                    }  
                }
                else 
                {
                    $(this).css('border', '3px dashed #BBBBBB');
                }
                return false;
            });
        })(jQuery);
    </script>
{% endblock %}
