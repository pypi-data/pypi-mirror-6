<html xmlns:tal="http://xml.zope.org/namespaces/tal"
      xmlns:metal="http://xml.zope.org/namespaces/metal"
      metal:use-macro="context/main_template/macros/master"
      i18n:domain="bastionledger">

  <metal:border fill-slot="top_slot">
    <tal:border define="dummy python:request.set('enable_border',1)" />
  </metal:border>
 
<body>
  <div metal:fill-slot="main"
       tal:define="date request/date | python: DateTime() - 30;
                   utool context/@@plone_portal_state/portal_url;
                   months request/months | python: 4">
                     
      <h1 class="documentFirstHeading"><img src="" alt="" tal:define="icon python:context.getIcon(1)" 
               tal:attributes="src string:${utool}/${icon}">&nbsp;<span tal:replace="context/Title | context/getId"/></h1>

      <div tal:replace="structure provider:plone.belowcontenttitle"/>

   <div class="reviewHistory">
      <dl id="viewing" class="collapsible inline collapsedOnLoad">
        <dt class="collapsibleHeader">Query</dt>
        <dd class="collapsibleContent">
        <form action="" method="post">
          <table summary="" border="0" cellpadding="2" cellspacing="0">
            <tr>
               <td class="field"
                   tal:define="inputvalue python: context.toLocalizedTime(date, long_format=0);
                               formname string:edit_form;
                               show_hm python: False;
                               inputname string:date;">
                   <strong>Start Date</strong>&nbsp;
                   <span metal:use-macro="here/calendar_macros/macros/calendarDatePickerBox"/>
               </td>
               <td class="field">
                   <strong>Months</strong>
                   <input type="text" name="months:int" size="2" maxlength="2" value=""
                          tal:attributes="value months"/>
               </td>
               <td>
                   <input type="submit" class="context" value=" Go "/>
               </td>
            </tr>
          </table>
        </form>
         </dd>
       </dl>
   </div>

         <table summary="" border="0" cellpadding="2" cellspacing="0" width="100%"
                tal:define="forecasts python: context.forecasts(date, months);
                            dates python: forecasts[0];
                            recs  python: forecasts[1];
                            totals python: forecasts[2];">
            <tr class="row">
                <td/>
                <td class="field"  tal:define="ldate python: (DateTime(date) - months * 30).strftime('%Y/%m/%d')">
                    <a href="" style="text-decoration: none"
                       tal:attributes="href string:${context/absolute_url}/${template/getId}?date:date=${ldate}&amp;months:int=${months}">&laquo;</a>
                </td>
                <td class="field" tal:repeat="dt dates" colspan="2" align="center">
                    <b tal:content="python: dt.strftime('%b %Y')"/>
                </td>
                <td class="field"
                    tal:define="rdate python: (DateTime(date) + months * 30).strftime('%Y/%m/%d')">
                    <a href=""  style="text-decoration: none" 
                       tal:attributes="href string:${context/absolute_url}/${template/getId}?date:date=${rdate}&amp;months:int=${months}">&raquo;</a>
                </td>
            </tr>
            <tr class="row">
                <td/>
                <td/>
                <tal:block tal:repeat="dt dates">
                    <td class="field" align="right"><b>Budgeted</b></td>
                    <td class="field" align="right"><b><i>Actual</i></b></td>
                </tal:block>
                <td/>
            </tr>
            <tr tal:repeat="rec recs" class="" 
                tal:attributes="class python: repeat['rec'].odd() and 'odd' or 'even'">
                <td class="field" nowrap tal:define="account python:rec[0]">
                     <img src="" tal:define="icon python:account.getIcon(1)" alt="Account"
                          tal:attributes="src string:${utool}/${icon}"/>
                     <a href="" tal:attributes="href account/absolute_url"
                                tal:content="account/Title"/>
                </td>
                <td/>
                <td class="field" align="right" nowrap tal:repeat="v python:rec[1:]">
                     <span tal:condition="repeat/v/even" tal:replace="v"/>
                     <i tal:condition="repeat/v/odd" tal:content="v"/>
                </td>
                <td/>
            </tr>
            <tr class="row">
                <td/>
                <td/>
                <td class="field" tal:repeat="total totals" align="right" nowrap>
                   <b><span tal:condition="repeat/total/even" tal:replace="total"/>
                      <i tal:condition="repeat/total/odd" tal:content="total"/></b>
                </td>
                <td/>
            </tr>
         </table>

      <div tal:replace="structure provider:plone.belowcontentbody">
           Document actions (print, sendto etc)
      </div>

  </div>
 
</body>
</html>
