<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html tal:omit-tag=""
  lang="en"
  xml:lang="en"
  xmlns="http://www.w3.org/1999/xhtml"
  xmlns:metal="http://xml.zope.org/namespaces/metal"
  xmlns:tal="http://xml.zope.org/namespaces/tal"
  xmlns:i18n="http://xml.zope.org/namespaces/i18n"
  tal:define="
    vein string:export;
    active_tab string:tab_status;
    parent_screen_name string:publish;
    refs request/refs | python:[request['model'].create_ref(request['model'])];
    docma_running python: hasattr(here, 'service_docma') and here.service_docma.try_connection_and_pw();
    "
  i18n:domain="silva">

<metal:block use-macro="here/macro_index/macros/master">

  <metal:block metal:fill-slot="middleground">
    <tal:buttons tal:replace="structure model/@@tab_publish_extra" />
  </metal:block>

<metal:block fill-slot="main">

<table class="columns columns2">
  <tbody>
    <tr>
      <tal:block replace="nothing">
        _____________________ sidebar _____________________
      </tal:block>
      <td class="left">
        <tal:block replace="nothing">
          ______________ vein navigation ______________
        </tal:block>
        <metal:use-macro use-macro="here/macro_vein_navigation/macros/vein">
          <metal:fill-slot fill-slot="sidebar">
            <tal:block replace="structure python: here.service_sidebar.render(model, 'tab_status_export', vein)" />
          </metal:fill-slot>
        </metal:use-macro>
      </td>

      <tal:block replace="nothing">
        _____________________ main subtable _____________________
      </tal:block>
      <td class="main">
        <span tal:replace="nothing">
          ______________ export feedback ______________
        </span>
        <div class="alert"
          style="margin-bottom:1em;"
          tal:condition="python:len(refs) > 1"
          i18n:translate="">
          Sorry, full media export is currently not supported for more
          than one item.  Please select one item, or select no items to export
          the whole folder.
        </div>
        <div class="feedback"
          style="margin-bottom:1em;">
          <span class="subhead"
            i18n:translate="">items to export:</span><br />
          <table width="100%" border="0">
            <tr tal:repeat="ref refs">
              <tal:block define="obj python: request['model'].resolve_ref(ref); path python: '/'.join(obj.getPhysicalPath())">
                <td valign="top">
                  <a class="blacklink" tal:attributes="href string:${path}/edit/tab_preview">
                    <b tal:content="obj/get_title_editable" />
                  </a>
                </td>
                <td valign="top">
                  <a class="blacklink" tal:attributes="href string:${path}/edit">
                    <span tal:replace="python: test(len(obj.id) > 30, '%s...' % obj.id[:30], obj.id)" />
                  </a>&nbsp;
                </td>
              </tal:block>
            </tr>
          </table>
        </div>

<span tal:replace="nothing">
  ____________________________ full media export ____________________________
</span>

<form tal:condition="python:user.has_role(['Manager', 'ChiefEditor'], model) and len(refs) == 1"
  action="." enctype="multipart/form-data" method="post">
  <input type="hidden"
    name="refs"
    tal:attributes="value python: '||'.join(refs)" />
  <table class="listing">
    <thead>
      <tr>
        <td class="top"
          colspan="2">
          <h2 tal:attributes="title string:id: ${model/id}">
            <img tal:replace="structure icon" />
            <tal:block i18n:translate="">export from
              &#xab;<tal:block content="title" i18n:name="title"/>&#xbb;</tal:block>
          </h2>
        </td>
      </tr>
      <tr class="top-controls">
        <td colspan="2">
          <h3 i18n:translate="">
            export
          </h3>
        </td>
      </tr>
    </thead>
    <tbody>
      <tr>
        <th width="33%"
          i18n:translate="">
          options
        </th>
        <th i18n:translate="">
          setting
        </th>
      </tr>
      <tr class="odd">
        <td class="designator">
          <label for="with_sub_publications"
            i18n:translate="">
            include sub publications?
          </label>
        </td>
        <td class="field align-right">
          <p style="float:left"
            i18n:translate="">
            Check to export all sub publications. 
          </p>
          <input class="min"
            type="checkbox"
            id="with_sub_publications"
            name="with_sub_publications"
          />
        </td>
      </tr>
      <tr class="even">
        <td class="designator">
          <label for="export_last_version"
            i18n:translate="">
            export only newest versions?
          </label>
        </td>
        <td class="field align-right">
          <p style="float:left"
            i18n:translate="">
            If not checked all versions are exported.
          </p>
          <input class="min"
            type="checkbox"
            name="export_last_version"
            id="export_last_version"
            checked="checked"
          />
        </td>
      </tr>
      <tal:def define="displayformats python:request['model'].export_content_format(refs[0])">
        <tal:comment replace="nothing">
          <!-- If there's only one export format (thus only one radio button)
            use a hidden field instead so users don't have to puzzle about it -->
        </tal:comment>
        <tal:if condition="python:len(displayformats) == 1">
          <tal:repeat repeat="format displayformats">
            <input type="hidden"
              name="export_format"
              tal:attributes="
                id string:export_format_${format/value};
                checked python:repeat['format'].start;
                value format/value"
            />
          </tal:repeat>
        </tal:if>
        <tr class="odd"
          tal:condition="python:len(displayformats) > 1">
          <td class="designator">
            <span class="matchlabel"
              i18n:translate="">
              select an export format
            </span>
          </td>
          <td class="field">
            <div style="float:right">
              <tal:repeat repeat="format displayformats">
                <input class="min"
                  type="radio"
                  name="export_format"
                  tal:attributes="
                    id string:export_format_${format/value};
                    checked python:repeat['format'].start;
                    value format/value"
                />
                <label tal:content="format/title"
                  tal:attributes="for string:export_format_${format/value}">
                  Name
                </label>
                <br />
              </tal:repeat>
            </div>
            <p i18n:translate="">
              Select the format which will be used for the export.
            </p>
          </td>
        </tr>
      </tal:def>

    </tbody>
    <tfoot>
      <tr class="controls">
        <td class="align-right"
          colspan="2">
          <input class="button"
            type="submit"
            name="download_fullmedia_selected:method"
            value="export"
            title="access key: alt-z"
            accesskey="z"
            i18n:attributes="value;title"
          />
        </td>
      </tr>
    </tfoot>
  </table>
</form>

<span tal:replace="nothing">
  ____________________________ xml export + docma2pdf ____________________________
</span>
<form action="." enctype="multipart/form-data" method="post"
  tal:condition="here/service_docmapdf | nothing">
  <input type="hidden"
    name="refs"
    tal:attributes="value python: '||'.join(refs)" />
  <table class="listing">
    <thead>
      <tr class="top-controls">
        <td colspan="3">
          <h3 i18n:translate="">
            export to Silva xml (.xml)
            <tal:block i18n:name="or_pdf">
              <tal:block i18n:translate="">or Adobe PDF (.pdf)</tal:block>
            </tal:block>
          </h3>
        </td>
      </tr>
    </thead>

    <tbody>
      <tr>
        <th class="align-right"
          width="30%"
          i18n:translate="">
          options
        </th>
        <th width="3%">
        </th>
        <th i18n:translate="">
          note
        </th>
      </tr>

      <tr class="odd">
        <td class="align-right">
          <label for="with_sub_publications"
            i18n:translate="">
            include sub publications?
          </label>
        </td>
        <td class="align-center">
          <input class="min"
            type="checkbox"
            name="with_sub_publications"
            id="with_sub_publications"
          />
        </td>
        <td>
        </td>
      </tr>

      <tr class="even">
        <td class="align-right">
          <label for="export_last_version"
            i18n:translate="">
            export newest versions?
          </label>
        </td>
        <td class="align-center">
          <input class="min"
            type="checkbox"
            name="export_last_version"
            id="export_last_version"
            checked="checked"
          />
        </td>
        <td i18n:translate="">
          If not checked the published version is exported.
        </td>
      </tr>
    </tbody>

    <tfoot>
      <tr class="controls">
        <td colspan="3">
          <input class="button"
            style="float:right"
            type="submit"
            name="download_pdf_selected:method"
            value="export pdf"
            title="access key: alt-p"
            accesskey="p"
            i18n:attributes="value;title"
          />
          <input class="button"
            style="float:right"
            type="submit"
            name="download_xml_selected:method"
            value="export xml"
            title="access key: alt-e"
            accesskey="e"
            i18n:attributes="value;title"
          />
        </td>
      </tr>
    </tfoot>
  </table>
</form>

<span tal:replace="nothing">
  ____________________________ docma facilities  ____________________________
</span>

<tal:condition condition="docma_running">

<tal:define define="
  global user here/REQUEST/AUTHENTICATED_USER;
  global userid user/getId;
  global queue here/service_docma/get_queue;
  global qls python:len(queue) != 0;
  global processingident here/service_docma/get_processing_ident;" />

<form class="sublisting" action="." enctype="multipart/form-data" method="post">
  <input type="hidden"
    name="refs"
    tal:attributes="value python: '||'.join(refs)" />
  <table class="listing">
    <thead>
      <tr tal:replace="nothing">
        ______________ vein + title row ______________
      </tr>
      <tr>
        <td class="top"
          colspan="5">
          <h2>
            <img class="icon"
              border="0"
              width="16"
              height="16"
              alt="docma icon"
              tal:attributes="src string:${root_url}/globals/docma.png"
              i18n:attributes="alt"
            />
            <span i18n:translate="">docma facilities</span>
          </h2>
        </td>
      </tr>

      <tr class="top-controls">
        <td colspan="3">
          <h3 i18n:translate="">
            export to Docma (.doc)
          </h3>
        </td>
      </tr>
    </thead>

    <tbody>
      <tr>
        <th class="align-right"
          i18n:translate="">
          options
        </th>
        <th i18n:translate="">
          content
        </th>
        <th width="40%"
          i18n:translate="">
          note
        </th>
      </tr>

      <tr class="even">
        <td class="align-right">
          <label for="docma_with_sub_publications"
            i18n:translate="">
            include sub publications?
          </label>
        </td>
        <td>
          <input class="min"
            type="checkbox"
            name="with_sub_publications"
            id="docma_with_sub_publications"
          />
        </td>
        <td>
        </td>
      </tr>

      <tr class="odd">
        <td class="align-right">
          <label for="docma_export_last_version"
            i18n:translate="">
            export newest versions?
          </label>
        </td>
        <td>
          <input class="min"
            type="checkbox"
            name="export_last_version"
            id="docma_export_last_version"
          />
        </td>
        <td i18n:translate="">
          If not checked the published version is exported.
        </td>
      </tr>

      <tr class="even">
        <td class="align-right">
          <label for="docma_export_closed_content"
            i18n:translate="">
            export closed content?
          </label>
        </td>
        <td>
          <input class="min"
            type="checkbox"
            name="export_closed_content"
            id="docma_export_closed_content"
          />
        </td>
        <td i18n:translate="">
          Check to include closed content in the export.
        </td>
      </tr>

      <tr class="odd">
        <td class="align-right">
          <span i18n:translate="">email address</span><span class="warning">*</span>
        </td>
        <td align="left">
          <input class="store"
            type="text"
            name="email"
            tal:attributes="
              value python:here.service_members.get_member(user.getId()).email() or ''"
          />
        </td>
        <td i18n:translate="">
          An e-mail will be sent to you when the item is processed.
        </td>
      </tr>

      <tr class="even">
        <td class="align-right"
          i18n:translate="">
          choose a template
        </td>
        <td align="left">
          <select class="store"
            name="template">
            <option value="" i18n:translate="">
              none
            </option>
            <tal:repeat repeat="template here/service_docma/get_templates">
              <option tal:content="template"
                tal:attributes="value template">
              </option>
            </tal:repeat>
          </select>
        </td>
        <td>
          &nbsp;
        </td>
      </tr>

      <tr class="odd">
        <td class="align-right"
          i18n:translate="">
          description
        </td>
        <td>
          <textarea name="description"
            class="store"
            tal:content="model/get_title_editable"></textarea>
        </td>
        <td i18n:translate="">
          This description will be shown in the queue and the list of processed items.
        </td>
      </tr>
    </tbody>

    <tfoot>
      <tr class="inter-controls">
        <td class="align-right"
          colspan="3">
        <tal:block condition="may_change_content">
          <input class="button"
          type="submit"
          name="tab_status_silva2word:method"
          value="export to Docma"
          title="export the selection to word: alt-d"
          accesskey="d"
          i18n:attributes="value;title"
        />
        </tal:block>
        </td>
      </tr>
    </tfoot>
  </table>
</form>

<span tal:replace="nothing">
  _____________________ docma queue: processing list + finished jobs _____________________
</span>
<tal:define define="
    format string:word;
    refresh_page string:tab_status_export;
">
<metal:use-macro use-macro="here/docma_queue/macros/listings">
<metal:fill-slot fill-slot="manipulators">
  <!--  XXX i18n hell, but docma won't be supported anymore -->
  <input class="button remover"
    accesskey="x"
    name="export_delete:method"
    onclick="return confirm('Really remove?')"
    title="there's no undo: alt-x"
    type="submit"
    value="remove"
    i18n:attributes="value;title"
  />
</metal:fill-slot>
</metal:use-macro>
</tal:define>

</tal:condition>

<span tal:replace="nothing">
  Here we insert the additional_export_actions view
</span>
<tal:block replace="structure model/@@additional_export_action"/>

      </td>
    </tr>
  </tbody>
</table>

</metal:block>
</metal:block>
</html>
