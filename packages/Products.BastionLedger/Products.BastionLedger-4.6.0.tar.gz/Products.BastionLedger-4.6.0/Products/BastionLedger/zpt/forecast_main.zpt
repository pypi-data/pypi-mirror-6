<html tal:replace="structure context/manage_page_header"/>

    <span tal:replace="structure context/manage_tabs"/>


    <tal:block tal:define="date request/date | python: DateTime() - 90;
                           months request/months | python: 6;">

       <table border="0" width="100%" cellspacing="0" cellpadding="0"
              tal:define="products context/filtered_meta_types">
          <tr>
              <td align="left" valign="top" class="form-element">
                 <form action="" method="post">
                     <span class="form-label">Date</span>
                     <input type="text" name="date:date" size="10" 
                            tal:attributes="value date"/>
                     <span class="form-label">Months</span>
                     <input type="text" name="months:int" size="2" maxlength="2" 
                            tal:attributes="value months">
                     <input type="submit" value=" Go "/>
                 </form>
              </td>
              <td align="right" valign="top" class="form-element">
                 <form method="get" action="" tal:attributes="action request/URL1">
                     <div tal:condition="python: len(products) > 1" tal:omit-tag="">
                         <select class="form-element" name=":action"
                                 onchange="" tal:attributes="onchange string:location.href='${request/URL1}/'+this.options[this.selectedIndex].value">
                             <option value="manage_workspace" disabled>Select type to add...</option>
                             <option tal:repeat="product products"
                                     value="" tal:attributes="value product/action"
                                     tal:content="product/name"/>
                          </select>
                          <input class="form-element" type="submit" value=" Add ">
                      </div>
                      <div tal:condition="python: len(products) == 1" tal:omit-tag="">
                          <div tal:omit-tag="" tal:define="product python:products[0]">
                             <input type="hidden" name=":method" value="" tal:attributes="value product/action"/>
                             <input class="form-element" type="submit" name="submit" value=""
                                     tal:attributes="value string: Add ${product/name}" />
                          </div>
                      </div>
                 </form>
              </td>
          </tr>
       </table>
       <br/>
       <form action="" method="post" tal:attributes="action request/URL1">
         <table border="0" cellpadding="2" cellspacing="0" width="100%"
                tal:define="forecasts python: context.forecasts(date, months);
                            dates  python: forecasts[0];
                            recs   python: forecasts[1];
                            totals python: forecasts[2];">
            <tr class="list-header">
                <td/>
                <td class="list-item" tal:repeat="dt dates" colspan="2" align="center" 
                    tal:content="python: dt.strftime('%b %Y')"/>
            </tr>
            <tr class="list-header">
                <td/>
                <tal:block tal:repeat="dt dates">
                    <td class="list-item" align="right">Budgeted</td>
                    <td class="list-item" align="right">Actual</td>
                </tal:block>
            </tr>
            <tr tal:repeat="rec recs" class="" 
                tal:attributes="class python: repeat['rec'].index % 2 and 'row-hilite' or 'row-normal'">
                <td class="list-item" nowrap tal:content="python: rec[0].Title()"/>
                <tal:block tal:repeat="v python:rec[1:]">
                    <td class="list-item" tal:condition="repeat/v/odd" align="right" nowrap tal:content="v"/>
                    <td class="list-item" tal:condition="repeat/v/even">
                        <input type="text" size="15" name="recs.amount:records" value="" align="right" 
                               tal:attributes="value v"/>
                        <input type="hidden" name="recs.date:date:records" 
                               tal:attributes="value python: dates[repeat['v'].index / 2]"/>
                        <input type="hidden" name="recs.account:records" 
                               tal:attributes="value python: rec[0].getId()"/>
                    </td>
                </tal:block>
            </tr>
            <tr class="list-header">
                <td/>
                <td class="list-item" tal:repeat="total totals" align="right" nowrap tal:content="total"/>
            </tr>
         </table>
         <input type="submit" name="manage_edit_forecasts:method" value=" Edit "/>
       </form>

   </tal:block>

<html tal:replace="structure context/manage_page_footer"/>





