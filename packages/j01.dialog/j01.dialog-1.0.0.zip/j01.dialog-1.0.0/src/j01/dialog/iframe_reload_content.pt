<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" xml:lang="en" lang="en"
      i18n:domain="job">
<head>
<title>Dialog</title>
<meta http-equiv="Content-Type" content="text/html;charset=utf-8" />
<meta http-equiv="cache-control" content="no-cache" />
<meta http-equiv="pragma" content="no-cache" />
<script type="text/javascript" src="jquery.js"
        tal:attributes="src context/++resource++jquery.js"> </script>
<script type="text/javascript" src="z3c.xmlhttp.js"
        tal:attributes="src context/++resource++z3c.xmlhttp.js"> </script>
<script type="text/javascript" src="z3c.z3c.jsonrpcproxyproxy.js"
        tal:attributes="src context/++resource++z3c.jsonrpcproxy.js"> </script>
</head>
<body>
<script language="javascript" type="text/javascript"
        tal:content="string:
    var reloadURL = '${view/nextURL}';"> 
</script>
<script language="javascript" type="text/javascript">
  // this works but the image does not get reloaded!
  var ele = $('#content', top.document.body);
  var dlg = $('#j01Dialog', top.document);
  var dlgHolder = $('#j01DialogHolder', top.document);
// XXX: check error message handling, use the error.message
  function j01LoadContentFromIFrame(response) {
      if (response.error) {
          ele.html(response.error);
      }
      ele.empty();
      ele.html(response.content);
      // remove event handler
      $(top.window).unbind('resize');
      dlg.find('#j01DialogClose', dlg).unbind('click');
      $("#j01DialogOverlay", top.document).unbind("click");
      $("#j01DialogOverlay", top.document).remove();
      $("#j01DialogHiddenIFrame", top.document).remove();
      dlg.hide();
      dlg.remove();
      dlgHolder.remove();
      top.document.onkeydown = "";
  };
  // load content from server via jsonrpc
  proxy = getJSONRPCProxy(reloadURL);
  proxy.addMethod('j01LoadContent', j01LoadContentFromIFrame, 'j01LoadContent');
  proxy.j01LoadContent();
</script>
</body>
</html>
