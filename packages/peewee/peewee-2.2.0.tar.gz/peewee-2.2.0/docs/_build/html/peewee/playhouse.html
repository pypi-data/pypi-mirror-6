<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN"
  "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">


<html xmlns="http://www.w3.org/1999/xhtml">
  <head>
    <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
    
    <title>Playhouse, a collection of addons &mdash; peewee 2.1.6 documentation</title>
    
    <link rel="stylesheet" href="../_static/flasky.css" type="text/css" />
    <link rel="stylesheet" href="../_static/pygments.css" type="text/css" />
    
    <script type="text/javascript">
      var DOCUMENTATION_OPTIONS = {
        URL_ROOT:    '../',
        VERSION:     '2.1.6',
        COLLAPSE_INDEX: false,
        FILE_SUFFIX: '.html',
        HAS_SOURCE:  true
      };
    </script>
    <script type="text/javascript" src="../_static/jquery.js"></script>
    <script type="text/javascript" src="../_static/underscore.js"></script>
    <script type="text/javascript" src="../_static/doctools.js"></script>
    <link rel="top" title="peewee 2.1.6 documentation" href="../index.html" />
    <link rel="next" title="Upgrading peewee" href="upgrading.html" />
    <link rel="prev" title="API Reference" href="api.html" />
   
  
  <link media="only screen and (max-device-width: 480px)" href="../_static/small_flask.css" type= "text/css" rel="stylesheet" />

  </head>
  <body>
  
  

    <div class="related">
      <h3>Navigation</h3>
      <ul>
        <li class="right" style="margin-right: 10px">
          <a href="../genindex.html" title="General Index"
             accesskey="I">index</a></li>
        <li class="right" >
          <a href="upgrading.html" title="Upgrading peewee"
             accesskey="N">next</a> |</li>
        <li class="right" >
          <a href="api.html" title="API Reference"
             accesskey="P">previous</a> |</li>
        <li><a href="../index.html">peewee 2.1.6 documentation</a> &raquo;</li> 
      </ul>
    </div>  

    <div class="document">
      <div class="documentwrapper">
        <div class="bodywrapper">
          <div class="body">
            
  <div class="section" id="playhouse-a-collection-of-addons">
<span id="playhouse"></span><h1>Playhouse, a collection of addons<a class="headerlink" href="#playhouse-a-collection-of-addons" title="Permalink to this headline">¶</a></h1>
<p>Peewee comes with numerous extras which I didn&#8217;t really feel like including in
the main source module, but which might be interesting to implementers or fun
to mess around with.</p>
<p>The playhouse includes modules for different database drivers or database
specific functionality:</p>
<ul class="simple">
<li><a class="reference internal" href="#apsw"><em>apsw, an advanced sqlite driver</em></a></li>
<li><a class="reference internal" href="#postgres-ext"><em>Postgresql Extensions</em></a></li>
<li><a class="reference internal" href="#sqlite-ext"><em>Sqlite Extensions</em></a></li>
</ul>
<p>Modules which expose higher-level python constructs:</p>
<ul class="simple">
<li><a class="reference internal" href="#djpeewee"><em>Django Integration</em></a></li>
<li><a class="reference internal" href="#gfk"><em>Generic foreign keys</em></a></li>
<li><a class="reference internal" href="#kv"><em>Key/Value Store</em></a></li>
<li><a class="reference internal" href="#shortcuts"><em>Shortcuts</em></a></li>
<li><a class="reference internal" href="#signals"><em>Signal support</em></a></li>
</ul>
<p>As well as tools for working with databases:</p>
<ul class="simple">
<li><a class="reference internal" href="#pwiz"><em>pwiz, a model generator</em></a></li>
<li><a class="reference internal" href="#migrate"><em>Basic Schema Migrations</em></a></li>
<li><a class="reference internal" href="#csv-loader"><em>CSV Loader</em></a></li>
<li><a class="reference internal" href="#test-utils"><em>Test Utils</em></a></li>
</ul>
<div class="section" id="apsw-an-advanced-sqlite-driver">
<span id="apsw"></span><h2>apsw, an advanced sqlite driver<a class="headerlink" href="#apsw-an-advanced-sqlite-driver" title="Permalink to this headline">¶</a></h2>
<p>The <tt class="docutils literal"><span class="pre">apsw_ext</span></tt> module contains a database class suitable for use with
the apsw sqlite driver.</p>
<p>APSW Project page: <a class="reference external" href="https://code.google.com/p/apsw/">https://code.google.com/p/apsw/</a></p>
<p>APSW is a really neat library that provides a thin wrapper on top of SQLite&#8217;s
C interface, making it possible to use all of SQLite&#8217;s advanced features.</p>
<p>Here are just a few reasons to use APSW, taken from the documentation:</p>
<ul class="simple">
<li>APSW gives all functionality of SQLite, including virtual tables, virtual
file system, blob i/o, backups and file control.</li>
<li>Connections can be shared across threads without any additional locking.</li>
<li>Transactions are managed explicitly by your code.</li>
<li>APSW can handle nested transactions.</li>
<li>Unicode is handled correctly.</li>
<li>APSW is faster.</li>
</ul>
<p>For more information on the differences between apsw and pysqlite,
check <a class="reference external" href="http://apidoc.apsw.googlecode.com/hg/pysqlite.html">the apsw docs</a>.</p>
<div class="section" id="how-to-use-the-apswdatabase">
<h3>How to use the APSWDatabase<a class="headerlink" href="#how-to-use-the-apswdatabase" title="Permalink to this headline">¶</a></h3>
<div class="highlight-python"><div class="highlight"><pre><span class="kn">from</span> <span class="nn">apsw_ext</span> <span class="kn">import</span> <span class="o">*</span>

<span class="n">db</span> <span class="o">=</span> <span class="n">APSWDatabase</span><span class="p">(</span><span class="s">&#39;:memory:&#39;</span><span class="p">)</span>

<span class="k">class</span> <span class="nc">BaseModel</span><span class="p">(</span><span class="n">Model</span><span class="p">):</span>
    <span class="k">class</span> <span class="nc">Meta</span><span class="p">:</span>
        <span class="n">database</span> <span class="o">=</span> <span class="n">db</span>

<span class="k">class</span> <span class="nc">SomeModel</span><span class="p">(</span><span class="n">BaseModel</span><span class="p">):</span>
    <span class="n">col1</span> <span class="o">=</span> <span class="n">CharField</span><span class="p">()</span>
    <span class="n">col2</span> <span class="o">=</span> <span class="n">DateTimeField</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="section" id="apsw-ext-api-notes">
<h3>apsw_ext API notes<a class="headerlink" href="#apsw-ext-api-notes" title="Permalink to this headline">¶</a></h3>
<dl class="class">
<dt id="APSWDatabase">
<em class="property">class </em><tt class="descname">APSWDatabase</tt><big>(</big><em>database</em>, <em>**connect_kwargs</em><big>)</big><a class="headerlink" href="#APSWDatabase" title="Permalink to this definition">¶</a></dt>
<dd><table class="docutils field-list" frame="void" rules="none">
<col class="field-name" />
<col class="field-body" />
<tbody valign="top">
<tr class="field-odd field"><th class="field-name">Parameters:</th><td class="field-body"><ul class="first last simple">
<li><strong>database</strong> (<em>string</em>) &#8211; filename of sqlite database</li>
<li><strong>connect_kwargs</strong> &#8211; keyword arguments passed to apsw when opening a connection</li>
</ul>
</td>
</tr>
</tbody>
</table>
<dl class="method">
<dt id="APSWDatabase.transaction">
<tt class="descname">transaction</tt><big>(</big><span class="optional">[</span><em>lock_type='deferred'</em><span class="optional">]</span><big>)</big><a class="headerlink" href="#APSWDatabase.transaction" title="Permalink to this definition">¶</a></dt>
<dd><p>Functions just like the <a class="reference internal" href="api.html#Database.transaction" title="Database.transaction"><tt class="xref py py-meth docutils literal"><span class="pre">Database.transaction()</span></tt></a> context manager,
but accepts an additional parameter specifying the type of lock to use.</p>
<table class="docutils field-list" frame="void" rules="none">
<col class="field-name" />
<col class="field-body" />
<tbody valign="top">
<tr class="field-odd field"><th class="field-name">Parameters:</th><td class="field-body"><strong>lock_type</strong> (<em>string</em>) &#8211; type of lock to use when opening a new transaction</td>
</tr>
</tbody>
</table>
</dd></dl>

<dl class="method">
<dt id="APSWDatabase.register_module">
<tt class="descname">register_module</tt><big>(</big><em>mod_name</em>, <em>mod_inst</em><big>)</big><a class="headerlink" href="#APSWDatabase.register_module" title="Permalink to this definition">¶</a></dt>
<dd><p>Provides a way of globally registering a module.  For more information,
see the <a class="reference external" href="http://apidoc.apsw.googlecode.com/hg/vtable.html">documentation on virtual tables</a>.</p>
<table class="docutils field-list" frame="void" rules="none">
<col class="field-name" />
<col class="field-body" />
<tbody valign="top">
<tr class="field-odd field"><th class="field-name">Parameters:</th><td class="field-body"><ul class="first last simple">
<li><strong>mod_name</strong> (<em>string</em>) &#8211; name to use for module</li>
<li><strong>mod_inst</strong> (<em>object</em>) &#8211; an object implementing the <a class="reference external" href="http://apidoc.apsw.googlecode.com/hg/vtable.html?highlight=virtual%20table#apsw.VTTable">Virtual Table</a> interface</li>
</ul>
</td>
</tr>
</tbody>
</table>
</dd></dl>

<dl class="method">
<dt id="APSWDatabase.unregister_module">
<tt class="descname">unregister_module</tt><big>(</big><em>mod_name</em><big>)</big><a class="headerlink" href="#APSWDatabase.unregister_module" title="Permalink to this definition">¶</a></dt>
<dd><p>Unregister a module.</p>
<table class="docutils field-list" frame="void" rules="none">
<col class="field-name" />
<col class="field-body" />
<tbody valign="top">
<tr class="field-odd field"><th class="field-name">Parameters:</th><td class="field-body"><strong>mod_name</strong> (<em>string</em>) &#8211; name to use for module</td>
</tr>
</tbody>
</table>
</dd></dl>

</dd></dl>

<div class="admonition note">
<p class="first admonition-title">Note</p>
<p class="last">Be sure to use the <tt class="docutils literal"><span class="pre">Field</span></tt> subclasses defined in the <tt class="docutils literal"><span class="pre">apsw_ext</span></tt>
module, as they will properly handle adapting the data types for storage.</p>
</div>
</div>
</div>
<div class="section" id="postgresql-extensions">
<span id="postgres-ext"></span><h2>Postgresql Extensions<a class="headerlink" href="#postgresql-extensions" title="Permalink to this headline">¶</a></h2>
<p>The postgresql extensions module provides a number of &#8220;postgres-only&#8221; functions,
currently:</p>
<ul class="simple">
<li><a class="reference internal" href="#hstore"><em>hstore support</em></a></li>
<li><a class="reference internal" href="#server-side-cursors"><em>server-side cursors</em></a></li>
<li><a class="reference internal" href="#ArrayField" title="ArrayField"><tt class="xref py py-class docutils literal"><span class="pre">ArrayField</span></tt></a> field type, for storing arrays.</li>
<li><a class="reference internal" href="#UUIDField" title="UUIDField"><tt class="xref py py-class docutils literal"><span class="pre">UUIDField</span></tt></a> field type, for storing UUID objects.</li>
<li><tt class="xref py py-class docutils literal"><span class="pre">DateTimeTZ</span></tt> field type, a timezone-aware datetime field.</li>
</ul>
<p>In the future I would like to add support for more of postgresql&#8217;s features.
If there is a particular feature you would like to see added, please
<a class="reference external" href="https://github.com/coleifer/peewee/issues">open a Github issue</a>.</p>
<div class="admonition warning">
<p class="first admonition-title">Warning</p>
<p class="last">In order to start using the features described below, you will need to use the
extension <a class="reference internal" href="#PostgresqlExtDatabase" title="PostgresqlExtDatabase"><tt class="xref py py-class docutils literal"><span class="pre">PostgresqlExtDatabase</span></tt></a> class instead of <a class="reference internal" href="api.html#PostgresqlDatabase" title="PostgresqlDatabase"><tt class="xref py py-class docutils literal"><span class="pre">PostgresqlDatabase</span></tt></a>.</p>
</div>
<p>The code below will assume you are using the following database and base model:</p>
<div class="highlight-python"><div class="highlight"><pre><span class="kn">from</span> <span class="nn">playhouse.postgres_ext</span> <span class="kn">import</span> <span class="o">*</span>

<span class="n">ext_db</span> <span class="o">=</span> <span class="n">PostgresqlExtDatabase</span><span class="p">(</span><span class="s">&#39;peewee_test&#39;</span><span class="p">,</span> <span class="n">user</span><span class="o">=</span><span class="s">&#39;postgres&#39;</span><span class="p">)</span>

<span class="k">class</span> <span class="nc">BaseExtModel</span><span class="p">(</span><span class="n">Model</span><span class="p">):</span>
    <span class="k">class</span> <span class="nc">Meta</span><span class="p">:</span>
        <span class="n">database</span> <span class="o">=</span> <span class="n">ext_db</span>
</pre></div>
</div>
<div class="section" id="hstore-support">
<span id="hstore"></span><h3>hstore support<a class="headerlink" href="#hstore-support" title="Permalink to this headline">¶</a></h3>
<p><a class="reference external" href="http://www.postgresql.org/docs/current/static/hstore.html">Postgresql hstore</a> is
an embedded key/value store.  With hstore, you can store arbitrary key/value pairs
in your database alongside structured relational data.</p>
<p>Currently the <tt class="docutils literal"><span class="pre">postgres_ext</span></tt> module supports the following operations:</p>
<ul class="simple">
<li>Store and retrieve arbitrary dictionaries</li>
<li>Filter by key(s) or partial dictionary</li>
<li>Update/add one or more keys to an existing dictionary</li>
<li>Delete one or more keys from an existing dictionary</li>
<li>Select keys, values, or zip keys and values</li>
<li>Retrieve a slice of keys/values</li>
<li>Test for the existence of a key</li>
<li>Test that a key has a non-NULL value</li>
</ul>
</div>
<div class="section" id="using-hstore">
<h3>Using hstore<a class="headerlink" href="#using-hstore" title="Permalink to this headline">¶</a></h3>
<p>To start with, you will need to import the custom database class and the hstore
functions from <tt class="docutils literal"><span class="pre">playhouse.postgres_ext</span></tt> (see above code snippet).  Then, it is
as simple as adding a <a class="reference internal" href="#HStoreField" title="HStoreField"><tt class="xref py py-class docutils literal"><span class="pre">HStoreField</span></tt></a> to your model:</p>
<div class="highlight-python"><div class="highlight"><pre><span class="k">class</span> <span class="nc">House</span><span class="p">(</span><span class="n">BaseExtModel</span><span class="p">):</span>
    <span class="n">address</span> <span class="o">=</span> <span class="n">CharField</span><span class="p">()</span>
    <span class="n">features</span> <span class="o">=</span> <span class="n">HStoreField</span><span class="p">()</span>
</pre></div>
</div>
<p>You can now store arbitrary key/value pairs on <tt class="docutils literal"><span class="pre">House</span></tt> instances:</p>
<div class="highlight-pycon"><div class="highlight"><pre><span class="gp">&gt;&gt;&gt; </span><span class="n">h</span> <span class="o">=</span> <span class="n">House</span><span class="o">.</span><span class="n">create</span><span class="p">(</span><span class="n">address</span><span class="o">=</span><span class="s">&#39;123 Main St&#39;</span><span class="p">,</span> <span class="n">features</span><span class="o">=</span><span class="p">{</span><span class="s">&#39;garage&#39;</span><span class="p">:</span> <span class="s">&#39;2 cars&#39;</span><span class="p">,</span> <span class="s">&#39;bath&#39;</span><span class="p">:</span> <span class="s">&#39;2 bath&#39;</span><span class="p">})</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">h_from_db</span> <span class="o">=</span> <span class="n">House</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">House</span><span class="o">.</span><span class="n">id</span> <span class="o">==</span> <span class="n">h</span><span class="o">.</span><span class="n">id</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">h_from_db</span><span class="o">.</span><span class="n">features</span>
<span class="go">{&#39;bath&#39;: &#39;2 bath&#39;, &#39;garage&#39;: &#39;2 cars&#39;}</span>
</pre></div>
</div>
<p>You can filter by keys or partial dictionary:</p>
<div class="highlight-pycon"><div class="highlight"><pre><span class="gp">&gt;&gt;&gt; </span><span class="n">f</span> <span class="o">=</span> <span class="n">House</span><span class="o">.</span><span class="n">features</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">House</span><span class="o">.</span><span class="n">select</span><span class="p">()</span><span class="o">.</span><span class="n">where</span><span class="p">(</span><span class="n">f</span><span class="o">.</span><span class="n">contains</span><span class="p">(</span><span class="s">&#39;garage&#39;</span><span class="p">))</span> <span class="c"># &lt;-- all houses w/garage key</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">House</span><span class="o">.</span><span class="n">select</span><span class="p">()</span><span class="o">.</span><span class="n">where</span><span class="p">(</span><span class="n">f</span><span class="o">.</span><span class="n">contains</span><span class="p">([</span><span class="s">&#39;garage&#39;</span><span class="p">,</span> <span class="s">&#39;bath&#39;</span><span class="p">]))</span> <span class="c"># &lt;-- all houses w/garage &amp; bath</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">House</span><span class="o">.</span><span class="n">select</span><span class="p">()</span><span class="o">.</span><span class="n">where</span><span class="p">(</span><span class="n">f</span><span class="o">.</span><span class="n">contains</span><span class="p">({</span><span class="s">&#39;garage&#39;</span><span class="p">:</span> <span class="s">&#39;2 cars&#39;</span><span class="p">}))</span> <span class="c"># &lt;-- houses w/2-car garage</span>
</pre></div>
</div>
<p>Suppose you want to do an atomic update to the house:</p>
<div class="highlight-pycon"><div class="highlight"><pre><span class="gp">&gt;&gt;&gt; </span><span class="n">f</span> <span class="o">=</span> <span class="n">House</span><span class="o">.</span><span class="n">features</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">new_features</span> <span class="o">=</span> <span class="n">House</span><span class="o">.</span><span class="n">features</span><span class="o">.</span><span class="n">update</span><span class="p">({</span><span class="s">&#39;bath&#39;</span><span class="p">:</span> <span class="s">&#39;2.5 bath&#39;</span><span class="p">,</span> <span class="s">&#39;sqft&#39;</span><span class="p">:</span> <span class="s">&#39;1100&#39;</span><span class="p">})</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">query</span> <span class="o">=</span> <span class="n">House</span><span class="o">.</span><span class="n">update</span><span class="p">(</span><span class="n">features</span><span class="o">=</span><span class="n">new_features</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">query</span><span class="o">.</span><span class="n">where</span><span class="p">(</span><span class="n">House</span><span class="o">.</span><span class="n">id</span> <span class="o">==</span> <span class="n">h</span><span class="o">.</span><span class="n">id</span><span class="p">)</span><span class="o">.</span><span class="n">execute</span><span class="p">()</span>
<span class="go">1</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">h</span> <span class="o">=</span> <span class="n">House</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">House</span><span class="o">.</span><span class="n">id</span> <span class="o">==</span> <span class="n">h</span><span class="o">.</span><span class="n">id</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">h</span><span class="o">.</span><span class="n">features</span>
<span class="go">{&#39;bath&#39;: &#39;2.5 bath&#39;, &#39;garage&#39;: &#39;2 cars&#39;, &#39;sqft&#39;: &#39;1100&#39;}</span>
</pre></div>
</div>
<p>Or, alternatively an atomic delete:</p>
<div class="highlight-pycon"><div class="highlight"><pre><span class="gp">&gt;&gt;&gt; </span><span class="n">query</span> <span class="o">=</span> <span class="n">House</span><span class="o">.</span><span class="n">update</span><span class="p">(</span><span class="n">features</span><span class="o">=</span><span class="n">f</span><span class="o">.</span><span class="n">delete</span><span class="p">(</span><span class="s">&#39;bath&#39;</span><span class="p">))</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">query</span><span class="o">.</span><span class="n">where</span><span class="p">(</span><span class="n">House</span><span class="o">.</span><span class="n">id</span> <span class="o">==</span> <span class="n">h</span><span class="o">.</span><span class="n">id</span><span class="p">)</span><span class="o">.</span><span class="n">execute</span><span class="p">()</span>
<span class="go">1</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">h</span> <span class="o">=</span> <span class="n">House</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">House</span><span class="o">.</span><span class="n">id</span> <span class="o">==</span> <span class="n">h</span><span class="o">.</span><span class="n">id</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">h</span><span class="o">.</span><span class="n">features</span>
<span class="go">{&#39;garage&#39;: &#39;2 cars&#39;, &#39;sqft&#39;: &#39;1100&#39;}</span>
</pre></div>
</div>
<p>Multiple keys can be deleted at the same time:</p>
<div class="highlight-pycon"><div class="highlight"><pre><span class="gp">&gt;&gt;&gt; </span><span class="n">query</span> <span class="o">=</span> <span class="n">House</span><span class="o">.</span><span class="n">update</span><span class="p">(</span><span class="n">features</span><span class="o">=</span><span class="n">f</span><span class="o">.</span><span class="n">delete</span><span class="p">(</span><span class="s">&#39;garage&#39;</span><span class="p">,</span> <span class="s">&#39;sqft&#39;</span><span class="p">))</span>
</pre></div>
</div>
<p>You can select just keys, just values, or zip the two:</p>
<div class="highlight-pycon"><div class="highlight"><pre><span class="gp">&gt;&gt;&gt; </span><span class="n">f</span> <span class="o">=</span> <span class="n">House</span><span class="o">.</span><span class="n">features</span>
<span class="gp">&gt;&gt;&gt; </span><span class="k">for</span> <span class="n">h</span> <span class="ow">in</span> <span class="n">House</span><span class="o">.</span><span class="n">select</span><span class="p">(</span><span class="n">House</span><span class="o">.</span><span class="n">address</span><span class="p">,</span> <span class="n">f</span><span class="o">.</span><span class="n">keys</span><span class="p">()</span><span class="o">.</span><span class="n">alias</span><span class="p">(</span><span class="s">&#39;keys&#39;</span><span class="p">)):</span>
<span class="gp">... </span>    <span class="k">print</span> <span class="n">h</span><span class="o">.</span><span class="n">address</span><span class="p">,</span> <span class="n">h</span><span class="o">.</span><span class="n">keys</span>

<span class="go">123 Main St [u&#39;bath&#39;, u&#39;garage&#39;]</span>

<span class="gp">&gt;&gt;&gt; </span><span class="k">for</span> <span class="n">h</span> <span class="ow">in</span> <span class="n">House</span><span class="o">.</span><span class="n">select</span><span class="p">(</span><span class="n">House</span><span class="o">.</span><span class="n">address</span><span class="p">,</span> <span class="n">f</span><span class="o">.</span><span class="n">values</span><span class="p">()</span><span class="o">.</span><span class="n">alias</span><span class="p">(</span><span class="s">&#39;vals&#39;</span><span class="p">)):</span>
<span class="gp">... </span>    <span class="k">print</span> <span class="n">h</span><span class="o">.</span><span class="n">address</span><span class="p">,</span> <span class="n">h</span><span class="o">.</span><span class="n">vals</span>

<span class="go">123 Main St [u&#39;2 bath&#39;, u&#39;2 cars&#39;]</span>

<span class="gp">&gt;&gt;&gt; </span><span class="k">for</span> <span class="n">h</span> <span class="ow">in</span> <span class="n">House</span><span class="o">.</span><span class="n">select</span><span class="p">(</span><span class="n">House</span><span class="o">.</span><span class="n">address</span><span class="p">,</span> <span class="n">f</span><span class="o">.</span><span class="n">items</span><span class="p">()</span><span class="o">.</span><span class="n">alias</span><span class="p">(</span><span class="s">&#39;mtx&#39;</span><span class="p">)):</span>
<span class="gp">... </span>    <span class="k">print</span> <span class="n">h</span><span class="o">.</span><span class="n">address</span><span class="p">,</span> <span class="n">h</span><span class="o">.</span><span class="n">mtx</span>

<span class="go">123 Main St [[u&#39;bath&#39;, u&#39;2 bath&#39;], [u&#39;garage&#39;, u&#39;2 cars&#39;]]</span>
</pre></div>
</div>
<p>You can retrieve a slice of data, for example, all the garage data:</p>
<div class="highlight-pycon"><div class="highlight"><pre><span class="gp">&gt;&gt;&gt; </span><span class="n">f</span> <span class="o">=</span> <span class="n">House</span><span class="o">.</span><span class="n">features</span>
<span class="gp">&gt;&gt;&gt; </span><span class="k">for</span> <span class="n">h</span> <span class="ow">in</span> <span class="n">House</span><span class="o">.</span><span class="n">select</span><span class="p">(</span><span class="n">House</span><span class="o">.</span><span class="n">address</span><span class="p">,</span> <span class="n">f</span><span class="o">.</span><span class="n">slice</span><span class="p">(</span><span class="s">&#39;garage&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">alias</span><span class="p">(</span><span class="s">&#39;garage_data&#39;</span><span class="p">)):</span>
<span class="gp">... </span>    <span class="k">print</span> <span class="n">h</span><span class="o">.</span><span class="n">address</span><span class="p">,</span> <span class="n">h</span><span class="o">.</span><span class="n">garage_data</span>

<span class="go">123 Main St {&#39;garage&#39;: &#39;2 cars&#39;}</span>
</pre></div>
</div>
<p>You can check for the existence of a key and filter rows accordingly:</p>
<div class="highlight-pycon"><div class="highlight"><pre><span class="gp">&gt;&gt;&gt; </span><span class="k">for</span> <span class="n">h</span> <span class="ow">in</span> <span class="n">House</span><span class="o">.</span><span class="n">select</span><span class="p">(</span><span class="n">House</span><span class="o">.</span><span class="n">address</span><span class="p">,</span> <span class="n">f</span><span class="o">.</span><span class="n">exists</span><span class="p">(</span><span class="s">&#39;garage&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">alias</span><span class="p">(</span><span class="s">&#39;has_garage&#39;</span><span class="p">)):</span>
<span class="gp">... </span>    <span class="k">print</span> <span class="n">h</span><span class="o">.</span><span class="n">address</span><span class="p">,</span> <span class="n">h</span><span class="o">.</span><span class="n">has_garage</span>

<span class="go">123 Main St True</span>

<span class="gp">&gt;&gt;&gt; </span><span class="k">for</span> <span class="n">h</span> <span class="ow">in</span> <span class="n">House</span><span class="o">.</span><span class="n">select</span><span class="p">()</span><span class="o">.</span><span class="n">where</span><span class="p">(</span><span class="n">f</span><span class="o">.</span><span class="n">exists</span><span class="p">(</span><span class="s">&#39;garage&#39;</span><span class="p">)):</span>
<span class="gp">... </span>    <span class="k">print</span> <span class="n">h</span><span class="o">.</span><span class="n">address</span><span class="p">,</span> <span class="n">h</span><span class="o">.</span><span class="n">features</span><span class="p">[</span><span class="s">&#39;garage&#39;</span><span class="p">]</span> <span class="c"># &lt;-- just houses w/garage data</span>

<span class="go">123 Main St 2 cars</span>
</pre></div>
</div>
</div>
<div class="section" id="server-side-cursors">
<span id="id1"></span><h3>Server-side cursors<a class="headerlink" href="#server-side-cursors" title="Permalink to this headline">¶</a></h3>
<p>When psycopg2 executes a query, normally all results are fetched and returned to
the client by the backend.  This can cause your application to use a lot of memory
when making large queries.  Using server-side cursors, results are returned a
little at a time (by default 2000 records).  For the definitive reference, please see the <a class="reference external" href="http://initd.org/psycopg/docs/usage.html#server-side-cursors">psycopg2 documentation</a>.</p>
<div class="admonition note">
<p class="first admonition-title">Note</p>
<p class="last">To use server-side (or named) cursors, you must be using <a class="reference internal" href="#PostgresqlExtDatabase" title="PostgresqlExtDatabase"><tt class="xref py py-class docutils literal"><span class="pre">PostgresqlExtDatabase</span></tt></a>.</p>
</div>
<p>To execute a query using a server-side cursor, simply wrap your select query
using the <a class="reference internal" href="#ServerSide" title="ServerSide"><tt class="xref py py-func docutils literal"><span class="pre">ServerSide()</span></tt></a> helper:</p>
<div class="highlight-python"><div class="highlight"><pre><span class="n">large_query</span> <span class="o">=</span> <span class="n">PageView</span><span class="o">.</span><span class="n">select</span><span class="p">()</span>  <span class="c"># Build query normally.</span>

<span class="c"># Iterate over large query inside a transaction.</span>
<span class="k">for</span> <span class="n">page_view</span> <span class="ow">in</span> <span class="n">ServerSide</span><span class="p">(</span><span class="n">large_query</span><span class="p">):</span>
    <span class="c"># do some interesting analysis here.</span>
    <span class="k">pass</span>

<span class="c"># Server-side resources are released.</span>
</pre></div>
</div>
<p>If you would like all <tt class="docutils literal"><span class="pre">SELECT</span></tt> queries to automatically use a server-side
cursor, you can specify this when creating your <a class="reference internal" href="#PostgresqlExtDatabase" title="PostgresqlExtDatabase"><tt class="xref py py-class docutils literal"><span class="pre">PostgresqlExtDatabase</span></tt></a>:</p>
<div class="highlight-python"><div class="highlight"><pre><span class="kn">from</span> <span class="nn">postgres_ext</span> <span class="kn">import</span> <span class="n">PostgresqlExtDatabase</span>

<span class="n">ss_db</span> <span class="o">=</span> <span class="n">PostgresqlExtDatabase</span><span class="p">(</span><span class="s">&#39;my_db&#39;</span><span class="p">,</span> <span class="n">server_side_cursors</span><span class="o">=</span><span class="bp">True</span><span class="p">)</span>
</pre></div>
</div>
<div class="admonition note">
<p class="first admonition-title">Note</p>
<p>Server-side cursors live only as long as the transaction, so for this reason
peewee will not automatically call <tt class="docutils literal"><span class="pre">commit()</span></tt> after executing a <tt class="docutils literal"><span class="pre">SELECT</span></tt>
query.  If you do not <tt class="docutils literal"><span class="pre">commit</span></tt> after you are done iterating, you will not
release the server-side resources until the connection is closed (or the
transaction is committed later).  Furthermore, since peewee will by default
cache rows returned by the cursor, you should always call <tt class="docutils literal"><span class="pre">.iterator()</span></tt>
when iterating over a large query.</p>
<p class="last">If you are using the <a class="reference internal" href="#ServerSide" title="ServerSide"><tt class="xref py py-func docutils literal"><span class="pre">ServerSide()</span></tt></a> helper, the transaction and
call to <tt class="docutils literal"><span class="pre">iterator()</span></tt> will be handled transparently.</p>
</div>
</div>
<div class="section" id="postgres-ext-api-notes">
<h3>postgres_ext API notes<a class="headerlink" href="#postgres-ext-api-notes" title="Permalink to this headline">¶</a></h3>
<dl class="class">
<dt id="PostgresqlExtDatabase">
<em class="property">class </em><tt class="descname">PostgresqlExtDatabase</tt><big>(</big><em>database</em><span class="optional">[</span>, <em>server_side_cursors=False</em><span class="optional">[</span>, <em>...</em><span class="optional">]</span><span class="optional">]</span><big>)</big><a class="headerlink" href="#PostgresqlExtDatabase" title="Permalink to this definition">¶</a></dt>
<dd><p>Identical to <a class="reference internal" href="api.html#PostgresqlDatabase" title="PostgresqlDatabase"><tt class="xref py py-class docutils literal"><span class="pre">PostgresqlDatabase</span></tt></a> but required in order to support:</p>
<ul class="simple">
<li><a class="reference internal" href="#server-side-cursors"><em>Server-side cursors</em></a></li>
<li><a class="reference internal" href="#ArrayField" title="ArrayField"><tt class="xref py py-class docutils literal"><span class="pre">ArrayField</span></tt></a></li>
<li><a class="reference internal" href="#DateTimeTZField" title="DateTimeTZField"><tt class="xref py py-class docutils literal"><span class="pre">DateTimeTZField</span></tt></a></li>
<li><a class="reference internal" href="#HStoreField" title="HStoreField"><tt class="xref py py-class docutils literal"><span class="pre">HStoreField</span></tt></a></li>
<li><a class="reference internal" href="#UUIDField" title="UUIDField"><tt class="xref py py-class docutils literal"><span class="pre">UUIDField</span></tt></a></li>
</ul>
<table class="docutils field-list" frame="void" rules="none">
<col class="field-name" />
<col class="field-body" />
<tbody valign="top">
<tr class="field-odd field"><th class="field-name">Parameters:</th><td class="field-body"><ul class="first last simple">
<li><strong>database</strong> (<em>str</em>) &#8211; Name of database to connect to.</li>
<li><strong>server_side_cursors</strong> (<em>bool</em>) &#8211; Whether <tt class="docutils literal"><span class="pre">SELECT</span></tt> queries should utilize
server-side cursors.</li>
</ul>
</td>
</tr>
</tbody>
</table>
<p>If using <tt class="docutils literal"><span class="pre">server_side_cursors</span></tt>, also be sure to wrap your queries with
<a class="reference internal" href="#ServerSide" title="ServerSide"><tt class="xref py py-func docutils literal"><span class="pre">ServerSide()</span></tt></a>.</p>
</dd></dl>

<dl class="function">
<dt id="ServerSide">
<tt class="descname">ServerSide</tt><big>(</big><em>select_query</em><big>)</big><a class="headerlink" href="#ServerSide" title="Permalink to this definition">¶</a></dt>
<dd><p>Wrap the given select query in a transaction, and call it&#8217;s <a class="reference internal" href="api.html#SelectQuery.iterator" title="SelectQuery.iterator"><tt class="xref py py-meth docutils literal"><span class="pre">iterator()</span></tt></a>
method to avoid caching row instances.  In order for the server-side resources
to be released, be sure to exhaust the generator (iterate over all the rows).</p>
<table class="docutils field-list" frame="void" rules="none">
<col class="field-name" />
<col class="field-body" />
<tbody valign="top">
<tr class="field-odd field"><th class="field-name">Parameters:</th><td class="field-body"><strong>select_query</strong> &#8211; a <a class="reference internal" href="api.html#SelectQuery" title="SelectQuery"><tt class="xref py py-class docutils literal"><span class="pre">SelectQuery</span></tt></a> instance.</td>
</tr>
<tr class="field-even field"><th class="field-name">Return type:</th><td class="field-body"><tt class="docutils literal"><span class="pre">generator</span></tt></td>
</tr>
</tbody>
</table>
<p>Usage:</p>
<div class="highlight-python"><div class="highlight"><pre><span class="n">large_query</span> <span class="o">=</span> <span class="n">PageView</span><span class="o">.</span><span class="n">select</span><span class="p">()</span>
<span class="k">for</span> <span class="n">page_view</span> <span class="ow">in</span> <span class="n">ServerSide</span><span class="p">(</span><span class="n">large_query</span><span class="p">):</span>
    <span class="c"># Do something interesting.</span>
    <span class="k">pass</span>

<span class="c"># At this point server side resources are released.</span>
</pre></div>
</div>
</dd></dl>

<dl class="class">
<dt id="ArrayField">
<em class="property">class </em><tt class="descname">ArrayField</tt><big>(</big><span class="optional">[</span><em>field_class=IntegerField</em><span class="optional">[</span>, <em>dimensions=1</em><span class="optional">]</span><span class="optional">]</span><big>)</big><a class="headerlink" href="#ArrayField" title="Permalink to this definition">¶</a></dt>
<dd><p>Field capable of storing arrays of the provided <cite>field_class</cite>.</p>
<table class="docutils field-list" frame="void" rules="none">
<col class="field-name" />
<col class="field-body" />
<tbody valign="top">
<tr class="field-odd field"><th class="field-name">Parameters:</th><td class="field-body"><ul class="first last simple">
<li><strong>field_class</strong> &#8211; a subclass of <a class="reference internal" href="api.html#Field" title="Field"><tt class="xref py py-class docutils literal"><span class="pre">Field</span></tt></a>, e.g. <a class="reference internal" href="api.html#IntegerField" title="IntegerField"><tt class="xref py py-class docutils literal"><span class="pre">IntegerField</span></tt></a>.</li>
<li><strong>dimensions</strong> (<em>int</em>) &#8211; dimensions of array.</li>
</ul>
</td>
</tr>
</tbody>
</table>
<p>You can store and retrieve lists (or lists-of-lists):</p>
<div class="highlight-python"><div class="highlight"><pre><span class="k">class</span> <span class="nc">BlogPost</span><span class="p">(</span><span class="n">BaseModel</span><span class="p">):</span>
    <span class="n">content</span> <span class="o">=</span> <span class="n">TextField</span><span class="p">()</span>
    <span class="n">tags</span> <span class="o">=</span> <span class="n">ArrayField</span><span class="p">(</span><span class="n">CharField</span><span class="p">)</span>


<span class="n">post</span> <span class="o">=</span> <span class="n">BlogPost</span><span class="p">(</span><span class="n">content</span><span class="o">=</span><span class="s">&#39;awesome&#39;</span><span class="p">,</span> <span class="n">tags</span><span class="o">=</span><span class="p">[</span><span class="s">&#39;foo&#39;</span><span class="p">,</span> <span class="s">&#39;bar&#39;</span><span class="p">,</span> <span class="s">&#39;baz&#39;</span><span class="p">])</span>
</pre></div>
</div>
<p>Additionally, you can use the <tt class="docutils literal"><span class="pre">__getitem__</span></tt> API to query values or slices
in the database:</p>
<div class="highlight-python"><div class="highlight"><pre><span class="c"># Get the first tag on a given blog post.</span>
<span class="n">first_tag</span> <span class="o">=</span> <span class="p">(</span><span class="n">BlogPost</span>
             <span class="o">.</span><span class="n">select</span><span class="p">(</span><span class="n">BlogPost</span><span class="o">.</span><span class="n">tags</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">alias</span><span class="p">(</span><span class="s">&#39;first_tag&#39;</span><span class="p">))</span>
             <span class="o">.</span><span class="n">where</span><span class="p">(</span><span class="n">BlogPost</span><span class="o">.</span><span class="n">id</span> <span class="o">==</span> <span class="mi">1</span><span class="p">)</span>
             <span class="o">.</span><span class="n">dicts</span><span class="p">()</span>
             <span class="o">.</span><span class="n">get</span><span class="p">())</span>

<span class="c"># first_tag = {&#39;first_tag&#39;: &#39;foo&#39;}</span>
</pre></div>
</div>
<p>Get a slice of values:</p>
<div class="highlight-python"><div class="highlight"><pre><span class="c"># Get the first two tags.</span>
<span class="n">two_tags</span> <span class="o">=</span> <span class="p">(</span><span class="n">BlogPost</span>
            <span class="o">.</span><span class="n">select</span><span class="p">(</span><span class="n">BlogPost</span><span class="o">.</span><span class="n">tags</span><span class="p">[:</span><span class="mi">2</span><span class="p">]</span><span class="o">.</span><span class="n">alias</span><span class="p">(</span><span class="s">&#39;two&#39;</span><span class="p">))</span>
            <span class="o">.</span><span class="n">dicts</span><span class="p">()</span>
            <span class="o">.</span><span class="n">get</span><span class="p">())</span>
<span class="c"># two_tags = {&#39;two&#39;: [&#39;foo&#39;, &#39;bar&#39;]}</span>
</pre></div>
</div>
</dd></dl>

<dl class="class">
<dt id="DateTimeTZField">
<em class="property">class </em><tt class="descname">DateTimeTZField</tt><big>(</big><em>*args</em>, <em>**kwargs</em><big>)</big><a class="headerlink" href="#DateTimeTZField" title="Permalink to this definition">¶</a></dt>
<dd><p>A timezone-aware subclass of <a class="reference internal" href="api.html#DateTimeField" title="DateTimeField"><tt class="xref py py-class docutils literal"><span class="pre">DateTimeField</span></tt></a>.</p>
</dd></dl>

<dl class="class">
<dt id="HStoreField">
<em class="property">class </em><tt class="descname">HStoreField</tt><big>(</big><em>*args</em>, <em>**kwargs</em><big>)</big><a class="headerlink" href="#HStoreField" title="Permalink to this definition">¶</a></dt>
<dd><p>A field for storing and retrieving arbitrary key/value pairs.  For details
on usage, see <a class="reference internal" href="#hstore"><em>hstore support</em></a>.</p>
<dl class="method">
<dt id="HStoreField.keys">
<tt class="descname">keys</tt><big>(</big><big>)</big><a class="headerlink" href="#HStoreField.keys" title="Permalink to this definition">¶</a></dt>
<dd><p>Returns the keys for a given row.</p>
<div class="highlight-pycon"><div class="highlight"><pre><span class="gp">&gt;&gt;&gt; </span><span class="n">f</span> <span class="o">=</span> <span class="n">House</span><span class="o">.</span><span class="n">features</span>
<span class="gp">&gt;&gt;&gt; </span><span class="k">for</span> <span class="n">h</span> <span class="ow">in</span> <span class="n">House</span><span class="o">.</span><span class="n">select</span><span class="p">(</span><span class="n">House</span><span class="o">.</span><span class="n">address</span><span class="p">,</span> <span class="n">f</span><span class="o">.</span><span class="n">keys</span><span class="p">()</span><span class="o">.</span><span class="n">alias</span><span class="p">(</span><span class="s">&#39;keys&#39;</span><span class="p">)):</span>
<span class="gp">... </span>    <span class="k">print</span> <span class="n">h</span><span class="o">.</span><span class="n">address</span><span class="p">,</span> <span class="n">h</span><span class="o">.</span><span class="n">keys</span>

<span class="go">123 Main St [u&#39;bath&#39;, u&#39;garage&#39;]</span>
</pre></div>
</div>
</dd></dl>

<dl class="method">
<dt id="HStoreField.values">
<tt class="descname">values</tt><big>(</big><big>)</big><a class="headerlink" href="#HStoreField.values" title="Permalink to this definition">¶</a></dt>
<dd><p>Return the values for a given row.</p>
<div class="highlight-pycon"><div class="highlight"><pre><span class="gp">&gt;&gt;&gt; </span><span class="k">for</span> <span class="n">h</span> <span class="ow">in</span> <span class="n">House</span><span class="o">.</span><span class="n">select</span><span class="p">(</span><span class="n">House</span><span class="o">.</span><span class="n">address</span><span class="p">,</span> <span class="n">f</span><span class="o">.</span><span class="n">values</span><span class="p">()</span><span class="o">.</span><span class="n">alias</span><span class="p">(</span><span class="s">&#39;vals&#39;</span><span class="p">)):</span>
<span class="gp">... </span>    <span class="k">print</span> <span class="n">h</span><span class="o">.</span><span class="n">address</span><span class="p">,</span> <span class="n">h</span><span class="o">.</span><span class="n">vals</span>

<span class="go">123 Main St [u&#39;2 bath&#39;, u&#39;2 cars&#39;]</span>
</pre></div>
</div>
</dd></dl>

<dl class="method">
<dt id="HStoreField.items">
<tt class="descname">items</tt><big>(</big><big>)</big><a class="headerlink" href="#HStoreField.items" title="Permalink to this definition">¶</a></dt>
<dd><p>Like python&#8217;s <tt class="docutils literal"><span class="pre">dict</span></tt>, return the keys and values in a list-of-lists:</p>
<div class="highlight-pycon"><div class="highlight"><pre><span class="gp">&gt;&gt;&gt; </span><span class="k">for</span> <span class="n">h</span> <span class="ow">in</span> <span class="n">House</span><span class="o">.</span><span class="n">select</span><span class="p">(</span><span class="n">House</span><span class="o">.</span><span class="n">address</span><span class="p">,</span> <span class="n">f</span><span class="o">.</span><span class="n">items</span><span class="p">()</span><span class="o">.</span><span class="n">alias</span><span class="p">(</span><span class="s">&#39;mtx&#39;</span><span class="p">)):</span>
<span class="gp">... </span>    <span class="k">print</span> <span class="n">h</span><span class="o">.</span><span class="n">address</span><span class="p">,</span> <span class="n">h</span><span class="o">.</span><span class="n">mtx</span>

<span class="go">123 Main St [[u&#39;bath&#39;, u&#39;2 bath&#39;], [u&#39;garage&#39;, u&#39;2 cars&#39;]]</span>
</pre></div>
</div>
</dd></dl>

<dl class="method">
<dt id="HStoreField.slice">
<tt class="descname">slice</tt><big>(</big><em>*args</em><big>)</big><a class="headerlink" href="#HStoreField.slice" title="Permalink to this definition">¶</a></dt>
<dd><p>Return a slice of data given a list of keys.</p>
<div class="highlight-pycon"><div class="highlight"><pre><span class="gp">&gt;&gt;&gt; </span><span class="n">f</span> <span class="o">=</span> <span class="n">House</span><span class="o">.</span><span class="n">features</span>
<span class="gp">&gt;&gt;&gt; </span><span class="k">for</span> <span class="n">h</span> <span class="ow">in</span> <span class="n">House</span><span class="o">.</span><span class="n">select</span><span class="p">(</span><span class="n">House</span><span class="o">.</span><span class="n">address</span><span class="p">,</span> <span class="n">f</span><span class="o">.</span><span class="n">slice</span><span class="p">(</span><span class="s">&#39;garage&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">alias</span><span class="p">(</span><span class="s">&#39;garage_data&#39;</span><span class="p">)):</span>
<span class="gp">... </span>    <span class="k">print</span> <span class="n">h</span><span class="o">.</span><span class="n">address</span><span class="p">,</span> <span class="n">h</span><span class="o">.</span><span class="n">garage_data</span>

<span class="go">123 Main St {&#39;garage&#39;: &#39;2 cars&#39;}</span>
</pre></div>
</div>
</dd></dl>

<dl class="method">
<dt id="HStoreField.exists">
<tt class="descname">exists</tt><big>(</big><em>key</em><big>)</big><a class="headerlink" href="#HStoreField.exists" title="Permalink to this definition">¶</a></dt>
<dd><p>Query for whether the given key exists.</p>
<div class="highlight-pycon"><div class="highlight"><pre><span class="gp">&gt;&gt;&gt; </span><span class="k">for</span> <span class="n">h</span> <span class="ow">in</span> <span class="n">House</span><span class="o">.</span><span class="n">select</span><span class="p">(</span><span class="n">House</span><span class="o">.</span><span class="n">address</span><span class="p">,</span> <span class="n">f</span><span class="o">.</span><span class="n">exists</span><span class="p">(</span><span class="s">&#39;garage&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">alias</span><span class="p">(</span><span class="s">&#39;has_garage&#39;</span><span class="p">)):</span>
<span class="gp">... </span>    <span class="k">print</span> <span class="n">h</span><span class="o">.</span><span class="n">address</span><span class="p">,</span> <span class="n">h</span><span class="o">.</span><span class="n">has_garage</span>

<span class="go">123 Main St True</span>

<span class="gp">&gt;&gt;&gt; </span><span class="k">for</span> <span class="n">h</span> <span class="ow">in</span> <span class="n">House</span><span class="o">.</span><span class="n">select</span><span class="p">()</span><span class="o">.</span><span class="n">where</span><span class="p">(</span><span class="n">f</span><span class="o">.</span><span class="n">exists</span><span class="p">(</span><span class="s">&#39;garage&#39;</span><span class="p">)):</span>
<span class="gp">... </span>    <span class="k">print</span> <span class="n">h</span><span class="o">.</span><span class="n">address</span><span class="p">,</span> <span class="n">h</span><span class="o">.</span><span class="n">features</span><span class="p">[</span><span class="s">&#39;garage&#39;</span><span class="p">]</span> <span class="c"># &lt;-- just houses w/garage data</span>

<span class="go">123 Main St 2 cars</span>
</pre></div>
</div>
</dd></dl>

<dl class="method">
<dt id="HStoreField.defined">
<tt class="descname">defined</tt><big>(</big><em>key</em><big>)</big><a class="headerlink" href="#HStoreField.defined" title="Permalink to this definition">¶</a></dt>
<dd><p>Query for whether the given key has a value associated with it.</p>
</dd></dl>

<dl class="method">
<dt id="HStoreField.update">
<tt class="descname">update</tt><big>(</big><em>**data</em><big>)</big><a class="headerlink" href="#HStoreField.update" title="Permalink to this definition">¶</a></dt>
<dd><p>Perform an atomic update to the keys/values for a given row or rows.</p>
<div class="highlight-pycon"><div class="highlight"><pre><span class="gp">&gt;&gt;&gt; </span><span class="n">query</span> <span class="o">=</span> <span class="n">House</span><span class="o">.</span><span class="n">update</span><span class="p">(</span><span class="n">features</span><span class="o">=</span><span class="n">House</span><span class="o">.</span><span class="n">features</span><span class="o">.</span><span class="n">update</span><span class="p">(</span>
<span class="gp">... </span>    <span class="n">sqft</span><span class="o">=</span><span class="mi">2000</span><span class="p">,</span>
<span class="gp">... </span>    <span class="n">year_built</span><span class="o">=</span><span class="mi">2012</span><span class="p">))</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">query</span><span class="o">.</span><span class="n">where</span><span class="p">(</span><span class="n">House</span><span class="o">.</span><span class="n">id</span> <span class="o">==</span> <span class="mi">1</span><span class="p">)</span><span class="o">.</span><span class="n">execute</span><span class="p">()</span>
</pre></div>
</div>
</dd></dl>

<dl class="method">
<dt id="HStoreField.delete">
<tt class="descname">delete</tt><big>(</big><em>*keys</em><big>)</big><a class="headerlink" href="#HStoreField.delete" title="Permalink to this definition">¶</a></dt>
<dd><p>Delete the provided keys for a given row or rows.</p>
<div class="admonition note">
<p class="first admonition-title">Note</p>
<p class="last">We will use an <tt class="docutils literal"><span class="pre">UPDATE</span></tt> query.</p>
</div>
<div class="highlight-pycon"><div class="highlight"><pre>
</pre></div>
</div>
<div class="highlight-python"><div class="highlight"><pre><span class="gp">&gt;&gt;&gt; </span><span class="n">query</span> <span class="o">=</span> <span class="n">House</span><span class="o">.</span><span class="n">update</span><span class="p">(</span><span class="n">features</span><span class="o">=</span><span class="n">House</span><span class="o">.</span><span class="n">features</span><span class="o">.</span><span class="n">delete</span><span class="p">(</span>
<span class="gp">... </span>    <span class="s">&#39;sqft&#39;</span><span class="p">,</span> <span class="s">&#39;year_built&#39;</span><span class="p">))</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">query</span><span class="o">.</span><span class="n">where</span><span class="p">(</span><span class="n">House</span><span class="o">.</span><span class="n">id</span> <span class="o">==</span> <span class="mi">1</span><span class="p">)</span><span class="o">.</span><span class="n">execute</span><span class="p">()</span>
</pre></div>
</div>
</dd></dl>

<dl class="method">
<dt id="HStoreField.contains">
<tt class="descname">contains</tt><big>(</big><em>value</em><big>)</big><a class="headerlink" href="#HStoreField.contains" title="Permalink to this definition">¶</a></dt>
<dd><table class="docutils field-list" frame="void" rules="none">
<col class="field-name" />
<col class="field-body" />
<tbody valign="top">
<tr class="field-odd field"><th class="field-name">Parameters:</th><td class="field-body"><strong>value</strong> &#8211; Either a <tt class="docutils literal"><span class="pre">dict</span></tt>, a <tt class="docutils literal"><span class="pre">list</span></tt> of keys, or a single key.</td>
</tr>
</tbody>
</table>
<p>Query rows for the existence of either:</p>
<ul class="simple">
<li>a partial dictionary.</li>
<li>a list of keys.</li>
<li>a single key.</li>
</ul>
<div class="highlight-pycon"><div class="highlight"><pre><span class="gp">&gt;&gt;&gt; </span><span class="n">f</span> <span class="o">=</span> <span class="n">House</span><span class="o">.</span><span class="n">features</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">House</span><span class="o">.</span><span class="n">select</span><span class="p">()</span><span class="o">.</span><span class="n">where</span><span class="p">(</span><span class="n">f</span><span class="o">.</span><span class="n">contains</span><span class="p">(</span><span class="s">&#39;garage&#39;</span><span class="p">))</span> <span class="c"># &lt;-- all houses w/garage key</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">House</span><span class="o">.</span><span class="n">select</span><span class="p">()</span><span class="o">.</span><span class="n">where</span><span class="p">(</span><span class="n">f</span><span class="o">.</span><span class="n">contains</span><span class="p">([</span><span class="s">&#39;garage&#39;</span><span class="p">,</span> <span class="s">&#39;bath&#39;</span><span class="p">]))</span> <span class="c"># &lt;-- all houses w/garage &amp; bath</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">House</span><span class="o">.</span><span class="n">select</span><span class="p">()</span><span class="o">.</span><span class="n">where</span><span class="p">(</span><span class="n">f</span><span class="o">.</span><span class="n">contains</span><span class="p">({</span><span class="s">&#39;garage&#39;</span><span class="p">:</span> <span class="s">&#39;2 cars&#39;</span><span class="p">}))</span> <span class="c"># &lt;-- houses w/2-car garage</span>
</pre></div>
</div>
</dd></dl>

<dl class="method">
<dt id="HStoreField.contains_any">
<tt class="descname">contains_any</tt><big>(</big><em>*keys</em><big>)</big><a class="headerlink" href="#HStoreField.contains_any" title="Permalink to this definition">¶</a></dt>
<dd><table class="docutils field-list" frame="void" rules="none">
<col class="field-name" />
<col class="field-body" />
<tbody valign="top">
<tr class="field-odd field"><th class="field-name">Parameters:</th><td class="field-body"><strong>keys</strong> &#8211; One or more keys to search for.</td>
</tr>
</tbody>
</table>
<p>Query rows for the existince of <em>any</em> key.</p>
</dd></dl>

</dd></dl>

<dl class="class">
<dt id="UUIDField">
<em class="property">class </em><tt class="descname">UUIDField</tt><big>(</big><em>*args</em>, <em>**kwargs</em><big>)</big><a class="headerlink" href="#UUIDField" title="Permalink to this definition">¶</a></dt>
<dd><p>A field for storing and retrieving <tt class="docutils literal"><span class="pre">UUID</span></tt> objects.</p>
</dd></dl>

</div>
</div>
<div class="section" id="sqlite-extensions">
<span id="sqlite-ext"></span><h2>Sqlite Extensions<a class="headerlink" href="#sqlite-extensions" title="Permalink to this headline">¶</a></h2>
<p>The SQLite extensions module provides support for some interesting sqlite-only
features:</p>
<ul class="simple">
<li>Define custom aggregates, collations and functions.</li>
<li>Basic support for virtual tables.</li>
<li>Basic support for FTS3/4 (sqlite full-text search).</li>
<li>Specify isolation level in transactions.</li>
</ul>
<div class="section" id="sqlite-ext-api-notes">
<h3>sqlite_ext API notes<a class="headerlink" href="#sqlite-ext-api-notes" title="Permalink to this headline">¶</a></h3>
<dl class="class">
<dt id="SqliteExtDatabase">
<em class="property">class </em><tt class="descname">SqliteExtDatabase</tt><big>(</big><em>database</em>, <em>**kwargs</em><big>)</big><a class="headerlink" href="#SqliteExtDatabase" title="Permalink to this definition">¶</a></dt>
<dd><p>Subclass of the <a class="reference internal" href="api.html#SqliteDatabase" title="SqliteDatabase"><tt class="xref py py-class docutils literal"><span class="pre">SqliteDatabase</span></tt></a> that provides some advanced
features only offered by Sqlite.</p>
<ul class="simple">
<li>Register custom aggregates, collations and functions</li>
<li>Specify a row factory</li>
<li>Advanced transactions (specify isolation level)</li>
</ul>
<dl class="method">
<dt id="SqliteExtDatabase.aggregate">
<tt class="descname">aggregate</tt><big>(</big><em>num_params</em><span class="optional">[</span>, <em>name</em><span class="optional">]</span><big>)</big><a class="headerlink" href="#SqliteExtDatabase.aggregate" title="Permalink to this definition">¶</a></dt>
<dd><p>Class-decorator for registering custom aggregation functions.</p>
<table class="docutils field-list" frame="void" rules="none">
<col class="field-name" />
<col class="field-body" />
<tbody valign="top">
<tr class="field-odd field"><th class="field-name">Parameters:</th><td class="field-body"><ul class="first last simple">
<li><strong>num_params</strong> &#8211; integer representing number of parameters the
aggregate function accepts.</li>
<li><strong>name</strong> &#8211; string name for the aggregate, defaults to the name of
the class.</li>
</ul>
</td>
</tr>
</tbody>
</table>
<div class="highlight-python"><div class="highlight"><pre><span class="nd">@db.aggregate</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="s">&#39;product&#39;</span><span class="p">)</span>
<span class="k">class</span> <span class="nc">Product</span><span class="p">(</span><span class="nb">object</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;Like sum, except calculate the product of a series of numbers.&quot;&quot;&quot;</span>
    <span class="k">def</span> <span class="nf">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">product</span> <span class="o">=</span> <span class="mi">1</span>

    <span class="k">def</span> <span class="nf">step</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">value</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">product</span> <span class="o">*=</span> <span class="n">value</span>

    <span class="k">def</span> <span class="nf">finalize</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">product</span>

<span class="c"># To use this aggregate:</span>
<span class="n">product</span> <span class="o">=</span> <span class="p">(</span><span class="n">Score</span>
           <span class="o">.</span><span class="n">select</span><span class="p">(</span><span class="n">fn</span><span class="o">.</span><span class="n">product</span><span class="p">(</span><span class="n">Score</span><span class="o">.</span><span class="n">value</span><span class="p">))</span>
           <span class="o">.</span><span class="n">scalar</span><span class="p">())</span>
</pre></div>
</div>
</dd></dl>

<dl class="method">
<dt id="SqliteExtDatabase.collation">
<tt class="descname">collation</tt><big>(</big><span class="optional">[</span><em>name</em><span class="optional">]</span><big>)</big><a class="headerlink" href="#SqliteExtDatabase.collation" title="Permalink to this definition">¶</a></dt>
<dd><p>Function decorator for registering a custom collation.</p>
<table class="docutils field-list" frame="void" rules="none">
<col class="field-name" />
<col class="field-body" />
<tbody valign="top">
<tr class="field-odd field"><th class="field-name">Parameters:</th><td class="field-body"><strong>name</strong> &#8211; string name to use for this collation.</td>
</tr>
</tbody>
</table>
<div class="highlight-python"><div class="highlight"><pre><span class="nd">@db.collation</span><span class="p">()</span>
<span class="k">def</span> <span class="nf">collate_reverse</span><span class="p">(</span><span class="n">s1</span><span class="p">,</span> <span class="n">s2</span><span class="p">):</span>
    <span class="k">return</span> <span class="o">-</span><span class="nb">cmp</span><span class="p">(</span><span class="n">s1</span><span class="p">,</span> <span class="n">s2</span><span class="p">)</span>

<span class="c"># To use this collation:</span>
<span class="n">Book</span><span class="o">.</span><span class="n">select</span><span class="p">()</span><span class="o">.</span><span class="n">order_by</span><span class="p">(</span><span class="n">collate_reverse</span><span class="o">.</span><span class="n">collation</span><span class="p">(</span><span class="n">Book</span><span class="o">.</span><span class="n">title</span><span class="p">))</span>
</pre></div>
</div>
<p>As you might have noticed, the original <tt class="docutils literal"><span class="pre">collate_reverse</span></tt> function
has a special attribute called <tt class="docutils literal"><span class="pre">collation</span></tt> attached to it.  This extra
attribute provides a shorthand way to generate the SQL necessary to use
our custom collation.</p>
</dd></dl>

<dl class="method">
<dt id="SqliteExtDatabase.func">
<tt class="descname">func</tt><big>(</big><span class="optional">[</span><em>name</em><span class="optional">[</span>, <em>num_params</em><span class="optional">]</span><span class="optional">]</span><big>)</big><a class="headerlink" href="#SqliteExtDatabase.func" title="Permalink to this definition">¶</a></dt>
<dd><p>Function decorator for registering user-defined functions.</p>
<table class="docutils field-list" frame="void" rules="none">
<col class="field-name" />
<col class="field-body" />
<tbody valign="top">
<tr class="field-odd field"><th class="field-name">Parameters:</th><td class="field-body"><ul class="first last simple">
<li><strong>name</strong> &#8211; name to use for this function.</li>
<li><strong>num_params</strong> &#8211; number of parameters this function accepts.  If not
provided, peewee will introspect the function for you.</li>
</ul>
</td>
</tr>
</tbody>
</table>
<div class="highlight-python"><div class="highlight"><pre><span class="nd">@db.func</span><span class="p">()</span>
<span class="k">def</span> <span class="nf">title_case</span><span class="p">(</span><span class="n">s</span><span class="p">):</span>
    <span class="k">return</span> <span class="n">s</span><span class="o">.</span><span class="n">title</span><span class="p">()</span>

<span class="c"># Use in the select clause...</span>
<span class="n">titled_books</span> <span class="o">=</span> <span class="n">Book</span><span class="o">.</span><span class="n">select</span><span class="p">(</span><span class="n">fn</span><span class="o">.</span><span class="n">title_case</span><span class="p">(</span><span class="n">Book</span><span class="o">.</span><span class="n">title</span><span class="p">))</span>

<span class="nd">@db.func</span><span class="p">()</span>
<span class="k">def</span> <span class="nf">sha1</span><span class="p">(</span><span class="n">s</span><span class="p">):</span>
    <span class="k">return</span> <span class="n">hashlib</span><span class="o">.</span><span class="n">sha1</span><span class="p">(</span><span class="n">s</span><span class="p">)</span><span class="o">.</span><span class="n">hexdigest</span><span class="p">()</span>

<span class="c"># Use in the where clause...</span>
<span class="n">user</span> <span class="o">=</span> <span class="n">User</span><span class="o">.</span><span class="n">select</span><span class="p">()</span><span class="o">.</span><span class="n">where</span><span class="p">(</span>
    <span class="p">(</span><span class="n">User</span><span class="o">.</span><span class="n">username</span> <span class="o">==</span> <span class="n">username</span><span class="p">)</span> <span class="o">&amp;</span>
    <span class="p">(</span><span class="n">fn</span><span class="o">.</span><span class="n">sha1</span><span class="p">(</span><span class="n">User</span><span class="o">.</span><span class="n">password</span><span class="p">)</span> <span class="o">==</span> <span class="n">password_hash</span><span class="p">))</span><span class="o">.</span><span class="n">get</span><span class="p">()</span>
</pre></div>
</div>
</dd></dl>

<dl class="method">
<dt id="SqliteExtDatabase.granular_transaction">
<tt class="descname">granular_transaction</tt><big>(</big><span class="optional">[</span><em>lock_type='deferred'</em><span class="optional">]</span><big>)</big><a class="headerlink" href="#SqliteExtDatabase.granular_transaction" title="Permalink to this definition">¶</a></dt>
<dd><p>With the <tt class="docutils literal"><span class="pre">granular_transaction</span></tt> helper, you can specify the isolation level
for an individual transaction.  The valid options are:</p>
<ul class="simple">
<li><tt class="docutils literal"><span class="pre">exclusive</span></tt></li>
<li><tt class="docutils literal"><span class="pre">immediate</span></tt></li>
<li><tt class="docutils literal"><span class="pre">deferred</span></tt></li>
</ul>
<p>Example usage:</p>
<div class="highlight-python"><div class="highlight"><pre><span class="k">with</span> <span class="n">db</span><span class="o">.</span><span class="n">granular_transaction</span><span class="p">(</span><span class="s">&#39;exclusive&#39;</span><span class="p">):</span>
    <span class="c"># no other readers or writers!</span>
    <span class="p">(</span><span class="n">Account</span>
     <span class="o">.</span><span class="n">update</span><span class="p">(</span><span class="n">Account</span><span class="o">.</span><span class="n">balance</span><span class="o">=</span><span class="n">Account</span><span class="o">.</span><span class="n">balance</span> <span class="o">-</span> <span class="mi">100</span><span class="p">)</span>
     <span class="o">.</span><span class="n">where</span><span class="p">(</span><span class="n">Account</span><span class="o">.</span><span class="n">id</span> <span class="o">==</span> <span class="n">from_acct</span><span class="p">)</span>
     <span class="o">.</span><span class="n">execute</span><span class="p">())</span>

    <span class="p">(</span><span class="n">Account</span>
     <span class="o">.</span><span class="n">update</span><span class="p">(</span><span class="n">Account</span><span class="o">.</span><span class="n">balance</span><span class="o">=</span><span class="n">Account</span><span class="o">.</span><span class="n">balance</span> <span class="o">+</span> <span class="mi">100</span><span class="p">)</span>
     <span class="o">.</span><span class="n">where</span><span class="p">(</span><span class="n">Account</span><span class="o">.</span><span class="n">id</span> <span class="o">==</span> <span class="n">to_acct</span><span class="p">)</span>
     <span class="o">.</span><span class="n">execute</span><span class="p">())</span>
</pre></div>
</div>
</dd></dl>

</dd></dl>

<dl class="class">
<dt id="VirtualModel">
<em class="property">class </em><tt class="descname">VirtualModel</tt><a class="headerlink" href="#VirtualModel" title="Permalink to this definition">¶</a></dt>
<dd><p>Subclass of <a class="reference internal" href="api.html#Model" title="Model"><tt class="xref py py-class docutils literal"><span class="pre">Model</span></tt></a> that signifies the model operates using a
virtual table provided by a sqlite extension.</p>
<dl class="attribute">
<dt>
<tt class="descname">_extension = 'name of sqlite extension'</tt></dt>
<dd></dd></dl>

</dd></dl>

<dl class="class">
<dt id="FTSModel">
<em class="property">class </em><tt class="descname">FTSModel</tt><a class="headerlink" href="#FTSModel" title="Permalink to this definition">¶</a></dt>
<dd><p>Model class that provides support for Sqlite&#8217;s full-text search extension.
Models should be defined normally, however there are a couple caveats:</p>
<ul class="simple">
<li>Indexes are ignored completely</li>
<li>Sqlite will treat all column types as <a class="reference internal" href="api.html#TextField" title="TextField"><tt class="xref py py-class docutils literal"><span class="pre">TextField</span></tt></a> (although you
can store other data types, Sqlite will treat them as text).</li>
</ul>
<p>Therefore it usually makes sense to index the content you intend to search
and a single link back to the original document, since all SQL queries
<em>except</em> full-text searches and <tt class="docutils literal"><span class="pre">rowid</span></tt> lookups will be slow.</p>
<p>Example:</p>
<div class="highlight-python"><div class="highlight"><pre><span class="k">class</span> <span class="nc">Document</span><span class="p">(</span><span class="n">FTSModel</span><span class="p">):</span>
    <span class="n">title</span> <span class="o">=</span> <span class="n">TextField</span><span class="p">()</span>  <span class="c"># type affinities are ignored by FTS, so use TextField</span>
    <span class="n">content</span> <span class="o">=</span> <span class="n">TextField</span><span class="p">()</span>

<span class="n">Document</span><span class="o">.</span><span class="n">create_table</span><span class="p">(</span><span class="n">tokenize</span><span class="o">=</span><span class="s">&#39;porter&#39;</span><span class="p">)</span>  <span class="c"># use the porter stemmer.</span>

<span class="c"># populate documents using normal operations.</span>
<span class="k">for</span> <span class="n">doc</span> <span class="ow">in</span> <span class="n">list_of_docs_to_index</span><span class="p">:</span>
    <span class="n">Document</span><span class="o">.</span><span class="n">create</span><span class="p">(</span><span class="n">title</span><span class="o">=</span><span class="n">doc</span><span class="p">[</span><span class="s">&#39;title&#39;</span><span class="p">],</span> <span class="n">content</span><span class="o">=</span><span class="n">doc</span><span class="p">[</span><span class="s">&#39;content&#39;</span><span class="p">])</span>

<span class="c"># use the &quot;match&quot; operation for FTS queries.</span>
<span class="n">matching_docs</span> <span class="o">=</span> <span class="n">Document</span><span class="o">.</span><span class="n">select</span><span class="p">()</span><span class="o">.</span><span class="n">where</span><span class="p">(</span><span class="n">match</span><span class="p">(</span><span class="n">Document</span><span class="o">.</span><span class="n">title</span><span class="p">,</span> <span class="s">&#39;some query&#39;</span><span class="p">))</span>

<span class="c"># to sort by best match, use the custom &quot;rank&quot; function.</span>
<span class="n">best</span> <span class="o">=</span> <span class="p">(</span><span class="n">Document</span>
        <span class="o">.</span><span class="n">select</span><span class="p">(</span><span class="n">Document</span><span class="p">,</span> <span class="n">Document</span><span class="o">.</span><span class="n">rank</span><span class="p">(</span><span class="s">&#39;score&#39;</span><span class="p">))</span>
        <span class="o">.</span><span class="n">where</span><span class="p">(</span><span class="n">match</span><span class="p">(</span><span class="n">Document</span><span class="o">.</span><span class="n">title</span><span class="p">,</span> <span class="s">&#39;some query&#39;</span><span class="p">))</span>
        <span class="o">.</span><span class="n">order_by</span><span class="p">(</span><span class="n">R</span><span class="p">(</span><span class="s">&#39;score&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">desc</span><span class="p">()))</span>

<span class="c"># or use the shortcut method:</span>
<span class="n">best</span> <span class="o">=</span> <span class="n">Document</span><span class="o">.</span><span class="n">match</span><span class="p">(</span><span class="s">&#39;some phrase&#39;</span><span class="p">)</span>
</pre></div>
</div>
<p>If you have an existing table and would like to add search for a column
on that table, you can specify it using the <tt class="docutils literal"><span class="pre">content</span></tt> option:</p>
<div class="highlight-python"><div class="highlight"><pre><span class="k">class</span> <span class="nc">Blog</span><span class="p">(</span><span class="n">Model</span><span class="p">):</span>
    <span class="n">title</span> <span class="o">=</span> <span class="n">CharField</span><span class="p">()</span>
    <span class="n">pub_date</span> <span class="o">=</span> <span class="n">DateTimeField</span><span class="p">()</span>
    <span class="n">content</span> <span class="o">=</span> <span class="n">TextField</span><span class="p">()</span>  <span class="c"># we want to search this.</span>

<span class="k">class</span> <span class="nc">FTSBlog</span><span class="p">(</span><span class="n">FTSModel</span><span class="p">):</span>
    <span class="n">content</span> <span class="o">=</span> <span class="n">TextField</span><span class="p">()</span>

<span class="n">Blog</span><span class="o">.</span><span class="n">create_table</span><span class="p">()</span>
<span class="n">FTSBlog</span><span class="o">.</span><span class="n">create_table</span><span class="p">(</span><span class="n">content</span><span class="o">=</span><span class="n">Blog</span><span class="o">.</span><span class="n">content</span><span class="p">)</span>

<span class="c"># Now, we can manage content in the FTSBlog.  To populate it with</span>
<span class="c"># content:</span>
<span class="n">FTSBlog</span><span class="o">.</span><span class="n">rebuild</span><span class="p">()</span>

<span class="c"># Optimize the index.</span>
<span class="n">FTSBlog</span><span class="o">.</span><span class="n">optimize</span><span class="p">()</span>
</pre></div>
</div>
<p>The <tt class="docutils literal"><span class="pre">content</span></tt> option accepts either a single <a class="reference internal" href="api.html#Field" title="Field"><tt class="xref py py-class docutils literal"><span class="pre">Field</span></tt></a> or a <a class="reference internal" href="api.html#Model" title="Model"><tt class="xref py py-class docutils literal"><span class="pre">Model</span></tt></a>
and can reduce the amount of storage used.  However, content will need to be
manually moved to/from the associated <tt class="docutils literal"><span class="pre">FTSModel</span></tt>.</p>
<dl class="classmethod">
<dt id="FTSModel.create_table">
<em class="property">classmethod </em><tt class="descname">create_table</tt><big>(</big><span class="optional">[</span><em>fail_silently=False</em><span class="optional">[</span>, <em>**options</em><span class="optional">]</span><span class="optional">]</span><big>)</big><a class="headerlink" href="#FTSModel.create_table" title="Permalink to this definition">¶</a></dt>
<dd><table class="docutils field-list" frame="void" rules="none">
<col class="field-name" />
<col class="field-body" />
<tbody valign="top">
<tr class="field-odd field"><th class="field-name">Parameters:</th><td class="field-body"><ul class="first last simple">
<li><strong>fail_silently</strong> (<em>boolean</em>) &#8211; do not re-create if table already exists.</li>
<li><strong>options</strong> &#8211; options passed along when creating the table, e.g. <tt class="docutils literal"><span class="pre">content</span></tt>.</li>
</ul>
</td>
</tr>
</tbody>
</table>
</dd></dl>

<dl class="classmethod">
<dt id="FTSModel.rebuild">
<em class="property">classmethod </em><tt class="descname">rebuild</tt><big>(</big><big>)</big><a class="headerlink" href="#FTSModel.rebuild" title="Permalink to this definition">¶</a></dt>
<dd><p>Rebuild the search index &#8211; this only works when the <tt class="docutils literal"><span class="pre">content</span></tt> option
was specified during table creation.</p>
</dd></dl>

<dl class="classmethod">
<dt id="FTSModel.optimize">
<em class="property">classmethod </em><tt class="descname">optimize</tt><big>(</big><big>)</big><a class="headerlink" href="#FTSModel.optimize" title="Permalink to this definition">¶</a></dt>
<dd><p>Optimize the search index.</p>
</dd></dl>

<dl class="classmethod">
<dt id="FTSModel.match">
<em class="property">classmethod </em><tt class="descname">match</tt><big>(</big><em>search_phrase</em><big>)</big><a class="headerlink" href="#FTSModel.match" title="Permalink to this definition">¶</a></dt>
<dd><p>Shorthand way of performing a search for a given phrase.  Example:</p>
<div class="highlight-python"><div class="highlight"><pre><span class="k">for</span> <span class="n">doc</span> <span class="ow">in</span> <span class="n">Document</span><span class="o">.</span><span class="n">match</span><span class="p">(</span><span class="s">&#39;search phrase&#39;</span><span class="p">):</span>
    <span class="k">print</span> <span class="s">&#39;match: &#39;</span><span class="p">,</span> <span class="n">doc</span><span class="o">.</span><span class="n">title</span>
</pre></div>
</div>
</dd></dl>

<dl class="classmethod">
<dt id="FTSModel.rank">
<em class="property">classmethod </em><tt class="descname">rank</tt><big>(</big><span class="optional">[</span><em>alias</em><span class="optional">]</span><big>)</big><a class="headerlink" href="#FTSModel.rank" title="Permalink to this definition">¶</a></dt>
<dd><p>Shorthand way of sorting search results by the quality of their match.</p>
<div class="highlight-python"><div class="highlight"><pre><span class="n">docs</span> <span class="o">=</span> <span class="p">(</span><span class="n">Document</span>
        <span class="o">.</span><span class="n">select</span><span class="p">(</span><span class="n">Document</span><span class="p">,</span> <span class="n">Document</span><span class="o">.</span><span class="n">rank</span><span class="p">()</span><span class="o">.</span><span class="n">alias</span><span class="p">(</span><span class="s">&#39;score&#39;</span><span class="p">))</span>
        <span class="o">.</span><span class="n">where</span><span class="p">(</span><span class="n">match</span><span class="p">(</span><span class="n">Document</span><span class="p">,</span> <span class="n">search</span><span class="p">))</span>
        <span class="o">.</span><span class="n">order_by</span><span class="p">(</span><span class="n">R</span><span class="p">(</span><span class="s">&#39;score&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">desc</span><span class="p">()))</span>
</pre></div>
</div>
<p>The above code is exactly what the <a class="reference internal" href="#FTSModel.match" title="FTSModel.match"><tt class="xref py py-meth docutils literal"><span class="pre">match()</span></tt></a> function
provides.</p>
</dd></dl>

</dd></dl>

</div>
</div>
<div class="section" id="django-integration">
<span id="djpeewee"></span><h2>Django Integration<a class="headerlink" href="#django-integration" title="Permalink to this headline">¶</a></h2>
<p>The Django ORM provides a very high-level abstraction over SQL and as a consequence is in some ways
<a class="reference external" href="http://charlesleifer.com/blog/shortcomings-in-the-django-orm-and-a-look-at-peewee-a-lightweight-alternative/">limited in terms of flexibility or expressiveness</a>. I
wrote a <a class="reference external" href="http://charlesleifer.com/blog/the-search-for-the-missing-link-what-lies-between-sql-and-django-s-orm-/">blog post</a>
describing my search for a &#8220;missing link&#8221; between Django&#8217;s ORM and the SQL it
generates, concluding that no such layer exists.  The <tt class="docutils literal"><span class="pre">djpeewee</span></tt> module attempts
to provide an easy-to-use, structured layer for generating SQL queries for use
with Django&#8217;s ORM.</p>
<p>A couple use-cases might be:</p>
<ul class="simple">
<li>Joining on fields that are not related by foreign key (for example UUID fields).</li>
<li>Performing aggregate queries on calculated values.</li>
<li>Features that Django does not support such as <tt class="docutils literal"><span class="pre">CASE</span></tt> statements.</li>
<li>Utilizing SQL functions that Django does not support, such as <tt class="docutils literal"><span class="pre">SUBSTR</span></tt>.</li>
<li>Replacing nearly-identical SQL queries with reusable, composable data-structures.</li>
</ul>
<p>Below is an example of how you might use this:</p>
<div class="highlight-python"><div class="highlight"><pre><span class="c"># Django model.</span>
<span class="k">class</span> <span class="nc">Event</span><span class="p">(</span><span class="n">models</span><span class="o">.</span><span class="n">Model</span><span class="p">):</span>
    <span class="n">start_time</span> <span class="o">=</span> <span class="n">models</span><span class="o">.</span><span class="n">DateTimeField</span><span class="p">()</span>
    <span class="n">end_time</span> <span class="o">=</span> <span class="n">models</span><span class="o">.</span><span class="n">DateTimeField</span><span class="p">()</span>
    <span class="n">title</span> <span class="o">=</span> <span class="n">models</span><span class="o">.</span><span class="n">CharField</span><span class="p">(</span><span class="n">max_length</span><span class="o">=</span><span class="mi">255</span><span class="p">)</span>

<span class="c"># Suppose we want to find all events that are longer than an hour.  Django</span>
<span class="c"># does not support this, but we can use peewee.</span>
<span class="kn">from</span> <span class="nn">playhouse.djpeewee</span> <span class="kn">import</span> <span class="n">translate</span>
<span class="n">P</span> <span class="o">=</span> <span class="n">translate</span><span class="p">(</span><span class="n">Event</span><span class="p">)</span>
<span class="n">query</span> <span class="o">=</span> <span class="p">(</span><span class="n">P</span><span class="o">.</span><span class="n">Event</span>
         <span class="o">.</span><span class="n">select</span><span class="p">()</span>
         <span class="o">.</span><span class="n">where</span><span class="p">(</span>
             <span class="p">(</span><span class="n">P</span><span class="o">.</span><span class="n">Event</span><span class="o">.</span><span class="n">end_time</span> <span class="o">-</span> <span class="n">P</span><span class="o">.</span><span class="n">Event</span><span class="o">.</span><span class="n">start_time</span><span class="p">)</span> <span class="o">&gt;</span> <span class="n">timedelta</span><span class="p">(</span><span class="n">hours</span><span class="o">=</span><span class="mi">1</span><span class="p">)))</span>

<span class="c"># Now feed our peewee query into Django&#39;s `raw()` method:</span>
<span class="n">sql</span><span class="p">,</span> <span class="n">params</span> <span class="o">=</span> <span class="n">query</span><span class="o">.</span><span class="n">sql</span><span class="p">()</span>
<span class="n">Event</span><span class="o">.</span><span class="n">objects</span><span class="o">.</span><span class="n">raw</span><span class="p">(</span><span class="n">sql</span><span class="p">,</span> <span class="n">params</span><span class="p">)</span>
</pre></div>
</div>
<div class="section" id="foreign-keys-and-many-to-many-relationships">
<h3>Foreign keys and Many-to-many relationships<a class="headerlink" href="#foreign-keys-and-many-to-many-relationships" title="Permalink to this headline">¶</a></h3>
<p>The <a class="reference internal" href="#translate" title="translate"><tt class="xref py py-func docutils literal"><span class="pre">translate()</span></tt></a> function will recursively traverse the graph of models
and return a dictionary populated with everything it finds.  Back-references are
not searched by default, but can be included by specifying <tt class="docutils literal"><span class="pre">backrefs=True</span></tt>.</p>
<p>Example:</p>
<div class="highlight-pycon"><div class="highlight"><pre><span class="gp">&gt;&gt;&gt; </span><span class="kn">from</span> <span class="nn">django.contrib.auth.models</span> <span class="kn">import</span> <span class="n">User</span><span class="p">,</span> <span class="n">Group</span>
<span class="gp">&gt;&gt;&gt; </span><span class="kn">from</span> <span class="nn">playhouse.djpeewee</span> <span class="kn">import</span> <span class="n">translate</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">translate</span><span class="p">(</span><span class="n">User</span><span class="p">,</span> <span class="n">Group</span><span class="p">)</span>
<span class="go">{&#39;ContentType&#39;: peewee.ContentType,</span>
<span class="go"> &#39;Group&#39;: peewee.Group,</span>
<span class="go"> &#39;Group_permissions&#39;: peewee.Group_permissions,</span>
<span class="go"> &#39;Permission&#39;: peewee.Permission,</span>
<span class="go"> &#39;User&#39;: peewee.User,</span>
<span class="go"> &#39;User_groups&#39;: peewee.User_groups,</span>
<span class="go"> &#39;User_user_permissions&#39;: peewee.User_user_permissions}</span>
</pre></div>
</div>
<p>As you can see in the example above, although only <cite>User</cite> and <cite>Group</cite> were passed
in to <a class="reference internal" href="#translate" title="translate"><tt class="xref py py-func docutils literal"><span class="pre">translate()</span></tt></a>, several other models which are related by foreign key
were also created. Additionally, the many-to-many &#8220;through&#8221; tables were created
as separate models since peewee does not abstract away these types of relationships.</p>
<p>Using the above models it is possible to construct joins.  The following example
will get all users who belong to a group that starts with the letter &#8220;A&#8221;:</p>
<div class="highlight-pycon"><div class="highlight"><pre><span class="gp">&gt;&gt;&gt; </span><span class="n">P</span> <span class="o">=</span> <span class="n">translate</span><span class="p">(</span><span class="n">User</span><span class="p">,</span> <span class="n">Group</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">query</span> <span class="o">=</span> <span class="n">P</span><span class="o">.</span><span class="n">User</span><span class="o">.</span><span class="n">select</span><span class="p">()</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">P</span><span class="o">.</span><span class="n">User_groups</span><span class="p">)</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">P</span><span class="o">.</span><span class="n">Group</span><span class="p">)</span><span class="o">.</span><span class="n">where</span><span class="p">(</span>
<span class="gp">... </span>    <span class="n">fn</span><span class="o">.</span><span class="n">Lower</span><span class="p">(</span><span class="n">fn</span><span class="o">.</span><span class="n">Substr</span><span class="p">(</span><span class="n">P</span><span class="o">.</span><span class="n">Group</span><span class="o">.</span><span class="n">name</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">))</span> <span class="o">==</span> <span class="s">&#39;a&#39;</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">sql</span><span class="p">,</span> <span class="n">params</span> <span class="o">=</span> <span class="n">query</span><span class="o">.</span><span class="n">sql</span><span class="p">()</span>
<span class="gp">&gt;&gt;&gt; </span><span class="k">print</span> <span class="n">sql</span>  <span class="c"># formatted for legibility</span>
<span class="go">SELECT t1.&quot;id&quot;, t1.&quot;password&quot;, ...</span>
<span class="go">FROM &quot;auth_user&quot; AS t1</span>
<span class="go">INNER JOIN &quot;auth_user_groups&quot; AS t2 ON (t1.&quot;id&quot; = t2.&quot;user_id&quot;)</span>
<span class="go">INNER JOIN &quot;auth_group&quot; AS t3 ON (t2.&quot;group_id&quot; = t3.&quot;id&quot;)</span>
<span class="go">WHERE (Lower(Substr(t3.&quot;name&quot;, %s, %s)) = %s)</span>
</pre></div>
</div>
</div>
<div class="section" id="djpeewee-api">
<h3>djpeewee API<a class="headerlink" href="#djpeewee-api" title="Permalink to this headline">¶</a></h3>
<dl class="function">
<dt id="translate">
<tt class="descname">translate</tt><big>(</big><em>*models</em>, <em>**options</em><big>)</big><a class="headerlink" href="#translate" title="Permalink to this definition">¶</a></dt>
<dd><p>Translate the given Django models into roughly equivalent peewee models
suitable for use constructing queries. Foreign keys and many-to-many relationships
will be followed and models generated, although back references are not traversed.</p>
<table class="docutils field-list" frame="void" rules="none">
<col class="field-name" />
<col class="field-body" />
<tbody valign="top">
<tr class="field-odd field"><th class="field-name">Parameters:</th><td class="field-body"><ul class="first simple">
<li><strong>models</strong> &#8211; One or more Django model classes.</li>
<li><strong>options</strong> &#8211; A dictionary of options, see note below.</li>
</ul>
</td>
</tr>
<tr class="field-even field"><th class="field-name">Returns:</th><td class="field-body"><p class="first last">A dict-like object containing the generated models, but which supports
dotted-name style lookups.</p>
</td>
</tr>
</tbody>
</table>
<p>The following are valid options:</p>
<ul class="simple">
<li><tt class="docutils literal"><span class="pre">recurse</span></tt>: Follow foreign keys and many to many (default: <tt class="docutils literal"><span class="pre">True</span></tt>).</li>
<li><tt class="docutils literal"><span class="pre">max_depth</span></tt>: Maximum depth to recurse (default: <tt class="docutils literal"><span class="pre">None</span></tt>, unlimited).</li>
<li><tt class="docutils literal"><span class="pre">backrefs</span></tt>: Follow backrefs (default: <tt class="docutils literal"><span class="pre">False</span></tt>).</li>
<li><tt class="docutils literal"><span class="pre">exclude</span></tt>: A list of models to exclude.</li>
</ul>
</dd></dl>

</div>
</div>
<div class="section" id="generic-foreign-keys">
<span id="gfk"></span><h2>Generic foreign keys<a class="headerlink" href="#generic-foreign-keys" title="Permalink to this headline">¶</a></h2>
<p>The <tt class="docutils literal"><span class="pre">gfk</span></tt> module provides a Generic ForeignKey (GFK), similar to Django.  A GFK
is composed of two columns: an object ID and an object type identifier.  The
object types are collected in a global registry (<tt class="docutils literal"><span class="pre">all_models</span></tt>).</p>
<p>How a <a class="reference internal" href="#GFKField" title="GFKField"><tt class="xref py py-class docutils literal"><span class="pre">GFKField</span></tt></a> is resolved:</p>
<ol class="arabic simple">
<li>Look up the object type in the global registry (returns a model class)</li>
<li>Look up the model instance by object ID</li>
</ol>
<div class="admonition note">
<p class="first admonition-title">Note</p>
<p class="last">In order to use Generic ForeignKeys, your application&#8217;s models <em>must</em>
subclass <tt class="docutils literal"><span class="pre">playhouse.gfk.Model</span></tt>.  This ensures that the model class will
be added to the global registry.</p>
</div>
<div class="admonition note">
<p class="first admonition-title">Note</p>
<p class="last">GFKs themselves are not actually a field and will not add a column
to your table.</p>
</div>
<p>Like regular ForeignKeys, GFKs support a &#8220;back-reference&#8221; via the <a class="reference internal" href="#ReverseGFK" title="ReverseGFK"><tt class="xref py py-class docutils literal"><span class="pre">ReverseGFK</span></tt></a>
descriptor.</p>
<div class="section" id="how-to-use-gfks">
<h3>How to use GFKs<a class="headerlink" href="#how-to-use-gfks" title="Permalink to this headline">¶</a></h3>
<ol class="arabic simple">
<li>Be sure your model subclasses <tt class="docutils literal"><span class="pre">playhouse.gfk.Model</span></tt></li>
<li>Add a <a class="reference internal" href="api.html#CharField" title="CharField"><tt class="xref py py-class docutils literal"><span class="pre">CharField</span></tt></a> to store the <tt class="docutils literal"><span class="pre">object_type</span></tt></li>
<li>Add a field to store the <tt class="docutils literal"><span class="pre">object_id</span></tt> (usually a <a class="reference internal" href="api.html#IntegerField" title="IntegerField"><tt class="xref py py-class docutils literal"><span class="pre">IntegerField</span></tt></a>)</li>
<li>Add a <a class="reference internal" href="#GFKField" title="GFKField"><tt class="xref py py-class docutils literal"><span class="pre">GFKField</span></tt></a> and instantiate it with the names of the <tt class="docutils literal"><span class="pre">object_type</span></tt>
and <tt class="docutils literal"><span class="pre">object_id</span></tt> fields.</li>
<li>(optional) On any other models, add a <a class="reference internal" href="#ReverseGFK" title="ReverseGFK"><tt class="xref py py-class docutils literal"><span class="pre">ReverseGFK</span></tt></a> descriptor</li>
</ol>
<p>Example:</p>
<div class="highlight-python"><div class="highlight"><pre><span class="kn">from</span> <span class="nn">playhouse.gfk</span> <span class="kn">import</span> <span class="o">*</span>

<span class="k">class</span> <span class="nc">Tag</span><span class="p">(</span><span class="n">Model</span><span class="p">):</span>
    <span class="n">tag</span> <span class="o">=</span> <span class="n">CharField</span><span class="p">()</span>
    <span class="n">object_type</span> <span class="o">=</span> <span class="n">CharField</span><span class="p">(</span><span class="n">null</span><span class="o">=</span><span class="bp">True</span><span class="p">)</span>
    <span class="n">object_id</span> <span class="o">=</span> <span class="n">IntegerField</span><span class="p">(</span><span class="n">null</span><span class="o">=</span><span class="bp">True</span><span class="p">)</span>
    <span class="nb">object</span> <span class="o">=</span> <span class="n">GFKField</span><span class="p">(</span><span class="s">&#39;object_type&#39;</span><span class="p">,</span> <span class="s">&#39;object_id&#39;</span><span class="p">)</span>

<span class="k">class</span> <span class="nc">Blog</span><span class="p">(</span><span class="n">Model</span><span class="p">):</span>
    <span class="n">tags</span> <span class="o">=</span> <span class="n">ReverseGFK</span><span class="p">(</span><span class="n">Tag</span><span class="p">,</span> <span class="s">&#39;object_type&#39;</span><span class="p">,</span> <span class="s">&#39;object_id&#39;</span><span class="p">)</span>

<span class="k">class</span> <span class="nc">Photo</span><span class="p">(</span><span class="n">Model</span><span class="p">):</span>
    <span class="n">tags</span> <span class="o">=</span> <span class="n">ReverseGFK</span><span class="p">(</span><span class="n">Tag</span><span class="p">,</span> <span class="s">&#39;object_type&#39;</span><span class="p">,</span> <span class="s">&#39;object_id&#39;</span><span class="p">)</span>
</pre></div>
</div>
<p>How you use these is pretty straightforward hopefully:</p>
<div class="highlight-pycon"><div class="highlight"><pre><span class="gp">&gt;&gt;&gt; </span><span class="n">b</span> <span class="o">=</span> <span class="n">Blog</span><span class="o">.</span><span class="n">create</span><span class="p">(</span><span class="n">name</span><span class="o">=</span><span class="s">&#39;awesome post&#39;</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">Tag</span><span class="o">.</span><span class="n">create</span><span class="p">(</span><span class="n">tag</span><span class="o">=</span><span class="s">&#39;awesome&#39;</span><span class="p">,</span> <span class="nb">object</span><span class="o">=</span><span class="n">b</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">b2</span> <span class="o">=</span> <span class="n">Blog</span><span class="o">.</span><span class="n">create</span><span class="p">(</span><span class="n">name</span><span class="o">=</span><span class="s">&#39;whiny post&#39;</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">Tag</span><span class="o">.</span><span class="n">create</span><span class="p">(</span><span class="n">tag</span><span class="o">=</span><span class="s">&#39;whiny&#39;</span><span class="p">,</span> <span class="nb">object</span><span class="o">=</span><span class="n">b2</span><span class="p">)</span>

<span class="gp">&gt;&gt;&gt; </span><span class="n">b</span><span class="o">.</span><span class="n">tags</span> <span class="c"># &lt;-- a select query</span>
<span class="go">&lt;class &#39;__main__.Tag&#39;&gt; SELECT t1.&quot;id&quot;, t1.&quot;tag&quot;, t1.&quot;object_type&quot;, t1.&quot;object_id&quot; FROM &quot;tag&quot; AS t1 WHERE ((t1.&quot;object_type&quot; = ?) AND (t1.&quot;object_id&quot; = ?)) [u&#39;blog&#39;, 1]</span>

<span class="gp">&gt;&gt;&gt; </span><span class="p">[</span><span class="n">x</span><span class="o">.</span><span class="n">tag</span> <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="n">b</span><span class="o">.</span><span class="n">tags</span><span class="p">]</span>
<span class="go">[u&#39;awesome&#39;]</span>

<span class="gp">&gt;&gt;&gt; </span><span class="p">[</span><span class="n">x</span><span class="o">.</span><span class="n">tag</span> <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="n">b2</span><span class="o">.</span><span class="n">tags</span><span class="p">]</span>
<span class="go">[u&#39;whiny&#39;]</span>

<span class="gp">&gt;&gt;&gt; </span><span class="n">p</span> <span class="o">=</span> <span class="n">Photo</span><span class="o">.</span><span class="n">create</span><span class="p">(</span><span class="n">name</span><span class="o">=</span><span class="s">&#39;picture of cat&#39;</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">Tag</span><span class="o">.</span><span class="n">create</span><span class="p">(</span><span class="nb">object</span><span class="o">=</span><span class="n">p</span><span class="p">,</span> <span class="n">tag</span><span class="o">=</span><span class="s">&#39;kitties&#39;</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">Tag</span><span class="o">.</span><span class="n">create</span><span class="p">(</span><span class="nb">object</span><span class="o">=</span><span class="n">p</span><span class="p">,</span> <span class="n">tag</span><span class="o">=</span><span class="s">&#39;cats&#39;</span><span class="p">)</span>

<span class="gp">&gt;&gt;&gt; </span><span class="p">[</span><span class="n">x</span><span class="o">.</span><span class="n">tag</span> <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="n">p</span><span class="o">.</span><span class="n">tags</span><span class="p">]</span>
<span class="go">[u&#39;kitties&#39;, u&#39;cats&#39;]</span>

<span class="gp">&gt;&gt;&gt; </span><span class="p">[</span><span class="n">x</span><span class="o">.</span><span class="n">tag</span> <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="n">Blog</span><span class="o">.</span><span class="n">tags</span><span class="p">]</span>
<span class="go">[u&#39;awesome&#39;, u&#39;whiny&#39;]</span>

<span class="gp">&gt;&gt;&gt; </span><span class="n">t</span> <span class="o">=</span> <span class="n">Tag</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">Tag</span><span class="o">.</span><span class="n">tag</span> <span class="o">==</span> <span class="s">&#39;awesome&#39;</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">t</span><span class="o">.</span><span class="n">object</span>
<span class="go">&lt;__main__.Blog at 0x268f450&gt;</span>

<span class="gp">&gt;&gt;&gt; </span><span class="n">t</span><span class="o">.</span><span class="n">object</span><span class="o">.</span><span class="n">name</span>
<span class="go">u&#39;awesome post&#39;</span>
</pre></div>
</div>
</div>
<div class="section" id="gfk-api">
<h3>GFK API<a class="headerlink" href="#gfk-api" title="Permalink to this headline">¶</a></h3>
<dl class="class">
<dt id="GFKField">
<em class="property">class </em><tt class="descname">GFKField</tt><big>(</big><span class="optional">[</span><em>model_type_field='object_type'</em><span class="optional">[</span>, <em>model_id_field='object_id'</em><span class="optional">]</span><span class="optional">]</span><big>)</big><a class="headerlink" href="#GFKField" title="Permalink to this definition">¶</a></dt>
<dd><p>Provide a clean API for storing &#8220;generic&#8221; foreign keys.  Generic foreign keys
are comprised of an object type, which maps to a model class, and an object id,
which maps to the primary key of the related model class.</p>
<p>Setting the GFKField on a model will automatically populate the <tt class="docutils literal"><span class="pre">model_type_field</span></tt>
and <tt class="docutils literal"><span class="pre">model_id_field</span></tt>.  Similarly, getting the GFKField on a model instance
will &#8220;resolve&#8221; the two fields, first looking up the model class, then looking
up the instance by ID.</p>
</dd></dl>

<dl class="class">
<dt id="ReverseGFK">
<em class="property">class </em><tt class="descname">ReverseGFK</tt><big>(</big><em>model</em><span class="optional">[</span>, <em>model_type_field='object_type'</em><span class="optional">[</span>, <em>model_id_field='object_id'</em><span class="optional">]</span><span class="optional">]</span><big>)</big><a class="headerlink" href="#ReverseGFK" title="Permalink to this definition">¶</a></dt>
<dd><p>Back-reference support for <a class="reference internal" href="#GFKField" title="GFKField"><tt class="xref py py-class docutils literal"><span class="pre">GFKField</span></tt></a>.</p>
</dd></dl>

</div>
</div>
<div class="section" id="key-value-store">
<span id="kv"></span><h2>Key/Value Store<a class="headerlink" href="#key-value-store" title="Permalink to this headline">¶</a></h2>
<p>Provides a simple key/value store, using a dictionary API.  By default the
the <a class="reference internal" href="#KeyStore" title="KeyStore"><tt class="xref py py-class docutils literal"><span class="pre">KeyStore</span></tt></a> will use an in-memory sqlite database, but any database
will work.</p>
<p>To start using the key-store, create an instance and pass it a field to use
for the values.</p>
<div class="highlight-python"><div class="highlight"><pre><span class="gp">&gt;&gt;&gt; </span><span class="n">kv</span> <span class="o">=</span> <span class="n">KeyStore</span><span class="p">(</span><span class="n">TextField</span><span class="p">())</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">kv</span><span class="p">[</span><span class="s">&#39;a&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="s">&#39;A&#39;</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">kv</span><span class="p">[</span><span class="s">&#39;a&#39;</span><span class="p">]</span>
<span class="go">&#39;A&#39;</span>
</pre></div>
</div>
<div class="admonition note">
<p class="first admonition-title">Note</p>
<p class="last">To store arbitrary python objects, use the <a class="reference internal" href="#PickledKeyStore" title="PickledKeyStore"><tt class="xref py py-class docutils literal"><span class="pre">PickledKeyStore</span></tt></a>, which
stores values in a pickled <tt class="xref py py-class docutils literal"><span class="pre">BlobField</span></tt>.</p>
</div>
<p>Using the <a class="reference internal" href="#KeyStore" title="KeyStore"><tt class="xref py py-class docutils literal"><span class="pre">KeyStore</span></tt></a> it is possible to use &#8220;expressions&#8221; to retrieve
values from the dictionary.  For instance, imagine you want to get all keys
which contain a certain substring:</p>
<div class="highlight-python"><div class="highlight"><pre><span class="gp">&gt;&gt;&gt; </span><span class="n">keys_matching_substr</span> <span class="o">=</span> <span class="n">kv</span><span class="p">[</span><span class="n">kv</span><span class="o">.</span><span class="n">key</span> <span class="o">%</span> <span class="s">&#39;</span><span class="si">%s</span><span class="s">ubstr%&#39;</span><span class="p">]</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">keys_start_with_a</span> <span class="o">=</span> <span class="n">kv</span><span class="p">[</span><span class="n">fn</span><span class="o">.</span><span class="n">Lower</span><span class="p">(</span><span class="n">fn</span><span class="o">.</span><span class="n">Substr</span><span class="p">(</span><span class="n">kv</span><span class="o">.</span><span class="n">key</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">))</span> <span class="o">==</span> <span class="s">&#39;a&#39;</span><span class="p">]</span>
</pre></div>
</div>
<div class="section" id="keystore-api">
<h3>KeyStore API<a class="headerlink" href="#keystore-api" title="Permalink to this headline">¶</a></h3>
<dl class="class">
<dt id="KeyStore">
<em class="property">class </em><tt class="descname">KeyStore</tt><big>(</big><em>value_field</em><span class="optional">[</span>, <em>ordered=False</em><span class="optional">[</span>, <em>database=None</em><span class="optional">]</span><span class="optional">]</span><big>)</big><a class="headerlink" href="#KeyStore" title="Permalink to this definition">¶</a></dt>
<dd><p>Lightweight dictionary interface to a model containing a key and value.
Implements common dictionary methods, such as <tt class="docutils literal"><span class="pre">__getitem__</span></tt>, <tt class="docutils literal"><span class="pre">__setitem__</span></tt>,
<tt class="docutils literal"><span class="pre">get</span></tt>, <tt class="docutils literal"><span class="pre">pop</span></tt>, <tt class="docutils literal"><span class="pre">items</span></tt>, <tt class="docutils literal"><span class="pre">keys</span></tt>, and <tt class="docutils literal"><span class="pre">values</span></tt>.</p>
<table class="docutils field-list" frame="void" rules="none">
<col class="field-name" />
<col class="field-body" />
<tbody valign="top">
<tr class="field-odd field"><th class="field-name">Parameters:</th><td class="field-body"><ul class="first last simple">
<li><strong>value_field</strong> (<a class="reference internal" href="api.html#Field" title="Field"><em>Field</em></a>) &#8211; Field instance to use as value field, e.g. an
instance of <a class="reference internal" href="api.html#TextField" title="TextField"><tt class="xref py py-class docutils literal"><span class="pre">TextField</span></tt></a>.</li>
<li><strong>ordered</strong> (<em>boolean</em>) &#8211; Whether the keys should be returned in sorted order</li>
<li><strong>database</strong> (<a class="reference internal" href="api.html#Database" title="Database"><em>Database</em></a>) &#8211; <a class="reference internal" href="api.html#Database" title="Database"><tt class="xref py py-class docutils literal"><span class="pre">Database</span></tt></a> class to use for the storage
backend.  If none is supplied, an in-memory Sqlite DB will be used.</li>
</ul>
</td>
</tr>
</tbody>
</table>
<p>Example:</p>
<div class="highlight-pycon"><div class="highlight"><pre><span class="gp">&gt;&gt;&gt; </span><span class="kn">from</span> <span class="nn">playhouse.kv</span> <span class="kn">import</span> <span class="n">KeyStore</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">kv</span> <span class="o">=</span> <span class="n">KeyStore</span><span class="p">(</span><span class="n">TextField</span><span class="p">())</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">kv</span><span class="p">[</span><span class="s">&#39;a&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="s">&#39;foo&#39;</span>
<span class="gp">&gt;&gt;&gt; </span><span class="k">for</span> <span class="n">k</span><span class="p">,</span> <span class="n">v</span> <span class="ow">in</span> <span class="n">kv</span><span class="p">:</span>
<span class="gp">... </span>    <span class="k">print</span> <span class="n">k</span><span class="p">,</span> <span class="n">v</span>
<span class="go">a foo</span>

<span class="gp">&gt;&gt;&gt; </span><span class="s">&#39;a&#39;</span> <span class="ow">in</span> <span class="n">kv</span>
<span class="go">True</span>
<span class="gp">&gt;&gt;&gt; </span><span class="s">&#39;b&#39;</span> <span class="ow">in</span> <span class="n">kv</span>
<span class="go">False</span>
</pre></div>
</div>
</dd></dl>

<dl class="class">
<dt id="PickledKeyStore">
<em class="property">class </em><tt class="descname">PickledKeyStore</tt><big>(</big><span class="optional">[</span><em>ordered=False</em><span class="optional">[</span>, <em>database=None</em><span class="optional">]</span><span class="optional">]</span><big>)</big><a class="headerlink" href="#PickledKeyStore" title="Permalink to this definition">¶</a></dt>
<dd><p>Identical to the <a class="reference internal" href="#KeyStore" title="KeyStore"><tt class="xref py py-class docutils literal"><span class="pre">KeyStore</span></tt></a> except <em>anything</em> can be stored as
a value in the dictionary.  The storage for the value will be a pickled
<tt class="xref py py-class docutils literal"><span class="pre">BlobField</span></tt>.</p>
<p>Example:</p>
<div class="highlight-pycon"><div class="highlight"><pre><span class="gp">&gt;&gt;&gt; </span><span class="kn">from</span> <span class="nn">playhouse.kv</span> <span class="kn">import</span> <span class="n">PickledKeyStore</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">pkv</span> <span class="o">=</span> <span class="n">PickledKeyStore</span><span class="p">()</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">pkv</span><span class="p">[</span><span class="s">&#39;a&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="s">&#39;A&#39;</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">pkv</span><span class="p">[</span><span class="s">&#39;b&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="mf">1.0</span>
<span class="gp">&gt;&gt;&gt; </span><span class="nb">list</span><span class="p">(</span><span class="n">pkv</span><span class="o">.</span><span class="n">items</span><span class="p">())</span>
<span class="go">[(u&#39;a&#39;, &#39;A&#39;), (u&#39;b&#39;, 1.0)]</span>
</pre></div>
</div>
</dd></dl>

</div>
</div>
<div class="section" id="shortcuts">
<span id="id2"></span><h2>Shortcuts<a class="headerlink" href="#shortcuts" title="Permalink to this headline">¶</a></h2>
<p>This module contains helper functions for expressing things that would otherwise
be somewhat verbose or cumbersome using peewee&#8217;s APIs.</p>
<dl class="function">
<dt id="case">
<tt class="descname">case</tt><big>(</big><em>predicate</em>, <em>expression_tuples</em>, <em>default=None</em><big>)</big><a class="headerlink" href="#case" title="Permalink to this definition">¶</a></dt>
<dd><table class="docutils field-list" frame="void" rules="none">
<col class="field-name" />
<col class="field-body" />
<tbody valign="top">
<tr class="field-odd field"><th class="field-name">Parameters:</th><td class="field-body"><ul class="first last simple">
<li><strong>predicate</strong> &#8211; A SQL expression or can be <tt class="docutils literal"><span class="pre">None</span></tt>.</li>
<li><strong>expression_tuples</strong> &#8211; An iterable containing one or more 2-tuples
comprised of an expression and return value.</li>
<li><strong>default</strong> &#8211; default if none of the cases match.</li>
</ul>
</td>
</tr>
</tbody>
</table>
<p>Example SQL case statements:</p>
<div class="highlight-sql"><div class="highlight"><pre><span class="c1">-- case with predicate --</span>
<span class="k">SELECT</span> <span class="ss">&quot;username&quot;</span><span class="p">,</span>
  <span class="k">CASE</span> <span class="ss">&quot;user_id&quot;</span>
    <span class="k">WHEN</span> <span class="mi">1</span> <span class="k">THEN</span> <span class="ss">&quot;one&quot;</span>
    <span class="k">WHEN</span> <span class="mi">2</span> <span class="k">THEN</span> <span class="ss">&quot;two&quot;</span>
    <span class="k">ELSE</span> <span class="ss">&quot;?&quot;</span>
  <span class="k">END</span>
<span class="k">FROM</span> <span class="ss">&quot;users&quot;</span><span class="p">;</span>

<span class="c1">-- case with no predicate (inline expressions) --</span>
<span class="k">SELECT</span> <span class="ss">&quot;username&quot;</span><span class="p">,</span>
  <span class="k">CASE</span>
    <span class="k">WHEN</span> <span class="ss">&quot;user_id&quot;</span> <span class="o">=</span> <span class="mi">1</span> <span class="k">THEN</span> <span class="ss">&quot;one&quot;</span>
    <span class="k">WHEN</span> <span class="ss">&quot;user_id&quot;</span> <span class="o">=</span> <span class="mi">2</span> <span class="k">THEN</span> <span class="ss">&quot;two&quot;</span>
    <span class="k">ELSE</span> <span class="ss">&quot;?&quot;</span>
  <span class="k">END</span>
<span class="k">FROM</span> <span class="ss">&quot;users&quot;</span><span class="p">;</span>
</pre></div>
</div>
<p>Equivalent function invocations:</p>
<div class="highlight-python"><div class="highlight"><pre><span class="n">User</span><span class="o">.</span><span class="n">select</span><span class="p">(</span><span class="n">User</span><span class="o">.</span><span class="n">username</span><span class="p">,</span> <span class="n">case</span><span class="p">(</span><span class="n">User</span><span class="o">.</span><span class="n">user_id</span><span class="p">,</span> <span class="p">(</span>
  <span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="s">&quot;one&quot;</span><span class="p">),</span>
  <span class="p">(</span><span class="mi">2</span><span class="p">,</span> <span class="s">&quot;two&quot;</span><span class="p">)),</span> <span class="s">&quot;?&quot;</span><span class="p">))</span>

<span class="n">User</span><span class="o">.</span><span class="n">select</span><span class="p">(</span><span class="n">User</span><span class="o">.</span><span class="n">username</span><span class="p">,</span> <span class="n">case</span><span class="p">(</span><span class="bp">None</span><span class="p">,</span> <span class="p">(</span>
  <span class="p">(</span><span class="n">User</span><span class="o">.</span><span class="n">user_id</span> <span class="o">==</span> <span class="mi">1</span><span class="p">,</span> <span class="s">&quot;one&quot;</span><span class="p">),</span>  <span class="c"># note the double equals</span>
  <span class="p">(</span><span class="n">User</span><span class="o">.</span><span class="n">user_id</span> <span class="o">==</span> <span class="mi">2</span><span class="p">,</span> <span class="s">&quot;two&quot;</span><span class="p">)),</span> <span class="s">&quot;?&quot;</span><span class="p">))</span>
</pre></div>
</div>
<p>You can specify a value for the CASE expression using the <tt class="docutils literal"><span class="pre">alias()</span></tt>
method:</p>
<div class="highlight-python"><div class="highlight"><pre><span class="n">User</span><span class="o">.</span><span class="n">select</span><span class="p">(</span><span class="n">User</span><span class="o">.</span><span class="n">username</span><span class="p">,</span> <span class="n">case</span><span class="p">(</span><span class="n">User</span><span class="o">.</span><span class="n">user_id</span><span class="p">,</span> <span class="p">(</span>
  <span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="s">&quot;one&quot;</span><span class="p">),</span>
  <span class="p">(</span><span class="mi">2</span><span class="p">,</span> <span class="s">&quot;two&quot;</span><span class="p">)),</span> <span class="s">&quot;?&quot;</span><span class="p">)</span><span class="o">.</span><span class="n">alias</span><span class="p">(</span><span class="s">&quot;id_string&quot;</span><span class="p">))</span>
</pre></div>
</div>
</dd></dl>

</div>
<div class="section" id="signal-support">
<span id="signals"></span><h2>Signal support<a class="headerlink" href="#signal-support" title="Permalink to this headline">¶</a></h2>
<p>Models with hooks for signals (a-la django) are provided in <tt class="docutils literal"><span class="pre">playhouse.signals</span></tt>.
To use the signals, you will need all of your project&#8217;s models to be a subclass
of <tt class="docutils literal"><span class="pre">playhouse.signals.Model</span></tt>, which overrides the necessary methods to provide
support for the various signals.</p>
<div class="highlight-python"><div class="highlight"><pre><span class="kn">from</span> <span class="nn">playhouse.signals</span> <span class="kn">import</span> <span class="n">Model</span><span class="p">,</span> <span class="n">post_save</span>


<span class="k">class</span> <span class="nc">MyModel</span><span class="p">(</span><span class="n">Model</span><span class="p">):</span>
    <span class="n">data</span> <span class="o">=</span> <span class="n">IntegerField</span><span class="p">()</span>

<span class="nd">@post_save</span><span class="p">(</span><span class="n">sender</span><span class="o">=</span><span class="n">MyModel</span><span class="p">)</span>
<span class="k">def</span> <span class="nf">on_save_handler</span><span class="p">(</span><span class="n">model_class</span><span class="p">,</span> <span class="n">instance</span><span class="p">,</span> <span class="n">created</span><span class="p">):</span>
    <span class="n">put_data_in_cache</span><span class="p">(</span><span class="n">instance</span><span class="o">.</span><span class="n">data</span><span class="p">)</span>
</pre></div>
</div>
<p>The following signals are provided:</p>
<dl class="docutils">
<dt><tt class="docutils literal"><span class="pre">pre_save</span></tt></dt>
<dd>Called immediately before an object is saved to the database.  Provides an
additional keyword argument <tt class="docutils literal"><span class="pre">created</span></tt>, indicating whether the model is being
saved for the first time or updated.</dd>
<dt><tt class="docutils literal"><span class="pre">post_save</span></tt></dt>
<dd>Called immediately after an object is saved to the database.  Provides an
additional keyword argument <tt class="docutils literal"><span class="pre">created</span></tt>, indicating whether the model is being
saved for the first time or updated.</dd>
<dt><tt class="docutils literal"><span class="pre">pre_delete</span></tt></dt>
<dd>Called immediately before an object is deleted from the database when <a class="reference internal" href="api.html#Model.delete_instance" title="Model.delete_instance"><tt class="xref py py-meth docutils literal"><span class="pre">Model.delete_instance()</span></tt></a>
is used.</dd>
<dt><tt class="docutils literal"><span class="pre">post_delete</span></tt></dt>
<dd>Called immediately after an object is deleted from the database when <a class="reference internal" href="api.html#Model.delete_instance" title="Model.delete_instance"><tt class="xref py py-meth docutils literal"><span class="pre">Model.delete_instance()</span></tt></a>
is used.</dd>
<dt><tt class="docutils literal"><span class="pre">pre_init</span></tt></dt>
<dd>Called when a model class is first instantiated</dd>
<dt><tt class="docutils literal"><span class="pre">post_init</span></tt></dt>
<dd>Called after a model class has been instantiated and the fields have been populated,
for example when being selected as part of a database query.</dd>
</dl>
<div class="section" id="connecting-handlers">
<h3>Connecting handlers<a class="headerlink" href="#connecting-handlers" title="Permalink to this headline">¶</a></h3>
<p>Whenever a signal is dispatched, it will call any handlers that have been registered.
This allows totally separate code to respond to events like model save and delete.</p>
<p>The <a class="reference internal" href="#Signal" title="Signal"><tt class="xref py py-class docutils literal"><span class="pre">Signal</span></tt></a> class provides a <a class="reference internal" href="#Signal.connect" title="Signal.connect"><tt class="xref py py-meth docutils literal"><span class="pre">connect()</span></tt></a> method, which takes
a callback function and two optional parameters for &#8220;sender&#8221; and &#8220;name&#8221;.  If specified,
the &#8220;sender&#8221; parameter should be a single model class and allows your callback to only
receive signals from that one model class.  The &#8220;name&#8221; parameter is used as a convenient alias
in the event you wish to unregister your signal handler.</p>
<p>Example usage:</p>
<div class="highlight-python"><div class="highlight"><pre><span class="kn">from</span> <span class="nn">playhouse.signals</span> <span class="kn">import</span> <span class="o">*</span>

<span class="k">def</span> <span class="nf">post_save_handler</span><span class="p">(</span><span class="n">sender</span><span class="p">,</span> <span class="n">instance</span><span class="p">,</span> <span class="n">created</span><span class="p">):</span>
    <span class="k">print</span> <span class="s">&#39;</span><span class="si">%s</span><span class="s"> was just saved&#39;</span> <span class="o">%</span> <span class="n">instance</span>

<span class="c"># our handler will only be called when we save instances of SomeModel</span>
<span class="n">post_save</span><span class="o">.</span><span class="n">connect</span><span class="p">(</span><span class="n">post_save_handler</span><span class="p">,</span> <span class="n">sender</span><span class="o">=</span><span class="n">SomeModel</span><span class="p">)</span>
</pre></div>
</div>
<p>All signal handlers accept as their first two arguments <tt class="docutils literal"><span class="pre">sender</span></tt> and <tt class="docutils literal"><span class="pre">instance</span></tt>,
where <tt class="docutils literal"><span class="pre">sender</span></tt> is the model class and <tt class="docutils literal"><span class="pre">instance</span></tt> is the actual model being acted
upon.</p>
<p>If you&#8217;d like, you can also use a decorator to connect signal handlers.  This is
functionally equivalent to the above example:</p>
<div class="highlight-python"><div class="highlight"><pre><span class="nd">@post_save</span><span class="p">(</span><span class="n">sender</span><span class="o">=</span><span class="n">SomeModel</span><span class="p">)</span>
<span class="k">def</span> <span class="nf">post_save_handler</span><span class="p">(</span><span class="n">sender</span><span class="p">,</span> <span class="n">instance</span><span class="p">,</span> <span class="n">created</span><span class="p">):</span>
    <span class="k">print</span> <span class="s">&#39;</span><span class="si">%s</span><span class="s"> was just saved&#39;</span> <span class="o">%</span> <span class="n">instance</span>
</pre></div>
</div>
</div>
<div class="section" id="signal-api">
<h3>Signal API<a class="headerlink" href="#signal-api" title="Permalink to this headline">¶</a></h3>
<dl class="class">
<dt id="Signal">
<em class="property">class </em><tt class="descname">Signal</tt><a class="headerlink" href="#Signal" title="Permalink to this definition">¶</a></dt>
<dd><p>Stores a list of receivers (callbacks) and calls them when the &#8220;send&#8221; method is invoked.</p>
<dl class="method">
<dt id="Signal.connect">
<tt class="descname">connect</tt><big>(</big><em>receiver</em><span class="optional">[</span>, <em>sender=None</em><span class="optional">[</span>, <em>name=None</em><span class="optional">]</span><span class="optional">]</span><big>)</big><a class="headerlink" href="#Signal.connect" title="Permalink to this definition">¶</a></dt>
<dd><p>Add the receiver to the internal list of receivers, which will be called
whenever the signal is sent.</p>
<table class="docutils field-list" frame="void" rules="none">
<col class="field-name" />
<col class="field-body" />
<tbody valign="top">
<tr class="field-odd field"><th class="field-name">Parameters:</th><td class="field-body"><ul class="first last simple">
<li><strong>receiver</strong> (<em>callable</em>) &#8211; a callable that takes at least two parameters,
a &#8220;sender&#8221;, which is the Model subclass that triggered the signal, and
an &#8220;instance&#8221;, which is the actual model instance.</li>
<li><strong>sender</strong> (<a class="reference internal" href="api.html#Model" title="Model"><em>Model</em></a>) &#8211; if specified, only instances of this model class will
trigger the receiver callback.</li>
<li><strong>name</strong> (<em>string</em>) &#8211; a short alias</li>
</ul>
</td>
</tr>
</tbody>
</table>
<div class="highlight-python"><div class="highlight"><pre><span class="kn">from</span> <span class="nn">playhouse.signals</span> <span class="kn">import</span> <span class="n">post_save</span>
<span class="kn">from</span> <span class="nn">project.handlers</span> <span class="kn">import</span> <span class="n">cache_buster</span>

<span class="n">post_save</span><span class="o">.</span><span class="n">connect</span><span class="p">(</span><span class="n">cache_buster</span><span class="p">,</span> <span class="n">name</span><span class="o">=</span><span class="s">&#39;project.cache_buster&#39;</span><span class="p">)</span>
</pre></div>
</div>
</dd></dl>

<dl class="method">
<dt id="Signal.disconnect">
<tt class="descname">disconnect</tt><big>(</big><span class="optional">[</span><em>receiver=None</em><span class="optional">[</span>, <em>name=None</em><span class="optional">]</span><span class="optional">]</span><big>)</big><a class="headerlink" href="#Signal.disconnect" title="Permalink to this definition">¶</a></dt>
<dd><p>Disconnect the given receiver (or the receiver with the given name alias)
so that it no longer is called.  Either the receiver or the name must be
provided.</p>
<table class="docutils field-list" frame="void" rules="none">
<col class="field-name" />
<col class="field-body" />
<tbody valign="top">
<tr class="field-odd field"><th class="field-name">Parameters:</th><td class="field-body"><ul class="first last simple">
<li><strong>receiver</strong> (<em>callable</em>) &#8211; the callback to disconnect</li>
<li><strong>name</strong> (<em>string</em>) &#8211; a short alias</li>
</ul>
</td>
</tr>
</tbody>
</table>
<div class="highlight-python"><div class="highlight"><pre><span class="n">post_save</span><span class="o">.</span><span class="n">disconnect</span><span class="p">(</span><span class="n">name</span><span class="o">=</span><span class="s">&#39;project.cache_buster&#39;</span><span class="p">)</span>
</pre></div>
</div>
</dd></dl>

<dl class="method">
<dt id="Signal.send">
<tt class="descname">send</tt><big>(</big><em>instance</em>, <em>*args</em>, <em>**kwargs</em><big>)</big><a class="headerlink" href="#Signal.send" title="Permalink to this definition">¶</a></dt>
<dd><p>Iterates over the receivers and will call them in the order in which
they were connected.  If the receiver specified a sender, it will only
be called if the instance is an instance of the sender.</p>
<table class="docutils field-list" frame="void" rules="none">
<col class="field-name" />
<col class="field-body" />
<tbody valign="top">
<tr class="field-odd field"><th class="field-name">Parameters:</th><td class="field-body"><strong>instance</strong> &#8211; a model instance</td>
</tr>
</tbody>
</table>
</dd></dl>

</dd></dl>

</div>
</div>
<div class="section" id="pwiz-a-model-generator">
<span id="pwiz"></span><h2>pwiz, a model generator<a class="headerlink" href="#pwiz-a-model-generator" title="Permalink to this headline">¶</a></h2>
<p><tt class="docutils literal"><span class="pre">pwiz</span></tt> is a little script that ships with peewee and is capable of introspecting
an existing database and generating model code suitable for interacting with the
underlying data.  If you have a database already, pwiz can give you a nice boost
by generating skeleton code with correct column affinities and foreign keys.</p>
<p>If you install peewee using <tt class="docutils literal"><span class="pre">setup.py</span> <span class="pre">install</span></tt>, pwiz will be installed as a &#8220;script&#8221;
and you can just run:</p>
<div class="highlight-console"><div class="highlight"><pre><span class="go">pwiz.py -e postgresql -u postgres my_postgres_db</span>
</pre></div>
</div>
<p>This will print a bunch of models to standard output.  So you can do this:</p>
<div class="highlight-console"><div class="highlight"><pre><span class="go">pwiz.py -e postgresql my_postgres_db &gt; mymodels.py</span>
<span class="go">python # &lt;-- fire up an interactive shell</span>
</pre></div>
</div>
<div class="highlight-pycon"><div class="highlight"><pre><span class="gp">&gt;&gt;&gt; </span><span class="kn">from</span> <span class="nn">mymodels</span> <span class="kn">import</span> <span class="n">Blog</span><span class="p">,</span> <span class="n">Entry</span><span class="p">,</span> <span class="n">Tag</span><span class="p">,</span> <span class="n">Whatever</span>
<span class="gp">&gt;&gt;&gt; </span><span class="k">print</span> <span class="p">[</span><span class="n">blog</span><span class="o">.</span><span class="n">name</span> <span class="k">for</span> <span class="n">blog</span> <span class="ow">in</span> <span class="n">Blog</span><span class="o">.</span><span class="n">select</span><span class="p">()]</span>
</pre></div>
</div>
<table border="1" class="docutils">
<colgroup>
<col width="8%" />
<col width="33%" />
<col width="59%" />
</colgroup>
<thead valign="bottom">
<tr class="row-odd"><th class="head">Option</th>
<th class="head">Meaning</th>
<th class="head">Example</th>
</tr>
</thead>
<tbody valign="top">
<tr class="row-even"><td>-h</td>
<td>show help</td>
<td>&nbsp;</td>
</tr>
<tr class="row-odd"><td>-e</td>
<td>database backend</td>
<td>-e mysql</td>
</tr>
<tr class="row-even"><td>-H</td>
<td>host to connect to</td>
<td>-H remote.db.server</td>
</tr>
<tr class="row-odd"><td>-p</td>
<td>port to connect on</td>
<td>-p 9001</td>
</tr>
<tr class="row-even"><td>-u</td>
<td>database user</td>
<td>-u postgres</td>
</tr>
<tr class="row-odd"><td>-P</td>
<td>database password</td>
<td>-P secret</td>
</tr>
<tr class="row-even"><td>-s</td>
<td>postgres schema</td>
<td>-s public</td>
</tr>
</tbody>
</table>
<p>The following are valid parameters for the engine:</p>
<ul class="simple">
<li>sqlite</li>
<li>mysql</li>
<li>postgresql</li>
</ul>
</div>
<div class="section" id="basic-schema-migrations">
<span id="migrate"></span><h2>Basic Schema Migrations<a class="headerlink" href="#basic-schema-migrations" title="Permalink to this headline">¶</a></h2>
<div class="admonition note">
<p class="first admonition-title">Note</p>
<p class="last">This module is still pretty experimental, but it provides a light
API for doing schema migrations with postgresql.</p>
</div>
<p>Instantiate a migrator:</p>
<div class="highlight-python"><div class="highlight"><pre><span class="n">my_db</span> <span class="o">=</span> <span class="n">PostgresqlDatabase</span><span class="p">(</span><span class="o">...</span><span class="p">)</span>
<span class="n">migrator</span> <span class="o">=</span> <span class="n">Migrator</span><span class="p">(</span><span class="n">my_db</span><span class="p">)</span>
</pre></div>
</div>
<p>Adding a field to a model:</p>
<div class="highlight-python"><div class="highlight"><pre><span class="c"># declare a field instance</span>
<span class="n">new_pubdate_field</span> <span class="o">=</span> <span class="n">DateTimeField</span><span class="p">(</span><span class="n">null</span><span class="o">=</span><span class="bp">True</span><span class="p">)</span>

<span class="c"># in a transaction, add the column to your model</span>
<span class="k">with</span> <span class="n">my_db</span><span class="o">.</span><span class="n">transaction</span><span class="p">():</span>
    <span class="n">migrator</span><span class="o">.</span><span class="n">add_column</span><span class="p">(</span><span class="n">Story</span><span class="p">,</span> <span class="n">new_pubdate_field</span><span class="p">,</span> <span class="s">&#39;pub_date&#39;</span><span class="p">)</span>
</pre></div>
</div>
<p>Renaming a field:</p>
<div class="highlight-python"><div class="highlight"><pre><span class="c"># specify the original name of the field and its new name</span>
<span class="k">with</span> <span class="n">my_db</span><span class="o">.</span><span class="n">transaction</span><span class="p">():</span>
    <span class="n">migrator</span><span class="o">.</span><span class="n">rename_column</span><span class="p">(</span><span class="n">Story</span><span class="p">,</span> <span class="s">&#39;pub_date&#39;</span><span class="p">,</span> <span class="s">&#39;publish_date&#39;</span><span class="p">)</span>
</pre></div>
</div>
<p>Dropping a field:</p>
<div class="highlight-python"><div class="highlight"><pre><span class="c"># specify the field name to drop</span>
<span class="k">with</span> <span class="n">my_db</span><span class="o">.</span><span class="n">transaction</span><span class="p">():</span>
    <span class="n">migrator</span><span class="o">.</span><span class="n">drop_column</span><span class="p">(</span><span class="n">Story</span><span class="p">,</span> <span class="s">&#39;some_old_field&#39;</span><span class="p">)</span>
</pre></div>
</div>
<p>Setting nullable / not nullable</p>
<div class="highlight-python"><div class="highlight"><pre><span class="k">with</span> <span class="n">my_db</span><span class="o">.</span><span class="n">transaction</span><span class="p">():</span>
    <span class="c"># make pubdate not nullable</span>
    <span class="n">migrator</span><span class="o">.</span><span class="n">set_nullable</span><span class="p">(</span><span class="n">Story</span><span class="p">,</span> <span class="n">Story</span><span class="o">.</span><span class="n">pub_date</span><span class="p">,</span> <span class="bp">False</span><span class="p">)</span>
</pre></div>
</div>
<p>Renaming a table</p>
<div class="highlight-python"><div class="highlight"><pre><span class="k">with</span> <span class="n">my_db</span><span class="o">.</span><span class="n">transaction</span><span class="p">():</span>
    <span class="n">migrator</span><span class="o">.</span><span class="n">rename_table</span><span class="p">(</span><span class="n">Story</span><span class="p">,</span> <span class="s">&#39;stories&#39;</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="section" id="csv-loader">
<span id="id3"></span><h2>CSV Loader<a class="headerlink" href="#csv-loader" title="Permalink to this headline">¶</a></h2>
<p>This module contains helpers for loading CSV data into a database.  CSV files can
be introspected to generate an appropriate model class for working with the data.
This makes it really easy to explore the data in a CSV file using Peewee and SQL.</p>
<p>Here is how you would load a CSV file into an in-memory SQLite database.  The
call to <a class="reference internal" href="#load_csv" title="load_csv"><tt class="xref py py-func docutils literal"><span class="pre">load_csv()</span></tt></a> returns a <a class="reference internal" href="api.html#Model" title="Model"><tt class="xref py py-class docutils literal"><span class="pre">Model</span></tt></a> instance suitable for
working with the CSV data:</p>
<div class="highlight-python"><div class="highlight"><pre><span class="kn">from</span> <span class="nn">peewee</span> <span class="kn">import</span> <span class="o">*</span>
<span class="kn">from</span> <span class="nn">playhouse.csv_loader</span> <span class="kn">import</span> <span class="n">load_csv</span>
<span class="n">db</span> <span class="o">=</span> <span class="n">SqliteDatabase</span><span class="p">(</span><span class="s">&#39;:memory:&#39;</span><span class="p">)</span>
<span class="n">ZipToTZ</span> <span class="o">=</span> <span class="n">load_csv</span><span class="p">(</span><span class="n">db</span><span class="p">,</span> <span class="s">&#39;zip_to_tz.csv&#39;</span><span class="p">)</span>
</pre></div>
</div>
<p>Now we can run queries using the new model.</p>
<div class="highlight-pycon"><div class="highlight"><pre><span class="go"># Get the timezone for a zipcode.</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">ZipToTZ</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">ZipToTZ</span><span class="o">.</span><span class="n">zip</span> <span class="o">==</span> <span class="mi">66047</span><span class="p">)</span><span class="o">.</span><span class="n">timezone</span>
<span class="go">&#39;US/Central&#39;</span>

<span class="go"># Get all the zipcodes for my town.</span>
<span class="gp">&gt;&gt;&gt; </span><span class="p">[</span><span class="n">row</span><span class="o">.</span><span class="n">zip</span> <span class="k">for</span> <span class="n">row</span> <span class="ow">in</span> <span class="n">ZipToTZ</span><span class="o">.</span><span class="n">select</span><span class="p">()</span><span class="o">.</span><span class="n">where</span><span class="p">(</span>
<span class="gp">... </span>    <span class="p">(</span><span class="n">ZipToTZ</span><span class="o">.</span><span class="n">city</span> <span class="o">==</span> <span class="s">&#39;Lawrence&#39;</span><span class="p">)</span> <span class="o">&amp;&amp;</span> <span class="p">(</span><span class="n">ZipToTZ</span><span class="o">.</span><span class="n">state</span> <span class="o">==</span> <span class="s">&#39;KS&#39;</span><span class="p">))]</span>
<span class="go">[66044, 66045, 66046, 66047, 66049]</span>
</pre></div>
</div>
<p>For more information and examples check out this <a class="reference external" href="http://charlesleifer.com/blog/using-peewee-to-explore-csv-files/">blog post</a>.</p>
<div class="section" id="csv-loader-api">
<h3>CSV Loader API<a class="headerlink" href="#csv-loader-api" title="Permalink to this headline">¶</a></h3>
<dl class="function">
<dt id="load_csv">
<tt class="descname">load_csv</tt><big>(</big><em>db_or_model</em>, <em>filename</em><span class="optional">[</span>, <em>fields=None</em><span class="optional">[</span>, <em>field_names=None</em><span class="optional">[</span>, <em>has_header=True</em><span class="optional">[</span>, <em>sample_size=10</em><span class="optional">[</span>, <em>converter=None</em><span class="optional">[</span>, <em>db_table=None</em><span class="optional">[</span>, <em>**reader_kwargs</em><span class="optional">]</span><span class="optional">]</span><span class="optional">]</span><span class="optional">]</span><span class="optional">]</span><span class="optional">]</span><span class="optional">]</span><big>)</big><a class="headerlink" href="#load_csv" title="Permalink to this definition">¶</a></dt>
<dd><p>Load a CSV file into the provided database or model class, returning a
<a class="reference internal" href="api.html#Model" title="Model"><tt class="xref py py-class docutils literal"><span class="pre">Model</span></tt></a> suitable for working with the CSV data.</p>
<table class="docutils field-list" frame="void" rules="none">
<col class="field-name" />
<col class="field-body" />
<tbody valign="top">
<tr class="field-odd field"><th class="field-name">Parameters:</th><td class="field-body"><ul class="first simple">
<li><strong>db_or_model</strong> &#8211; Either a <a class="reference internal" href="api.html#Database" title="Database"><tt class="xref py py-class docutils literal"><span class="pre">Database</span></tt></a> instance or a <a class="reference internal" href="api.html#Model" title="Model"><tt class="xref py py-class docutils literal"><span class="pre">Model</span></tt></a> class.  If a model is not provided, one will be automatically generated for you.</li>
<li><strong>filename</strong> (<em>str</em>) &#8211; Path of CSV file to load.</li>
<li><strong>fields</strong> (<em>list</em>) &#8211; A list of <a class="reference internal" href="api.html#Field" title="Field"><tt class="xref py py-class docutils literal"><span class="pre">Field</span></tt></a> instances mapping to each column in the CSV.  This allows you to manually specify the column types.  If not provided, and a model is not provided, the field types will be determined automatically.</li>
<li><strong>field_names</strong> (<em>list</em>) &#8211; A list of strings to use as field names for each column in the CSV.  If not provided, and a model is not provided, the field names will be determined by looking at the header row of the file.  If no header exists, then the fields will be given generic names.</li>
<li><strong>has_header</strong> (<em>bool</em>) &#8211; Whether the first row is a header.</li>
<li><strong>sample_size</strong> (<em>int</em>) &#8211; Number of rows to look at when introspecting data types.  If set to <tt class="docutils literal"><span class="pre">0</span></tt>, then a generic field type will be used for all fields.</li>
<li><strong>converter</strong> (<em>RowConverter</em>) &#8211; a <tt class="xref py py-class docutils literal"><span class="pre">RowConverter</span></tt> instance to use for introspecting the CSV.  If not provided, one will be created.</li>
<li><strong>db_table</strong> (<em>str</em>) &#8211; The name of the database table to load data into.  If this value is not provided, it will be determined using the filename of the CSV file.  If a model is provided, this value is ignored.</li>
<li><strong>reader_kwargs</strong> &#8211; Arbitrary keyword arguments to pass to the <tt class="docutils literal"><span class="pre">csv.reader</span></tt> object, such as the dialect, separator, etc.</li>
</ul>
</td>
</tr>
<tr class="field-even field"><th class="field-name">Return type:</th><td class="field-body"><p class="first last">A <a class="reference internal" href="api.html#Model" title="Model"><tt class="xref py py-class docutils literal"><span class="pre">Model</span></tt></a> suitable for querying the CSV data.</p>
</td>
</tr>
</tbody>
</table>
<p>Basic example &#8211; field names and types will be introspected:</p>
<div class="highlight-python"><div class="highlight"><pre><span class="kn">from</span> <span class="nn">peewee</span> <span class="kn">import</span> <span class="o">*</span>
<span class="kn">from</span> <span class="nn">playhouse.csv_loader</span> <span class="kn">import</span> <span class="o">*</span>
<span class="n">db</span> <span class="o">=</span> <span class="n">SqliteDatabase</span><span class="p">(</span><span class="s">&#39;:memory:&#39;</span><span class="p">)</span>
<span class="n">User</span> <span class="o">=</span> <span class="n">load_csv</span><span class="p">(</span><span class="n">db</span><span class="p">,</span> <span class="s">&#39;users.csv&#39;</span><span class="p">)</span>
</pre></div>
</div>
<p>Using a pre-defined model:</p>
<div class="highlight-python"><div class="highlight"><pre><span class="k">class</span> <span class="nc">ZipToTZ</span><span class="p">(</span><span class="n">Model</span><span class="p">):</span>
    <span class="nb">zip</span> <span class="o">=</span> <span class="n">IntegerField</span><span class="p">()</span>
    <span class="n">timezone</span> <span class="o">=</span> <span class="n">CharField</span><span class="p">()</span>

<span class="n">load_csv</span><span class="p">(</span><span class="n">ZipToTZ</span><span class="p">,</span> <span class="s">&#39;zip_to_tz.csv&#39;</span><span class="p">)</span>
</pre></div>
</div>
<p>Specifying fields:</p>
<div class="highlight-python"><div class="highlight"><pre><span class="n">fields</span> <span class="o">=</span> <span class="p">[</span><span class="n">DecimalField</span><span class="p">(),</span> <span class="n">IntegerField</span><span class="p">(),</span> <span class="n">IntegerField</span><span class="p">(),</span> <span class="n">DateField</span><span class="p">()]</span>
<span class="n">field_names</span> <span class="o">=</span> <span class="p">[</span><span class="s">&#39;amount&#39;</span><span class="p">,</span> <span class="s">&#39;from_acct&#39;</span><span class="p">,</span> <span class="s">&#39;to_acct&#39;</span><span class="p">,</span> <span class="s">&#39;timestamp&#39;</span><span class="p">]</span>
<span class="n">Payments</span> <span class="o">=</span> <span class="n">load_csv</span><span class="p">(</span><span class="n">db</span><span class="p">,</span> <span class="s">&#39;payments.csv&#39;</span><span class="p">,</span> <span class="n">fields</span><span class="o">=</span><span class="n">fields</span><span class="p">,</span> <span class="n">field_names</span><span class="o">=</span><span class="n">field_names</span><span class="p">,</span> <span class="n">has_header</span><span class="o">=</span><span class="bp">False</span><span class="p">)</span>
</pre></div>
</div>
</dd></dl>

</div>
</div>
<div class="section" id="test-utils">
<span id="id5"></span><h2>Test Utils<a class="headerlink" href="#test-utils" title="Permalink to this headline">¶</a></h2>
<p>Contains utilities helpful when testing peewee projects.</p>
<dl class="class">
<dt id="test_database">
<em class="property">class </em><tt class="descname">test_database</tt><big>(</big><em>db</em>, <em>models</em><span class="optional">[</span>, <em>create_tables=True</em><span class="optional">[</span>, <em>fail_silently=False</em><span class="optional">]</span><span class="optional">]</span><big>)</big><a class="headerlink" href="#test_database" title="Permalink to this definition">¶</a></dt>
<dd><p>Context manager that lets you use a different database with a set of
models.  Models can also be automatically created and dropped.</p>
<p>This context manager helps make it possible to test your peewee models
using a &#8220;test-only&#8221; database.</p>
<table class="docutils field-list" frame="void" rules="none">
<col class="field-name" />
<col class="field-body" />
<tbody valign="top">
<tr class="field-odd field"><th class="field-name">Parameters:</th><td class="field-body"><ul class="first last simple">
<li><strong>db</strong> (<a class="reference internal" href="api.html#Database" title="Database"><em>Database</em></a>) &#8211; Database to use with the given models</li>
<li><strong>models</strong> &#8211; a <tt class="docutils literal"><span class="pre">list</span></tt> of <a class="reference internal" href="api.html#Model" title="Model"><tt class="xref py py-class docutils literal"><span class="pre">Model</span></tt></a> classes to use with the <tt class="docutils literal"><span class="pre">db</span></tt></li>
<li><strong>create_tables</strong> (<em>boolean</em>) &#8211; Whether tables should be automatically created
and dropped.</li>
<li><strong>fail_silently</strong> (<em>boolean</em>) &#8211; Whether the table create / drop should fail
silently.</li>
</ul>
</td>
</tr>
</tbody>
</table>
<p>Example:</p>
<div class="highlight-python"><div class="highlight"><pre><span class="kn">from</span> <span class="nn">unittest</span> <span class="kn">import</span> <span class="n">TestCase</span>
<span class="kn">from</span> <span class="nn">playhouse.test_utils</span> <span class="kn">import</span> <span class="n">test_database</span>
<span class="kn">from</span> <span class="nn">peewee</span> <span class="kn">import</span> <span class="o">*</span>

<span class="kn">from</span> <span class="nn">my_app.models</span> <span class="kn">import</span> <span class="n">User</span><span class="p">,</span> <span class="n">Tweet</span>

<span class="n">test_db</span> <span class="o">=</span> <span class="n">SqliteDatabase</span><span class="p">(</span><span class="s">&#39;:memory:&#39;</span><span class="p">)</span>

<span class="k">class</span> <span class="nc">TestUsersTweets</span><span class="p">(</span><span class="n">TestCase</span><span class="p">):</span>
    <span class="k">def</span> <span class="nf">create_test_data</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="c"># ... create a bunch of users and tweets</span>
        <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">10</span><span class="p">):</span>
            <span class="n">User</span><span class="o">.</span><span class="n">create</span><span class="p">(</span><span class="n">username</span><span class="o">=</span><span class="s">&#39;user-</span><span class="si">%d</span><span class="s">&#39;</span> <span class="o">%</span> <span class="n">i</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">test_timeline</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">with</span> <span class="n">test_database</span><span class="p">(</span><span class="n">test_db</span><span class="p">,</span> <span class="p">(</span><span class="n">User</span><span class="p">,</span> <span class="n">Tweet</span><span class="p">)):</span>
            <span class="c"># This data will be created in `test_db`</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">create_test_data</span><span class="p">()</span>

            <span class="c"># Perform assertions on test data inside ctx manager.</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="n">Tweet</span><span class="o">.</span><span class="n">timeline</span><span class="p">(</span><span class="s">&#39;user-0&#39;</span><span class="p">)</span> <span class="p">[</span><span class="o">...</span><span class="p">])</span>

        <span class="c"># once we exit the context manager, we&#39;re back to using the normal database</span>
</pre></div>
</div>
</dd></dl>

</div>
</div>


          </div>
        </div>
      </div>
      <div class="sphinxsidebar">
        <div class="sphinxsidebarwrapper">
  <h3><a href="../index.html">Table Of Contents</a></h3>
  <ul>
<li><a class="reference internal" href="#">Playhouse, a collection of addons</a><ul>
<li><a class="reference internal" href="#apsw-an-advanced-sqlite-driver">apsw, an advanced sqlite driver</a><ul>
<li><a class="reference internal" href="#how-to-use-the-apswdatabase">How to use the APSWDatabase</a></li>
<li><a class="reference internal" href="#apsw-ext-api-notes">apsw_ext API notes</a></li>
</ul>
</li>
<li><a class="reference internal" href="#postgresql-extensions">Postgresql Extensions</a><ul>
<li><a class="reference internal" href="#hstore-support">hstore support</a></li>
<li><a class="reference internal" href="#using-hstore">Using hstore</a></li>
<li><a class="reference internal" href="#server-side-cursors">Server-side cursors</a></li>
<li><a class="reference internal" href="#postgres-ext-api-notes">postgres_ext API notes</a></li>
</ul>
</li>
<li><a class="reference internal" href="#sqlite-extensions">Sqlite Extensions</a><ul>
<li><a class="reference internal" href="#sqlite-ext-api-notes">sqlite_ext API notes</a></li>
</ul>
</li>
<li><a class="reference internal" href="#django-integration">Django Integration</a><ul>
<li><a class="reference internal" href="#foreign-keys-and-many-to-many-relationships">Foreign keys and Many-to-many relationships</a></li>
<li><a class="reference internal" href="#djpeewee-api">djpeewee API</a></li>
</ul>
</li>
<li><a class="reference internal" href="#generic-foreign-keys">Generic foreign keys</a><ul>
<li><a class="reference internal" href="#how-to-use-gfks">How to use GFKs</a></li>
<li><a class="reference internal" href="#gfk-api">GFK API</a></li>
</ul>
</li>
<li><a class="reference internal" href="#key-value-store">Key/Value Store</a><ul>
<li><a class="reference internal" href="#keystore-api">KeyStore API</a></li>
</ul>
</li>
<li><a class="reference internal" href="#shortcuts">Shortcuts</a></li>
<li><a class="reference internal" href="#signal-support">Signal support</a><ul>
<li><a class="reference internal" href="#connecting-handlers">Connecting handlers</a></li>
<li><a class="reference internal" href="#signal-api">Signal API</a></li>
</ul>
</li>
<li><a class="reference internal" href="#pwiz-a-model-generator">pwiz, a model generator</a></li>
<li><a class="reference internal" href="#basic-schema-migrations">Basic Schema Migrations</a></li>
<li><a class="reference internal" href="#csv-loader">CSV Loader</a><ul>
<li><a class="reference internal" href="#csv-loader-api">CSV Loader API</a></li>
</ul>
</li>
<li><a class="reference internal" href="#test-utils">Test Utils</a></li>
</ul>
</li>
</ul>
<h3>Related Topics</h3>
<ul>
  <li><a href="../index.html">Documentation overview</a><ul>
      <li>Previous: <a href="api.html" title="previous chapter">API Reference</a></li>
      <li>Next: <a href="upgrading.html" title="next chapter">Upgrading peewee</a></li>
  </ul></li>
</ul>
  <h3>This Page</h3>
  <ul class="this-page-menu">
    <li><a href="../_sources/peewee/playhouse.txt"
           rel="nofollow">Show Source</a></li>
  </ul>
<div id="searchbox" style="display: none">
  <h3>Quick search</h3>
    <form class="search" action="../search.html" method="get">
      <input type="text" name="q" />
      <input type="submit" value="Go" />
      <input type="hidden" name="check_keywords" value="yes" />
      <input type="hidden" name="area" value="default" />
    </form>
    <p class="searchtip" style="font-size: 90%">
    Enter search terms or a module, class or function name.
    </p>
</div>
<script type="text/javascript">$('#searchbox').show(0);</script>
        </div>
      </div>
      <div class="clearer"></div>
    </div>
  <div class="footer">
    &copy; Copyright charles leifer.
    Created using <a href="http://sphinx.pocoo.org/">Sphinx</a>.
  </div>
  
  </body>
</html>