(function(a){String.prototype.startsWith=function(e){var c=this.length;var d=e.length;if(c<d){return false}return(this.substr(0,d)==e)};String.prototype.endsWith=function(e){var c=this.length;var d=e.length;if(c<d){return false}return(this.substr(c-d)==e)};if(!Array.prototype.indexOf){Array.prototype.indexOf=function(d){var c=this.length;var e=Number(arguments[1])||0;e=(e<0)?Math.ceil(e):Math.floor(e);if(e<0){e+=c}for(;e<c;e++){if(e in this&&this[e]===d){return e}}return -1}}a.expr[":"].econtains=function(f,d,e,c){return(f.textContent||f.innerText||a(f).text()||"").toLowerCase()==e[3].toLowerCase()};a.expr[":"].withtext=function(f,d,e,c){return(f.textContent||f.innerText||a(f).text()||"")==e[3]};if(a.scrollbarWidth===undefined){a.scrollbarWidth=function(){var d,e,c;if(c===undefined){d=a('<div style="width:50px;height:50px;overflow:auto"><div/></div>').appendTo("body");e=d.children();c=e.innerWidth()-e.height(99).innerWidth();d.remove()}return c}}a.UTF8={encode:function(e){e=e.replace(/\r\n/g,"\n");var d="";for(var g=0;g<e.length;g++){var f=e.charCodeAt(g);if(f<128){d+=String.fromCharCode(f)}else{if((f>127)&&(f<2048)){d+=String.fromCharCode((f>>6)|192);d+=String.fromCharCode((f&63)|128)}else{d+=String.fromCharCode((f>>12)|224);d+=String.fromCharCode(((f>>6)&63)|128);d+=String.fromCharCode((f&63)|128)}}}return d},decode:function(d){var e="";var f=0;var g=c1=c2=0;while(f<d.length){g=d.charCodeAt(f);if(g<128){e+=String.fromCharCode(g);f++}else{if((g>191)&&(g<224)){c2=d.charCodeAt(f+1);e+=String.fromCharCode(((g&31)<<6)|(c2&63));f+=2}else{c2=d.charCodeAt(f+1);c3=d.charCodeAt(f+2);e+=String.fromCharCode(((g&15)<<12)|((c2&63)<<6)|(c3&63));f+=3}}}return e}};if(a.ZTFY===undefined){a.ZTFY={}}a.ZTFY.getScript=function(d,f,e){var c={dataType:"script",url:d,success:f,cache:e===undefined?true:e};return a.ajax(c)};a.ZTFY.getFunctionByName=function(g,d){var f=g.split(".");var e=f.pop();var d=(d===undefined||d===null)?window:d;for(var c=0;c<f.length;c++){d=d[f[c]]}return d[e]};a.ZTFY.executeFunctionByName=function(f,d){var e=a.ZTFY.getFunctionByName(f,d);var c=Array.prototype.slice.call(arguments,2);return e.apply(d,c)};a.ZTFY.getQueryVar=function(e,f){if(e.indexOf("?")<0){return false}if(!e.endsWith("&")){e+="&"}var c=new RegExp(".*?[&\\?]"+f+"=(.*?)&.*");var d=e.replace(c,"$1");return d==e?false:d};a.ZTFY.rgb2hex=function(c){return"#"+a.map(c.match(/\b(\d+)\b/g),function(d){return("0"+parseInt(d).toString(16)).slice(-2)}).join("")};a.ZTFY.skin={stopEvent:function(c){if(!c){var c=window.event}if(c){if(c.stopPropagation){c.stopPropagation();c.preventDefault()}else{c.cancelBubble=true;c.returnValue=false}}},getCSS:function(e,g,f){var d=a("HEAD");var c=a('style[ztfy_id="'+g+'"]',d);if(c.length==0){a.get(e,function(i){var h=a("<style></style>").attr("type","text/css").attr("ztfy_id",g).text(i);d.prepend(h);if(f){f()}})}},switcher:function(c){a(c).toggle()}};a.ZTFY.ajax={check:function(c,d,e){if(typeof(c)=="undefined"){a.ZTFY.getScript(d,e)}else{e()}},getAddr:function(e){var c=e||a("HTML HEAD BASE").attr("href")||window.location.href;var d=c.replace(/\+\+skin\+\+\w+\//,"");return d.substr(0,d.lastIndexOf("/")+1)},post:function(f,h,d,c,g){if(f.startsWith("http://")){var i=f}else{var i=a.ZTFY.ajax.getAddr()+f}var e={url:i,type:"post",cache:false,data:a.param(h,true),dataType:g||"json",success:d,error:c||a.ZTFY.ajax.error};a.ajax(e)},submit:function(g,e,h,d,c,f){a.ZTFY.ajax.check(a.progressBar,"/--static--/ztfy.jqueryui/js/jquery-progressbar.min.js",function(){var j=a.progressBar.submit(g);if(e.startsWith(window.location.protocol)){var k=e}else{var k=a.ZTFY.ajax.getAddr()+e}if(j&&(k.indexOf("X-Progress-ID")<0)){k+="?X-Progress-ID="+j}var i={url:k,type:"post",iframe:true,data:h,dataType:f||"json",success:d,error:c||a.ZTFY.ajax.error};a(g).ajaxSubmit(i)})},error:function(e,c,d){a.ZTFY.ajax.check(jAlert,"/--static--/ztfy.jqueryui/js/jquery-alerts.min.js",function(){jAlert(c+":\n\n"+d,a.ZTFY.I18n.ERROR_OCCURED,null)})}};a.ZTFY.json={getAddr:function(c){return a.ZTFY.ajax.getAddr(c)},getQuery:function(f,i,h,g){var c;if((h===null)||(h==="")||(h==="null")){h=undefined}else{if(typeof(h)=="string"){h=a.ZTFY.getFunctionByName(h)}}var e=a.isFunction(h);var d={url:a.ZTFY.json.getAddr(),type:"POST",method:i,async:e,params:{query:f},complete:h,success:function(k,j){c=k.result},error:function(l,j,k){jAlert(l.responseText,"Error !",window.location.reload)}};d.params=a.extend(d.params,g||{});a.jsonRpc(d);return c},post:function(i,g,d,c,f){var h=a.ZTFY.json.getAddr();if(f){h+="/"+f}var e={url:h,type:"post",cache:false,method:i,params:g,success:d,error:c};a.jsonRpc(e)}};a.ZTFY.loader={div:null,start:function(e){e.empty();var c=a('<div class="loader"></div>').appendTo(e);var d=a('<img class="loading" src="/--static--/ztfy.skin/img/loading.gif" />').appendTo(c);a.ZTFY.loader.div=c},stop:function(){if(a.ZTFY.loader.div!=null){a.ZTFY.loader.div.replaceWith("");a.ZTFY.loader.div=null}}};a.ZTFY.plugins={_registry:null,register:function(e,d,c){if(this._registry==null){this._registry=new Array()}this._registry.push([e,d,c])},callAndRegister:function(f,d,e,c){f.call(d,e,c);if(this._registry==null){this._registry=new Array()}this._registry.push([f,d,c])},call:function(g){var c=this._registry;if(c==null){return}for(var e in c){if(!a.isNumeric(e)){continue}var h=c[e][0];var f=c[e][1];var d=c[e][2];h.call(f,g,d)}},callCustomPlugins:function(c){a("[data-ztfy-plugin]",c).each(function(){var e=this;var d=a(this).data("ztfy-plugin").split(/\s+/);a(d).each(function(){var f=a.ZTFY.getFunctionByName(this);f.call(window,e)})})}};a.ZTFY.widgets={initTabs:function(c){if(typeof(a.fn.tabs)=="undefined"){return}a("DIV.form #tabforms UL.tabs",c).tabs("DIV.panes > DIV")},initDates:function(c){if(typeof(a.fn.dynDateTime)=="undefined"){return}if(a.i18n_calendar===undefined){var d=a("html").attr("lang")||a("html").attr("xml:lang");a.i18n_calendar=d;if(d){if(d=="en"){a.ZTFY.getScript("/--static--/ztfy.jqueryui/js/lang/calendar-"+d+".min.js")}else{a.ZTFY.getScript("/--static--/ztfy.jqueryui/js/lang/calendar-"+d+"-utf8.js")}}}a('[data-ztfy-widget="datetime"]',c).each(function(){var e=a(this);e.dynDateTime({showsTime:e.data("datetime-showtime"),ifFormat:e.data("datetime-format"),button:e.data("datetime-button")})})},initMultiselect:function(c){if(typeof(a.fn.multiselect)=="undefined"){return}a('[data-ztfy-widget="multiselect"]',c).each(function(){var f=a(this);var e=f.data();var d=e.multiselectReferences||"{}";if(typeof(d)=="string"){d=a.parseJSON(d.replace(/'/g,'"'))}f.multiselect({readonly:e.multiselectReadonly,input_class:e.multiselectClass,separator:e.multiselectSeparator||",",min_query_length:e.multiselectMinLength||3,input_references:d,on_search:function(j){if(e.multiselectSearchCallback){var k=a.ZTFY.getFunctionByName(e.multiselectSearchCallback);var h=(e.multiselectSearchArgs||"").split(";");if(h.length>2){var g=h.length-1;var i=h[g];if(i){h[g]=a.parseJSON(i.replace(/'/g,'"'))}}h.splice(0,0,j);return k.apply(window,h)}else{return""}},on_search_timeout:e.multiselectSearchTimeout||300,max_complete_results:e.multiselectMaxResults||20,enable_new_options:e.multiselectEnableNew,complex_search:e.multiselectComplexSearch,max_selection_length:e.multiselectMaxSelectionLength,backspace_removes_last:e.multiselectBackspaceRemovesLast==false?false:true})})},initColors:function(c){if(typeof(a.fn.ColorPicker)=="undefined"){return}a('[data-ztfy-widget="color-selector"]',c).each(function(){var d=a(this);var e=a("INPUT",d);a("DIV",d).css("background-color","#"+e.val());if(d.data("readonly")===undefined){d.ColorPicker({color:"#"+e.val(),onShow:function(f){a(f).fadeIn(500);return false},onHide:function(f){a(f).fadeOut(500);return false},onChange:function(f,i,g){var h=a(this).data().colorpicker.el;a("INPUT",h).val(i);a("DIV",h).css("background-color","#"+i)},onSubmit:function(){a(this).ColorPickerHide()}})}})},initHints:function(c){a.ZTFY.ajax.check(a.fn.tipsy,"/--static--/ztfy.jqueryui/js/jquery-tipsy.min.js",function(){var d=a("DIV.form",a(c));if(d.data("ztfy-inputs-hints")==true){a('INPUT[type!="hidden"]:not(.nohint), SELECT, TEXTAREA',d).each(function(e,f){a(f).tipsy({html:true,fallback:a("A.hint",a(f).closest("DIV.row")).attr("title"),gravity:"nw"});a("A.hint:not(.nohide)",a(f).closest("DIV.row")).hide()})}a("A.hint",d).tipsy({gravity:function(e){return a(this).data("ztfy-hint-gravity")||"sw"},offset:function(e){return a(this).data("ztfy-hint-offset")||0}})})},initTinyMCE:function(c){if(typeof(tinyMCE)=="undefined"){return}a('[data-ztfy-widget="TinyMCE"]',c).each(function(){var g=a(this).data();var e={script_url:"/--static--/ztfy.jqueryui/js/tiny_mce/tiny_mce.js"};var f=g.tinymceOptions.split(";");for(var d in f){if(!a.isNumeric(d)){continue}var h=f[d].split("=");switch(h[1]){case"true":e[h[0]]=true;break;case"false":e[h[0]]=false;break;default:e[h[0]]=h[1]}}if(!tinyMCE.settings){tinyMCE.init(e)}});a('[data-ztfy-widget="TinyMCE"]',c).click(function(d){if(d instanceof a.Event){d=d.srcElement||d.target}if(tinyMCE.activeEditor){tinyMCE.execCommand("mceRemoveControl",false,tinyMCE.activeEditor.id)}tinyMCE.execCommand("mceAddControl",false,a(d).attr("id"))})},initFancybox:function(c){if(typeof(a.fn.fancybox)=="undefined"){return}a('[data-ztfy-widget="fancybox"]',c).each(function(){var f=a(this).data();var e=a(f.fancyboxSelector||"IMG",this);if(f.fancyboxParent!==undefined){e=e.parents(f.fancyboxParent)}var d={type:f.fancyboxType||"image",titleShow:f.fancyboxShowTitle,titlePosition:f.fancyboxTitlePosition||"outside",hideOnContentClick:f.fancyboxClickHide===undefined?true:f.fancyboxClickHide,overlayOpacity:f.fancyboxOverlayOpacity||0.5,padding:f.fancyboxPadding||10,margin:f.fancyboxMargin||20,transitionIn:f.fancyboxTransitionIn||"elastic",transitionOut:f.fancyboxTransitionOut||"elastic"};if(f.fancyboxTitleFormat){d.titleFormat=a.ZTFY.getFunctionByName(f.fancyboxTitleFormat)}else{d.titleFormat=function(k,l,h,j){if(k&&k.length){var g='<span id="fancybox-title-over"><strong>'+k+"</strong>";var i=a(l[h]).data("fancybox-description");if(i){g+="<br />"+i}g+="</span>";return g}else{return null}}}if(f.fancyboxComplete){d.onComplete=a.ZTFY.getFunctionByName(f.fancyboxComplete)}else{d.onComplete=function(){a("#fancybox-wrap").hover(function(){a("#fancybox-title").slideDown("slow")},function(){a("#fancybox-title").slideUp("slow")})}}e.fancybox(d)})}};a.ZTFY.dialog={switchGroup:function(c,d){var c=a(c);var d=a('DIV[id="group_'+d+'"]');if(c.attr("type")=="checkbox"){if(c.is(":checked")){d.show()}else{d.hide()}}else{if(c.attr("src").endsWith("pl.png")){d.show();c.attr("src","/--static--/ztfy.skin/img/mi.png")}else{d.hide();c.attr("src","/--static--/ztfy.skin/img/pl.png")}}c.parents("FIELDSET:first").toggleClass("switched")},options:{expose:{maskId:"mask",color:"#444",opacity:0.6,zIndex:1000},top:"5%",api:true,oneInstance:false,closeOnClick:false,onBeforeLoad:function(){var d=this.getOverlay();a.ZTFY.loader.start(d);var c=a.ZTFY.dialog.dialogs[a.ZTFY.dialog.getCount()-1];d.load(c.src,c.callback);if(a.browser.msie&&(a.browser.version<"7")){a("select").css("visibility","hidden")}},onClose:function(){a.ZTFY.dialog.onClose();if(a.browser.msie&&(a.browser.version<"7")){a("select").css("visibility","hidden")}}},dialogs:[],getCount:function(){return a.ZTFY.dialog.dialogs.length},getCurrent:function(){var c=a.ZTFY.dialog.getCount();return a("#dialog_"+c)},open:function(h,f,j){if(typeof(a.fn.overlay)=="undefined"){jAlert(a.ZTFY.I18n.MISSING_OVERLAY,a.ZTFY.I18n.ERROR_OCCURED);return}var h=h.replace(/ /g,"%20");if(a.isFunction(f)){j=f;f=null}var f=typeof(window.event)!="undefined"?window.event:f;a.ZTFY.skin.stopEvent(f);if(!a.ZTFY.dialog.dialogs){a.ZTFY.dialog.dialogs=new Array()}var d=a.ZTFY.dialog.getCount()+1;var i="dialog_"+d;var c={};var g={maskId:"mask_"+i,color:"#444",opacity:0.6,zIndex:a.ZTFY.dialog.options.expose.zIndex+d};a.extend(c,a.ZTFY.dialog.options,{expose:g});a.ZTFY.dialog.dialogs.push({src:h,callback:j||a.ZTFY.dialog.openCallback,body:a('<div class="overlay"></div>').attr("id",i).css("z-index",g.zIndex+1).appendTo(a("body"))});var e=a("#"+i);e.empty().overlay(c).load();if(a.fn.draggable){e.draggable({handle:'DIV[id="osx-container"], H1',containment:"window"})}},openCallback:function(c,f,n){if(f=="error"){a(this).html(c)}else{var i=a.ZTFY.dialog.getCurrent();a.ZTFY.plugins.call(i);a.ZTFY.plugins.callCustomPlugins(i);var h=a("DIV.viewspace",i);var j=a("H1",i);var k=a("DIV.legend",i);var e=a("DIV.form > FIELDSET > DIV.help",i);var d=a("DIV.actions",i);if(h.length>0){var l=a(window).height()-j.height()-k.height()-e.height()-d.height()-180;var g=h.position();var m=a.scrollbarWidth();h.css("max-height",l);if(h.get(0).scrollHeight>l){a("<div></div>").addClass("scrollmarker").addClass("top").css("width",h.width()-m/2).css("top",g.top).hide().appendTo(h);a("<div></div>").addClass("scrollmarker").addClass("bottom").css("width",h.width()-m/2).css("top",g.top+l-10).appendTo(h);h.scroll(function(r){var s=r.srcElement||r.target;var q=a(s);var o=a("DIV.scrollmarker.top",q);var u=q.scrollTop();if(u>0){o.show()}else{o.hide()}var p=a("DIV.scrollmarker.bottom",q);var v=parseInt(q.css("max-height"));var t=v+u-10;if(t>=s.scrollHeight-20){p.hide()}else{p.show()}})}h.scroll(function(o){a("DIV.jquery-multiselect-autocomplete",h).each(function(r,s){var q=a("BODY").scrollTop();var t=a(s).closest(".widget");var u=t.offset();var p=t.height();a(s).css("top",u.top+p-q)})});a(h).on("keydown","INPUT",function(o){if(o.which==13){o.preventDefault();if(a(o.target).data("ztfy-widget")!="multiselect"){a("INPUT[type=button]:first",d).click()}}})}}},close:function(){a("#dialog_"+a.ZTFY.dialog.getCount()).overlay().close()},onClose:function(){if(typeof(tinyMCE)!="undefined"){if(tinyMCE.activeEditor){tinyMCE.execCommand("mceRemoveControl",false,tinyMCE.activeEditor.id)}}var c=a.ZTFY.dialog.getCount();var d="dialog_"+c;a("DIV.tipsy").remove();a("#"+d).remove();a("#mask_"+d).remove();a.ZTFY.dialog.dialogs.pop()}};a.ZTFY.form={check:function(c){a.ZTFY.ajax.check(a.fn.ajaxSubmit,"/--static--/ztfy.jqueryui/js/jquery-form.min.js",c)},hideStatus:function(){a("DIV.form DIV.status").animate({opacity:0,height:0,"margin-top":0,"margin-bottom":0,"padding-top":0,"padding-bottom":0},2000,function(){a(this).remove()})},getSubmitCallbacks:function(f){var d=a(f);var e=new Array();var c=d.data("ztfy-submit-callback");if(c){e.push([d,c])}a("[data-ztfy-submit-callback]",a(f)).each(function(){var g=a(this);e.push([g,g.data("ztfy-submit-callback")])});return e},checkSubmitCallbacks:function(d){var h=a.ZTFY.form.getSubmitCallbacks(d);if(!h.length){return true}var e=new Array();var f=true;for(var g in h){if(!a.isNumeric(g)){continue}var j=h[g];var i=j[0];var c=j[1];var k=a.ZTFY.executeFunctionByName(c,undefined,d,i);if((k!==undefined)&&(k!==true)){if(k===false){f=false}else{if(typeof(k)=="string"){e.push(k)}else{if(k.length&&(k.length>0)){e=e.concat(k)}}}}}if(e.length>1){jAlert(a.ZTFY.I18n.ERRORS_OCCURED+"\n"+e.join("\n"),a.ZTFY.I18n.WARNING);return false}else{if(e.length==1){jAlert(a.ZTFY.I18n.ERROR_OCCURED+"\n"+e.join("\n"),a.ZTFY.I18n.WARNING);return false}else{return f}}},submit:function(d){var c=a(this);if(c.data("submitted")||!a.ZTFY.form.checkSubmitCallbacks(this)){a.ZTFY.skin.stopEvent(d);return false}if(!c.data("ztfy-disable-submit-flag")){c.data("submitted",true)}a.ZTFY.ajax.check(a.progressBar,"/--static--/ztfy.jqueryui/js/jquery-progressbar.min.js",function(){if(a.progressBar){a.progressBar.submit(c)}})},reset:function(c){c.reset();a("input:first",c).focus()},showErrors:function(p){var l=a.ZTFY.dialog.getCurrent();var j=a("DIV.status",l).outerHeight(true);a("DIV.status",l).remove();a("DIV.error",l).each(function(i,q){a("DIV.widget",a(q)).detach().insertAfter(a(q));a(q).remove()});var e=a("<div></div>").addClass("status error");a("<div></div>").addClass("summary").text(p.errors.status).appendTo(e);var n=a("<ul></ul>").appendTo(e);if(p.errors.errors){for(var g in p.errors.errors){if(!a.isNumeric(g)){continue}var m=p.errors.errors[g];if(m.widget){a("<li></li>").text(m.widget+" : "+m.message).appendTo(n);var h=a('[id="'+m.id+'"]',l).parents("DIV.widget");var o=a(h).parents("DIV.row");var d=a("<div></div>").addClass("error").append(a("<div></div>").addClass("error").text(m.message)).insertBefore(h);h.detach().appendTo(d)}else{a("<li></li>").text(m.message).appendTo(n)}}}var k=a("DIV.viewspace",l);e.insertBefore(k);var c=e.outerHeight(true);if(c!=j){k.css("max-height",parseInt(k.css("max-height"))-c+j);var f=a("DIV.scrollmarker.top",l);f.css("top",parseInt(f.css("top"))-j+c)}a("FORM",l).data("submitted",false)},add:function(f,e,h,g,d){var c=a(f);if(c.data("submitted")||!a.ZTFY.form.checkSubmitCallbacks(f)){return false}var g=g||{};c.data("submitted",true);a.ZTFY.form.check(function(){if(typeof(tinyMCE)!="undefined"){tinyMCE.triggerSave()}if(e){g.parent=e}var j=c.attr("action").replace(/\?X-Progress-ID=.*/,"");var i="/@@ajax/"+(d||"ajaxCreate");a(a.ZTFY.form).data("add_action",j);a.ZTFY.ajax.submit(f,j+i,g,h||a.ZTFY.form._addCallback,null,"json")});return false},_addCallback:function(c,d){if(d=="success"){if(typeof(c)=="string"){c=a.parseJSON(c)}var e=c.output;switch(e){case"ERRORS":a.ZTFY.form.showErrors(c);break;case"OK":a.ZTFY.dialog.close();a("DIV.status").remove();var h=c.message||a.ZTFY.I18n.DATA_UPDATED;a("DIV.required-info").after('<div class="status success"><div class="summary">'+h+"</div></div>");break;case"NONE":a.ZTFY.dialog.close();a("DIV.status").remove();var h=c.message||a.ZTFY.I18n.NO_UPDATE;a("DIV.required-info").after('<div class="status warning"><div class="summary">'+h+"</div></div>");break;case"MESSAGE":jAlert(c.message,c.title||a.ZTFY.I18n.INFO);var f=a.ZTFY.dialog.getCurrent();a("FORM",f).data("submitted",false);break;case"PASS":a.ZTFY.dialog.close();a("DIV.status").remove();break;case"RELOAD":window.location.href=window.location.href;break;case"REDIRECT":window.location.href=c.target;break;case"CALLBACK":if(c.close_dialog){a.ZTFY.dialog.close()}a.ZTFY.executeFunctionByName(c.callback,undefined,c.options);break;default:if(e&&e.startsWith("<!-- OK -->")){a.ZTFY.dialog.close();a("DIV.form").replaceWith(e)}else{var f=a.ZTFY.dialog.getCurrent();a("DIV.dialog",f).replaceWith(e);var g=a("FORM",f);g.attr("action",a(a.ZTFY.form).data("add_action"));a('INPUT[id="'+g.attr("id")+'-buttons-add"]',f).bind("click",function(i){a.ZTFY.form.add(this.form,c.parent)});a('INPUT[id="'+g.attr("id")+'-buttons-cancel"]',f).bind("click",function(i){a.ZTFY.dialog.close()});a("#tabforms UL.tabs",f).tabs(a(f).selector+" DIV.panes > DIV")}}if(e!="ERRORS"){setTimeout("$.ZTFY.form.hideStatus();",2000)}}},edit:function(e,g,h,f,d){var c=a(e);if(c.data("submitted")||!a.ZTFY.form.checkSubmitCallbacks(e)){return false}c.data("submitted",true);a.ZTFY.form.check(function(){if(typeof(tinyMCE)!="undefined"){tinyMCE.triggerSave()}var j=c.attr("action").replace(/\?X-Progress-ID=.*/,"");var i="/@@ajax/"+(d||"ajaxEdit");a(a.ZTFY.form).data("edit_action",j);a.ZTFY.ajax.submit(e,j+i,f||{},h||a.ZTFY.form._editCallback,null,"json")});return false},_editCallback:function(c,d,f){if(d=="success"){if(typeof(c)=="string"){c=a.parseJSON(c)}var e=c.output;switch(e){case"ERRORS":a.ZTFY.form.showErrors(c);break;case"OK":a.ZTFY.dialog.close();a("DIV.status").remove();var i=c.message||a.ZTFY.I18n.DATA_UPDATED;a("DIV.required-info").after('<div class="status success"><div class="summary">'+i+"</div></div>");break;case"NONE":a.ZTFY.dialog.close();a("DIV.status").remove();var i=c.message||a.ZTFY.I18n.NO_UPDATE;a("DIV.required-info").after('<div class="status warning"><div class="summary">'+i+"</div></div>");break;case"MESSAGE":jAlert(c.message,c.title||a.ZTFY.I18n.INFO);var g=a.ZTFY.dialog.getCurrent();a("FORM",g).data("submitted",false);break;case"PASS":a.ZTFY.dialog.close();a("DIV.status").remove();break;case"RELOAD":window.location.href=window.location.href;break;case"REDIRECT":window.location.href=c.target;break;case"CALLBACK":if(c.close_dialog){a.ZTFY.dialog.close()}a.ZTFY.executeFunctionByName(c.callback,undefined,c.options);break;default:if(e&&e.startsWith("<!-- OK -->")){a.ZTFY.dialog.close();a("DIV.form").replaceWith(e)}else{var g=a.ZTFY.dialog.getCurrent();a("DIV.dialog",g).replaceWith(e);var h=a("FORM",g);h.attr("action",a(a.ZTFY.form).data("edit_action"));a('INPUT[id="'+h.attr("id")+'-buttons-dialog_submit"]',g).bind("click",function(j){a.ZTFY.form.edit(this.form)});a('INPUT[id="'+h.attr("id")+'-buttons-dialog_cancel"]',g).bind("click",function(j){a.ZTFY.dialog.close()});a("#tabforms UL.tabs",g).tabs(a(g).selector+" DIV.panes > DIV")}}if(e!="ERRORS"){setTimeout("$.ZTFY.form.hideStatus();",2000)}}},remove:function(d,e,f,c){jConfirm(a.ZTFY.I18n.CONFIRM_REMOVE,a.ZTFY.I18n.CONFIRM,function(i){if(i){var h={id:d};a.ZTFY.form.ajax_source=e;var g="/@@ajax/"+(c||"ajaxRemove");a.ZTFY.ajax.post(window.location.href+g,h,f||a.ZTFY.form._removeCallback,null,"text")}})},_removeCallback:function(c,d){if((d=="success")&&(c=="OK")){a(a.ZTFY.form.ajax_source).parents("TR").remove()}},update:function(d,e,c){a.ZTFY.form.check(function(){if(typeof(tinyMCE)!="undefined"){tinyMCE.triggerSave()}var g=a(d).formToArray(true);var f="/@@ajax/"+(c||"ajaxUpdate");a.ZTFY.ajax.post(a(d).attr("action")+f,g,e||a.ZTFY.form._updateCallback,null,"text")});return false},_updateCallback:function(c,d){if((d=="success")&&(c=="OK")){a("DIV.status").remove();a("LEGEND").after('<div class="status success"><div class="summary">'+a.ZTFY.I18n.DATA_UPDATED+"</div></div>")}}};a.ZTFY.container={remove:function(d,e,f){var c={_source:e,url:a.ZTFY.json.getAddr(f),type:"POST",method:"remove",params:{id:d},success:function(h,g){a(this._source).parents("BODY").css("cursor","default");a(this._source).parents("TR").remove()},error:function(i,g,h){jAlert(i.responseText,a.ZTFY.I18n.ERROR_OCCURED,window.location.reload)}};jConfirm(a.ZTFY.I18n.CONFIRM_REMOVE,a.ZTFY.I18n.CONFIRM,function(g){if(g){a(e).parents("BODY").css("cursor","wait");a.jsonRpc(c)}})}};a.ZTFY.sortable={options:{handle:"IMG.handler",axis:"y",containment:"parent",placeholder:"sorting-holder",stop:function(d,f){var c=new Array();a("TD.id",this).each(function(g){c[c.length]=a(this).text()});var e={ids:c};if(c.length>1){a.ZTFY.ajax.post(window.location.href+"/@@ajax/ajaxUpdateOrder",e,null,function(i,g,h){jAlert(i.responseText,a.ZTFY.I18n.ERROR_OCCURED,window.location.reload)})}}},init:function(c){if(typeof(a.fn.sortable)=="undefined"){return}a("TABLE.orderable TBODY",c).sortable(a.ZTFY.sortable.options)}};a.ZTFY.treeview={init:function(c){if(typeof(a.fn.treeTable)=="undefined"){return}a("TABLE.treeview",c).each(function(){var e=a(this);var d=e.data();e.treeTable({treeColumn:d.treeColumn===undefined?1:d.treeColumn,initialState:d.initialState===undefined?"expanded":d.initialState})})},changeParent:function(d,f){var h=a(f.draggable.parents("TR"));if(h.appendBranchTo(this)){var e=h.attr("id").substr("node-".length);var g=a(this).attr("id").substr("node-".length);var c={url:a.ZTFY.json.getAddr(),type:"POST",method:"changeParent",params:{source:parseInt(e),target:parseInt(g)},error:function(k,i,j){jAlert(k.responseText,a.ZTFY.I18n.ERROR_OCCURED,window.location.reload)}};a.jsonRpc(c)}}};a.ZTFY.reference={activate:function(c){a("INPUT[name="+c+"]").attr("readonly","").val("").focus();a("INPUT[name="+c+"]").prev().val("")},keyPressed:function(c){if(c.which==13){a.ZTFY.reference.search(this);return false}},search:function(e){var c;var d={url:a.ZTFY.ajax.getAddr(),type:"POST",method:"searchByTitle",async:false,params:{query:e},success:function(g,f){c=g.result},error:function(h,f,g){jAlert(h.responseText,"Error !",window.location.reload)}};a.jsonRpc(d);return c},select:function(c,e){var d=a.ZTFY.reference.source;a(d).prev().val(c);a(d).val(e+" (OID: "+c+")").attr("readonly","readonly");a("#selector").overlay().close();a("#selector").remove();return false}};a.ZTFY.extras={initDownloader:function(d,g,f){var e=a(d).attr("action");var g=e+g;var c=a('IFRAME[name="downloadFrame"]');if(c.length==0){c=a("<iframe></iframe>").hide().attr("name","downloadFrame").appendTo(a("BODY"))}a(d).attr("action",g).attr("target","downloadFrame").ajaxSubmit({data:f,iframe:true,iframeTarget:c});a(d).attr("action",e).attr("target",null);a.ZTFY.dialog.close();a("BODY").css("cursor","auto")},initContainerSize:function(c){a(c).css("min-height",a(a(c).data("container-sizer")).height())},initCaptcha:function(d){if(d instanceof a.Event){d=d.srcElement||d.target}var e=a(d).data();var c=new Date();var f="@@captcha.jpeg?id="+e.captchaId+unescape("%26")+c.getTime();a(d).attr("src",f).off("click").on("click",a.ZTFY.extras.initCaptcha)}};a.ZTFY.I18n={INFO:"Information",WARNING:"!! WARNING !!",ERROR_OCCURED:"An error occured!",ERRORS_OCCURED:"Some errors occured!",BAD_LOGIN_TITLE:"Bad login!",BAD_LOGIN_MESSAGE:"Your anthentication credentials didn't allow you to open a session; please check your credentials or contact administrator.",CONFIRM:"Confirm",CONFIRM_REMOVE:"Removing this content can't be undone. Do you confirm?",NO_UPDATE:"No changes were applied.",DATA_UPDATED:"Data successfully updated.",MISSING_OVERLAY:"JQuery « overlay » plug-in is required; please include JQuery-tools resources in your page!"};var b=a("HTML").attr("lang")||a("HTML").attr("xml:lang");if(b&&(b!="en")){a.ZTFY.getScript("/--static--/ztfy.skin/js/i18n/"+b+".js")}a(document).ready(function(){a(document).ajaxStart(function(){a("BODY").css("cursor","wait")});a(document).ajaxStop(function(){a("BODY").css("cursor","auto")});a.ZTFY.plugins.callAndRegister(a.ZTFY.widgets.initTabs,window,document);a.ZTFY.plugins.callAndRegister(a.ZTFY.widgets.initDates,window,document);a.ZTFY.plugins.callAndRegister(a.ZTFY.widgets.initMultiselect,window,document);a.ZTFY.plugins.callAndRegister(a.ZTFY.widgets.initHints,window,document);a.ZTFY.plugins.callAndRegister(a.ZTFY.widgets.initColors,window,document);a.ZTFY.plugins.callAndRegister(a.ZTFY.widgets.initTinyMCE,window,document);a.ZTFY.plugins.callAndRegister(a.ZTFY.widgets.initFancybox,window,document);a.ZTFY.plugins.callAndRegister(a.ZTFY.sortable.init,window,document);a.ZTFY.plugins.callAndRegister(a.ZTFY.treeview.init,window,document);a.ZTFY.plugins.callCustomPlugins(document);a('A[rel="external"]').attr("target","_blank");a(document).on("submit","FORM",a.ZTFY.form.submit)})})(jQuery);