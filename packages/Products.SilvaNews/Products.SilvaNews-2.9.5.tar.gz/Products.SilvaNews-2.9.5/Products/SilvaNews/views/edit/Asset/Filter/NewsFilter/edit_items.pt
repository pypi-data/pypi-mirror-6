<html tal:omit-tag=""
  lang="en"
  xml:lang="en"
  xmlns="http://www.w3.org/1999/xhtml"
  xmlns:metal="http://xml.zope.org/namespaces/metal"
  xmlns:tal="http://xml.zope.org/namespaces/tal"
  xmlns:i18n="http://xml.zope.org/namespaces/i18n"
  i18n:domain="silva_news"
  tal:define="
    view here;
    model request/model;
    root_url model/get_root_url;
    user_role view/get_user_role;
    title model/get_title_editable;
    vein string:editor;
    dummy model/security_trigger;
    results python:model.get_all_items();
    startat python:path('request/start | nothing') or path('options/startat | nothing') or 0;
    batch python:modules['ZTUtils'].Batch(results, size=10, start=int(startat));
    objects python:view.prepare_objects(batch);
    previous python:batch.previous;
    next python:batch.next;
    mangle modules/Products/Silva/mangle;
    ct python:mangle.String.centeredTruncate;
">

  <table class="columns columns2">
    <tbody>
      <tr>
        <tal:block replace="nothing">
          _____________________ sidebar _____________________
        </tal:block>
        <td class="left"
          tal:define="template_id string:tab_edit">
          <metal:block use-macro="view/macro_vein_navigation/macros/vein" />
        </td>

        <tal:block replace="nothing">
          _____________________ main _____________________
        </tal:block>
        <td class="main">

  <form action="." name="silvaObjects" method="POST">

    <table class="listing">
      <thead>
        <tal:block replace="nothing">
          ______________ vein + title row ______________
        </tal:block>
        <tr>
          <td class="top"
            colspan="5">
            <h2>
              <img tal:replace="structure python:view.render_icon(model)" />
              <span style="text-transform:lowercase;"
                tal:content="model/meta_type">Meta type</span> 
              &#xab;<tal:block content="model/get_title_or_id" />&#xbb;
            </h2>
          </td>
        </tr>
      </thead>

      <span tal:replace="nothing"> ______________ table header ______________ </span>
      <tr tal:condition="python:len(objects) != 0">
        <th i18n:translate="" width="3%" nowrap="1">in use</th>
        <th i18n:translate="">edit</th>
        <th i18n:translate="">view</th>
        <th i18n:translate="">publication&nbsp;due&nbsp;</th>
        <th i18n:translate="">expiration&nbsp;due&nbsp;</th>
      </tr>

      <span tal:replace="nothing"> ______________ listing iteration ______________ </span>
      <toc_entry tal:omit-tag=""
          tal:repeat="object objects">
        <tal:define define="obj python:object['object'].getObject();
                            id object/index;
                            object_status obj/version_status;
                            object_path python: '/'.join(obj.object_path());
                            object_url python: model.restrictedTraverse(obj.object_path()).absolute_url();
                            meta_type python: obj.get_content().meta_type;
                            ">
          <cycle tal:define="oddrow repeat/object/odd" tal:omit-tag="">
            <tr class="odd"
                tal:attributes="class python:test(oddrow, 'odd', 'even')">

              <span tal:replace="nothing"> _______ checkbox + icon _______ </span>
              <td class="listing-left">
                <input type="checkbox" name="cb:list" value="value"
                    tal:attributes="value string:cb_${id}; checked object/check_checkbox" />
                <img tal:replace="structure python:view.render_icon(obj.get_content())" />
              </td>

              <span tal:replace="nothing"> _______ id cell _______ </span>
              <td>
                <a title="edit this item"
                   tal:attributes="href string:${object_url}/edit;
                                   title meta_type"
                   tal:content="python: ct(object_path, 30)">id</a>
              </td>

              <span tal:replace="nothing"> _______ title cell _______ </span>
              <td>
                <tal:block condition="python:obj.get_title != ''">
                  <a class="bluelink" title="Preview this item" i18n:attributes="title"
                    tal:attributes="href string:${object_url}">
                    <span tal:replace="string:${obj/get_title}">title</span>
                    <span class="warning" tal:condition="not: object/check_checkbox">
                      &nbsp;<span i18n:translate="">(deselected)</span>
                    </span>
                  </a>
                </tal:block>
                <tal:block condition="python:obj.get_title == ''">
                </tal:block>
              </td>

              <span tal:replace="nothing"> _______ publish date cell _______ </span>
              <td>
                <tal:block define="publication_dt python: obj.publication_datetime()">
                  <tal:block condition="publication_dt">
                    <span tal:replace="structure python: mangle.DateTime(publication_dt).toStr()" tal:omit-tag="">21 oct 2001 18:18</span>
                  </tal:block>
                  <tal:block condition="not: publication_dt">
                   &nbsp; 
                  </tal:block>
                </tal:block>
              </td>

              <span tal:replace="nothing"> _______ expiration date cell _______ </span>
              <td>
                <span tal:condition="object_status">
                  <tal:block define="expiration_dt python: obj.expiration_datetime()">
                    <tal:block condition="expiration_dt">
                      <span tal:replace="structure python: mangle.DateTime(expiration_dt).toStr()" tal:omit-tag="">21 oct 2001 18:18</span>
                    </tal:block>
                    <tal:block condition="not: expiration_dt">
                     &nbsp; 
                    </tal:block>
                  </tal:block>
                </span>
                <span tal:condition="not: object_status" tal:omit-tag="">
                  &nbsp;
                </span>
                &nbsp;
              </td>

            </tr>

          </cycle>
          
        </tal:define>
      </toc_entry>

      <span tal:replace="nothing"> ______________ if no records ______________ </span>
      <check tal:condition="python:len(objects) == 0">
        <tr class="divider">
          <td colspan="5"><img tal:attributes="src string:${root_url}/globals/pixel.gif" width="1" height="1" /></td>
        </tr>
        <tr class="focus-light">
          <td colspan="5">
            <i i18n:translate="">There are no published news items in this filter. Check that news sources are activated (go to the editor screen) and items in the sources are published.</i>
          </td>
        </tr>
        <tr class="divider">
          <td colspan="5"><img tal:attributes="src string:${root_url}/globals/pixel.gif" width="1" height="1" /></td>
        </tr>
      </check>
      <!-- /iteration -->


      <check tal:condition="python:len(objects) != 0">

        <span tal:replace="nothing"> ______________ controls for chief ______________ </span>
        <tr class="controls"
            tal:condition="python:user_role == 'Editor'">
          <td colspan="5">
            <input style="display: none"
                    id="select_all_button"
                    class="button" 
                    type="submit" 
                    name="selectButton" 
                    value="deselect all" 
                    sel_value="select all"
                    desel_value="deselect all"
                    title="select all items: alt-a" 
                    accesskey="a" 
                    onClick="toggleSelect(this); return false"
                    i18n:attributes="value;sel_value;desel_value;title">
            <script type="text/javascript">
            // <![CDATA[

              if (document.forms[0]) {
                document.getElementById('select_all_button').style.display = 'inline';
              }

              isSelected = true;

              function toggleSelect(button) {
                var form = button.form;
                var check = true;
                if (isSelected) {
                  check = false;
                  isSelected = false;
                } else {
                  isSelected = true;
                };
                var inputs = form.getElementsByTagName('input');
                for (var i=0; i < inputs.length; i++) {
                  var child = inputs[i];
                  var type = child.getAttribute('type');
                  if (type != 'radio' && type != 'checkbox') {
                    continue;
                  };
                  if (check) {
                    child.setAttribute('checked', true);
                  } else {
                    // make very sure the checkbox is unchecked, the 
                    // setAttribute works on IE but not on Moz, the 
                    // removeAttribute the other way round, this doesn't
                    // seem to clash and who knows IE 8 will require both ;)
                    child.setAttribute('checked', null);
                    child.removeAttribute('checked');
                  };
                };
                var newvalue = isSelected ? button.getAttribute('desel_value') :
                                button.getAttribute('sel_value');
                button.setAttribute('value', newvalue);
              };
              
            // ]]>
            </script>
            &nbsp;
            <input type="hidden" name="start" tal:attributes="value startat">
            <input class="button" type="submit" name="use_items:method" value="update" title="use selected items in this filter: alt-u" accesskey="u" i18n:attributes="title;value"/>
            &nbsp;
          </td>
        </tr>

      </check>

    </table>

  </form>

<table width="50%" tal:condition="python: previous or next">
  <tr>
    <td width="50%" align="left">
      &nbsp;
      <a href="#" tal:attributes="href string:${model/absolute_url}/edit/tab_edit_items?start:int=${previous/first}" tal:condition="previous" i18n:translate="">Previous</a>
    </td>
    <td width="50%" align="right">
      &nbsp;
      <a href="#" tal:attributes="href string:${model/absolute_url}/edit/tab_edit_items?start:int=${next/first}" tal:condition="next" i18n:translate="">Next</a></td>
  </tr>
</table>

</html>
