<html tal:replace="structure context/manage_page_header"/>

  <body tal:define="ceiling_date python: modules['Products.BastionLedger.utils'].ceiling_date;
                    all python: request.has_key('historical') and request['historical'] == '';
                    now python: DateTime();
                    effective python: not all and request.get('historical', '') or request.get('effective', now);
                    effective python: ceiling_date(effective);
                    opening_dt python: context.openingDate(effective);
                    opening_bal python: context.openingBalance(effective);
                    currency request/currency | context/base_currency;
                    statuses request/statuses | python: ('posted', 'reversed','postedreversal');
                    global balance python: context.balance(effective=effective, currency=currency);
                    entries python: all and context.entryValues((DateTime(0), DateTime('3000/01/01')), statuses) or (not request.has_key('effective') or effective > opening_dt) and context.entryValues((opening_dt, effective), statuses) or context.entryValues(effective, statuses)">

    <span tal:replace="structure context/manage_tabs"/>

    <br/>
    <form action="" tal:attributes="action: request/URL1" method="get">
       <table border="0" cellspacing="0" cellpadding="0" width="100%">
          <tr>
              <td tal:define="actions context/actions" >
                <span class="form-label">Effective</span>
                <input class="form-element" type="text" name="effective:date" value="" size="10"
                       tal:attributes="value python: effective.strftime('%Y/%m/%d')"/>
                <select name="currency" tal:condition="context/isFCA">
                    <option tal:repeat="cur python:(context.defaultCurrency(), context.base_currency)"
                            tal:content="cur" 
                            tal:attributes="selected python: currency==cur and 1 or 0"/>
                </select>
                <input class="form-element" type="submit" name="" 
                       tal:attributes="name template/getId" value=" Show "/>
                &nbsp;&nbsp;
                <span class="form-label">Status</span>&nbsp;
                <span class="form-element" tal:content="context/status"/>
                <select class="form-element" name="workflow_action" tal:condition="nocall: actions">
                     <option tal:repeat="action actions" 
                                  tal:content="action/title"
                                  tal:attributes="value action/transition/id"/>
                </select>
                <input class="form-element" type="submit"  tal:condition="nocall: actions"
                       name="manage_statusModify:method" value=" Change "/>
              </td>
              <td align="right" tal:define="historicals context/historicalDates">
                  <span class="form-label">Period Ends</span>
                  <select class="form-element" name="historical">
                     <option tal:repeat="h historicals"
                             tal:attributes="value python: h.strftime('%Y/%m/%d')"
                             tal:content="python: h.strftime('%Y/%m')"/>
                     <option value="3000/01/01">forwards</option>
                     <option value="">--- all ---</option>
                  </select>
                  <input type="submit" class="form-element" name="manage_statement" value=" Go "/>
              </td>
           </tr>
       </table>
    </form>

       <table border="0" cellpadding="2" cellspacing="0" width="100%">
           <tr><td class="form-label" align="left" tal:content="context/accno"/>
               <td class="form-label" align="left" tal:content="context/title"/>
               <td class="form-label" align="left" tal:content="context/type"/>
               <td class="form-label" align="left" tal:content="context/subtype"/>
               <td class="form-label" tal:content="context/base_currency"/>
               <td class="form-label" align="right" 
                   tal:content="python: effective.strftime('%d %B %Y')"/>
               <td class="form-label" width="100px"/>
               <td class="form-element" align="right">
                   <span class="form-label">Cache</span><i tal:content="string: ${context/totBalance} (${context/totDate})"/>
               </td>
           </tr>
       </table>

       <table border="0" cellpadding="2" cellspacing="0" width="100%">
           <tr class="list-header">
               <td class="list-item">&nbsp;</td>
               <td class="list-item">Transaction</td>
               <td class="list-item">Entered</td>
               <td class="list-item">Date</td>
               <td class="list-item">Description 
                   <a href="manage_setDescriptionFromEntryAccount"><small>[entrify]</small></a>
               </td>
               <td class="list-item" align="right">Debit</td>
               <td class="list-item" align="right">Credit</td>
               <td class="list-item" align="right">Balance</td>
     	       <td class="list-item">&nbsp;</td>
           </tr>
           <tr tal:repeat="entry entries"
               tal:attributes="class python: repeat['entry'].index % 2 and 'row-hilite' or 'row-normal'">
             <tal:entry  tal:define="txn entry/blTransaction | nothing">
               <td class="list-item">
                   <a href="" tal:attributes="href string:${entry/absolute_url}/manage_propertiesForm">
                       <img src="" alt="Entry" border="0" tal:attributes="src entry/icon" />
                   </a>
               </td>
               <td class="list-item">
                   <a href="" tal:condition="python: txn"
                      tal:attributes="href string:${txn/absolute_url}/manage_workspace" 
                      tal:content="txn/getId"/>
               </td>
               <td class="list-item" tal:content="entry/Creator | nothing"/>
               <td class="list-item" 
                   tal:define="dt python: txn and txn.effective_date or effective;"
                   tal:content="python: dt.strftime('%Y/%m/%d')"/>
               <td class="list-item">
                   <a href="" tal:condition="python: txn"
                              tal:attributes="href string:${entry/absolute_url}/manage_workspace"
                              tal:content="entry/title_or_id | nothing"/>
                   <a href="" tal:condition="python: not txn and entry.isControlEntry()"
                              tal:attributes="href string:${entry/blLedgerUrl}/manage_workspace"
                              tal:content="entry/title_or_id | nothing"/>
               </td>
               <tal:amount tal:define="amount python: entry.amountAs(currency)">
                  <tal:debit tal:condition="entry/isDebit | nothing">
                     <td class="list-item" align="right" tal:content="amount"/>
                     <td>&nbsp;</td>
                  </tal:debit>
                  <tal:credit tal:condition="entry/isCredit | nothing">
                     <td>&nbsp;</td>
                     <td class="list-item" align="right" tal:content="python: abs(amount)"/>
                  </tal:credit>
                  <td class="list-item" align="right" nowrap tal:content="balance"/>
                  <td class="list-item">&nbsp;</td>
                  <tal:compute tal:define="global balance python: balance - amount" />
               </tal:amount>
              </tal:entry>
           </tr>
           <tr tal:condition="python: not all">
               <td class="list-item"/>
               <td class="list-item"/>
               <td class="list-item"/>
               <td class="list-item" tal:content="python: opening_dt.strftime('%Y/%m/%d')"/>
               <td class="list-item">Opening Balance</td>
               <td class="list-item"/>
               <td class="list-item"/>
               <td class="list-item" align="right" nowrap tal:content="opening_bal"/>
           </tr>
           <tr>
             <form action="" tal:attributes="action request/URL1">
               <td class="form-element" colspan="8">
                  <input class="form-element" type="text" name="email" size="25" value=""
                         tal:attributes="value request/email | python: getattr(context.aq_inner, 'email')"/>
                  <input class="form-element" type="submit" name="manage_emailStatement:method" value=" Email "/>
             </form>
           </tr>
       </table>
  </body>

<html tal:replace="structure context/manage_page_footer"/>



