<?xml version="1.0" encoding="UTF-8"?><!DOCTYPE html><html manifest="virtual-touchpad.appcache" xmlns="http://www.w3.org/1999/xhtml"><head><meta content="yes" name="mobile-web-app-capable"/><meta content="width=device-width,user-scalable=no" name="viewport"/><link href="img/icon196x196.png" rel="shortcut icon" sizes="196x196"/><meta content="yes" name="apple-mobile-web-app-capable"/><meta content="black-translucent" name="apple-mobile-web-app-status-bar-style"/><link href="img/icon144x144.png" rel="apple-touch-icon" sizes="144x144"/><link href="img/icon114x114.png" rel="apple-touch-icon" sizes="114x114"/><link href="img/icon72x72.png" rel="apple-touch-icon" sizes="72x72"/><link href="img/icon57x57.png" rel="apple-touch-icon" sizes="57x57"/><title>Virtual Touchpad</title><style type="text/css"><![CDATA[html,body{background-color:black;height:100%;margin:0}#touchpad{background:radial-gradient(circle at bottom center,#282828 0,#181818 50%,black 100%);min-height:100%}#message-box{z-index:100;display:none;position:fixed;left:0;right:0;border-radius:5pt;width:inherit;margin:5pt;padding:5pt;background:radial-gradient(circle at top left,white 0,#E0E0E0 50%,#D0D0D0 100%);background-color:white;color:black;font-family:sans-serif;font-size:18pt}#message-box.error{}.toolbar{z-index:50;position:fixed;margin:0;padding:4px}.toolbar.bottom{display:table-cell;left:0;right:0;bottom:0;vertical-align:middle;text-align:right;background:linear-gradient(white 0,#E0E0E0 50%,#D0D0D0 100%);background-color:white}.toolbar>.button{display:table-cell;height:44px;width:44px;float:right;vertical-align:middle;text-align:center}]]></style><script type="text/javascript"><![CDATA[exports=window;exports.checks=(function(){var a={failures:[]};a.failed=function(b){return a.failures.indexOf(b)!=-1;};if(typeof WebSocket=="undefined")a.failures.push("WebSocket");if(!("ontouchstart" in window))a.failures.push("TouchEvents");else if(typeof (TouchList.prototype.identifiedTouch)=="undefined")TouchList.prototype.identifiedTouch=function(a){for(var b=0;b<this.length;b++)if(this[b].identifier===a)return this[b];};if(!document.implementation.hasFeature("http://www.w3.org/TR/SVG11/feature#SVG","1.1")&&!document.implementation.hasFeature("http://www.w3.org/TR/SVG11/feature#Image","1.1"))a.failures.push("SVG");if(typeof (document.documentElement.requestFullscreen)==="undefined")if(document.documentElement.mozRequestFullScreen){document.documentElement.requestFullscreen=document.documentElement.mozRequestFullScreen;document.exitFullscreen=document.mozCancelFullScreen;document.FULLSCREENCHANGE_EVENT_NAME="mozfullscreenchange";document.FULLSCREEN_ELEMENT_NAME="mozFullScreenElement";}else if(document.documentElement.webkitRequestFullscreen){document.documentElement.requestFullscreen=function(){return document.documentElement.webkitRequestFullscreen(Element.ALLOW_KEYBOARD_INPUT);};document.exitFullscreen=document.webkitExitFullscreen;document.FULLSCREENCHANGE_EVENT_NAME="webkitfullscreenchange";document.FULLSCREEN_ELEMENT_NAME="webkitFullscreenElement";}else a.failures.push("Fullscreen");return a;})();exports.controller=(function(){var a={};var b=function(a){this.ws=a;};a.Touchpad=b;b.prototype.buttonDown=function(a){ws.send(JSON.stringify({command:"mouse_down",data:{button:a}}));};b.prototype.buttonUp=function(a){ws.send(JSON.stringify({command:"mouse_up",data:{button:a}}));};b.prototype.scroll=function(a,b){ws.send(JSON.stringify({command:"mouse_scroll",data:{dx:a,dy:b}}));};b.prototype.move=function(a,b){ws.send(JSON.stringify({command:"mouse_move",data:{dx:a,dy:b}}));};return a;})();exports.features=(function(){var a={};a.listMissing=function(){var a=document.createDocumentFragment();function b(b){var c=document.createElement("li");c.innerHTML=b;a.appendChild(c);}if(checks.failed("WebSocket"))b("WebSockets are not supported");if(checks.failed("TouchEvents"))b("Touch events are not supported");if(a.childNodes.length>0){var c=document.createDocumentFragment();c.appendChild(document.createTextNode("Your browser does not support Virtual Touchpad. These "+"features are missing:"));var d=document.createElement("ul");d.appendChild(a);c.appendChild(d);c.appendChild(document.createTextNode("Please upgrade your browser to a newer version."));messagebox.show(c,["error"]);return true;}else return false;};return a;})();exports.messagebox=(function(){var a={};a.show=function(a,b){var c=document.getElementById("message-box");while(c.firstChild)c.removeChild(c.firstChild);if(typeof a==="string")c.innerHTML=a;else c.appendChild(a);c.className=b.join(", ");c.style.display="block";};return a;})();exports.view=(function(){var a={};var b=function(a,b){this.parentEl=a;this.touchpad=b;var c=this;var d,e,f,g,h;this.parentEl.addEventListener("touchstart",d=function(){return c.onTouchStart.apply(c,arguments);});this.parentEl.addEventListener("touchend",e=function(){return c.onTouchEnd.apply(c,arguments);});this.parentEl.addEventListener("touchcancel",f=function(){return c.onTouchCancel.apply(c,arguments);});this.parentEl.addEventListener("touchleave",g=function(){return c.onTouchEnd.apply(c,arguments);});this.parentEl.addEventListener("touchmove",h=function(){return c.onTouchMove.apply(c,arguments);});this.detach=function(){this.parentEl.removeEventListener("touchstart",d);this.parentEl.removeEventListener("touchend",e);this.parentEl.removeEventListener("touchcancel",f);this.parentEl.removeEventListener("touchleave",g);this.parentEl.removeEventListener("touchmove",h);};};a.Touchview=b;function c(a){if(!a)return [];var b=[];for(var c=0;c<a.length;c++)b.push({identifier:a[c].identifier,screenX:a[c].screenX,screenY:a[c].screenY});return b;}function d(a,b){var c=b.screenX-a.screenX;var d=b.screenY-a.screenY;var e=Math.sqrt(c*c+d*d);var f=Math.atan2(d,c);var g=0.3;var h=1.5;var i=h*Math.pow(e,1.0+g);return [Math.cos(f)*i,Math.sin(f)*i];}function e(a,b){var c=b.screenX-a.screenX;var d=b.screenY-a.screenY;var e=-1;var f=-1;return [c>0?e:c<0?-e:0,d>0?f:d<0?-f:0];}b.prototype.click=function(a){var b=this;var d=c(this.currentTouches);this._click=setTimeout(function(){var a=d.length==2?3:1;b.touchpad.buttonDown(a);b.touchpad.buttonUp(a);b._click=undefined;},300);};b.prototype.clickInProgress=function(){return !!this._click;};b.prototype.clickCancel=function(){if(this._click){clearTimeout(this._click);this._click=undefined;return true;}else return false;};b.prototype.dndStart=function(){this._dnd=true;this.touchpad.buttonDown(1);};b.prototype.dndInProgress=function(){return !!this._dnd;};b.prototype.dndEnd=function(){this._dnd=false;this.touchpad.buttonUp(1);};b.prototype.onTouchStart=function(a){this.currentTouches=c(a.touches);this._hasMoved=false;a.preventDefault();};b.prototype.onTouchEnd=function(a){if(!this._hasMoved)if(this.dndInProgress())this.dndEnd();else this.click(this.currentTouches.length==2?3:1);delete this.currentTouches;};b.prototype.onTouchCancel=function(a){};b.prototype.onTouchLeave=function(a){};b.prototype.onTouchMove=function(a){this._hasMoved=true;if(this.clickInProgress()){this.clickCancel();this.dndStart();}if(!a.changedTouches)return;if(a.changedTouches.length!=this.currentTouches.length)return;var b=this.currentTouches[0];var f=a.changedTouches.identifiedTouch(b.identifier);this.currentTouches=c(a.changedTouches);if(a.changedTouches.length==1){var g=d(b,f);this.touchpad.move.apply(undefined,g);}else if(a.changedTouches.length==2){var h=e(b,f);this.touchpad.scroll.apply(undefined,h);}a.preventDefault();};return a;})();exports.toolbar=(function(){var a={};var b=function(a){this.parentEl=a;this.parentEl.addEventListener("touchstart",this.onTouchStart.bind(this));this.parentEl.addEventListener("touchend",this.onTouchEnd.bind(this));this.parentEl.addEventListener("touchcancel",this.onTouchCancel.bind(this));this.parentEl.addEventListener("touchleave",this.onTouchEnd.bind(this));this.parentEl.addEventListener("touchmove",this.onTouchMove.bind(this));this.applyClass();};a.Toolbar=b;b.prototype.applyClass=function(){if(this.parentEl.classList.contains("bottom")){var a,b,c;var d,e,f=-(4*this.parentEl.clientHeight/5);this.start=function(d){a=d.touches[0].screenX;b=d.touches[0].screenY;c=this.parentElBottom();};this.setPosition=function(a){var d=b-a.screenY;var e=c+d;this.parentEl.style.bottom=(e>0?0:e>-this.parentEl.clientHeight?e:-this.parentEl.clientHeight)+"px";this._locked=e>=0;};this.hideStart=function(){d=this.parentElBottom();e=f-d;};this.hideUpdate=function(){var a=f-this.parentElBottom();progress=1-a/e,t=Math.sin(Math.PI*0.5*(progress+0.1));if(t>1.0)t=1.0;else if(t<0.0)t=0.0;this.parentEl.style.bottom=(d+e*t).toFixed(0)+"px";return this.parentElBottom()==f;};}else throw "Unknown tool bar type";};b.prototype.parentElBottom=function(){var a=parseInt(getComputedStyle(this.parentEl).getPropertyValue("bottom"));return isNaN(a)?0:a;};b.prototype.hide=function(){if(this._hideInterval)return;this.hideStart();this._hideInterval=setInterval((function(){if(this.hideUpdate()===true)this.hideStop();}).bind(this),50);};b.prototype.hideStop=function(){if(this._hideInterval){clearInterval(this._hideInterval);this._hideInterval=undefined;return true;}else return false;};b.prototype.onTouchStart=function(a){this._identifier=a.touches[0].identifier;this.start(a);this.hideStop();if(this._hideTimer){clearTimeout(this._hideTimer);this._hideTimer=undefined;}};b.prototype.onTouchEnd=function(a){if(!this._locked)this.hide();else this._hideTimer=setTimeout((function(){this.hide();}).bind(this),3000);};b.prototype.onTouchCancel=function(a){this.hide();};b.prototype.onTouchLeave=function(a){};b.prototype.onTouchMove=function(a){var b=a.changedTouches.identifiedTouch(this._identifier);if(b)this.setPosition(b);a.preventDefault();};return a;})();exports.toolbar.bottom=(function(){var a,b;function c(){document.querySelector(".toolbar > .fullscreen-on").style.display=(document[document.FULLSCREEN_ELEMENT_NAME]||checks.failed("Fullscreen"))?"none":"table-cell";document.querySelector(".toolbar > .fullscreen-off").style.display=(document[document.FULLSCREEN_ELEMENT_NAME]&&!checks.failed("Fullscreen"))?"table-cell":"none";}return{initialize:function(d){if(checks.failed("SVG")){d.parentElement.removeChild(d);return;}b=d;a=new toolbar.Toolbar(b);setTimeout(a.hide.bind(a),2000);c();document.addEventListener(document.FULLSCREENCHANGE_EVENT_NAME,c);},onFullscreenOn:function(){document.documentElement.requestFullscreen();},onFullscreenOff:function(){document.exitFullscreen();}};})();exports.main=function(){if(features.listMissing())return;var a,b;var c=document.getElementById("touchpad");ws=new WebSocket("ws://"+document.location.host+"/ws");ws.onopen=function(){a=new controller.Touchpad(ws);b=new view.Touchview(c,a);};ws.onclose=function(){b.detach();a=undefined;messagebox.show("Connection closed. Please click "+"<a href='javascript:location.reload();'>here</a> to reconnect.",["error"]);};ws.onerror=function(a){messagebox.show("Failed to connect. Please verify that <host> is running.".replace(/<host>/g,document.location.host),["error"]);};toolbar.bottom.initialize(document.getElementById("toolbar-bottom"));};]]></script></head><body onload="exports.main();"><div id="message-box"></div><div id="touchpad"></div><div class="toolbar bottom" id="toolbar-bottom"><div class="button fullscreen-on" onclick="javascript:toolbar.bottom.onFullscreenOn();"><svg version="1.1" viewBox="0 0 44 44" xmlns="http://www.w3.org/2000/svg" xmlns:cc="http://creativecommons.org/ns#" xmlns:dc="http://purl.org/dc/elements/1.1/" xmlns:rdf="http://www.w3.org/1999/02/22-rdf-syntax-ns#"><g transform="translate(0 -1008.4)"><rect fill="none" height="36" rx="1.7045" ry="1.9286" stroke="#606060" stroke-linecap="round" stroke-width="2" width="40" x="2" y="1012.4"/><g fill="#606060"><path d="m6 1044.4v-7.071l2.1213 2.1213 3.5355-3.5355 2.8284 2.8284-3.5355 3.5355 2.1213 2.1213z"/><path d="m38 1044.4v-7.071l-2.1213 2.1213-3.5355-3.5355-2.8284 2.8284 3.5355 3.5355-2.1213 2.1213z"/><path d="m6 1016.4v7.071l2.1213-2.1213 3.5355 3.5355 2.8284-2.8284-3.5355-3.5355 2.1213-2.1213z"/><path d="m38 1016.4v7.071l-2.1213-2.1213-3.5355 3.5355-2.8284-2.8284 3.5355-3.5355-2.1213-2.1213z"/></g></g></svg></div><div class="button fullscreen-off" onclick="javascript:toolbar.bottom.onFullscreenOff();"><svg version="1.1" viewBox="0 0 44 44" xmlns="http://www.w3.org/2000/svg" xmlns:cc="http://creativecommons.org/ns#" xmlns:dc="http://purl.org/dc/elements/1.1/" xmlns:rdf="http://www.w3.org/1999/02/22-rdf-syntax-ns#"><g transform="translate(0 -1008.4)"><rect fill="none" height="36" rx="1.7045" ry="1.9286" stroke="#606060" stroke-linecap="round" stroke-width="2" width="40" x="2" y="1012.4"/><g fill="#606060"><path d="m29 1025.4v-7.071l2.1213 2.1213 3.5355-3.5355 2.8284 2.8284-3.5355 3.5355 2.1213 2.1213z"/><path d="m15 1025.4v-7.071l-2.1213 2.1213-3.5355-3.5355-2.8284 2.8284 3.5355 3.5355-2.1213 2.1213z"/><path d="m29 1035.4v7.071l2.1213-2.1213 3.5355 3.5355 2.8284-2.8284-3.5355-3.5355 2.1213-2.1213z"/><path d="m15 1035.4v7.071l-2.1213-2.1213-3.5355 3.5355-2.8284-2.8284 3.5355-3.5355-2.1213-2.1213z"/></g></g></svg></div></div></body></html>