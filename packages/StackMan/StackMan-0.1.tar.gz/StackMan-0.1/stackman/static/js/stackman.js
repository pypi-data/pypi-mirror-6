!function(){var a,b,c,d,e,f,g,h,i,j,k,l,m,n,o,p={}.hasOwnProperty,q=function(a,b){function d(){this.constructor=a}for(var c in b)p.call(b,c)&&(a[c]=b[c]);return d.prototype=b.prototype,a.prototype=new d,a.__super__=b.prototype,a};j=function(){function a(a){this.element=a,this.tab_container=$("<ul></ul>"),this.tab_container.attr("id","tabs"),this.tab_container.addClass("nav nav-tabs"),this.tab_container.appendTo(this.element),this.pane_container=$("<div></div>"),this.pane_container.attr("id","panes"),this.pane_container.addClass("tab-content"),this.pane_container.appendTo(this.element),this.tab_counter=0}return a.prototype.clear=function(){return this.tab_container.html(""),this.pane_container.html(""),this.tab_counter=0},a.prototype.add_tab=function(a,b){var c,d,e;return c=$("<li></li>"),0===this.tab_counter&&c.addClass("active"),c.appendTo(this.tab_container),d=$("<a></a>"),d.attr("href","#pane-"+this.tab_counter),0===this.tab_counter&&d.addClass("active"),d.text(a),d.appendTo(c),d.click(function(a){var b;return a.preventDefault(),b=$(a.target),b.tab("show")}),e=$("<div></div>"),e.addClass("tab-pane"),0===this.tab_counter&&e.addClass("active"),e.attr("id","pane-"+this.tab_counter),e.appendTo(this.pane_container),b.appendTo(e),this.tab_counter++},a}(),k=function(){function a(a,b,c,d){var e;this.control_id=a,null==c&&(c=""),this.type=null!=d?d:"text",this.widget=$("<div>"),this.widget.addClass("form-group"),e=$("<label>"),e.attr("for",this.control_id),e.html(b),e.appendTo(this.widget),this.control=$("<input>"),this.control.attr("type",this.type),this.control.attr("id",this.control_id),this.control.addClass("form-control"),this.control.val(c),this.control.appendTo(this.widget)}return a.prototype.get_value=function(){return this.control.val()},a}(),d=function(){function a(a,b,c,d){var e,f,g,h,i;for(this.control_id=a,null==d&&(d=""),this.widget=$("<div>"),this.widget.addClass("form-group"),e=$("<label>"),e.attr("for",this.control_id),e.html(b),e.appendTo(this.widget),this.control=$("<select>"),this.control.attr("id",this.control_id),this.control.addClass("form-control"),h=0,i=c.length;i>h;h++)g=c[h],f=$("<option>"),f.text(g),f.val(g),f.appendTo(this.control);this.control.val(d),this.control.appendTo(this.widget)}return a.prototype.get_value=function(){return this.control.val()},a}(),b=function(){function a(a,b,c){var d;this.control_id=a,null==c&&(c=!1),this.widget=$("<div>"),this.widget.addClass="checkbox",d=$("<label>"),d.text(b),d.appendTo(this.widget),d.prepend(" "),this.control=$('<input type="checkbox">'),this.control.attr("id",this.control_id),this.control.prop("checked",c),this.control.prependTo(d)}return a.prototype.get_value=function(){return this.control.is(":checked")},a}(),e=function(){function a(){var a,b,c,d,e;this.modal=$("<div>"),this.modal.addClass("modal"),this.modal.attr("id","modal"),this.modal.on("hidden.bs.modal",$.proxy(this.destroy,this)),this.modal.prependTo($("body")),c=$("<div>"),c.addClass("modal-dialog"),c.appendTo(this.modal),b=$("<div>"),b.addClass("modal-content"),b.appendTo(c),e=$("<div>"),e.addClass("modal-header"),e.appendTo(b),a=$("<button>"),a.attr("type","button"),a.attr("data-dismiss","modal"),a.attr("aria-hidden","true"),a.addClass("close"),a.html("&times;"),a.appendTo(e),this.modal_title=$("<div>"),this.modal_title.addClass("modal-title"),this.modal_title.appendTo(e),this.modal_body=$("<div>"),this.modal_body.addClass("modal-body"),this.modal_body.appendTo(b),d=$("<div>"),d.addClass("modal-footer"),d.appendTo(b),this.button_cancel=$("<button>"),this.button_cancel.addClass("btn btn-default"),this.button_cancel.attr("data-dismiss","modal"),this.button_cancel.text("Cancel"),this.button_cancel.appendTo(d),this.button_save=$("<button>"),this.button_save.addClass("btn btn-primary"),this.button_save.text("Save"),this.button_save.appendTo(d),this.controls=[],this.modal.modal({backdrop:"static"}),this.modal.modal("show")}return a.prototype.destroy=function(){return void 0!==this.modal?this.modal.remove():void 0},a.prototype.set_title=function(a){return this.modal_title.html("<h4>"+a+"</title>")},a.prototype.add_p=function(a){return this.modal_body.append($("<p>"+a+"</p>"))},a.prototype.add_control=function(a){return this.controls.push(a),a.widget.appendTo(this.modal_body)},a.prototype.clear_controls=function(){return this.controls=[]},a.prototype.show=function(){return this.modal.modal("show")},a.prototype.hide=function(){return this.modal.modal("hide")},a}(),a=function(a){function b(){b.__super__.constructor.call(this),this.set_title("Add Stack"),this.add_control(new k("stack-name","Stack Name")),this.button_save.click($.proxy(this.on_save,this)),this.show()}return q(b,a),b.prototype.launch=function(){return new b},b.prototype.on_save=function(){return m.submit("","addstack",this.controls[0].get_value()),this.modal.modal("hide")},b}(e),i=function(a){function c(a){var b;this.stack=a,c.__super__.constructor.call(this),this.stack_items=$(document).data("stack_items"),b=Object.keys(this.stack_items),b.sort(),this.set_title("Add Item"),this.add_control(new d("item-type","Type to create",b)),this.button_save.text("Next"),this.button_save.click($.proxy(this.on_first_save,this)),this.show}return q(c,a),c.prototype.launch=function(){return new c},c.prototype.on_first_save=function(){var c,d,e,f,g,h;for(this.item_type=this.controls[0].get_value(),this.clear_controls(),this.modal_body.html(""),this.button_save.text("Add"),this.button_save.off("click"),this.button_save.click($.proxy(this.on_second_save,this)),g=this.stack_items[this.item_type]._args,h=[],e=0,f=g.length;f>e;e++)switch(c=g[e],d=this.stack_items[this.item_type][c],d.type){case"str":case"int":h.push(this.add_control(new k(c,d.label,d["default"])));break;case"bool":h.push(this.add_control(new b(c,d.label,d["default"])));break;default:h.push(void 0)}return h},c.prototype.on_second_save=function(){var b,c,d,e,f;for(b={},f=this.controls,d=0,e=f.length;e>d;d++)c=f[d],b[c.control_id]=c.get_value();return m.submit(this.stack.id,"additem",{"class":this.item_type,config:b}),this.modal.modal("hide")},c}(e),g=function(){function a(a,b){this.stack=a,this.status=b._status,this.id=b._id,this["class"]=b._class,this.command=b._command,this.config=b,this.console_log=""}return a.prototype.draw=function(){var a,b,c,d,e,f,g,h,i;for(this.widget=$("<div>"),this.widget.addClass("panel"),this.widget.attr("id",this.stack.name+"--"+this.config.name),a=$("<div><strong>"+this.config.name+"</strong> </div>"),a.addClass("panel-heading"),a.appendTo(this.widget),this.status_text=$("<small>"),this.status_text.appendTo(a),b=$("<div>"),b.addClass("pull-right"),b.appendTo(a),this.start_button=$("<button>Start</button>"),this.start_button.addClass("btn btn-success btn-xs"),this.start_button.appendTo(b),this.start_button.click($.proxy(this.start,this)),b.append(" "),this.stop_button=$("<button>Stop</button>"),this.stop_button.addClass("btn btn-danger btn-xs"),this.stop_button.appendTo(b),this.stop_button.click($.proxy(this.stop,this)),b.append(" "),this.info_button=$("<button>+ Show Info</button>"),this.info_button.addClass("btn btn-info btn-xs"),this.info_button.appendTo(b),this.info_button.click($.proxy(this.toggle_body,this)),b.append(" "),this.delete_button=$("<button>Remove</button>"),this.delete_button.addClass("btn btn-danger btn-xs"),this.delete_button.appendTo(b),this.delete_button.click($.proxy(this.remove,this)),b.append(" "),this.move_buttons=$('<div class="btn-group"></div>'),this.move_buttons.appendTo(b),this.move_up_button=$('<button><span class="glyphicon glyphicon-chevron-up"></span></button>'),this.move_up_button.addClass("btn btn-xs"),this.move_up_button.click($.proxy(this.move_up,this)),this.move_up_button.appendTo(this.move_buttons),this.move_down_button=$('<button><span class="glyphicon glyphicon-chevron-down"></span></button>'),this.move_down_button.addClass("btn btn-xs"),this.move_down_button.click($.proxy(this.move_down,this)),this.move_down_button.appendTo(this.move_buttons),this.body=$("<div>"),this.body.addClass("panel-body"),this.body.appendTo(this.widget),this.body.hide(),d=$('<table><thead><tr><th width="200">Setting</th><th>Value</th></tr></thead></table>'),d.addClass("table table-condensed table-striped"),d.appendTo(this.body),e=$("<tbody>"),e.appendTo(d),i=Object.keys(this.config),g=0,h=i.length;h>g;g++)c=i[g],f=$("<tr><td>"+c+"</td><td>"+this.config[c]+"</td></tr>"),f.appendTo(e);return this.console_log=$("<pre>"),this.console_log.css("height","400px"),this.console_log.css("overflow","auto"),this.console_log.appendTo(this.body),this.footer=$("<div>"),this.footer.addClass("panel-footer"),this.footer.appendTo(this.widget),this.footer.hide(),this.update_widget()},a.prototype.start=function(){return m.submit(this.stack.id,"start",this.id)},a.prototype.stop=function(){return m.submit(this.stack.id,"stop",this.id)},a.prototype.remove=function(){return m.submit(this.stack.id,"removeitem",this.id)},a.prototype.destroy=function(){return this.widget.remove()},a.prototype.move_up=function(){return m.submit(this.stack.id,"moveup",this.id)},a.prototype.move_down=function(){return m.submit(this.stack.id,"movedown",this.id)},a.prototype.add_log=function(a,b){return null==b&&(b=null),null!==b&&(a="<span class='text-"+b+"'>"+a+"</span>"),this.console_log.append(a),this.footer.html("<small>"+a+"</small>")},a.prototype.toggle_body=function(){return this.body.is(":visible")?(this.info_button.text("+ Show Info"),this.body.hide()):(this.info_button.text("- Hide Info"),this.body.show())},a.prototype.update_widget=function(){switch(this.widget.removeClass("panel-success panel-danger panel-warning"),this.stop_button.hide(),this.start_button.hide(),this.footer.hide(),this.status){case"stopped":return this.widget.addClass("panel-danger"),this.status_text.text("Stopped"),this.start_button.show(),this.add_log("[StackMan] Stopped\n","primary");case"ready":return this.widget.addClass("panel-success"),this.status_text.text("Ready"),this.stop_button.show(),this.add_log("[StackMan] Ready\n","primary");case"stopping":return this.widget.addClass("panel-warning"),this.status_text.text("Stopping"),this.add_log("[StackMan] Stopping\n","primary");case"running":case"starting":return this.widget.addClass("panel-warning"),this.status_text.text("Starting"),this.add_log("[StackMan] Starting\n","primary"),this.footer.show()}},a.prototype.process_command=function(a){switch(a.command){case"status":return this.status=a.payload,this.update_widget();case"stdout":return this.add_log(a.payload);case"stderr":return this.add_log(a.payload,"danger")}},a}(),f=function(){function a(a,b){var c,d,e,f;for(this.id=a,this.name=b.name,this.items=[],this.item_container=$("<div>"),f=b.items,d=0,e=f.length;e>d;d++)c=f[d],this.add_item(c)}return a.prototype.draw=function(){var a,b,c;return this.widget=$("<div>"),a=$("<nav>"),a.addClass("navbar navbar-default"),a.appendTo(this.widget),b=$("<div>"),b.addClass("navbar-form navbar-left"),b.appendTo(a),c=$("<div>"),c.addClass("navbar-form navbar-right"),c.appendTo(a),this.button_start=$("<button>Start All</button>"),this.button_start.addClass("btn btn-success navbar-btn btn-sm"),this.button_start.click($.proxy(this.start_all,this)),this.button_start.appendTo(b),b.append(" "),this.button_stop=$("<button>Stop All</button>"),this.button_stop.addClass("btn btn-danger navbar-btn btn-sm"),this.button_stop.click($.proxy(this.stop_all,this)),this.button_stop.appendTo(b),b.append(" "),this.button_delete=$("<button>Delete Stack</button>"),this.button_delete.addClass("btn btn-danger navbar-btn btn-sm"),this.button_delete.click($.proxy(this.remove,this)),this.button_delete.appendTo(c),c.append(" "),this.button_rename=$("<button>"),this.button_add=$("<button>Add Item</button>"),this.button_add.addClass("btn btn-primary navbar-btn btn-sm"),this.button_add.click($.proxy(this.on_add_click,this)),this.button_add.appendTo(b),this.item_container.appendTo(this.widget)},a.prototype.start_all=function(){return this.items.length>0?m.submit(this.id,"start",this.items[this.items.length-1].id):void 0},a.prototype.stop_all=function(){return this.items.length>0?m.submit(this.id,"stop",this.items[0].id):void 0},a.prototype.index_by_id=function(a){var b,c,d;for(b=c=0,d=this.items.length-1;d>=0?d>=c:c>=d;b=d>=0?++c:--c)if(this.items[b].id===a)return b},a.prototype.move_up=function(a){var b,c,d,e,f;return c=this.index_by_id(a),d=c+1,e=this.items[c],b=this.items[d],e.widget.insertBefore(b.widget),f=[this.items[d],this.items[c]],this.items[c]=f[0],this.items[d]=f[1],f},a.prototype.move_down=function(a){var b,c,d,e,f;return c=this.index_by_id(a),d=c-1,e=this.items[c],b=this.items[d],e.widget.insertAfter(b.widget),f=[this.items[d],this.items[c]],this.items[c]=f[0],this.items[d]=f[1],f},a.prototype.remove=function(){return m.submit(this.id,"removestack",[])},a.prototype.on_add_click=function(){return new i(this)},a.prototype.add_item=function(a){var b;return b=new g(this,a),this.items.push(b),b.draw(),b.widget.prependTo(this.item_container)},a.prototype.remove_item=function(a){var b,c,d,e;for(e=[],b=c=0,d=this.items.length-1;d>=0?d>=c:c>=d;b=d>=0?++c:--c){if(this.items[b].id===a){this.items[b].destroy(),this.items.splice(b,1);break}e.push(void 0)}return e},a.prototype.process_command=function(a){var b,c,d,e,f;for("additem"===a.command?this.add_item(a.payload):"removeitem"===a.command?this.remove_item(a.sender):"moveup"===a.command?this.move_up(a.sender):"movedown"===a.command&&this.move_down(a.sender),e=this.items,f=[],c=0,d=e.length;d>c;c++)b=e[c],b.id===a.sender?f.push(b.process_command(a)):f.push(void 0);return f},a}(),h=function(){function a(){this.stacks=[]}return a.prototype.stack_sorter=function(a,b){return a=a[1].config.name.toLowerCase(),b=b[1].config.name.toLowerCase(),b>a?-1:a>b?1:0},a.prototype.load_stacks=function(a){var b,c,d,e,f,g,h,i;o.clear(),d=[],h=a.stacks;for(b in h)e=h[b],d.push([b,e]);for(d.sort(this.stack_sorter),i=[],f=0,g=d.length;g>f;f++)c=d[f],i.push(this.add_stack(c[0],c[1]));return i},a.prototype.add_stack=function(a,b){var c;return c=new f(a,b),this.stacks.push(c),c.draw(),o.add_tab(c.name,c.widget)},a.prototype.process_command=function(a){var b,c,d,e,f;if("addstack"===a.command)return this.add_stack(a.stack,a.payload);for(e=this.stacks,f=[],c=0,d=e.length;d>c;c++)b=e[c],b.id===a.stack?f.push(b.process_command(a)):f.push(void 0);return f},a}(),c=function(){function a(){this.socket=new WebSocket("ws://"+location.host+"/socket"),this.socket.onmessage=$.proxy(this.process_message,this)}return a.prototype.process_message=function(a){var b;return b=JSON.parse(a.data),console.log(b),"list"===b.command?($(document).data("stack_items",b.payload.items),n.load_stacks(b.payload)):n.process_command(b)},a.prototype.submit=function(a,b,c){var d;return d={stack:a,command:b,arg:c},d=JSON.stringify(d),this.socket.send(d)},a}(),n=new h,l=$("#btn-add"),l.click(function(){return new a}),o=new j($("#stacks")),m=new c,m.socket.onopen=function(){return m.submit("","list",[])}}.call(this);
