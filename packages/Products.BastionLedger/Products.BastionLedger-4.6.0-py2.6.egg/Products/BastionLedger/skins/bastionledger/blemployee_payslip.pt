<html xmlns:tal="http://xml.zope.org/namespaces/tal"
      xmlns:metal="http://xml.zope.org/namespaces/metal"
      metal:use-macro="context/main_template/macros/master"
      i18n:domain="bastionledger">

<body>
  <div metal:fill-slot="main">

    <metal:payslip metal:define-macro="payslip">

    <tal:variables tal:define="txn python: context.blTransaction();
                     employee nocall: context/aq_parent;
                     gross_id python: context.Ledger.accountIds(tags='wages_exp')[0];
                     tax_id python: context.Ledger.accountIds(tags='wages_tax')[0]">

    <table summary="" border="0" cellpadding="2" cellspacing="0" width="100%">
       <tr>
           <td align="left" valign="top">
             <span class="label">Payroll</span>&nbsp;
             <span class="field" tal:content="context/aq_parent/aq_parent/aq_parent/title"/>
           </td>
           <td align="right" valign="top">
             <span class="label">Date</span>&nbsp;
             <span class="field" tal:content="python: txn.effective().strftime('%Y/%m/%d')"/>
           </td>
       </tr>
    </table>
    <table summary="" border="0" cellpadding="2" cellspacing="0" width="100%" bgcolor="silver">
       <tr>
           <td valign="top">
              <table summary="" border="0" cellpadding="2" cellspacing="0" width="100%">
                <tr>
                    <td class="label">Employee No.</td>
                    <td class="field" tal:content="employee/getId"/>
                    <td class="label">Salary P.A.</td>
                    <td class="field" tal:content="employee/salary"/>
                </tr>
                <tr>
                    <td class="label">Name</td>
                    <td class="field" tal:content="employee/title"/>
                    <td class="label">Bank Account</td>
                    <td class="field" tal:content="employee/bank_account"/>
                </tr>
                <tr>
                    <td class="label">Department</td>
                    <td class="field" tal:content="employee/department"/>
                    <td class="label">Tax Number</td>
                    <td class="field" tal:content="employee/tax_number"/>
                </tr>
                <tr>
                    <td colspan="2">&nbsp;</td>
                    <td class="label">Tax Code</td>
                    <td class="field" tal:content="employee/tax_code"/>

                </tr>
            </table>
           </td>
        </tr>
        <tr>
           <td valign="top">
             <table summary="" border="0" cellpadding="3" cellspacing="3" width="100%">
               <tr>
                 <td width="35%" valign="top">
                   <table summary="" border="1" cellpadding="2" cellspacing="0" bgcolor="white" width="100%"
                          tal:define="gross python: txn.blEntry(gross_id)">
                     <tr>
                          <td colspan="3" align="center"><span class="label">Taxable Payments</span></td>
                     </tr>
                     <tr class="list-header">
                          <td><span class="label">Type</span></td>
                          <td><span class="label">Quantity</span></td>
                          <td><span class="label">Value</span></td>
                     </tr>
                     <tr>
                          <td height="200" valign="top" class="field" tal:content="gross/title"/>
                          <td></td>
                          <td align="right" valign="top" class="field" nowrap tal:content="gross/amount"/>
                      </tr>
                     <tr>
                          <td colspan="2"><span class="label">Total Taxable</span></td>
                          <td align="right" class="field" nowrap tal:content="gross/amount"/>
                      </tr>
                 </table>
               </td>
               <td width="35%" valign="top">
                 <table summary="" border="1" cellpadding="2" cellspacing="0" bgcolor="white" width="100%">
                     <tr>
                          <td colspan="3" align="center"><span class="label">Non-Taxable Payments</span></td>
                     </tr>
                     <tr class="list-header">
                          <td><span class="label">Type</span></td>
                          <td><span class="label">Quantity</span></td>
                          <td><span class="label">Value</span></td>
                     </tr>
                     <tr>
                          <td height="200">&nbsp;</td>
                          <td>&nbsp;</td>
                          <td>&nbsp;</td>
                      </tr>
                     <tr>
                          <td colspan="2"><span class="label">Total Non-Taxable</span></td>
                          <td>&nbsp;</td>
                      </tr>
                 </table>
               </td>
               <td width="25%" valign="top">
                  <table summary="" border="1" cellpadding="2" cellspacing="0" bgcolor="white" width="100%"
                         tal:define="tax python: txn.blEntry(tax_id)">
                     <tr>
                          <td colspan="2"><span align="center" class="label">Deductions</span></td>
                     </tr>
                     <tr class="list-header">
                          <td><span class="label">Description</span></td>
                          <td><span class="label">Amount</span></td>
                     </tr>
                     <tr>
                          <td height="200" valign="top" class="field">
                               <span tal:condition="nocall: tax" tal:replace="tax/title"/>&nbsp;
                          </td>
                          <td valign="top" align="right" class="field" nowrap >
                               &nbsp;<span tal:condition="nocall: tax" tal:replace="tax/absAmount"/>
                          </td>
                      </tr>
                      <tr>
                          <td><span class="label">Total Deductions</span></td>
                          <td align="right" class="field" nowrap>
                               &nbsp;<span tal:condition="nocall: tax" tal:replace="tax/absAmount"/>
                          </td>
                      </tr>
                </table>
               </td>
              </tr>
             </table>
           </td>
        </tr>
         <tr>
            <td valign="top">
                <table summary="" border="0" cellpadding="3" cellspacing="3" width="100%">
                   <tr>
                       <td width="40%" valign="top">
                   <table summary="" border="1" cellpadding="2" cellspacing="0" bgcolor="white" width="100%">
                     <tr>
                          <td colspan="3" align="center"><span class="label">Year To Date</span></td>
                     </tr>
                     <tr class="list-header">
                          <td><span class="label">Gross Taxable</span></td>
                          <td><span class="label">Tax</span></td>
                          <td><span class="label">Net</span></td>
                     </tr>
                     <tr>
                          <td align="right" valign="center" height="40" class="field"
                              tal:content="context/gross_to_date"/>
                          <td align="right" valign="center" class="field"
                              tal:content="python: abs(context.tax_to_date)"/>
                          <td align="right" valign="center" class="field"
                              tal:content="python: -context.net_to_date"/>
                     </tr>
                    </table>
                       </td>
                        <td valign="top">
                            <table summary="" bgcolor="white" width="100%" height="100%">
                               <tr class="list-header">
                                   <td><span class="label" valign="top">Message</span></td>
                               </tr>
                               <tr><td tal:content="structure context/message | nothing"/></tr>
                            </table>
                        </td>
                        <td valign="bottom" width="20%">
                             <table summary="" bgcolor="white" width="100%">
                               <tr>
                                   <td><span class="label">NET</span></td>
                                   <td align="right" class="field"
                                       tal:content="python:txn.blEntry(employee.getId()).absAmount()"/>
                               </tr>
                            </table>
                         </td>
                 </tr>
                </table>
            </td>
        </tr>
      </table>
    </tal:variables>
    </metal:payslip>

      <div tal:replace="structure provider:plone.belowcontentbody">
           Document actions (print, sendto etc)
      </div>

  </div>

</body>
</html>
