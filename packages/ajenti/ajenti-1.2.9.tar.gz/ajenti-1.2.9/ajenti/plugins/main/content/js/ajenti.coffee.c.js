(function(){var a,d,c,b,e;window.WEB_SOCKET_SWF_LOCATION="/static/main/WebSocketMain.swf";window.Stream=(function(){function f(){}f.prototype.start=function(){this.socket=ajentiConnectSocket("/stream");this.socket.on("connect",function(){return $("#connection-error").hide()});this.socket.on("auth-error",function(){console.log("Authentication lost!");return location.reload()});this.socket.on("disconnect",function(){return $("#connection-error").show()});this.socket.on("init",function(g){g=JSON.parse(g);console.group("Welcome to Ajenti");console.log("version",g.version);console.log("running on",g.platform);console.log("your session:",g.session);$("title").text(g.hostname);console.groupEnd();Feedback.configure(g.feedback,g.platform,g.version,g.edition);return Feedback.emit("Login")});this.socket.on("ui",function(g){console.group("Received update");console.log("Transfer size",g.length);profiler.start("Decompressing");g=RawDeflate.inflate(RawDeflate.Base64.decode(g));profiler.stop();console.log("Payload size",g.length);g=JSON.parse(g);console.log("JSON data:",g);UI.clear();profiler.start("UI inflating");g=UI.inflate(g);profiler.stop();profiler.start("UI replacement");UI.replace(g);profiler.stop();console.log("Total elements:",UI._total_elements);console.groupEnd();return Loading.hide()});this.socket.on("ack",function(){return Loading.hide()});this.socket.on("update-request",function(){UI.checkForUpdates();UI.sendUpdates(true);return Loading.show()});this.socket.on("crash",function(g){g=JSON.parse(g);console.log("CRASH:",g);return ajentiCrash(g)});this.socket.on("security-error",function(){console.log("SECURITY ERROR");return ajentiSecurityError()});this.socket.on("notify",function(g){g=JSON.parse(g);return Notificator.notify(g.type,g.text)});this.socket.on("openTab",function(g){g=JSON.parse(g);return Tabs.addTab(g.url,g.title)});this.socket.on("closeTab",function(g){g=JSON.parse(g);return Tabs.closeTab(g.url)});this.socket.on("debug",function(g){var h;g=JSON.parse(g);console.group("Profiling");for(h in g.profiles){console.log(h,g.profiles[h])}return console.groupEnd()});return $("#connection-error").hide()};f.prototype.send=function(g){console.log("Sending updates",g);this.socket.send(JSON.stringify(g));return Loading.show()};f.prototype.emit_ui_update=function(g){return this.send({type:"ui_update",content:g})};return f})();window.UIManager=(function(){function f(g){this.stream=g;this.ui=null;this.pendingUpdates=[];this.updaterTimeout=null}f.prototype.inflate=function(o){var g,h,p,n,i,j,m,k,l=this;h=[];this._total_elements+=1;if(o.visible===true){k=o.children;i=function(q){return h.push(l.inflate(q))};for(j=0,m=k.length;j<m;j++){g=k[j];i(g)}}n=o.typeid.replace(":","__");p=Controls[n];if(!p){p=Controls["default"]}return new p(this,o,h)};f.prototype.clear=function(){this._total_elements=0;if(this.ui){this.ui.broadcast("destruct")}$(".root *").unbind();$.cleanData($(".root *"));$(".root *").safeRemove();return delete this.ui};f.prototype.replace=function(g){$(".ui-tooltip").remove();this.ui=g;$(".root").append(this.ui.dom);return aoConnector.reportHeight($("body")[0].scrollHeight)};f.prototype.extractUpdates=function(j,m){var g,o,i,n,k,h,l=this;o=j.extractUpdates();if(o){m.push(o)}k=j.children;h=[];for(i=0,n=k.length;i<n;i++){g=k[i];h.push((function(p){return l.extractUpdates(p,m)})(g))}return h};f.prototype.checkForUpdates=function(){var l,j,i,h,g,k=this;j=[];this.extractUpdates(this.ui,j);g=[];for(i=0,h=j.length;i<h;i++){l=j[i];g.push((function(m){return k.queueUpdate(m)})(l))}return g};f.prototype.queueUpdate=function(g){return this.pendingUpdates.push(g)};f.prototype.sendUpdates=function(g){var h=this;if(g==null){g=false}if(this.updaterTimeout){clearTimeout(this.updaterTimeout)}return this.updaterTimeout=setTimeout(function(){if(g||h.pendingUpdates.length>0){h.stream.emit_ui_update(h.pendingUpdates)}h.pendingUpdates=[];return h.updaterTimeout=null},50)};f.prototype.event=function(h,g,i){var j;this.checkForUpdates();j={type:"event",uid:h.uid,event:g,params:i!=null?i:null};this.queueUpdate(j);return this.sendUpdates()};f.prototype.restoreTheme=function(){if(getCookie("ajenti-theme")==="dark"){return this.toggleTheme()}};f.prototype.toggleTheme=function(){$("html").toggleClass("ui-dark");$("html").toggleClass("ui-light");if($("html").hasClass("ui-dark")){return setCookie("ajenti-theme","dark")}else{return setCookie("ajenti-theme","light")}};return f})();window.LoadingDim=(function(){function f(g){this.dom=g;this.dom.show()}f.prototype.hide=function(){var g=this;$(".hide-when-loaded").hide();$("body").removeClass("loading");return this.dom.stop().fadeTo(500,0,function(){return g.dom.hide()})};f.prototype.show=function(){$("body").addClass("loading");return this.dom.show().stop().fadeTo(500,1)};return f})();a=(function(){function f(){var g=this;this.mainTab=$("#tab-ajenti");this.tabHeadersDom=$("#tab-headers");this.tabsDom=$("#tabs");this.tabHeadersDom.find("a").click(function(){return g.goHome()});this.goHome();this.openTabs={}}f.prototype.goHome=function(){this.tabsDom.find(">*").hide();this.mainTab.show();this.tabHeadersDom.find("a").removeClass("active");return this.tabHeadersDom.find("a:first").addClass("active")};f.prototype.addTab=function(g,j){var i,h,k=this;if(this.openTabs[g]){this.openTabs[g].click();return}i=$('<div class="tab"><iframe src="'+g+'" /></div>');this.tabsDom.append(i);h=$('<a href="#">'+j+'<span class="close"><i class="icon-remove"></span></a></a>');this.tabHeadersDom.append(h);this.openTabs[g]=h;this.openTabs[g].dom=i;h.click(function(){k.tabsDom.find(">*").hide();i.show();setTimeout(function(){return i.find("iframe")[0].contentWindow.focus()},100);k.tabHeadersDom.find("a").removeClass("active");return h.addClass("active")});h.find(".close").click(function(){return k.closeTab(g)});return h.click()};f.prototype.closeTab=function(g){this.openTabs[g].dom.remove();this.openTabs[g].remove();delete this.openTabs[g];return this.goHome()};return f})();$(function(){window.Loading=new LoadingDim($("#loading"));window.Tabs=new a();if(window.UI){UI.restoreTheme();return $("#ui-theme-toggle").click(function(){return UI.toggleTheme()})}});window.Controls={};window.Control=(function(){function f(o,n,h){var g,q,j,k,p,l,i,m=this;this.ui=o;this.properties=n;if((l=this.properties)==null){this.properties={}}if((i=(q=this.properties).visible)==null){q.visible=true}this.uid=this.properties.uid;this.childContainer=null;this.dom=null;this.children=[];this.changed=false;profiler.start("Generating DOM");this.createDom();profiler.stop();if(h){j=function(r){return m.append(r)};for(k=0,p=h.length;k<p;k++){g=h[k];j(g)}}if(this.dom&&this.dom.length){this.dom=this.dom[0]}if(this.properties.visible!==true&&this.dom){this.dom.style.display="none"}if(this.childContainer&&this.childContainer.length){this.childContainer=this.childContainer[0]}}f.prototype.createDom=function(){return""};f.prototype.destruct=function(){};f.prototype.detectUpdates=function(){return{}};f.prototype.markChanged=function(){if(!this.changed){$(this.dom).before('<div class="changed-badge">\n    <span title="Not saved yet">*</span>\n</div>')}this.changed=true;return $(this.dom).addClass("changed")};f.prototype.wrapChild=function(g){return g.dom};f.prototype.onBroadcast=function(g){};f.prototype.broadcast=function(k){var m,j,h,i,g,l=this;this.onBroadcast(k);i=this.children;g=[];for(j=0,h=i.length;j<h;j++){m=i[j];g.push((function(n){return n.broadcast(k)})(m))}return g};f.prototype.extractUpdates=function(){var g,h,j,i=this;h=this.detectUpdates();if(!this.uid||$.isEmptyObject(h)){return null}j=function(l){return i.properties[l]=h[l]};for(g in h){j(g)}return{type:"update",uid:this.uid,properties:h}};f.prototype.append=function(i){var g,h;this.children.push(i);h=this.wrapChild(i);if(h&&h.length){h=h[0]}if(h){if(!this.childContainer){g=1}if(this.childContainer.length){this.childContainer=this.childContainer[0]}return this.childContainer.appendChild(h)}};f.prototype.publish=function(){this.ui.checkForUpdates();return this.ui.sendUpdates()};f.prototype.event=function(g,i){var h;this.ui.checkForUpdates();h=this["on_"+g];if(h){if(!h(i)){return false}}if(!this.uid||this.properties.client){return false}this.ui.event(this,g,i);return true};f.prototype._int_to_px=function(g){if(/^[0-9]+$/.test(g)){return g+"px"}if(g===null||g==="auto"){return"auto"}return g+""};f.prototype.cancel=function(g){g.preventDefault();return g.stopPropagation()};return f})();e=function(f){return f.replace(/</g,"&lt;")};window.ajentiConnectSocket=function(f){return io.connect(f,{resource:"ajenti:socket"})};window.ajentiCrash=function(f){$("#crash").fadeIn();$("#crash-traceback").html(e(f.message+"\n"+f.traceback));return $("#crash-report textarea").val(f.report)};window.ajentiCrashResume=function(f){return $("#crash").fadeOut()};window.ajentiCrashShowReport=function(){var f=this;$("#crash-traceback").toggle("blind");$("#crash-report").toggle("blind");return setTimeout(function(){return $("#crash-report textarea").focus()[0].select()},1000)};window.ajentiSecurityError=function(){return $("#security-error").fadeIn()};window.ajentiSecurityResume=function(f){return $("#security-error").fadeOut()};$.fn.safeRemove=function(){return this.each(function(f,g){if(g.parentNode){return g.parentNode.removeChild(g)}})};$(function(){if(location.protocol==="https:"||location.hostname==="localhost"){return $("#ssl-alert").hide()}});if(/Android|webOS|iPad|IEMobile/i.test(navigator.userAgent)){$(function(){return $("html").addClass("mode-tablet")})}window.$$=function(g,f){var h;if(f==null){f="div"}h=document.createElement(f);h.innerHTML=g;return h.childNodes[0]};d=100;c=-1;b=function(h){var k,j,g,i,f;i=h.changedTouches;j=i[0];f="";k=new Date();switch(h.type){case"touchstart":f="mousedown";c=k.getTime();break;case"touchmove":f="mousemove";c=-1;break;case"touchend":if(c>-1&&(k.getTime()-c)<d){c=-1;f="click"}else{f="mouseup"}break;default:return}g=document.createEvent("MouseEvent");g.initMouseEvent(f,true,true,window,1,j.screenX,j.screenY,j.clientX,j.clientY,false,false,false,false,0,null);j.target.dispatchEvent(g);return h.preventDefault()}}).call(this);