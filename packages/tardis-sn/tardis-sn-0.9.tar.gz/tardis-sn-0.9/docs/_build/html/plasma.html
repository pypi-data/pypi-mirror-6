

<!DOCTYPE html>



<html xmlns="http://www.w3.org/1999/xhtml">
  <head>
    <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
    
    <title>Plasma &mdash; TARDIS v0.9.dev692</title>
    
    <link rel="stylesheet" href="_static/basic.css" type="text/css" />
    <link rel="stylesheet" href="_static/pygments.css" type="text/css" />
    <link rel="stylesheet" href="_static/css/bootstrap-2.2.1.min.css" type="text/css" />
    <link rel="stylesheet" href="_static/bootstrap-sphinx.css" type="text/css" />
    <link rel="stylesheet" href="_static/css/bootstrap-responsive-2.2.1.min.css" type="text/css" />
    
    <script type="text/javascript">
      var DOCUMENTATION_OPTIONS = {
        URL_ROOT:    '',
        VERSION:     '0.9.dev692',
        COLLAPSE_INDEX: false,
        FILE_SUFFIX: '.html',
        HAS_SOURCE:  true
      };
    </script>
    <script type="text/javascript" src="_static/jquery.js"></script>
    <script type="text/javascript" src="_static/underscore.js"></script>
    <script type="text/javascript" src="_static/doctools.js"></script>
    <script type="text/javascript" src="http://cdn.mathjax.org/mathjax/latest/MathJax.js?config=TeX-AMS-MML_HTMLorMML"></script>
    <script type="text/javascript" src="_static/js/bootstrap-2.2.1.min.js"></script>
    <script type="text/javascript" src="_static/bootstrap-sphinx.js"></script>
    <link rel="shortcut icon" href="_static/tardis_logo.ico"/>
    <link rel="top" title="TARDIS v0.9.dev692" href="index.html" />
    <link rel="next" title="LTE Plasma" href="plasma_doc/lte_plasma.html" />
    <link rel="prev" title="Atomic Data" href="atomic.html" />
<meta charset='utf-8'>
<meta http-equiv='X-UA-Compatible' content='IE=edge,chrome=1'>
<meta name='viewport' content='width=device-width, initial-scale=1.0, maximum-scale=1'>
<meta name="apple-mobile-web-app-capable" content="yes">

  </head>
  <body>
  
  <a href="http://github.com/wkerzendorf/tardis"><img style="position: fixed; top: 0px; right: 0; border: 0; z-index: 100000;image-orientation: 90deg;" src="https://s3.amazonaws.com/github/ribbons/forkme_left_darkblue_121621.png" alt="Fork me on GitHub"/></a>

<div class="container">
  
  <div id="navbar" class="navbar navbar-fixed-top">
    <div class="navbar-inner">
      <!-- .btn-navbar is used as the toggle for collapsed navbar content -->
      <button class="btn btn-navbar" data-toggle="collapse" data-target=".nav-collapse">
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
      </button>

      <a class="brand" href="index.html">TARDIS</a>
      <span class="navbar-text pull-left"><b>0.9.dev692</b></span>

      <div class="nav-collapse">
        <ul class="nav">
          <li class="divider-vertical"></li>
          
            <li class="dropdown">
  <a href="index.html"
     class="dropdown-toggle"
     data-toggle="dropdown">Site <b class="caret"></b></a>
  <ul class="dropdown-menu globaltoc"
    ><ul class="current">
<li class="toctree-l1"><a class="reference internal" href="installation.html">Installation</a></li>
<li class="toctree-l1"><a class="reference internal" href="running.html">Running TARDIS</a></li>
<li class="toctree-l1"><a class="reference internal" href="gui.html">Graphical User Interface</a></li>
<li class="toctree-l1"><a class="reference internal" href="atomic.html">Atomic Data</a></li>
<li class="toctree-l1 current"><a class="current reference internal" href="">Plasma</a></li>
<li class="toctree-l1"><a class="reference internal" href="montecarlo.html">Radiative Monte Carlo</a></li>
<li class="toctree-l1"><a class="reference internal" href="glossary.html">Glossary</a></li>
<li class="toctree-l1"><a class="reference internal" href="zreferences.html">References</a></li>
<li class="toctree-l1"><a class="reference internal" href="credits.html">Credits</a></li>
</ul>
</ul>
</li>
            <li class="dropdown">
  <a href="#" class="dropdown-toggle" data-toggle="dropdown">Page <b class="caret"></b></a>
  <ul class="dropdown-menu localtoc"><ul>
<li><a class="reference internal" href="#">Plasma</a><ul>
<li><a class="reference internal" href="#base-plasma">Base Plasma</a></li>
<li><a class="reference internal" href="#plasma-types">Plasma Types</a><ul>
</ul>
</li>
<li><a class="reference internal" href="#sobolev-optical-depth">Sobolev optical depth</a></li>
<li><a class="reference internal" href="#macro-atom">Macro Atom</a></li>
<li><a class="reference internal" href="#nlte-treatment">NLTE treatment</a></li>
</ul>
</li>
</ul>
</ul>
</li>
          
          
            
  <li><a href="atomic.html"
         title="previous chapter">&laquo; Atomic Data</a></li>
  <li><a href="plasma_doc/lte_plasma.html"
         title="next chapter">LTE Plasma &raquo;</a></li>
          
          
            <li></li>
          
        </ul>

        
          
<form class="navbar-search pull-right" style="margin-bottom:-3px;" action="search.html" method="get">
  <input type="text" name="q" placeholder="Search" />
  <input type="hidden" name="check_keywords" value="yes" />
  <input type="hidden" name="area" value="default" />
</form>
        
      </div>
    </div>
  </div>

  
  <div class="section" id="plasma">
<span id="plasmas"></span><h1>Plasma<a class="headerlink" href="#plasma" title="Permalink to this headline">¶</a></h1>
<p>This module calculates the ionization balance and level populations in the BasePlasma, give a abundance fraction, temperature
and density. After calculating the state of the plasma, these classes are able to calculate <span class="math">\(\tau_\textrm{sobolev}\)</span>
for the supernova radiative transfer. The simplest BasePlasma (<tt class="xref py py-class docutils literal"><span class="pre">BasePlasma</span></tt>) only calculates the atom number densities, but serves
as a base for all BasePlasma classes.&nbsp;The next more complex class is <cite>LTEPlasma</cite> which will calculate the aforementioned quantities in
Local Thermal Equilibrium conditions (LTE). The <tt class="xref py py-class docutils literal"><span class="pre">NebularPlasma</span></tt>-class inherits from <cite>LTEPlasma</cite> and uses a more complex
description of the BasePlasma (for details see <em class="xref std std-ref">nebular_plasma</em>).</p>
<div class="admonition note">
<p class="first admonition-title">Note</p>
<p class="last">In this documentation we use the indices <span class="math">\(i, j, k\)</span> to mean atomic number, ion number and level number respectively.</p>
</div>
<p>All plasma calculations follow the same basic procedure in calculating the plasma state.
This is always accomplished with the function <tt class="docutils literal"><span class="pre">update_radiationfield</span></tt>. This block diagram shows the basic procedure</p>
<div class="section" id="base-plasma">
<h2>Base Plasma<a class="headerlink" href="#base-plasma" title="Permalink to this headline">¶</a></h2>
<p><cite>BasePlasma</cite> serves as the base class for all plasmas and can just calculate the atom number densities for a given input of
abundance fraction.</p>
<div class="math">
\[N_{atom} = \rho_\textrm{total} \times \textrm{Abundance fraction} / m_\textrm{atom}\]</div>
<p>In the next step the line and level tables are purged of entries that are not represented in the
abundance fractions are saved in <cite>BasePlasma.levels</cite> and <cite>BasePlasma.lines</cite>. Finally, the function <cite>BasePlasma.update_t_rad</cite> is called
at the end of initialization to update the plasma conditions to a new <span class="math">\(T_\textrm{radiation field}\)</span> (with the give t_rad).
This function is the same in the other plasma classes and does the main part of the calculation. In the case of <cite>BasePlasma</cite> this is only
setting <cite>BasePlasma.beta_rad</cite> to <span class="math">\(\frac{1}{k_\textrm{B}T_\textrm{rad}}\)</span>.</p>
<p>Here&#8217;s an example how to instantiate a simple base plasma:</p>
<div class="highlight-python"><div class="highlight"><pre><span class="gp">&gt;&gt;&gt; </span><span class="kn">from</span> <span class="nn">tardis</span> <span class="kn">import</span> <span class="n">atomic</span><span class="p">,</span> <span class="n">plasma</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">atom_data</span> <span class="o">=</span> <span class="n">atomic</span><span class="o">.</span><span class="n">AtomData</span><span class="o">.</span><span class="n">from_hdf5</span><span class="p">()</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">my_plasma</span> <span class="o">=</span> <span class="n">plasma</span><span class="o">.</span><span class="n">BasePlasma</span><span class="p">({</span><span class="s">&#39;Fe&#39;</span><span class="p">:</span><span class="mf">0.5</span><span class="p">,</span> <span class="s">&#39;Ni&#39;</span><span class="p">:</span><span class="mf">0.5</span><span class="p">},</span> <span class="mi">10000</span><span class="p">,</span> <span class="mf">1e-13</span><span class="p">,</span> <span class="n">atom_data</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="k">print</span> <span class="n">my_plasma</span><span class="o">.</span><span class="n">abundances</span>
<span class="go">atomic_number abundance_fraction number_density</span>
<span class="go">------------- ------------------ --------------</span>
<span class="go">           28                0.5  513016973.936</span>
<span class="go">           26                0.5  539183641.472</span>
</pre></div>
</div>
</div>
<div class="section" id="plasma-types">
<h2>Plasma Types<a class="headerlink" href="#plasma-types" title="Permalink to this headline">¶</a></h2>
<div class="toctree-wrapper compound">
<ul>
<li class="toctree-l1"><a class="reference internal" href="plasma_doc/lte_plasma.html">LTE Plasma</a><ul>
<li class="toctree-l2"><a class="reference internal" href="plasma_doc/lte_plasma.html#example-calculations">Example Calculations</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="plasma_doc/nebular_plasma.html">Nebular Plasma</a><ul>
<li class="toctree-l2"><a class="reference internal" href="plasma_doc/nebular_plasma.html#calculating-zeta">Calculating Zeta</a></li>
<li class="toctree-l2"><a class="reference internal" href="plasma_doc/nebular_plasma.html#calculating-delta">Calculating Delta</a></li>
<li class="toctree-l2"><a class="reference internal" href="plasma_doc/nebular_plasma.html#example-calculations">Example Calculations</a></li>
</ul>
</li>
</ul>
</div>
</div>
<div class="section" id="sobolev-optical-depth">
<span id="tau-sobolev"></span><h2>Sobolev optical depth<a class="headerlink" href="#sobolev-optical-depth" title="Permalink to this headline">¶</a></h2>
<p>This function calculates the Sobolev optical depth <span class="math">\(\tau_\textrm{Sobolev}\)</span></p>
<div class="math">
\[C_\textrm{Sobolev} = \frac{\pi e^2}{m_e c}\]\[\tau_\textrm{Sobolev} = C_\textrm{Sobolev}\,  \lambda\, f_{\textrm{lower}\rightarrow\textrm{upper}}\,
    t_\textrm{explosion}\, N_\textrm{lower}
    (1 - \frac{g_\textrm{lower}}{g_\textrm{upper}}\frac{N_\textrm{upper}}{N_\textrm{lower}})\]</div>
</div>
<div class="section" id="macro-atom">
<h2>Macro Atom<a class="headerlink" href="#macro-atom" title="Permalink to this headline">¶</a></h2>
<p>The macro atom is described in detail in <a class="reference internal" href="zreferences.html#a-a-384-725l">[1]</a>. The basic principal is that when an energy packet
is absorbed that the macro atom is on a certain level. Three probabilities govern the next step the P<sub>up</sub>,
P<sub>down</sub> and P<sub>down emission</sub> being the probability for going to a higher level, a lower level and a lower
level and emitting a photon while doing this respectively (see Figure 1 in <a class="reference internal" href="zreferences.html#a-a-384-725l">[1]</a> ).</p>
<p>The macro atom is the most complex idea to implement as a data structure. The setup is done in <cite>~tardisatomic</cite>, but
we will nonetheless discuss it here (as <cite>~tardisatomic</cite> is even less documented than this one).</p>
<p>For each level we look at the line list to see what transitions (upwards or downwards are possible). We create a two arrays,
the first is a long one-dimensional array containing the probabilities. Each level contains a set of probabilities, The first
part of each set contains the upwards probabilities (internal upward), the second part the downwards probabilities
(internal downward), and the last part is the downward and emission probability.</p>
<p>each set is stacked after the other one to make one long one dimensional <cite>~numpy.ndarray</cite>.</p>
<p>The second array is for book-keeping it has exactly the length as levels (with an example for the Si II level 15):</p>
<table border="1" class="docutils">
<colgroup>
<col width="11%" />
<col width="25%" />
<col width="17%" />
<col width="23%" />
<col width="24%" />
</colgroup>
<thead valign="bottom">
<tr class="row-odd"><th class="head">Level ID</th>
<th class="head">Probability index</th>
<th class="head">N<sub>up</sub></th>
<th class="head">N<sub>down</sub></th>
<th class="head">N<sub>total</sub></th>
</tr>
</thead>
<tbody valign="top">
<tr class="row-even"><td>14001015</td>
<td>???</td>
<td>17</td>
<td>5</td>
<td>17 + 5*2 = 27</td>
</tr>
</tbody>
</table>
<p>We now will calculate the transition probabilites, using the radiative rates in Equation 20, 21, and 22
in <a class="reference internal" href="zreferences.html#a-a-384-725l">[1]</a>. Then we calculate the downward emission probability from Equation 5, the downward and
upward internal transition probabilities in <a class="reference internal" href="zreferences.html#a-a-403-261l">[2]</a>.</p>
<div class="math">
\[\begin{split}p_\textrm{emission down}&amp;= {\cal R}_{\textrm{i}\rightarrow\textrm{lower}}\,(\epsilon_\textrm{upper} - \epsilon_\textrm{lower}) / {\cal D}_{i}\\
p_\textrm{internal down}&amp;= {\cal R}_{\textrm{i}\rightarrow\textrm{lower}}\,\epsilon_\textrm{lower}/{\cal D}_{i}\\,
p_\textrm{internal up}&amp;={\cal R}_{\textrm{i}\rightarrow\textrm{upper}}\,\epsilon_{i}/{\cal D}_{i}\\,\end{split}\]</div>
<dl class="docutils">
<dt>where <span class="math">\(i\)</span> is the current level, <span class="math">\(\epsilon\)</span> is the energy of the level, and <span class="math">\({\cal R}\)</span> is the radiative</dt>
<dd>rates.</dd>
</dl>
<p>We ignore the probability to emit a k-packet as TARDIS only works with photon packets.
Next we calculate the radidative
rates using equation 10 in <a class="reference internal" href="zreferences.html#a-a-403-261l">[2]</a>.</p>
<div class="math">
\[\begin{split}{\cal R}_{\textrm{upper}\rightarrow\textrm{lower}} &amp;=
A_{\textrm{upper}\rightarrow\textrm{lower}}\beta_\textrm{Sobolev}n_\textrm{upper}\\
{\cal R}_{\textrm{lower}\rightarrow\textrm{upper}} &amp;=
(B_{\textrm{lower}\rightarrow\textrm{upper}}n_\textrm{lower}-
B_{\textrm{upper}\rightarrow\textrm{lower}}n_\textrm{upper})
\beta_\textrm{Sobolev} J_{\nu}^{b}\\,\end{split}\]</div>
<p>with <span class="math">\(\beta_\textrm{Sobolev} = \frac{1}{\tau_\textrm{Sobolev}}(1-e^{-\tau_\textrm{Sobolev}})\)</span> .</p>
<p>using the Einstein coefficients</p>
<div class="math">
\[\begin{split}A_{\textrm{upper}\rightarrow\textrm{lower}} &amp;= \frac{8 \nu^2 \pi^2 e^2}{m_e c^3}~
    \frac{g_\textrm{lower}}{g_\textrm{upper}}~f_{\textrm{lower}\rightarrow\textrm{upper}}\\
A_{\textrm{upper}\rightarrow\textrm{lower}} &amp;= \underbrace{\frac{4 \pi^2 e^2}{m_e c}}_{C_\textrm{Einstein}}~ \frac{2\nu^2}{c^2}
        \frac{g_\textrm{lower}}{g_\textrm{upper}}~f_{\textrm{lower}\rightarrow\textrm{upper}}\\
B_{\textrm{lower}\rightarrow\textrm{upper}} &amp;= \frac{4\pi^2 e^2}{m_e h\nu c}\,f_{\textrm{lower}\rightarrow\textrm{upper}}\\
B_{\textrm{lower}\rightarrow\textrm{upper}} &amp;= \underbrace{\frac{4 \pi^2 e^2}{m_e c}}_{C_\textrm{Einstein}}\frac{1}{h\nu} f_{\textrm{lower}\rightarrow\textrm{upper}}\\\end{split}\]\[\begin{split}B_{\textrm{upper}\rightarrow\textrm{lower}} &amp;= \frac{4\pi^2 e^2}{m_e h\nu c}\,f_{\textrm{lower}\rightarrow\textrm{upper}}\\
B_{\textrm{upper}\rightarrow\textrm{lower}} &amp;= \underbrace{\frac{4 \pi^2 e^2}{m_e c}}_{C_\textrm{Einstein}}\frac{1}{h\nu}\frac{g_\textrm{lower}}{g_\textrm{upper}}f_{\textrm{lower}\rightarrow\textrm{upper}}\\\end{split}\]</div>
<p>we get</p>
<div class="math">
\[\begin{split}{\cal R}_{\textrm{upper}\rightarrow\textrm{lower}} &amp;=
    C_\textrm{Einstein} \frac{2\nu^2}{c^2} \frac{g_\textrm{lower}}{g_\textrm{upper}}~f_{\textrm{lower}\rightarrow\textrm{upper}}
    \beta_\textrm{Sobolev}n_\textrm{upper}\\\end{split}\]\[\begin{split}{\cal R}_{\textrm{lower}\rightarrow\textrm{upper}} &amp;=
        C_\textrm{Einstein}\frac{1}{h\nu} f_{\textrm{lower}\rightarrow\textrm{upper}}
        (n_\textrm{lower}-\frac{g_\textrm{lower}}{g_\textrm{upper}}n_\textrm{upper})
                    \beta_\textrm{Sobolev} J_{\nu}^{b}\\\end{split}\]</div>
<p>This results in the transition probabilities:</p>
<div class="math">
\[\begin{split}p_\textrm{emission down}&amp;= C_\textrm{Einstein} \frac{2\nu^2}{c^2} \frac{g_\textrm{lower}}{g_\textrm{i}}~f_{\textrm{lower}\rightarrow\textrm{i}}
                                   \beta_\textrm{Sobolev}n_\textrm{i}\,(\epsilon_\textrm{i} - \epsilon_\textrm{lower}) / {\cal D}_{i}\\
p_\textrm{internal down}&amp;= C_\textrm{Einstein} \frac{2\nu^2}{c^2} \frac{g_\textrm{lower}}{g_\textrm{i}}~f_{\textrm{lower}\rightarrow\textrm{i}}
                                   \beta_\textrm{Sobolev}n_\textrm{i}\,\epsilon_\textrm{lower}/{\cal D}_{i}\\
p_\textrm{internal up}&amp;=C_\textrm{Einstein}\frac{1}{h\nu} f_{\textrm{i}\rightarrow\textrm{upper}}
                                    (n_\textrm{i}-\frac{g_\textrm{i}}{g_\textrm{upper}}n_\textrm{upper})
                                                \beta_\textrm{Sobolev} J_{\nu}^{b}\,\epsilon_{i}/{\cal D}_{i}\\,\end{split}\]</div>
<dl class="docutils">
<dt>and as we will normalise the transition probabilities numerically later,  we can get rid of <span class="math">\(C_\textrm{Einstein}\)</span>,</dt>
<dd><span class="math">\(\frac{1}{{\cal D}_i}\)</span> and number densities.</dd>
</dl>
<div class="math">
\[\begin{split}p_\textrm{emission down}&amp;= \frac{2\nu^2}{c^2} \frac{g_\textrm{lower}}{g_\textrm{i}}~f_{\textrm{lower}\rightarrow\textrm{i}}
                                   \beta_\textrm{Sobolev}\,(\epsilon_\textrm{i} - \epsilon_\textrm{lower})\\
p_\textrm{internal down}&amp;=  \frac{2\nu^2}{c^2} \frac{g_\textrm{lower}}{g_\textrm{i}}~f_{\textrm{lower}\rightarrow\textrm{i}}
                                   \beta_\textrm{Sobolev}\,\epsilon_\textrm{lower}\\
p_\textrm{internal up}&amp;=\frac{1}{h\nu} f_{\textrm{i}\rightarrow\textrm{upper}}
                                    \underbrace{(1-\frac{g_\textrm{i}}{g_\textrm{upper}}\frac{n_\textrm{upper}}{n_i})}
                                    _\textrm{stimulated emission}
                                                \beta_\textrm{Sobolev} J_{\nu}^{b}\,\epsilon_{i}\\,\end{split}\]</div>
<p>There are two parts for each of the probabilities, one that is pre-computed by <cite>~tardisatomic</cite> and is in the HDF5 File,
and one that is computed during the plasma calculations:</p>
<div class="math">
\[\begin{split}p_\textrm{emission down}&amp;= \underbrace{\frac{2\nu^2}{c^2} \frac{g_\textrm{lower}}{g_\textrm{i}}~f_{\textrm{lower}\rightarrow\textrm{i}}
                                   (\epsilon_\textrm{i} - \epsilon_\textrm{lower})}_\textrm{pre-computed}
                                   \,\beta_\textrm{Sobolev}\\
p_\textrm{internal down} &amp;= \underbrace{\frac{2\nu^2}{c^2} \frac{g_\textrm{lower}}{g_\textrm{i}}~f_{\textrm{lower}\rightarrow\textrm{i}}
                                   \epsilon_\textrm{lower}}_\textrm{pre-computed}\,\beta_\textrm{Sobolev}\\
p_\textrm{internal up} &amp;= \underbrace{\frac{1}{h\nu} f_{\textrm{i}\rightarrow\textrm{upper}}}_\textrm{pre-computed}
                                                \beta_\textrm{Sobolev} J_{\nu}^{b}\,
                                                (1-\frac{g_\textrm{i}}{g_\textrm{upper}}\frac{n_\textrm{upper}}{n_i})
                                                \,\epsilon_{i}.\end{split}\]</div>
</div>
<div class="section" id="nlte-treatment">
<h2>NLTE treatment<a class="headerlink" href="#nlte-treatment" title="Permalink to this headline">¶</a></h2>
<p>NLTE treatment of lines is available both in ~LTEPlasma and the ~NebularPlasma class. This can be enabled by specifying
which species should be treated as NLTE with a simple list of tuples (e.g. [(20,1)] for Ca II).</p>
<p>First let&#8217;s dive into the basics:</p>
<p>There are two rates to consider from a given level.</p>
<div class="math">
\[\begin{split}R_{\textrm{upper}\rightarrow\textrm{lower}} &amp;= \underbrace{A_{ul} n_u}_\textrm{spontaneous emission}
        + \underbrace{B_{ul} n_u \bar{J}_\nu}_\textrm{stimulated emission} +
        \underbrace{C_{ul} n_u n_e}_\textrm{collisional deexcitation}\\
        &amp;= n_u \underbrace{(A_{ul} + B_{ul}\bar{J}_\nu + C_{ul} n_e)}_{r_{ul}} \\\end{split}\]\[\begin{split}R_{\textrm{lower}\rightarrow\textrm{upper}} &amp;= \underbrace{B_{lu} n_l \bar{J}_\nu}_\textrm{stimulated absorption} +
            \underbrace{C_{lu}\,n_l\,n_e}_\textrm{collisional excitation}\\
            &amp;= n_l \underbrace{(B_{lu}\bar{J}_\nu + C_{ul}n_e)}_{r_{lu}},\end{split}\]</div>
<p>where <span class="math">\(\bar{J}_\nu\)</span> (in LTE this is <span class="math">\(B(\nu, T)\)</span>) denotes the mean intensity at the frequency of the line and
<span class="math">\(n_e\)</span> the number density of electrons.</p>
<p>Next, we calculate the rate of change of a level by adding up all outgoing and all incoming transitions from level <span class="math">\(j\)</span>.</p>
<div class="math">
\[\frac{dn_j}{dt} = \underbrace{\sum_{i \ne j} R_{ij}}_\textrm{incoming rate} -
                    \underbrace{\sum_{i \ne j} R_{ji}}_\textrm{outgoing rate}\]</div>
<p>In a statistical equilibrium all incoming rates and outgoing rates add up to 0 (<span class="math">\(\frac{dn_j}{dt}=0\)</span>). We use this to
calculate the level populations using the rate coefficients (<span class="math">\(r_ij, r_ji\)</span>).</p>
<div class="math">
\[\begin{split}\left(
\begin{matrix}
-(\cal{R}_{12} + \dots + \cal{R}_{1j}) &amp; \dots &amp; \cal{R}_{j1}\\
\vdots &amp; \ddots &amp; \vdots \\
\cal{R}_{1j} &amp; \dots &amp; - (\cal{R} _{j1} + \dots + \cal{R} _{j, j-1}) \\
\end{matrix}
\right)
%
\left(
\begin{matrix}
n_1\\
\vdots\\
n_j\\
\end{matrix}
\right)
%
=
%
\left(
\begin{matrix}
0\\
0\\
0\\
\end{matrix}
\right)\end{split}\]</div>
<p>with the additional constrained that all the level number populations need to add up to the current ion population $N$ we change this to</p>
<div class="math">
\[\begin{split}\left(
\begin{matrix}
1 &amp; 1 &amp; \dots \\
\vdots &amp; \ddots &amp; \vdots \\
\cal{R}_{1j} &amp; \dots &amp; - (\cal{R} _{j1} + \dots + \cal{R} _{j, j-1}) \\
\end{matrix}
\right)
%
\left(
\begin{matrix}
n_1\\
\vdots\\
n_j\\
\end{matrix}
\right)
%
=
%
\left(
\begin{matrix}
N\\
0\\
0\\
\end{matrix}
\right)\end{split}\]</div>
<p>For a three level atom we have:</p>
<div class="math">
\[\begin{split}\frac{dn_1}{dt} &amp;= \underbrace{n_2 r_{21} + n_3 r_{31}}_\textrm{incoming rate}
                - \underbrace{(n_1 r_{12} + n_1 r_{13})}_\textrm{outgoing rate} = 0\\\end{split}\]\[\begin{split}\frac{dn_2}{dt} &amp;= \underbrace{n_1 r_{12} + n_3 r_{32}}_\textrm{incoming rate}
                - \underbrace{(n_2 r_{21} + n_2 r_{23})}_{outgoing rate} = 0\\\end{split}\]\[\begin{split}\frac{dn_3}{dt} &amp;= \underbrace{n_1 r_{13} + n_2 r_{23}}_\textrm{incoming rate}
                - \underbrace{(n_3 r_{32} + n_3 r_{31})}_\textrm{outgoing rate} = 0,\end{split}\]</div>
<p>which can be written in matrix from:</p>
<div class="math">
\[\begin{split}\left(\begin{matrix}
    -(r_{12} + r_{13}) &amp; r_{21} &amp; r_{31}\\
    r_{12} &amp; -(r_{21} + r_{23}) &amp; r_{32}\\
    r_{13} &amp; r_{23} &amp; -(r_{31} + r_{32}) \\
\end{matrix}\right)
\left(
\begin{matrix}
    n_1\\
    n_2\\
    n_3\\
\end{matrix}
\right)
=
\left(
\begin{matrix}
    0\\
    0\\
    0\\
\end{matrix}
\right)\end{split}\]</div>
<p>To solve for the level populations we need an additional constraint: <span class="math">\(n_1 + n_2 + n_3 = N\)</span>. By setting <span class="math">\(N = 1\)</span>:
we can get the relative rates:</p>
<div class="math">
\[\begin{split}\left(\begin{matrix}
    1 &amp; 1 &amp; 1\\
    r_{12} &amp; -(r_{21} + r_{23}) &amp; r_{32}\\
    r_{13} &amp; r_{23} &amp; -(r_{31} + r_{32}) \\
\end{matrix}\right)
\left(
\begin{matrix}
    n_1\\
    n_2\\
    n_3\\
\end{matrix}
\right)
=
\left(
\begin{matrix}
    1\\
    0\\
    0\\
\end{matrix}
\right)\end{split}\]</div>
<p>Now we go back and look at the rate coefficients used for a level population - as an example <span class="math">\(\frac{dn_2}{dt}\)</span>:</p>
<div class="math">
\[\begin{split}\frac{dn_2}{dt} &amp;= n_1 r_{12} - n_2 (r_{21} + r_{23}) + n_3 r_{32}\\
            &amp;= n_1 B_{12} \bar{J}_{12} + n_1 C_{12} n_e - n_2 A_{21} - n_2 B_{21} \bar{J}_{21} - n_2 C_{21} n_e\\
                    - n_2 B_{23} \bar{J}_{23} - n_2 C_{23} n_e + n_3 A_{32} + n_3 B_{32} \bar{J}_{32} + n_3 C_{32} n_e,\\
                     + n_3 A_{32}  + n_3 C_{32} n_e,\end{split}\]</div>
<p>Next we will group the stimulated emission and stimulated absorption terms as we can assume <span class="math">\(\bar{J_{12}} = \bar{J_{21}}\)</span>:</p>
<div class="math">
\[\begin{split}\frac{dn_2}{dt} &amp;= n_1 (B_{12} \bar{J}_{12} \underbrace{(1 - \frac{n_2}{n_1}\frac{B_{21}}{B_{12}})}_\textrm{stimulated emission term} + C_{12} n_e)
                - n_2 (A_{21} + C_{23} n_e + n_2 B_{23} \bar{J}_{23} \underbrace{(1 - \frac{n_3}{n_2}\frac{B_{32}}{B_{23}})}_\textrm{stimulated emission term})
                + n_3 (A_{32} + C_{32} n_e)\end{split}\]</div>
</div>
</div>


</div>
<footer class="footer">
  <div class="container">
    <p class="pull-right">
      <a href="#">Back to top</a>
      
    </p>
    <p>
        &copy; Copyright 2013, TARDIS team.<br/>
      Created using <a href="http://sphinx.pocoo.org/">Sphinx</a> 1.1.3.<br/>
    </p>
  </div>
</footer>
  </body>
</html>