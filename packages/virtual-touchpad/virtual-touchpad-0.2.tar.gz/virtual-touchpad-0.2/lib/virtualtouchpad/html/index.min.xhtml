<?xml version="1.0" encoding="UTF-8"?><!DOCTYPE html><html manifest="virtual-touchpad.appcache" xmlns="http://www.w3.org/1999/xhtml"><head><meta content="yes" name="mobile-web-app-capable"/><meta content="width=device-width,user-scalable=no" name="viewport"/><link href="img/icon196x196.png" rel="shortcut icon" sizes="196x196"/><meta content="yes" name="apple-mobile-web-app-capable"/><meta content="black-translucent" name="apple-mobile-web-app-status-bar-style"/><link href="img/icon144x144.png" rel="apple-touch-icon" sizes="144x144"/><link href="img/icon114x114.png" rel="apple-touch-icon" sizes="114x114"/><link href="img/icon72x72.png" rel="apple-touch-icon" sizes="72x72"/><link href="img/icon57x57.png" rel="apple-touch-icon" sizes="57x57"/><title>Virtual Touchpad</title><style type="text/css"><![CDATA[html,body{background-color:black;height:100%;margin:0}#touchpad{background:radial-gradient(circle at bottom center,#282828 0,#181818 50%,black 100%);min-height:100%}#message-box{z-index:100;display:none;position:fixed;left:0;right:0;border-radius:5pt;width:inherit;margin:5pt;padding:5pt;background:radial-gradient(circle at top left,white 0,#E0E0E0 50%,#D0D0D0 100%);color:black;font-family:sans-serif}#message-box.error{}]]></style><script type="text/javascript"><![CDATA[exports=window;exports.checks=(function(){var a={failures:[]};a.failed=function(b){return a.failures.indexOf(b)!=-1;};if(typeof WebSocket=="undefined")a.failures.push("WebSocket");if(!("ontouchstart" in window))a.failures.push("TouchEvents");else if(typeof (TouchList.prototype.identifiedTouch)=="undefined")TouchList.prototype.identifiedTouch=function(a){for(var b=0;b<this.length;b++)if(this[b].identifier===a)return this[b];};return a;})();exports.controller=(function(){var a={};var b=function(a){this.ws=a;};a.Touchpad=b;b.prototype.buttonDown=function(a){ws.send(JSON.stringify({command:"mouse_down",data:{button:a}}));};b.prototype.buttonUp=function(a){ws.send(JSON.stringify({command:"mouse_up",data:{button:a}}));};b.prototype.scroll=function(a,b){ws.send(JSON.stringify({command:"mouse_scroll",data:{dx:a,dy:b}}));};b.prototype.move=function(a,b){ws.send(JSON.stringify({command:"mouse_move",data:{dx:a,dy:b}}));};return a;})();exports.features=(function(){var a={};a.listMissing=function(){var a=document.createDocumentFragment();function b(b){var c=document.createElement("li");c.innerHTML=b;a.appendChild(c);}if(checks.failed("WebSocket"))b("WebSockets are not supported");if(checks.failed("TouchEvents"))b("Touch events are not supported");if(a.childNodes.length>0){var c=document.createDocumentFragment();c.appendChild(document.createTextNode("Your browser does not support Virtual Touchpad. These "+"features are missing:"));var d=document.createElement("ul");d.appendChild(a);c.appendChild(d);c.appendChild(document.createTextNode("Please upgrade your browser to a newer version."));messagebox.show(c,["error"]);return true;}else return false;};return a;})();exports.messagebox=(function(){var a={};a.show=function(a,b){var c=document.getElementById("message-box");while(c.firstChild)c.removeChild(c.firstChild);if(typeof a==="string")c.innerHTML=a;else c.appendChild(a);c.className=b.join(", ");c.style.display="block";};return a;})();exports.view=(function(){var a={};var b=function(a,b){this.parentEl=a;this.touchpad=b;var c=this;var d,e,f,g,h;this.parentEl.addEventListener("touchstart",d=function(){return c.onTouchStart.apply(c,arguments);});this.parentEl.addEventListener("touchend",e=function(){return c.onTouchEnd.apply(c,arguments);});this.parentEl.addEventListener("touchcancel",f=function(){return c.onTouchCancel.apply(c,arguments);});this.parentEl.addEventListener("touchleave",g=function(){return c.onTouchEnd.apply(c,arguments);});this.parentEl.addEventListener("touchmove",h=function(){return c.onTouchMove.apply(c,arguments);});this.detach=function(){this.parentEl.removeEventListener("touchstart",d);this.parentEl.removeEventListener("touchend",e);this.parentEl.removeEventListener("touchcancel",f);this.parentEl.removeEventListener("touchleave",g);this.parentEl.removeEventListener("touchmove",h);};};a.Touchview=b;function c(a){if(!a)return [];var b=[];for(var c=0;c<a.length;c++)b.push({identifier:a[c].identifier,screenX:a[c].screenX,screenY:a[c].screenY});return b;}function d(a,b){var c=b.screenX-a.screenX;var d=b.screenY-a.screenY;var e=Math.sqrt(c*c+d*d);var f=Math.atan2(d,c);var g=0.3;var h=1.5;var i=h*Math.pow(e,1.0+g);return [Math.cos(f)*i,Math.sin(f)*i];}function e(a,b){var c=b.screenX-a.screenX;var d=b.screenY-a.screenY;var e=-1;var f=-1;return [c>0?e:c<0?-e:0,d>0?f:d<0?-f:0];}b.prototype.onTouchStart=function(a){this.currentTouches=c(a.touches);this.hasMoved=false;a.preventDefault();};b.prototype.onTouchEnd=function(a){if(!this.hasMoved){var b=this.currentTouches.length==2?3:1;this.touchpad.buttonDown(b);this.touchpad.buttonUp(b);}delete this.currentTouches;};b.prototype.onTouchCancel=function(a){};b.prototype.onTouchLeave=function(a){};b.prototype.onTouchMove=function(a){this.hasMoved=true;if(!a.changedTouches)return;if(a.changedTouches.length!=this.currentTouches.length)return;var b=this.currentTouches[0];var f=a.changedTouches.identifiedTouch(b.identifier);this.currentTouches=c(a.changedTouches);if(a.changedTouches.length==1){var g=d(b,f);this.touchpad.move.apply(undefined,g);}else if(a.changedTouches.length==2){var h=e(b,f);this.touchpad.scroll.apply(undefined,h);}a.preventDefault();};return a;})();exports.main=function(){if(features.listMissing())return;var a,b;var c=document.getElementById("touchpad");ws=new WebSocket("ws://"+document.location.host+"/ws");ws.onopen=function(){a=new controller.Touchpad(ws);b=new view.Touchview(c,a);};ws.onclose=function(){b.detach();a=undefined;messagebox.show("Connection closed. Please click "+"<a href='javascript:location.reload();'>here</a> to reconnect.",["error"]);};ws.onerror=function(a){messagebox.show("Failed to connect. Please verify that <host> is running.".replace(/<host>/g,document.location.host),["error"]);};};]]></script></head><body onload="exports.main();"><div id="message-box"></div><div id="touchpad"></div></body></html>