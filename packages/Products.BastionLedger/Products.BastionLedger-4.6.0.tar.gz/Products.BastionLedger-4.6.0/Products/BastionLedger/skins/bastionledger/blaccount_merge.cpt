<html xmlns:tal="http://xml.zope.org/namespaces/tal"
      xmlns:metal="http://xml.zope.org/namespaces/metal"
      metal:use-macro="here/main_template/macros/master"
      i18n:domain="bastionledger">

 
    <div metal:fill-slot="main"
         tal:define="errors options/state/getErrors;
                     utool context/@@plone_portal_state/portal_url;
                     subtypes python: here.subtypes(here.type);
                     lockable python:hasattr(here, 'wl_isLocked');
                     isLocked python:lockable and here.wl_isLocked();">


      <h1><img src="" alt="" tal:define="icon python:context.getIcon(1)" 
               tal:attributes="src string:${utool}/${icon}">&nbsp;<span tal:replace="here/prettyTitle"/></h1>

      <form name="merge_form"  action="."  method="post" tal:attributes="action template/getId" >

             <div tal:define="error errors/ids|nothing;
                              Ids request/ids | python: []"
                  tal:attributes="class python:error and 'field error' or 'field'">

                 <div class="label">Accounts</div>

                 <span class="fieldRequired" title="Required"
                       i18n:attributes="type"
                       i18n:translate="label_required">(Required)</span>


                 <div tal:content="error">Validation error output</div>

                 <div class="formHelp" i18n:translate="help_accounts">
                     The account(s) to merge/move transactions into this one.
                 </div>


                <select name="ids:list" size="20" multiple>
                    <option tal:repeat="account python: filter(lambda x,self=context: x != self, 
                                                               context.aq_parent.accountValues(sort_on='accno'))"
                            tal:content="account/prettyTitle"
                            tal:attributes="value account/getId;
                                            selected python: account.getId() in Ids and 1 or 0"/>
                </select>
             </div>

             <div tal:define="error errors/delete|nothing;
                              Delete request/delete | nothing"
                  tal:attributes="class python:error and 'field error' or 'field'">
             
                 <input type="checkbox" name="delete" value="1" checked>Delete those account(s)
             </div>


          <div class="formControls">

            <img src="" class="context"
                   tal:define="portal context/portal_url/getPortalObject; locked portal/lock_icon.png;"
                   tal:condition="isLocked"
                   tal:replace="structure python:locked.tag(title='This item is locked')"
                   alt="Object locked"
                   i18n:attributes="alt"/>

            <input class="context"
                   
                   type="submit"
                   name="form.button.Merge"
                   value="Merge"
                   i18n:attributes="value"
                   tal:attributes="disabled python:isLocked and 'disabled' or None;" />

          </div>

         <input type="hidden" name="form.submitted" value="1" />

      </form>

    </div>
 
</html>
