<dl class="portlet portletCollection"
    i18n:domain="plone"
    tal:define="collection_url view/collection_url;
                collection python:view.collection();
                collection_name python: collection is not None and collection.Title or '';
                plone_view context/@@plone;
                toLocalizedTime nocall:plone_view/toLocalizedTime;
                viewActions here/portal_properties/site_properties/typesUseViewActionInListings|python:();
                getIcon nocall:plone_view/getIcon;">

    <tal:hasDescription condition="exists: view/data/description">
        <dd class="description" tal:condition="python: view.data.description is not None and view.data.description != u''">
            <span tal:content="view/data/description">Description </span> <a href="" tal:attributes="href collection_url" tal:content="collection_name">link</a>
        </dd>
    </tal:hasDescription>
    
    <dt class="portletHeader">
        <span class="portletTopLeft"></span>
	<span class="downArrow">&darr; </span>
        <a tal:attributes="href collection_url" tal:omit-tag="not:view/data/show_more">
            <span tal:content="view/data/header" />
        </a>
        <span class="portletTopRight"></span>
    </dt>
   
    <tal:events tal:repeat="item view/results">
    <dd class="portletItem"
        tal:define="oddrow repeat/item/odd;
			useView    python:item.portal_type in viewActions;
			itemUrl    python:(item.portal_type == 'Press Kit' and not view.checkPermission(item, 'Add portal content')) and item.getURL() + '/download_zip' or (useView and item.getURL() + '/view' or item.getURL());
			item_icon python:getIcon(item);"

        tal:attributes="class python:oddrow and 'portletItem even'+ ' ' + view.getTagsAsClass(item) or 'portletItem odd'+ ' ' + view.getTagsAsClass(item)">
        
	<a class="imagelink" tal:condition="item/hasMedia" href="" tal:attributes="href string:${item/getURL}/view;">
	    <tal:image replace="structure python:view.getLeadMediaTag(item, scale='crop')"></tal:image>
	</a>
	
	<a href="" tal:attributes="href itemUrl; title item/Description" class="relatedTitle" tal:content="item/Title"></a>

	<div id="eventBooking" tal:condition="python: item.portal_type == 'Event' or item.portal_type == 'Media Event'">  
	    <p class="dates" tal:replace="structure python: view.getFormattedEventDate(item.getObject())">
		  Thursday 14 February 2013, 7.30 to 9.30pm
	    </p>
	    <p class="booking" tal:condition="python:not item.getObject().getBooking() and not view.isEventPast(item.getObject())">
					  <span class="price">Free</span>
				    </p>
	    <p class="booking" tal:define="price python: item.getObject().getPrice()" tal:condition="python: item.getObject().getBooking() and not view.isEventPast(item.getObject())">
					  <span class="price" tal:condition="python: item.getObject().getPrice() != ''" tal:content="python: item.getObject().getPrice()">Free</span>
					  <span class="arrow" tal:condition="python: item.getObject().getLink() != ''">&rarr;</span>
					  <a href="" class="bookLink" tal:condition="python: item.getObject().getLink() != ''"
					     tal:attributes="href python:view.getEventBookingLink(item.getObject());
								  onCLick string: return Arnolfini.trackEcommerce('${item/Title}', '0.00', 'Event')">Book</a>
	    </p>
	</div>
	
	<div class="buyable" tal:condition="python: view.isBuyable(item.getObject())">
	    <div class="buyableInfo">
		  <span tal:define="price python:getattr(view.payable(item.getObject()),'price',0) or 0">&pound;<span tal:replace="python: '%.2f'%price">29.00</span> &rarr; <span tal:replace="structure python:view.addPaypalButton('Buy' ,item.Title, price)"></span></span>
	    </div>
	</div>

	<div class="visualClear"></div>
		
    </dd>
    </tal:events>
    
    <dd class="portletFooter" tal:condition="view/data/show_more">
        <span class="portletBottomLeft"></span>
        <span>
        <a tal:attributes="href collection_url" i18n:translate="more_url">
             More&hellip;
             </a>
        </span>
        <span class="portletBottomRight"></span>
    </dd>
</dl>