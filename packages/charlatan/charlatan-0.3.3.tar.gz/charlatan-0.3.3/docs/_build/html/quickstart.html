

<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN"
  "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">


<html xmlns="http://www.w3.org/1999/xhtml">
  <head>
    <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
    
    <title>Quickstart &mdash; charlatan 0.3.2 documentation</title>
    
    <link rel="stylesheet" href="_static/default.css" type="text/css" />
    <link rel="stylesheet" href="_static/pygments.css" type="text/css" />
    
    <script type="text/javascript">
      var DOCUMENTATION_OPTIONS = {
        URL_ROOT:    '',
        VERSION:     '0.3.2',
        COLLAPSE_INDEX: false,
        FILE_SUFFIX: '.html',
        HAS_SOURCE:  true
      };
    </script>
    <script type="text/javascript" src="_static/jquery.js"></script>
    <script type="text/javascript" src="_static/underscore.js"></script>
    <script type="text/javascript" src="_static/doctools.js"></script>
    <link rel="top" title="charlatan 0.3.2 documentation" href="index.html" />
    <link rel="next" title="File format" href="file-format.html" />
    <link rel="prev" title="Welcome to Charlatan’s documentation!" href="index.html" /> 
  </head>
  <body>
    <div class="related">
      <h3>Navigation</h3>
      <ul>
        <li class="right" style="margin-right: 10px">
          <a href="genindex.html" title="General Index"
             accesskey="I">index</a></li>
        <li class="right" >
          <a href="py-modindex.html" title="Python Module Index"
             >modules</a> |</li>
        <li class="right" >
          <a href="file-format.html" title="File format"
             accesskey="N">next</a> |</li>
        <li class="right" >
          <a href="index.html" title="Welcome to Charlatan’s documentation!"
             accesskey="P">previous</a> |</li>
        <li><a href="index.html">charlatan 0.3.2 documentation</a> &raquo;</li> 
      </ul>
    </div>  

    <div class="document">
      <div class="documentwrapper">
        <div class="bodywrapper">
          <div class="body">
            
  <div class="section" id="quickstart">
<h1>Quickstart<a class="headerlink" href="#quickstart" title="Permalink to this headline">¶</a></h1>
<div class="section" id="a-simple-example">
<h2>A simple example<a class="headerlink" href="#a-simple-example" title="Permalink to this headline">¶</a></h2>
<p>Let&#8217;s say we have the following model:</p>
<div class="highlight-python"><div class="highlight"><pre><span class="k">class</span> <span class="nc">Toaster</span><span class="p">(</span><span class="nb">object</span><span class="p">):</span>

    <span class="k">def</span> <span class="nf">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">color</span><span class="p">,</span> <span class="n">slots</span><span class="p">,</span> <span class="n">content</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">color</span> <span class="o">=</span> <span class="n">color</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">slots</span> <span class="o">=</span> <span class="n">slots</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">content</span> <span class="o">=</span> <span class="n">content</span>
</pre></div>
</div>
<p>Let&#8217;s define a very simple fixtures YAML file:</p>
<div class="highlight-yaml"><div class="highlight"><pre><span class="l-Scalar-Plain">toaster</span><span class="p-Indicator">:</span>   <span class="c1"># The fixture&#39;s name</span>
  <span class="l-Scalar-Plain">fields</span><span class="p-Indicator">:</span>  <span class="c1"># The fixture&#39;s content</span>
    <span class="l-Scalar-Plain">color</span><span class="p-Indicator">:</span> <span class="l-Scalar-Plain">red</span>
    <span class="l-Scalar-Plain">slots</span><span class="p-Indicator">:</span> <span class="l-Scalar-Plain">5</span>
    <span class="l-Scalar-Plain">content</span><span class="p-Indicator">:</span> <span class="kt">!rel</span> <span class="l-Scalar-Plain">toasts</span>  <span class="c1"># You can reference other fixtures</span>
  <span class="l-Scalar-Plain">model</span><span class="p-Indicator">:</span> <span class="l-Scalar-Plain">charlatan.tests.fixtures.simple_models:Toaster</span>

<span class="l-Scalar-Plain">toasts</span><span class="p-Indicator">:</span>
  <span class="l-Scalar-Plain">fields</span><span class="p-Indicator">:</span>
    <span class="p-Indicator">-</span> <span class="s">&quot;Toast</span><span class="nv"> </span><span class="s">1&quot;</span>
    <span class="p-Indicator">-</span> <span class="s">&quot;Toast</span><span class="nv"> </span><span class="s">2&quot;</span>
  <span class="c1"># No model is defined, so it defaults to what `fields` actually is, i.e.</span>
  <span class="c1"># in our case, a list.</span>
</pre></div>
</div>
<p>In this example:</p>
<ul class="simple">
<li><tt class="docutils literal"><span class="pre">toaster</span></tt> and <tt class="docutils literal"><span class="pre">toasts</span></tt> are the fixture keys.</li>
<li><tt class="docutils literal"><span class="pre">fields</span></tt> is provided as argument when instantiating the class:
<tt class="docutils literal"><span class="pre">Toaster(**fields)</span></tt>.</li>
<li><tt class="docutils literal"><span class="pre">model</span></tt> is the path to the model that we defined.</li>
<li><tt class="docutils literal"><span class="pre">!rel</span></tt> lets you create relationships by pointing to another fixture key.</li>
</ul>
<p>You first need to load a fixtures file (do it once for the whole test suite)
with <a class="reference internal" href="api-reference.html#charlatan.FixturesManager.load" title="charlatan.FixturesManager.load"><tt class="xref py py-meth docutils literal"><span class="pre">charlatan.FixturesManager.load()</span></tt></a>:</p>
<div class="highlight-python"><div class="highlight"><pre><span class="gp">&gt;&gt;&gt; </span><span class="kn">import</span> <span class="nn">charlatan</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">fixtures_manager</span> <span class="o">=</span> <span class="n">charlatan</span><span class="o">.</span><span class="n">FixturesManager</span><span class="p">()</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">fixtures_manager</span><span class="o">.</span><span class="n">load</span><span class="p">(</span><span class="s">&quot;./docs/examples/simple_fixtures.yaml&quot;</span><span class="p">,</span>
<span class="gp">... </span>    <span class="n">models_package</span><span class="o">=</span><span class="s">&quot;toaster.models&quot;</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">toaster</span> <span class="o">=</span> <span class="n">fixtures_manager</span><span class="o">.</span><span class="n">install_fixture</span><span class="p">(</span><span class="s">&quot;toaster&quot;</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">toaster</span><span class="o">.</span><span class="n">color</span>
<span class="go">&#39;red&#39;</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">toaster</span><span class="o">.</span><span class="n">slots</span>
<span class="go">5</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">toaster</span><span class="o">.</span><span class="n">content</span>
<span class="go">[&#39;Toast 1&#39;, &#39;Toast 2&#39;]</span>
</pre></div>
</div>
<p>Voila!</p>
</div>
<div class="section" id="using-charlatan-in-test-cases">
<h2>Using charlatan in test cases<a class="headerlink" href="#using-charlatan-in-test-cases" title="Permalink to this headline">¶</a></h2>
<p><cite>Charlatan</cite> works best when used with <tt class="xref py py-class docutils literal"><span class="pre">unittest.TestCase</span></tt>. Your test
class needs to inherits from <a class="reference internal" href="api-reference.html#charlatan.FixturesManagerMixin" title="charlatan.FixturesManagerMixin"><tt class="xref py py-class docutils literal"><span class="pre">charlatan.FixturesManagerMixin</span></tt></a>.</p>
<p><cite>Charlatan</cite> uses an internal cache to store fixtures instance (in particular to
create relationships). If you are resetting your database after each tests
(using transactions or by manually truncating all tables), you need to clean
the cache either in <tt class="xref py py-meth docutils literal"><span class="pre">TestCase.setUp()</span></tt>, otherwise <cite>Charlatan</cite> will try
accessing objects that are not anymore in the sqlalchemy session.</p>
<div class="highlight-python"><div class="highlight"><pre><span class="kn">import</span> <span class="nn">unittest</span>

<span class="kn">import</span> <span class="nn">charlatan</span>

<span class="n">fixtures_manager</span> <span class="o">=</span> <span class="n">charlatan</span><span class="o">.</span><span class="n">FixturesManager</span><span class="p">()</span>
<span class="n">fixtures_manager</span><span class="o">.</span><span class="n">load</span><span class="p">(</span><span class="s">&quot;./docs/examples/simple_fixtures.yaml&quot;</span><span class="p">)</span>


<span class="k">class</span> <span class="nc">TestToaster</span><span class="p">(</span><span class="n">unittest</span><span class="o">.</span><span class="n">TestCase</span><span class="p">,</span> <span class="n">charlatan</span><span class="o">.</span><span class="n">FixturesManagerMixin</span><span class="p">):</span>

    <span class="k">def</span> <span class="nf">setUp</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="c"># Attach the fixtures manager to the instance</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">fixtures_manager</span> <span class="o">=</span> <span class="n">fixtures_manager</span>
        <span class="c"># Cleanup the cache</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">init_fixtures</span><span class="p">()</span>

    <span class="k">def</span> <span class="nf">test_example</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Verify that we can get fixtures.&quot;&quot;&quot;</span>
        <span class="n">toaster</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">install_fixture</span><span class="p">(</span><span class="s">&quot;toaster&quot;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="n">toaster</span><span class="o">.</span><span class="n">color</span><span class="p">,</span> <span class="s">&quot;red&quot;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="n">toaster</span><span class="o">.</span><span class="n">slots</span><span class="p">,</span> <span class="mi">5</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="n">toaster</span><span class="o">.</span><span class="n">content</span><span class="p">,</span> <span class="p">[</span><span class="s">&#39;Toast 1&#39;</span><span class="p">,</span> <span class="s">&#39;Toast 2&#39;</span><span class="p">])</span>
</pre></div>
</div>
</div>
<div class="section" id="using-fixtures">
<h2>Using fixtures<a class="headerlink" href="#using-fixtures" title="Permalink to this headline">¶</a></h2>
<p>There are multiple ways to require and use fixtures.</p>
<div class="section" id="for-each-tests-in-setup-and-teardown">
<h3>For each tests, in setUp and tearDown<a class="headerlink" href="#for-each-tests-in-setup-and-teardown" title="Permalink to this headline">¶</a></h3>
<div class="highlight-python"><div class="highlight"><pre><span class="k">class</span> <span class="nc">MyTest</span><span class="p">(</span><span class="n">FixturesManagerMixin</span><span class="p">):</span>

    <span class="k">def</span> <span class="nf">setUp</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="c"># This will create self.client and self.driver</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">install_fixtures</span><span class="p">((</span><span class="s">&quot;client&quot;</span><span class="p">,</span> <span class="s">&quot;driver&quot;</span><span class="p">))</span>

    <span class="k">def</span> <span class="nf">tearDown</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="c"># This will delete self.client and self.driver</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">uninstall_fixtures</span><span class="p">((</span><span class="s">&quot;client&quot;</span><span class="p">,</span> <span class="s">&quot;driver&quot;</span><span class="p">))</span>
</pre></div>
</div>
</div>
<div class="section" id="for-a-single-test">
<h3>For a single test<a class="headerlink" href="#for-a-single-test" title="Permalink to this headline">¶</a></h3>
<div class="highlight-python"><div class="highlight"><pre><span class="k">class</span> <span class="nc">MyTest</span><span class="p">(</span><span class="n">FixturesMixin</span><span class="p">):</span>

    <span class="k">def</span> <span class="nf">test_toaster</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">install_fixture</span><span class="p">(</span><span class="s">&quot;toaster&quot;</span><span class="p">)</span>
        <span class="c"># do things... and optionally uninstall it once you&#39;re done</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">uninstall_fixture</span><span class="p">(</span><span class="s">&quot;toaster&quot;</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="section" id="getting-a-fixture-without-saving-it">
<h3>Getting a fixture without saving it<a class="headerlink" href="#getting-a-fixture-without-saving-it" title="Permalink to this headline">¶</a></h3>
<p>If you want to have complete control over the fixture, you can also get it
without saving it nor attaching it to the test class:</p>
<div class="highlight-python"><div class="highlight"><pre><span class="k">class</span> <span class="nc">MyTest</span><span class="p">(</span><span class="n">FixturesManagerMixin</span><span class="p">):</span>

    <span class="k">def</span> <span class="nf">test_toaster</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">toaster</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_fixture</span><span class="p">(</span><span class="s">&quot;toaster&quot;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">toaster</span><span class="o">.</span><span class="n">brand</span> <span class="o">=</span> <span class="s">&quot;Flying&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">toaster</span><span class="o">.</span><span class="n">save</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="section" id="overriding-fixture-fields">
<h3>Overriding fixture fields<a class="headerlink" href="#overriding-fixture-fields" title="Permalink to this headline">¶</a></h3>
<p>You can override a fixture&#8217;s parameters when getting or installing it.</p>
<div class="highlight-python"><div class="highlight"><pre><span class="n">manager</span> <span class="o">=</span> <span class="n">FixturesManager</span><span class="p">()</span>
<span class="n">manager</span><span class="o">.</span><span class="n">load</span><span class="p">(</span><span class="s">&quot;./examples/fixtures.yaml&quot;</span><span class="p">)</span>
<span class="n">manager</span><span class="o">.</span><span class="n">get_fixture</span><span class="p">(</span><span class="s">&quot;toaster&quot;</span><span class="p">,</span> <span class="n">attrs</span><span class="o">=</span><span class="p">{</span><span class="s">&quot;brand&quot;</span><span class="p">:</span> <span class="s">&quot;Flying&quot;</span><span class="p">})</span>
</pre></div>
</div>
</div>
<div class="section" id="what-happens-when-you-install-a-fixture">
<h3>What happens when you install a fixture<a class="headerlink" href="#what-happens-when-you-install-a-fixture" title="Permalink to this headline">¶</a></h3>
<p>Here&#8217;s the general process:</p>
<ol class="arabic simple">
<li>The fixture is instantiated: <tt class="docutils literal"><span class="pre">Model(**fields)</span></tt>.</li>
<li>If there&#8217;s any post creation hook, they are run (see <a class="reference internal" href="file-format.html#post-creation"><em>Dependencies</em></a>
for more information).</li>
<li>The fixture is then saved. If it&#8217;s a sqlalchemy model, charlatan will detect
it, add it to the session and commit it (<tt class="docutils literal"><span class="pre">db_session.add(instance);</span> <span class="pre">db_session.commit()</span></tt>).
If it&#8217;s not a sqlalchemy model, charlatan will try to call a <cite>save</cite> method
on the instance. If there&#8217;s no such method, charlatan will do nothing.</li>
</ol>
<p>Fixtures are then attached to your test class, you can access them as instance
attributes:</p>
<div class="highlight-python"><div class="highlight"><pre><span class="k">class</span> <span class="nc">MyTest</span><span class="p">(</span><span class="n">FixturesManagerMixin</span><span class="p">):</span>

    <span class="n">fixtures</span> <span class="o">=</span> <span class="p">(</span><span class="s">&quot;toaster&quot;</span><span class="p">,</span> <span class="s">&quot;toast1&quot;</span><span class="p">,</span> <span class="s">&quot;toast2&quot;</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">test_toaster</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">toaster</span><span class="o">.</span><span class="n">toast</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">toast1</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">toast2</span><span class="p">)</span>
</pre></div>
</div>
<p><a class="reference internal" href="hooks.html#hooks"><em>Hooks</em></a> are also supported.</p>
</div>
</div>
</div>


          </div>
        </div>
      </div>
      <div class="sphinxsidebar">
        <div class="sphinxsidebarwrapper">
  <h3><a href="index.html">Table Of Contents</a></h3>
  <ul>
<li><a class="reference internal" href="#">Quickstart</a><ul>
<li><a class="reference internal" href="#a-simple-example">A simple example</a></li>
<li><a class="reference internal" href="#using-charlatan-in-test-cases">Using charlatan in test cases</a></li>
<li><a class="reference internal" href="#using-fixtures">Using fixtures</a><ul>
<li><a class="reference internal" href="#for-each-tests-in-setup-and-teardown">For each tests, in setUp and tearDown</a></li>
<li><a class="reference internal" href="#for-a-single-test">For a single test</a></li>
<li><a class="reference internal" href="#getting-a-fixture-without-saving-it">Getting a fixture without saving it</a></li>
<li><a class="reference internal" href="#overriding-fixture-fields">Overriding fixture fields</a></li>
<li><a class="reference internal" href="#what-happens-when-you-install-a-fixture">What happens when you install a fixture</a></li>
</ul>
</li>
</ul>
</li>
</ul>

  <h4>Previous topic</h4>
  <p class="topless"><a href="index.html"
                        title="previous chapter">Welcome to Charlatan&#8217;s documentation!</a></p>
  <h4>Next topic</h4>
  <p class="topless"><a href="file-format.html"
                        title="next chapter">File format</a></p>
  <h3>This Page</h3>
  <ul class="this-page-menu">
    <li><a href="_sources/quickstart.txt"
           rel="nofollow">Show Source</a></li>
  </ul>
<div id="searchbox" style="display: none">
  <h3>Quick search</h3>
    <form class="search" action="search.html" method="get">
      <input type="text" name="q" />
      <input type="submit" value="Go" />
      <input type="hidden" name="check_keywords" value="yes" />
      <input type="hidden" name="area" value="default" />
    </form>
    <p class="searchtip" style="font-size: 90%">
    Enter search terms or a module, class or function name.
    </p>
</div>
<script type="text/javascript">$('#searchbox').show(0);</script>
        </div>
      </div>
      <div class="clearer"></div>
    </div>
    <div class="related">
      <h3>Navigation</h3>
      <ul>
        <li class="right" style="margin-right: 10px">
          <a href="genindex.html" title="General Index"
             >index</a></li>
        <li class="right" >
          <a href="py-modindex.html" title="Python Module Index"
             >modules</a> |</li>
        <li class="right" >
          <a href="file-format.html" title="File format"
             >next</a> |</li>
        <li class="right" >
          <a href="index.html" title="Welcome to Charlatan’s documentation!"
             >previous</a> |</li>
        <li><a href="index.html">charlatan 0.3.2 documentation</a> &raquo;</li> 
      </ul>
    </div>
    <div class="footer">
        &copy; Copyright 2013, Charles-Axel Dein (Uber).
      Created using <a href="http://sphinx.pocoo.org/">Sphinx</a> 1.1.3.
    </div>
  </body>
</html>