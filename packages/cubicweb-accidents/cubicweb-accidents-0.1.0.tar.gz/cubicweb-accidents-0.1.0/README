Summary
-------
Cube for data.gouv.fr accidents (http://www.data.gouv.fr/fr/dataset/base-de-donnees-accidents-corporels-de-la-circulation-sur-6-annees)



Installation
------------

Create an instance:

cubicweb create accidents my_instance_accidents

Create the database:

cubicweb db-create my_instance_accidents

! Do not launch the db-init !

Insert postgis:

psql my_instance_accidents -f /usr/share/postgresql/9.1/contrib/postgis-1.5/postgis.sql

psql my_instance_accidents -f /usr/share/postgresql/9.1/contrib/postgis-1.5/spatial_ref_sys.sql

Finish the db:

cubicweb db-init my_instance_accidents



Push the data:

Get the communes and departements on http://fr.dbpedia.org/sparql
in JSON, using the following request:


prefix db-owl: <http://dbpedia.org/ontology/>
 select ?ville ?code ?name ?lat ?long ?dep ?depcode ?depname where {
    ?ville db-owl:country <http://fr.dbpedia.org/resource/France> .
    ?ville dbpedia-owl:inseeCode ?code.
    ?ville foaf:name ?name.
    ?ville dbpedia-owl:department ?dep.
    ?dep dbpedia-owl:inseeCode ?depcode.
    ?dep foaf:name ?depname.
    ?ville geo:lat ?lat.
    ?ville geo:long ?long.
 }



Push the communes/departements using:

cubicweb-ctl shell my_instance_accidents /path/to/cubes/accidents/import_communes.py /path/to/json/files


Download both vehicules and accidents files on data.gouv.fr.
Push the data:

cubicweb-ctl shell my_instance_accidents /path/to/cubes/accidents/import_vehicules.py /path/to/vehicules.csv


cubicweb-ctl shell my_instance_accidents /path/to/cubes/accidents/import_accidents.py /path/to/accidents.csv


