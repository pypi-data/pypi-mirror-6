{% extends "base.html" %}

{% block content %}

<div class="row"><div class="span11">
    <form method="post" action="/resolve_all">
        {{ xsrf_form_html() }}
        <button
            type="submit"
            title="Resolve"
            class="btn btn-danger pull-right"
            {% if not num_active %}disabled{% endif %}
        >
            <i class="fa fa-check"> Resolve All</i>
        </button>
    </form>
    <div class="btn-group pull-right" style="padding-right: 10px;">
        <button type="button" class="btn btn-default dropdown-toggle" data-toggle="dropdown">
            Limit: {{limit}} <span class="caret"></span>
        </button>
            <ul class="dropdown-menu" role="menu">
            <li><a href="#">25</a></li>
            <li><a href="#">50</a></li>
            <li><a href="#">100</a></li>
        </ul>
    </div>
</div></div>


<div class="row">&nbsp;</div>

<div class="row"><div class="span11">
    <table class="table table-hover">
        <tr>
            <th>&nbsp;</th>
            <th>Hostname</th>
            <th>Trap</th>
            <th>Received</th>
            <th>Expiration</th>
        </tr>
        {% if not traps %}
            <tr><td colspan="5">
                <div class="alert">No Active Traps.</div>
            </td></tr>
        {% endif %}
        {% for trap in traps %}
            {% set expired = trap.expires != None and now >= trap.expires %}
            <tr class="clickable-row {% if not expired %}danger{% endif %}"
                href="/traps?oid={{trap.oid}}&hostname={{trap.host}}">
                <td class="buttons-column">
                    {% if not expired %}
                        <form method="post" action="/resolve">
                            <input type="hidden" name="host" value="{{trap.host}}">
                            <input type="hidden" name="oid" value="{{trap.oid}}">
                            {{ xsrf_form_html() }}
                            <button type="submit" title="Resolve" class="btn btn-success btn-xs">
                                <i class="fa fa-check fa-sm"></i>
                            </button>
                        </form>
                    {% endif %}
                </td>
                <td>{{trap.host|hostname_or_ip}}</td>
                <td>{{trap.oid|to_mibname}}</td>
                <td>{{trap.sent|print_date}}</td>
                <td>{{trap.expires|print_date}}</span></td>
            </tr>
        {% endfor %}
    </table>
</div></div>

{% endblock %}

{% block script %}
    <script type="text/javascript">
        $(function($) {
            $(".clickable-row").click(function(event) {
                window.document.location = $(this).attr("href");
            });
        });
    </script>

{% endblock %}
