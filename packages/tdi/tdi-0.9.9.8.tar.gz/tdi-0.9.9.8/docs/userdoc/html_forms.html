

<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN"
  "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">


<html xmlns="http://www.w3.org/1999/xhtml">
  <head>
    <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
    
    <title>HTML Form Tools &mdash; TDI 0.9.9.8 documentation</title>
    
    <link rel="stylesheet" href="_static/default.css" type="text/css" />
    <link rel="stylesheet" href="_static/pygments.css" type="text/css" />
    <link rel="stylesheet" href="_static/tdi.css" type="text/css" />
    
    <script type="text/javascript">
      var DOCUMENTATION_OPTIONS = {
        URL_ROOT:    '',
        VERSION:     '0.9.9.8',
        COLLAPSE_INDEX: false,
        FILE_SUFFIX: '.html',
        HAS_SOURCE:  true
      };
    </script>
    <script type="text/javascript" src="_static/jquery.js"></script>
    <script type="text/javascript" src="_static/underscore.js"></script>
    <script type="text/javascript" src="_static/doctools.js"></script>
    <link rel="top" title="TDI 0.9.9.8 documentation" href="index.html" />
    <link rel="up" title="Documentation Topics" href="topics.html" />
    <link rel="next" title="Javascript Tools" href="javascript_tools.html" />
    <link rel="prev" title="Miscellaneous HTML tools" href="html_tools.html" /> 
  </head>
  <body>
    <div class="related">
      <h3>Navigation</h3>
      <ul>
        <li class="right" style="margin-right: 10px">
          <a href="javascript_tools.html" title="Javascript Tools"
             accesskey="N">next</a></li>
        <li class="right" >
          <a href="html_tools.html" title="Miscellaneous HTML tools"
             accesskey="P">previous</a> |</li>
        <li><a href="index.html">TDI 0.9.9.8 documentation</a> &raquo;</li>
          <li><a href="topics.html" accesskey="U">Documentation Topics</a> &raquo;</li> 
      </ul>
    </div>  

    <div class="document">
      <div class="documentwrapper">
        <div class="bodywrapper">
          <div class="body">
            
  <div class="section" id="html-form-tools">
<h1>HTML Form Tools<a class="headerlink" href="#html-form-tools" title="Permalink to this headline">¶</a></h1>
<p>Since <em class="tdi">TDI</em> provides you with such neat node objects, it&#8217;s pretty easy
to write generic functions to handle certain kinds of nodes. HTML
forms always require a huge effort to get them right and are such a
common use case that <em class="tdi">TDI</em> comes with a ready-to-use abstraction of
those particular (and peculiar) kind of nodes.</p>
<p>The form abstraction is located in the <tt class="docutils literal"><a class="reference external" href="../apidoc/tdi.tools.htmlform-module.html"><span class="pre">→&nbsp;tdi.tools.htmlform</span></a></tt> module.
The <tt class="xref py py-mod docutils literal"><span class="pre">htmlform</span></tt> module does <em>not</em> provide a form validation
mechanism. It&#8217;s merely for displaying HTML forms properly and connecting
them easily to data sources (databases, web requests, ...) and/or
validation handlers (e.g. when displaying error messages).</p>
<div class="section" id="htmlform-introduction">
<h2>HTMLForm Introduction<a class="headerlink" href="#htmlform-introduction" title="Permalink to this headline">¶</a></h2>
<p>Before you can do fancy things with your form, you need to get your
hands on the actual form element nodes and pass them to an instance of
the <tt class="docutils literal"><a class="reference external" href="../apidoc/tdi.tools.htmlform._main.HTMLForm-class.html"><span class="pre">→&nbsp;HTMLForm</span></a></tt> class. Here&#8217;s a simple example:</p>
<div class="highlight-python"><div class="highlight"><pre><span class="kn">from</span> <span class="nn">tdi</span> <span class="kn">import</span> <span class="n">html</span>
<span class="kn">from</span> <span class="nn">tdi.tools</span> <span class="kn">import</span> <span class="n">htmlform</span>
<span class="n">template</span> <span class="o">=</span> <span class="n">html</span><span class="o">.</span><span class="n">from_string</span><span class="p">(</span><span class="s">&quot;&quot;&quot;</span>
<span class="s">&lt;html&gt;</span>
<span class="s">&lt;body&gt;</span>
<span class="s">    &lt;p&gt;Type your name:&lt;/p&gt;</span>
<span class="s">    &lt;form tdi=&quot;form&quot;&gt;</span>
<span class="s">        &lt;input tdi=&quot;name&quot; type=&quot;text&quot; /&gt;</span>
<span class="s">        &lt;input tdi=&quot;submit&quot; type=&quot;submit&quot; /&gt;</span>
<span class="s">    &lt;/form&gt;</span>
<span class="s">&lt;/body&gt;</span>
<span class="s">&lt;/html&gt;</span>
<span class="s">&quot;&quot;&quot;</span><span class="p">)</span>

<span class="k">class</span> <span class="nc">Model</span><span class="p">(</span><span class="nb">object</span><span class="p">):</span>
    <span class="k">def</span> <span class="nf">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_form</span> <span class="o">=</span> <span class="n">htmlform</span><span class="o">.</span><span class="n">HTMLForm</span><span class="p">()</span>

    <span class="k">def</span> <span class="nf">render_form</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">node</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_form</span><span class="o">.</span><span class="n">form</span><span class="p">(</span><span class="n">node</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">render_name</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">node</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_form</span><span class="o">.</span><span class="n">text</span><span class="p">(</span><span class="n">node</span><span class="p">,</span> <span class="s">u&quot;name&quot;</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">render_submit</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">node</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_form</span><span class="o">.</span><span class="n">submit</span><span class="p">(</span><span class="n">node</span><span class="p">,</span> <span class="s">u&quot;send&quot;</span><span class="p">,</span> <span class="s">u&quot;Submit form&quot;</span><span class="p">)</span>

<span class="n">model</span> <span class="o">=</span> <span class="n">Model</span><span class="p">()</span>
<span class="n">template</span><span class="o">.</span><span class="n">render</span><span class="p">(</span><span class="n">model</span><span class="p">)</span>
</pre></div>
</div>
<p>And this is basically it. Since most additional logic is plugged into the
<tt class="xref py py-class docutils literal"><span class="pre">HTMLForm</span></tt> instance, the <tt class="xref py py-meth docutils literal"><span class="pre">render()</span></tt> methods will usually stay
easily readable and as clearly laid out as shown in the code above. This
also gives you a nice overview about the form content when reviewing or
editing the model later. It&#8217;s often advisable to put the form even into
its own <a class="reference internal" href="scopes.html"><em>scope</em></a>.</p>
<p>The <tt class="docutils literal"><a class="reference external" href="../apidoc/tdi.tools.htmlform._main.HTMLForm-class.html"><span class="pre">→&nbsp;HTMLForm</span></a></tt> class provides a method for
each form control type defined in HTML that is besides
<tt class="docutils literal"><a class="reference external" href="../apidoc/tdi.tools.htmlform._main.HTMLForm-class.html#form"><span class="pre">→&nbsp;form</span></a></tt> itself:</p>
<dl class="docutils">
<dt>Common text controls</dt>
<dd><tt class="docutils literal"><a class="reference external" href="../apidoc/tdi.tools.htmlform._main.HTMLForm-class.html#text"><span class="pre">→&nbsp;text</span></a></tt>,
<tt class="docutils literal"><a class="reference external" href="../apidoc/tdi.tools.htmlform._main.HTMLForm-class.html#textarea"><span class="pre">→&nbsp;textarea</span></a></tt>,
<tt class="docutils literal"><a class="reference external" href="../apidoc/tdi.tools.htmlform._main.HTMLForm-class.html#password"><span class="pre">→&nbsp;password</span></a></tt></dd>
<dt>More text controls</dt>
<dd><tt class="docutils literal"><a class="reference external" href="../apidoc/tdi.tools.htmlform._main.HTMLForm-class.html#search"><span class="pre">→&nbsp;search</span></a></tt>,
<tt class="docutils literal"><a class="reference external" href="../apidoc/tdi.tools.htmlform._main.HTMLForm-class.html#email"><span class="pre">→&nbsp;email</span></a></tt>,
<tt class="docutils literal"><a class="reference external" href="../apidoc/tdi.tools.htmlform._main.HTMLForm-class.html#tel"><span class="pre">→&nbsp;tel</span></a></tt>,
<tt class="docutils literal"><a class="reference external" href="../apidoc/tdi.tools.htmlform._main.HTMLForm-class.html#url"><span class="pre">→&nbsp;url</span></a></tt></dd>
<dt>Special text controls</dt>
<dd><tt class="docutils literal"><a class="reference external" href="../apidoc/tdi.tools.htmlform._main.HTMLForm-class.html#color"><span class="pre">→&nbsp;color</span></a></tt>,
<tt class="docutils literal"><a class="reference external" href="../apidoc/tdi.tools.htmlform._main.HTMLForm-class.html#number"><span class="pre">→&nbsp;number</span></a></tt>,
<tt class="docutils literal"><a class="reference external" href="../apidoc/tdi.tools.htmlform._main.HTMLForm-class.html#range"><span class="pre">→&nbsp;range</span></a></tt></dd>
<dt>Date and time controls</dt>
<dd><tt class="docutils literal"><a class="reference external" href="../apidoc/tdi.tools.htmlform._main.HTMLForm-class.html#date"><span class="pre">→&nbsp;date</span></a></tt>,
<tt class="docutils literal"><a class="reference external" href="../apidoc/tdi.tools.htmlform._main.HTMLForm-class.html#datetime"><span class="pre">→&nbsp;datetime</span></a></tt>,
<tt class="docutils literal"><a class="reference external" href="../apidoc/tdi.tools.htmlform._main.HTMLForm-class.html#datetime_local"><span class="pre">→&nbsp;datetime_local</span></a></tt>,
<tt class="docutils literal"><a class="reference external" href="../apidoc/tdi.tools.htmlform._main.HTMLForm-class.html#month"><span class="pre">→&nbsp;month</span></a></tt>,
<tt class="docutils literal"><a class="reference external" href="../apidoc/tdi.tools.htmlform._main.HTMLForm-class.html#time"><span class="pre">→&nbsp;time</span></a></tt>,
<tt class="docutils literal"><a class="reference external" href="../apidoc/tdi.tools.htmlform._main.HTMLForm-class.html#week"><span class="pre">→&nbsp;week</span></a></tt></dd>
<dt>Selection controls</dt>
<dd><tt class="docutils literal"><a class="reference external" href="../apidoc/tdi.tools.htmlform._main.HTMLForm-class.html#select"><span class="pre">→&nbsp;select</span></a></tt>,
<tt class="docutils literal"><a class="reference external" href="../apidoc/tdi.tools.htmlform._main.HTMLForm-class.html#datalist"><span class="pre">→&nbsp;datalist</span></a></tt>,
<tt class="docutils literal"><a class="reference external" href="../apidoc/tdi.tools.htmlform._main.HTMLForm-class.html#option"><span class="pre">→&nbsp;option</span></a></tt>,
<tt class="docutils literal"><a class="reference external" href="../apidoc/tdi.tools.htmlform._main.HTMLForm-class.html#checkbox"><span class="pre">→&nbsp;checkbox</span></a></tt>,
<tt class="docutils literal"><a class="reference external" href="../apidoc/tdi.tools.htmlform._main.HTMLForm-class.html#radio"><span class="pre">→&nbsp;radio</span></a></tt></dd>
<dt>Upload controls</dt>
<dd><tt class="docutils literal"><a class="reference external" href="../apidoc/tdi.tools.htmlform._main.HTMLForm-class.html#file"><span class="pre">→&nbsp;file</span></a></tt>,
<tt class="docutils literal"><a class="reference external" href="../apidoc/tdi.tools.htmlform._main.HTMLForm-class.html#keygen"><span class="pre">→&nbsp;keygen</span></a></tt></dd>
<dt>Hidden controls</dt>
<dd><tt class="docutils literal"><a class="reference external" href="../apidoc/tdi.tools.htmlform._main.HTMLForm-class.html#hidden"><span class="pre">→&nbsp;hidden</span></a></tt></dd>
<dt>Buttons</dt>
<dd><tt class="docutils literal"><a class="reference external" href="../apidoc/tdi.tools.htmlform._main.HTMLForm-class.html#button"><span class="pre">→&nbsp;button</span></a></tt>,
<tt class="docutils literal"><a class="reference external" href="../apidoc/tdi.tools.htmlform._main.HTMLForm-class.html#image"><span class="pre">→&nbsp;image</span></a></tt>,
<tt class="docutils literal"><a class="reference external" href="../apidoc/tdi.tools.htmlform._main.HTMLForm-class.html#reset"><span class="pre">→&nbsp;reset</span></a></tt>,
<tt class="docutils literal"><a class="reference external" href="../apidoc/tdi.tools.htmlform._main.HTMLForm-class.html#submit"><span class="pre">→&nbsp;submit</span></a></tt></dd>
</dl>
<p>These methods implement the particular semantics of the accompanying
form elements, hence they all have individual signatures. For example
the <tt class="xref py py-meth docutils literal"><span class="pre">image()</span></tt> method accepts <tt class="docutils literal"><span class="pre">src</span></tt> and <tt class="docutils literal"><span class="pre">alt</span></tt> parameters, while the
<tt class="xref py py-meth docutils literal"><span class="pre">option()</span></tt> method doesn&#8217;t take a <tt class="docutils literal"><span class="pre">name</span></tt> argument. The only argument
common to all methods is <tt class="docutils literal"><span class="pre">node</span></tt> which acts as the link between the
template and the <tt class="docutils literal"><span class="pre">HTMLForm</span></tt> class.</p>
<p>Also for pragmatical reasons some of the methods (optionally) provide to
control related nodes. That is:</p>
<ul class="simple">
<li><tt class="docutils literal"><a class="reference external" href="../apidoc/tdi.tools.htmlform._main.HTMLForm-class.html#form"><span class="pre">→&nbsp;form</span></a></tt> accepts a list of hidden
fields.</li>
<li><tt class="docutils literal"><a class="reference external" href="../apidoc/tdi.tools.htmlform._main.HTMLForm-class.html#select"><span class="pre">→&nbsp;select</span></a></tt> accepts a list of options.</li>
<li><tt class="docutils literal"><a class="reference external" href="../apidoc/tdi.tools.htmlform._main.HTMLForm-class.html#datalist"><span class="pre">→&nbsp;datalist</span></a></tt> accepts a list of
options. In fact, the <tt class="xref py py-meth docutils literal"><span class="pre">datalist()</span></tt> method exists more or less
only to conveniently setup those options.</li>
</ul>
<div class="admonition note">
<p class="first admonition-title">Note</p>
<p class="last">Not all these form controls (especially the new HTML5 features) are
already implemented everywhere. Furthermore existing implementations
still suffer from growing pains. Try out what your browser platforms
support with this <a class="reference external" href="../examples/html5form.html">HTML5 Form Browser Support Test Page</a>. Use libraries like
<a class="reference external" href="http://modernizr.com/">Modernizr</a> for runtime analysis and
provide a graceful degradation strategy.</p>
</div>
<p>Now. So far, we simply got control over the form elements. We defined form
element types, names and values. While this is not that much, it&#8217;s already
handy:</p>
<div class="highlight-html"><div class="highlight"><pre><span class="nt">&lt;html&gt;</span>
<span class="nt">&lt;body&gt;</span>
    <span class="nt">&lt;p&gt;</span>Type your name:<span class="nt">&lt;/p&gt;</span>
    <span class="nt">&lt;form</span> <span class="na">accept-charset=</span><span class="s">&quot;utf-8&quot;</span> <span class="na">method=</span><span class="s">&quot;get&quot;</span><span class="nt">&gt;</span>
        <span class="nt">&lt;input</span> <span class="na">type=</span><span class="s">&quot;text&quot;</span> <span class="na">name=</span><span class="s">&quot;name&quot;</span> <span class="na">value=</span><span class="s">&quot;&quot;</span> <span class="nt">/&gt;</span>
        <span class="nt">&lt;input</span> <span class="na">type=</span><span class="s">&quot;submit&quot;</span> <span class="na">name=</span><span class="s">&quot;send&quot;</span> <span class="na">value=</span><span class="s">&quot;Submit form&quot;</span> <span class="nt">/&gt;</span>
    <span class="nt">&lt;/form&gt;</span>
<span class="nt">&lt;/body&gt;</span>
<span class="nt">&lt;/html&gt;</span>
</pre></div>
</div>
</div>
<div class="section" id="configuring-the-form">
<h2>Configuring The Form<a class="headerlink" href="#configuring-the-form" title="Permalink to this headline">¶</a></h2>
<p>All configuration happens during the initialization of the
<tt class="docutils literal"><a class="reference external" href="../apidoc/tdi.tools.htmlform._main.HTMLForm-class.html"><span class="pre">→&nbsp;HTMLForm</span></a></tt> class.</p>
<p>The following parameters are more or less directly related to HTML and the
HTTP submission (<a class="reference external" href="http://www.w3.org/TR/html5/">W3C</a> and <a class="reference external" href="http://www.ietf.org/rfc/rfc1867.txt">IETF</a>):</p>
<table border="1" class="docutils">
<colgroup>
<col width="27%" />
<col width="73%" />
</colgroup>
<thead valign="bottom">
<tr class="row-odd"><th class="head">Name</th>
<th class="head">Description</th>
</tr>
</thead>
<tbody valign="top">
<tr class="row-even"><td><tt class="docutils literal"><span class="pre">action</span></tt></td>
<td>The form action URL. If omitted or <tt class="docutils literal"><span class="pre">None</span></tt>, the
action is not touched (i.e. taken from the template)</td>
</tr>
<tr class="row-odd"><td><tt class="docutils literal"><span class="pre">method</span></tt></td>
<td>Form submission method (<tt class="docutils literal"><span class="pre">'get'</span></tt> or <tt class="docutils literal"><span class="pre">'post'</span></tt>)</td>
</tr>
<tr class="row-even"><td><tt class="docutils literal"><span class="pre">upload</span></tt></td>
<td>Is this an file upload form? This forces the
<tt class="docutils literal"><span class="pre">method</span></tt> to <tt class="docutils literal"><span class="pre">'post'</span></tt>, sets the <tt class="docutils literal"><span class="pre">enctype</span></tt>
attribute of the form element properly and unlocks
the <tt class="xref py py-meth docutils literal"><span class="pre">file()</span></tt> method (calling <tt class="xref py py-meth docutils literal"><span class="pre">file()</span></tt> on a
instance without upload enabled raises an error).</td>
</tr>
<tr class="row-odd"><td><tt class="docutils literal"><span class="pre">accept_charset</span></tt></td>
<td>Defines the <tt class="docutils literal"><span class="pre">accept-charset</span></tt> attribute of the form
element. By default it&#8217;s <tt class="docutils literal"><span class="pre">'utf-8'</span></tt>. If you set
it to <tt class="docutils literal"><span class="pre">None</span></tt>, the attribute won&#8217;t be touched
(similar to <tt class="docutils literal"><span class="pre">action</span></tt>).</td>
</tr>
<tr class="row-even"><td><tt class="docutils literal"><span class="pre">xhtml</span></tt></td>
<td>If true, boolean attributes are emitted in XHTML
syntax (<tt class="docutils literal"><span class="pre">selected=&quot;selected&quot;</span></tt>), otherwise short
attribute syntax is used (<tt class="docutils literal"><span class="pre">selected</span></tt>). Defaults
to <tt class="docutils literal"><span class="pre">True</span></tt>.</td>
</tr>
</tbody>
</table>
<p>There are three parameters left, which are finally responsible for any
magic you may want to perform:</p>
<table border="1" class="docutils">
<colgroup>
<col width="19%" />
<col width="81%" />
</colgroup>
<thead valign="bottom">
<tr class="row-odd"><th class="head">Name</th>
<th class="head">Description</th>
</tr>
</thead>
<tbody valign="top">
<tr class="row-even"><td><tt class="docutils literal"><span class="pre">param</span></tt></td>
<td>The object used to fill the form fields automatically.
It has to implement the
<tt class="docutils literal"><a class="reference external" href="../apidoc/tdi.tools.htmlform._interfaces.ParameterAdapterInterface-class.html"><span class="pre">→&nbsp;ParameterAdapterInterface</span></a></tt>
If omitted or <tt class="docutils literal"><span class="pre">None</span></tt>, the
<tt class="docutils literal"><a class="reference external" href="../apidoc/tdi.tools.htmlform._adapters.NullParameterAdapter-class.html"><span class="pre">→&nbsp;NullParameterAdapter</span></a></tt>
is applied, which simply doesn&#8217;t return anything and thus
creates empty text fields and leaves everything
unselected.</td>
</tr>
<tr class="row-odd"><td><tt class="docutils literal"><span class="pre">pre_proc</span></tt></td>
<td>Callable used to process the <em class="tdi">TDI</em> nodes <em>before</em> the
<tt class="docutils literal"><span class="pre">HTMLForm</span></tt> method semantics are applied. The
function has to implement the
<tt class="docutils literal"><a class="reference external" href="../apidoc/tdi.tools.htmlform._interfaces.PreProcInterface-class.html"><span class="pre">→&nbsp;PreProcInterface</span></a></tt>.</td>
</tr>
<tr class="row-even"><td><tt class="docutils literal"><span class="pre">post_proc</span></tt></td>
<td>Callable used to process the <em class="tdi">TDI</em> nodes <em>after</em> the
<tt class="docutils literal"><span class="pre">HTMLForm</span></tt> method semantics have been applied. The
function has to implement the
<tt class="docutils literal"><a class="reference external" href="../apidoc/tdi.tools.htmlform._interfaces.PostProcInterface-class.html"><span class="pre">→&nbsp;PostProcInterface</span></a></tt>.</td>
</tr>
</tbody>
</table>
</div>
<div class="section" id="filling-the-form-fields">
<h2>Filling The Form Fields<a class="headerlink" href="#filling-the-form-fields" title="Permalink to this headline">¶</a></h2>
<p>Filling a form field means setting the value or selection of the form
control which is displayed when the HTML page is loaded by the browser.
When the user has finished manipulating the form, he submits it back. The
browser transforms both values and selections into a (by definition)
unordered list of name/value pairs and sends it to the server.</p>
<p>It&#8217;s common practice to use this list to fill the form and present it
again (for example in case of erroneous or incomplete input). The
<tt class="docutils literal"><span class="pre">HTMLForm</span></tt> class expects such a list (via the parameter adapter passed
during initialization) and implements the semantics typcially associated
with it. In the rare case of actually needing different semantics,
doublecheck that it&#8217;s really the case and then just override the
particular method (or simply don&#8217;t use it...).</p>
<p>Depending on the semantics of the particular field type the adapter is
queried for single values (via <tt class="docutils literal"><span class="pre">getfirst</span></tt> or multiple values (via
<tt class="docutils literal"><span class="pre">getlist</span></tt>). Have a look into API documentation of the particular
<tt class="docutils literal"><a class="reference external" href="../apidoc/tdi.tools.htmlform._main.HTMLForm-class.html"><span class="pre">→&nbsp;HTMLForm</span></a></tt> methods about how the values and
selections are picked automatically.</p>
<div class="admonition note">
<p class="first admonition-title">Note</p>
<p class="last">You can always override the logic of picking values or
selections from the parameter adapter by passing the value or
selection information directly to the method.</p>
</div>
<p>Another typical use case for filling forms is to show some records from
a database (or another resource) for manipulation.</p>
<p>The <tt class="docutils literal"><span class="pre">htmlform</span></tt> module provides a few ready-to-use parameter adapters:</p>
<dl class="docutils">
<dt><tt class="docutils literal"><a class="reference external" href="../apidoc/tdi.tools.htmlform._adapters.DictParameterAdapter-class.html"><span class="pre">→&nbsp;DictParameterAdapter</span></a></tt></dt>
<dd>Takes a simple dict as input</dd>
<dt><tt class="docutils literal"><a class="reference external" href="../apidoc/tdi.tools.htmlform._adapters.ListDictParameterAdapter-class.html"><span class="pre">→&nbsp;ListDictParameterAdapter</span></a></tt></dt>
<dd>Takes a dict of sequences as input.</dd>
<dt><tt class="docutils literal"><a class="reference external" href="../apidoc/tdi.tools.htmlform._adapters.MultiDictParameterAdapter-class.html"><span class="pre">→&nbsp;MultiDictParameterAdapter</span></a></tt></dt>
<dd>Takes a multidict as input (it queries the <tt class="docutils literal"><span class="pre">getall</span></tt> method for
values)</dd>
<dt><tt class="docutils literal"><a class="reference external" href="../apidoc/tdi.tools.htmlform._adapters.NullParameterAdapter-class.html"><span class="pre">→&nbsp;NullParameterAdapter</span></a></tt></dt>
<dd>The adapter provides empty values. It&#8217;s the default adapter.</dd>
</dl>
<p>The <tt class="docutils literal"><span class="pre">cgi.FieldStorage</span></tt> class provides a similar interface - it does
not return unicode, however.</p>
</div>
<div class="section" id="post-processing-nodes">
<h2>Post-processing Nodes<a class="headerlink" href="#post-processing-nodes" title="Permalink to this headline">¶</a></h2>
<p><tt class="docutils literal"><span class="pre">HTMLForm</span></tt> provides the possibility to attach some automatic action
after applying its own. That&#8217;s what the post processor is for. A
typical task, perfectly suitable for automation is to set the
<tt class="docutils literal"><span class="pre">tabindex</span></tt> attribute for form fields. This allows the user to switch
more easily between the fields using his <tt class="docutils literal"><span class="pre">tab</span></tt> key.</p>
<p>The post processor is a function (or more general: a callable) which
takes as arguments:</p>
<ul class="simple">
<li>the name of the calling <tt class="docutils literal"><span class="pre">HTMLForm</span></tt> method.</li>
<li>the <em class="tdi">TDI</em> node.</li>
<li>the <tt class="docutils literal"><span class="pre">HTMLForm</span></tt> method arguments as dict</li>
</ul>
<p>There&#8217;s actually a <tt class="docutils literal"><span class="pre">TabIndexer</span></tt> implementation
available, which can be plugged as a post processor. Here&#8217;s the same form
we&#8217;ve seen in the introduction chapter, but with the tab indexer
enabled:</p>
<div class="highlight-python"><div class="highlight"><pre><span class="kn">from</span> <span class="nn">tdi</span> <span class="kn">import</span> <span class="n">html</span>
<span class="kn">from</span> <span class="nn">tdi.tools</span> <span class="kn">import</span> <span class="n">htmlform</span>
<span class="n">template</span> <span class="o">=</span> <span class="n">html</span><span class="o">.</span><span class="n">from_string</span><span class="p">(</span><span class="s">&quot;&quot;&quot;</span>
<span class="s">&lt;html&gt;</span>
<span class="s">&lt;body&gt;</span>
<span class="s">    &lt;p&gt;Type your name:&lt;/p&gt;</span>
<span class="s">    &lt;form tdi=&quot;form&quot;&gt;</span>
<span class="s">        &lt;input tdi=&quot;name&quot; type=&quot;text&quot; /&gt;</span>
<span class="s">        &lt;input tdi=&quot;submit&quot; type=&quot;submit&quot; /&gt;</span>
<span class="s">    &lt;/form&gt;</span>
<span class="s">&lt;/body&gt;</span>
<span class="s">&lt;/html&gt;</span>
<span class="s">&quot;&quot;&quot;</span><span class="p">)</span>

<span class="k">class</span> <span class="nc">Model</span><span class="p">(</span><span class="nb">object</span><span class="p">):</span>
    <span class="k">def</span> <span class="nf">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_form</span> <span class="o">=</span> <span class="n">htmlform</span><span class="o">.</span><span class="n">HTMLForm</span><span class="p">(</span><span class="n">post_proc</span><span class="o">=</span><span class="n">htmlform</span><span class="o">.</span><span class="n">TabIndexer</span><span class="p">())</span>

    <span class="k">def</span> <span class="nf">render_form</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">node</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_form</span><span class="o">.</span><span class="n">form</span><span class="p">(</span><span class="n">node</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">render_name</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">node</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_form</span><span class="o">.</span><span class="n">text</span><span class="p">(</span><span class="n">node</span><span class="p">,</span> <span class="s">u&quot;name&quot;</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">render_submit</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">node</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_form</span><span class="o">.</span><span class="n">submit</span><span class="p">(</span><span class="n">node</span><span class="p">,</span> <span class="s">u&quot;send&quot;</span><span class="p">,</span> <span class="s">u&quot;Submit form&quot;</span><span class="p">)</span>

<span class="n">model</span> <span class="o">=</span> <span class="n">Model</span><span class="p">()</span>
<span class="n">template</span><span class="o">.</span><span class="n">render</span><span class="p">(</span><span class="n">model</span><span class="p">)</span>
</pre></div>
</div>
<p>And here&#8217;s the result:</p>
<div class="highlight-html"><div class="highlight"><pre><span class="nt">&lt;html&gt;</span>
<span class="nt">&lt;body&gt;</span>
    <span class="nt">&lt;p&gt;</span>Type your name:<span class="nt">&lt;/p&gt;</span>
    <span class="nt">&lt;form</span> <span class="na">accept-charset=</span><span class="s">&quot;utf-8&quot;</span> <span class="na">method=</span><span class="s">&quot;get&quot;</span><span class="nt">&gt;</span>
        <span class="nt">&lt;input</span> <span class="na">type=</span><span class="s">&quot;text&quot;</span> <span class="na">name=</span><span class="s">&quot;name&quot;</span> <span class="na">value=</span><span class="s">&quot;&quot;</span> <span class="na">tabindex=</span><span class="s">&quot;1&quot;</span> <span class="nt">/&gt;</span>
        <span class="nt">&lt;input</span> <span class="na">type=</span><span class="s">&quot;submit&quot;</span> <span class="na">name=</span><span class="s">&quot;send&quot;</span> <span class="na">value=</span><span class="s">&quot;Submit form&quot;</span> <span class="na">tabindex=</span><span class="s">&quot;2&quot;</span> <span class="nt">/&gt;</span>
    <span class="nt">&lt;/form&gt;</span>
<span class="nt">&lt;/body&gt;</span>
<span class="nt">&lt;/html&gt;</span>
</pre></div>
</div>
</div>
<div class="section" id="pre-processing-nodes">
<h2>Pre-Processing Nodes<a class="headerlink" href="#pre-processing-nodes" title="Permalink to this headline">¶</a></h2>
<p><tt class="docutils literal"><span class="pre">HTMLForm</span></tt> also provides the possibility to attach some automatic action
<em>before</em> applying its own. That&#8217;s the pre processor. A pre processor
can do everything a post processor can do. However, because it&#8217;s running
before the actual <tt class="docutils literal"><span class="pre">HTMLForm</span></tt> logic, it has the ability to modify the
arguments of the calling methods, which apparently is also the main use
case.</p>
<p>The pre processor is a callable which takes the same arguments as the
post processor:</p>
<ul class="simple">
<li>the name of the calling <tt class="docutils literal"><span class="pre">HTMLForm</span></tt> method.</li>
<li>the <em class="tdi">TDI</em> node.</li>
<li>the <tt class="docutils literal"><span class="pre">HTMLForm</span></tt> method arguments as dict</li>
</ul>
<p>Additionally the pre processor must return a tuple consisting of:</p>
<ul class="simple">
<li>the <em class="tdi">TDI</em> node. This does not need to be the same node as passed
originally.</li>
<li>a dict with replacements for the original <tt class="docutils literal"><span class="pre">HTMLForm</span></tt> arguments.
Missing keys are not replaced and unrecognized keys are simply ignored.</li>
</ul>
<p>The following example uses a pre processor in order to display error
messages. We&#8217;re still using the same form, again with the tab indexer,
but now additionally with error handling:</p>
<div class="highlight-python"><div class="highlight"><pre><span class="kn">from</span> <span class="nn">tdi</span> <span class="kn">import</span> <span class="n">html</span>
<span class="kn">from</span> <span class="nn">tdi.tools</span> <span class="kn">import</span> <span class="n">htmlform</span>
<span class="n">template</span> <span class="o">=</span> <span class="n">html</span><span class="o">.</span><span class="n">from_string</span><span class="p">(</span><span class="s">&quot;&quot;&quot;</span>
<span class="s">&lt;html&gt;</span>
<span class="s">&lt;body&gt;</span>
<span class="s">    &lt;p&gt;Type your name:&lt;/p&gt;</span>
<span class="s">    &lt;form tdi=&quot;form&quot;&gt;</span>
<span class="s">        &lt;div tdi=&quot;-name&quot;&gt;</span>
<span class="s">            &lt;p tdi=&quot;*error&quot; class=&quot;error&quot;&gt;Error message&lt;/p&gt;</span>
<span class="s">            &lt;input tdi=&quot;*field&quot; id=&quot;name&quot; type=&quot;text&quot; /&gt;</span>
<span class="s">        &lt;/div&gt;</span>
<span class="s">        &lt;input tdi=&quot;submit&quot; type=&quot;submit&quot; /&gt;</span>
<span class="s">    &lt;/form&gt;</span>
<span class="s">&lt;/body&gt;</span>
<span class="s">&lt;/html&gt;</span>
<span class="s">&quot;&quot;&quot;</span><span class="p">)</span>

<span class="k">class</span> <span class="nc">Model</span><span class="p">(</span><span class="nb">object</span><span class="p">):</span>
    <span class="k">def</span> <span class="nf">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">errors</span><span class="o">=</span><span class="bp">None</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_errors</span> <span class="o">=</span> <span class="n">errors</span> <span class="ow">or</span> <span class="p">{}</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_form</span> <span class="o">=</span> <span class="n">htmlform</span><span class="o">.</span><span class="n">HTMLForm</span><span class="p">(</span>
            <span class="n">pre_proc</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">preproc</span><span class="p">,</span>
            <span class="n">post_proc</span><span class="o">=</span><span class="n">htmlform</span><span class="o">.</span><span class="n">TabIndexer</span><span class="p">(),</span>
        <span class="p">)</span>

    <span class="k">def</span> <span class="nf">preproc</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">which</span><span class="p">,</span> <span class="n">node</span><span class="p">,</span> <span class="n">kwargs</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot; HTMLForm node pre processor &quot;&quot;&quot;</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="n">fieldnode</span> <span class="o">=</span> <span class="n">node</span><span class="o">.</span><span class="n">field</span>
        <span class="k">except</span> <span class="ne">AttributeError</span><span class="p">:</span>
            <span class="n">fieldnode</span> <span class="o">=</span> <span class="n">node</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">try</span><span class="p">:</span>
                <span class="n">errornode</span> <span class="o">=</span> <span class="n">node</span><span class="o">.</span><span class="n">error</span>
            <span class="k">except</span> <span class="ne">AttributeError</span><span class="p">:</span>
                <span class="k">pass</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">name</span> <span class="o">=</span> <span class="n">kwargs</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s">&#39;name&#39;</span><span class="p">)</span>
                <span class="k">if</span> <span class="n">name</span> <span class="ow">and</span> <span class="n">name</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">_errors</span><span class="p">:</span>
                    <span class="n">errornode</span><span class="o">.</span><span class="n">content</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_errors</span><span class="p">[</span><span class="n">name</span><span class="p">]</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="n">errornode</span><span class="o">.</span><span class="n">remove</span><span class="p">()</span>

        <span class="k">return</span> <span class="n">fieldnode</span><span class="p">,</span> <span class="n">kwargs</span>

    <span class="k">def</span> <span class="nf">render_form</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">node</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_form</span><span class="o">.</span><span class="n">form</span><span class="p">(</span><span class="n">node</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">render_name</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">node</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_form</span><span class="o">.</span><span class="n">text</span><span class="p">(</span><span class="n">node</span><span class="p">,</span> <span class="s">u&quot;name&quot;</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">render_submit</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">node</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_form</span><span class="o">.</span><span class="n">submit</span><span class="p">(</span><span class="n">node</span><span class="p">,</span> <span class="s">u&quot;send&quot;</span><span class="p">,</span> <span class="s">u&quot;Submit form&quot;</span><span class="p">)</span>

<span class="n">model</span> <span class="o">=</span> <span class="n">Model</span><span class="p">(</span><span class="n">errors</span><span class="o">=</span><span class="nb">dict</span><span class="p">(</span><span class="n">name</span><span class="o">=</span><span class="s">u&#39;Please do enter a name!&#39;</span><span class="p">))</span>
<span class="n">template</span><span class="o">.</span><span class="n">render</span><span class="p">(</span><span class="n">model</span><span class="p">)</span>
</pre></div>
</div>
<p>This pre processor sets the error message and then replaces the node
with the real field node, which both <tt class="docutils literal"><span class="pre">HTMLForm</span></tt> and the post processor
work on.</p>
<div class="highlight-html"><div class="highlight"><pre><span class="nt">&lt;html&gt;</span>
<span class="nt">&lt;body&gt;</span>
    <span class="nt">&lt;p&gt;</span>Type your name:<span class="nt">&lt;/p&gt;</span>
    <span class="nt">&lt;form</span> <span class="na">accept-charset=</span><span class="s">&quot;utf-8&quot;</span> <span class="na">method=</span><span class="s">&quot;get&quot;</span><span class="nt">&gt;</span>
        
            <span class="nt">&lt;p</span> <span class="na">class=</span><span class="s">&quot;error&quot;</span><span class="nt">&gt;</span>Please do enter a name!<span class="nt">&lt;/p&gt;</span>
            <span class="nt">&lt;input</span> <span class="na">tabindex=</span><span class="s">&quot;1&quot;</span> <span class="na">type=</span><span class="s">&quot;text&quot;</span> <span class="na">id=</span><span class="s">&quot;name&quot;</span> <span class="na">value=</span><span class="s">&quot;&quot;</span> <span class="na">name=</span><span class="s">&quot;name&quot;</span> <span class="nt">/&gt;</span>
        
        <span class="nt">&lt;input</span> <span class="na">type=</span><span class="s">&quot;submit&quot;</span> <span class="na">name=</span><span class="s">&quot;send&quot;</span> <span class="na">value=</span><span class="s">&quot;Submit form&quot;</span> <span class="na">tabindex=</span><span class="s">&quot;2&quot;</span> <span class="nt">/&gt;</span>
    <span class="nt">&lt;/form&gt;</span>
<span class="nt">&lt;/body&gt;</span>
<span class="nt">&lt;/html&gt;</span>
</pre></div>
</div>
</div>
</div>


          </div>
        </div>
      </div>
      <div class="sphinxsidebar">
        <div class="sphinxsidebarwrapper">
  <h3><a href="index.html">Table Of Contents</a></h3>
  <ul>
<li><a class="reference internal" href="#">HTML Form Tools</a><ul>
<li><a class="reference internal" href="#htmlform-introduction">HTMLForm Introduction</a></li>
<li><a class="reference internal" href="#configuring-the-form">Configuring The Form</a></li>
<li><a class="reference internal" href="#filling-the-form-fields">Filling The Form Fields</a></li>
<li><a class="reference internal" href="#post-processing-nodes">Post-processing Nodes</a></li>
<li><a class="reference internal" href="#pre-processing-nodes">Pre-Processing Nodes</a></li>
</ul>
</li>
</ul>

  <h4>Previous topic</h4>
  <p class="topless"><a href="html_tools.html"
                        title="previous chapter">Miscellaneous HTML tools</a></p>
  <h4>Next topic</h4>
  <p class="topless"><a href="javascript_tools.html"
                        title="next chapter">Javascript Tools</a></p>
<div id="searchbox" style="display: none">
  <h3>Quick search</h3>
    <form class="search" action="search.html" method="get">
      <input type="text" name="q" />
      <input type="submit" value="Go" />
      <input type="hidden" name="check_keywords" value="yes" />
      <input type="hidden" name="area" value="default" />
    </form>
    <p class="searchtip" style="font-size: 90%">
    Enter search terms or a module, class or function name.
    </p>
</div>
<script type="text/javascript">$('#searchbox').show(0);</script>
        </div>
      </div>
      <div class="clearer"></div>
    </div>
    <div class="related">
      <h3>Navigation</h3>
      <ul>
        <li class="right" style="margin-right: 10px">
          <a href="javascript_tools.html" title="Javascript Tools"
             >next</a></li>
        <li class="right" >
          <a href="html_tools.html" title="Miscellaneous HTML tools"
             >previous</a> |</li>
        <li><a href="index.html">TDI 0.9.9.8 documentation</a> &raquo;</li>
          <li><a href="topics.html" >Documentation Topics</a> &raquo;</li> 
      </ul>
    </div>
    <div class="footer">
        &copy; Copyright 2014 André Malo.
      Created using <a href="http://sphinx.pocoo.org/">Sphinx</a> 1.1.3.
    </div>
  </body>
</html>