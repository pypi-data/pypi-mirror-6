

<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN"
  "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">


<html xmlns="http://www.w3.org/1999/xhtml">
  <head>
    <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
    
    <title>powder Documentation &mdash; powder 0.9.1 documentation</title>
    
    <link rel="stylesheet" href="_static/default.css" type="text/css" />
    <link rel="stylesheet" href="_static/pygments.css" type="text/css" />
    
    <script type="text/javascript">
      var DOCUMENTATION_OPTIONS = {
        URL_ROOT:    '',
        VERSION:     '0.9.1',
        COLLAPSE_INDEX: false,
        FILE_SUFFIX: '.html',
        HAS_SOURCE:  true
      };
    </script>
    <script type="text/javascript" src="_static/jquery.js"></script>
    <script type="text/javascript" src="_static/underscore.js"></script>
    <script type="text/javascript" src="_static/doctools.js"></script>
    <link rel="top" title="powder 0.9.1 documentation" href="#" /> 
  </head>
  <body>
    <div class="related">
      <h3>Navigation</h3>
      <ul>
        <li class="right" style="margin-right: 10px">
          <a href="genindex.html" title="General Index"
             accesskey="I">index</a></li>
        <li><a href="#">powder 0.9.1 documentation</a> &raquo;</li> 
      </ul>
    </div>  

    <div class="document">
      <div class="documentwrapper">
        <div class="bodywrapper">
          <div class="body">
            
  <div class="section" id="powder-documentation">
<h1>powder Documentation<a class="headerlink" href="#powder-documentation" title="Permalink to this headline">¶</a></h1>
<p>A python package that simulates powder diffraction using CCP4 and xprepx.</p>
<p>The <em>powder</em> script glues together operations to simulate powder
diffraction using <em>xprepx</em> and <em>ccp4</em>.</p>
<p>The <em>powder</em> script installs to the <tt class="docutils literal"><span class="pre">bin/</span></tt> directory of your
Python install, which should be in your path.</p>
<div class="section" id="complete-instructions-for-powder">
<h2>Complete Instructions for <em>powder</em><a class="headerlink" href="#complete-instructions-for-powder" title="Permalink to this headline">¶</a></h2>
<div class="section" id="prerequisits">
<h3>Prerequisits<a class="headerlink" href="#prerequisits" title="Permalink to this headline">¶</a></h3>
<p>Before running powder, make sure that the following programs
and packages are available and in your path:</p>
<ul class="simple">
<li><em>molscript</em> (including molauto)</li>
<li><em>sfall</em> (CCP4)</li>
<li><em>mtz2various</em> (CCP4)</li>
<li><em>xprepx</em> (by George Sheldrick)</li>
<li><em>ps2pdf</em></li>
<li><em>convert</em> (ImageMagick)</li>
</ul>
<p>You also need Python version 2.6 or 2.7.</p>
</div>
<div class="section" id="instructions">
<h3>Instructions<a class="headerlink" href="#instructions" title="Permalink to this headline">¶</a></h3>
<p>Running <em>powder</em> requires only four easy steps.</p>
<ol class="arabic">
<li><p class="first">Make a new directory and put your pdb file in it.</p>
</li>
<li><p class="first">Make a template settings file in that directory:</p>
<div class="highlight-python"><div class="highlight"><pre><span class="n">powder</span> <span class="o">-</span><span class="n">t</span> <span class="o">&gt;</span> <span class="n">settings</span><span class="o">.</span><span class="n">cfg</span>
</pre></div>
</div>
</li>
<li><p class="first">Edit <em>at least</em> the first five values in the settings
file on the right hand side of the &#8220;=&#8221; signs.</p>
<p><strong>Important</strong> - Don&#8217;t change the names on othe left
of the &#8220;=&#8221; signs because the left hand side names have meaning.</p>
</li>
<li><p class="first">Run <em>powder</em> with the config file you edited:</p>
<div class="highlight-python"><pre>powder settings.cfg</pre>
</div>
</li>
</ol>
</div>
</div>
<div class="section" id="notes">
<h2>Notes<a class="headerlink" href="#notes" title="Permalink to this headline">¶</a></h2>
<ul>
<li><p class="first">Run <em>powder</em> with no arguments for quick help:</p>
<div class="highlight-python"><div class="highlight"><pre><span class="n">powder</span>
</pre></div>
</div>
</li>
<li><p class="first">The powder diffraction and a postscript file will be made for
you. The program that does the summation and averaging, <em>xprepx</em>,
runs as an X-window. When the plot pops up, it is important to click
in the plot window and hit <tt class="docutils literal"><span class="pre">&lt;Enter&gt;</span></tt> to make sure the postscript
file is saved.</p>
</li>
<li><p class="first">A pdf file is now also made that summarizes the model and
simulation. That file is named the same as the postscript output,
except that the filename extension is &#8221;.pdf&#8221;, of course.
Contents of the file specified by the <tt class="docutils literal"><span class="pre">info</span></tt> setting
will be inserted into this report.</p>
</li>
<li><p class="first">There is no need to edit the pdb file in most cases. The
<tt class="docutils literal"><span class="pre">CRYST1</span></tt> card, which specifies the crystallographic symmetry, is
created for you from the settings file and written to a new pdb file
which is then used for the diffraction simulation.</p>
</li>
<li><p class="first">An exception to modifying pdb files is that NMR structures should be
limited to one model only. NMR structures come from the PDB with
more than one model included. The extra structures will influence
the powder diffraction.</p>
</li>
<li><p class="first">A text file will now be created that contains YAML
(<a class="reference external" href="http://en.wikipedia.org/wiki/YAML">http://en.wikipedia.org/wiki/YAML</a>) describing the spectrum as
taken from the xprepx postscript output. The name of this file
is specified by the <tt class="docutils literal"><span class="pre">spectrum</span> <span class="pre">file</span></tt> setting
(default: <tt class="docutils literal"><span class="pre">spectrum.yml</span></tt>). In YAML terms, the
spectrum is stored as a top-level list of [2-theta, intensity] pairs.
A python program can make a 2-D numpy array from the spectrum easily
if numpy (<a class="reference external" href="http://numpy.scipy.org/">http://numpy.scipy.org/</a>) and pyYAML (<a class="reference external" href="http://pyyaml.org/">http://pyyaml.org/</a>)
are installed.  For example, if the spectrum is stored in the
file &#8220;<tt class="docutils literal"><span class="pre">spectrum.yml</span></tt>&#8221;:</p>
<div class="highlight-python"><div class="highlight"><pre><span class="kn">import</span> <span class="nn">numpy</span>
<span class="kn">import</span> <span class="nn">yaml</span>
<span class="n">spec_ary</span> <span class="o">=</span> <span class="n">numpy</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">yaml</span><span class="o">.</span><span class="n">load</span><span class="p">(</span><span class="nb">open</span><span class="p">(</span><span class="s">&#39;spectrum.yml&#39;</span><span class="p">)))</span>
</pre></div>
</div>
<p>More generally, the spectrum starts on the second line of the yaml
file and each data line conforms to the following FORTRAN
formatted read:</p>
<div class="highlight-python"><pre>REAL X, Y
READ '(4X, F9.0, 2X, F9.0)', X, Y</pre>
</div>
</li>
</ul>
</div>
<div class="section" id="flags">
<h2>Flags<a class="headerlink" href="#flags" title="Permalink to this headline">¶</a></h2>
<ul>
<li><p class="first">The <tt class="docutils literal"><span class="pre">-d</span></tt> flag prevents powder from running xprepx and
CCP4 programs for debugging.</p>
</li>
<li><p class="first">The <tt class="docutils literal"><span class="pre">-t</span></tt> flag will print a template file for editing (see
the instructions).</p>
</li>
<li><p class="first">The <tt class="docutils literal"><span class="pre">-c</span></tt> flag with the config file will give a 2-theta -&gt; resolution
conversion for the wavelength specified in the config file. E.g.:</p>
<blockquote>
<div><p>powder -c settings.cfg</p>
</div></blockquote>
</li>
<li><p class="first">The <tt class="docutils literal"><span class="pre">-h</span></tt> flag will print the usage and help notes.</p>
</li>
</ul>
</div>
<div class="section" id="settings-file">
<h2>Settings File<a class="headerlink" href="#settings-file" title="Permalink to this headline">¶</a></h2>
<p>The settings file is a standard <em>sectionless</em> config
file in the standard INI file format
(<a class="reference external" href="http://en.wikipedia.org/wiki/INI_file">http://en.wikipedia.org/wiki/INI_file</a>).</p>
<p>Examples of minimimal and complete settings files are at the
end of this manual.</p>
<div class="section" id="mandatory-settings">
<h3>Mandatory Settings<a class="headerlink" href="#mandatory-settings" title="Permalink to this headline">¶</a></h3>
<p>The &#8220;powder&#8221; script will fail if these minimal settings are not
included in the settings file.</p>
<blockquote>
<div><table class="docutils field-list" frame="void" rules="none">
<col class="field-name" />
<col class="field-body" />
<tbody valign="top">
<tr class="field-odd field"><th class="field-name">pdb model:</th><td class="field-body">the name of the pdb file containing the model
(e.g. <tt class="docutils literal"><span class="pre">my_model.pdb</span></tt>)</td>
</tr>
<tr class="field-even field"><th class="field-name" colspan="2">cell dimensions:</th></tr>
<tr class="field-even field"><td>&nbsp;</td><td class="field-body">three numbers separated by spaces that
specify the dimensions
of the unit cell (e.g. <tt class="docutils literal"><span class="pre">250</span> <span class="pre">250</span> <span class="pre">250</span></tt>)</td>
</tr>
<tr class="field-odd field"><th class="field-name">res limits:</th><td class="field-body">two numbers separated by spaces that specify
the low and high resolution
limits over which to calculate the simulated
powder diffraction spectrum (e.g. <tt class="docutils literal"><span class="pre">1000</span> <span class="pre">4.0</span></tt>)</td>
</tr>
<tr class="field-even field"><th class="field-name">wavelength:</th><td class="field-body">the wavelength of the simulated x-ray radiation
(e.g. <tt class="docutils literal"><span class="pre">1.54178</span></tt>)</td>
</tr>
<tr class="field-odd field"><th class="field-name" colspan="2">postscript file:</th></tr>
<tr class="field-odd field"><td>&nbsp;</td><td class="field-body">name of the output postscript file that
shows the simulated spectrum
(e.g. <tt class="docutils literal"><span class="pre">my_powder.ps</span></tt>)</td>
</tr>
</tbody>
</table>
</div></blockquote>
</div>
<div class="section" id="optional-settings">
<h3>Optional Settings<a class="headerlink" href="#optional-settings" title="Permalink to this headline">¶</a></h3>
<p>These settings are not necessary but are included for special cases,
like using non-standard versions of sfall, xprep, etc.</p>
<blockquote>
<div><table class="docutils field-list" frame="void" rules="none">
<col class="field-name" />
<col class="field-body" />
<tbody valign="top">
<tr class="field-odd field"><th class="field-name">reset b-facs:</th><td class="field-body">a number that specifies a new b factor
for all atoms in the model&#8211;if this
number is negative, then no reset will be done
(default: <tt class="docutils literal"><span class="pre">-1</span></tt>)</td>
</tr>
<tr class="field-even field"><th class="field-name">mark interval:</th><td class="field-body">for the plotted spectrum, the interval
between marks on the 2-theta axis (default: <tt class="docutils literal"><span class="pre">2</span></tt>)</td>
</tr>
<tr class="field-odd field"><th class="field-name">title:</th><td class="field-body">for the pdf report, the title will pe placed in the
report above the simulated diffraction pattern
(default: <tt class="docutils literal"><span class="pre">info.txt</span></tt>)</td>
</tr>
<tr class="field-even field"><th class="field-name">info:</th><td class="field-body">name of info file that contains pre-formatted text
that will be inserted into the pdf report
(default: <tt class="docutils literal"><span class="pre">info.txt</span></tt>)</td>
</tr>
<tr class="field-odd field"><th class="field-name">clean up:</th><td class="field-body">if set to <tt class="docutils literal"><span class="pre">True</span></tt>, then the mtz &amp; sca files will be removed
to save disk space
(default: <tt class="docutils literal"><span class="pre">True</span></tt>)</td>
</tr>
<tr class="field-even field"><th class="field-name">plot x units:</th><td class="field-body">if set to <tt class="docutils literal"><span class="pre">angstroms</span></tt>, then theta angles along the
x-axis are converted to angstroms instead of the <em>xprepx</em>
default of degrees
(default: <tt class="docutils literal"><span class="pre">angstroms</span></tt>)</td>
</tr>
<tr class="field-odd field"><th class="field-name">side ps file:</th><td class="field-body">name of an intermediate ps file showing a side view of the
model&#8211;use it if you don&#8217;t want a hidden file
(default: <tt class="docutils literal"><span class="pre">.tmp.side.ps</span></tt>)</td>
</tr>
<tr class="field-even field"><th class="field-name">top ps file:</th><td class="field-body">name of an intermediate ps file showing a top view of the
model&#8211;use it if you don&#8217;t want a hidden file
(default: <tt class="docutils literal"><span class="pre">.tmp.top.ps</span></tt>)</td>
</tr>
<tr class="field-odd field"><th class="field-name">spectrum file:</th><td class="field-body">name of the yaml file in which the spectrum will be stored
as a numerical 2-d array
(default: <tt class="docutils literal"><span class="pre">spectrum.yml</span></tt>)</td>
</tr>
<tr class="field-even field"><th class="field-name">temp pdb file:</th><td class="field-body"><em>powder</em> must create an intermediate pdb
file (default: <tt class="docutils literal"><span class="pre">.tmp.pdb</span></tt>)</td>
</tr>
<tr class="field-odd field"><th class="field-name">mtz file:</th><td class="field-body"><em>powder</em> must create an intermediate mtz file
(default: <tt class="docutils literal"><span class="pre">my_model.mtz</span></tt>)</td>
</tr>
<tr class="field-even field"><th class="field-name">sca file:</th><td class="field-body"><em>powder</em> must also create an intermediate sca
file that will also serve as the root name for
the xprep prp results file (default: <tt class="docutils literal"><span class="pre">my_model.sca</span></tt>)</td>
</tr>
<tr class="field-odd field"><th class="field-name">sfall:</th><td class="field-body">command to call the <em>sfall</em> program from CCP4
(default: <tt class="docutils literal"><span class="pre">sfall</span></tt>)</td>
</tr>
<tr class="field-even field"><th class="field-name">mtz2various:</th><td class="field-body">command to call the <em>mtz2various</em> program from
CCP4 (default: <tt class="docutils literal"><span class="pre">mtz2various</span></tt>)</td>
</tr>
<tr class="field-odd field"><th class="field-name">xprepx:</th><td class="field-body">command to call xprepx&#8211;if you have memory problems, use
<em>bigxprepx</em>, i.e. <tt class="docutils literal"><span class="pre">/joule2/programs/xprep/bigxprepx</span></tt>
(default: <tt class="docutils literal"><span class="pre">xprepx</span></tt>)</td>
</tr>
<tr class="field-even field"><th class="field-name">ps2pdf:</th><td class="field-body">command to convert postscript to pdf
(default: <tt class="docutils literal"><span class="pre">ps2pdf</span></tt>)</td>
</tr>
<tr class="field-odd field"><th class="field-name">molauto:</th><td class="field-body">command to call <em>molauto</em> for making views of model
(default: <tt class="docutils literal"><span class="pre">molauto</span></tt>)</td>
</tr>
<tr class="field-even field"><th class="field-name">molscript:</th><td class="field-body">command to call <em>molscript</em> to make views of model
(default: <tt class="docutils literal"><span class="pre">molscript</span></tt>)</td>
</tr>
<tr class="field-odd field"><th class="field-name">convert:</th><td class="field-body">command to convert different image formats
(default: <tt class="docutils literal"><span class="pre">convert</span></tt>)</td>
</tr>
</tbody>
</table>
</div></blockquote>
</div>
</div>
<div class="section" id="example-settings-files">
<h2>Example Settings Files<a class="headerlink" href="#example-settings-files" title="Permalink to this headline">¶</a></h2>
<div class="section" id="minimal-settings-file">
<h3>Minimal Settings File<a class="headerlink" href="#minimal-settings-file" title="Permalink to this headline">¶</a></h3>
<div class="highlight-python"><pre># minimal settings file for powder

pdb model = my_model.pdb
cell dimensions = 200 200 200
res limits = 1000 4.0
wavelength = 1.54178
postscript file = my_powder.ps</pre>
</div>
</div>
<div class="section" id="complete-settings-file">
<h3>Complete Settings File<a class="headerlink" href="#complete-settings-file" title="Permalink to this headline">¶</a></h3>
<div class="highlight-python"><pre># complete settings file for powder

pdb model = my_model.pdb
cell dimensions = 200 200 200
res limits = 1000 4.0
wavelength = 1.54178
postscript file = my_powder.ps

# New B factor (-1 for no reset)
reset b-facs = -1

# 2-Theta Interval Marks
mark interval = 2

# Title of simulation
title = My Model

# Name of file that contains info about model
info = info.txt

# Clean up sca and mtz files
clean up = True

# Units of x axis for plot
plot x units = angstroms

# Name of intermediate ps file for side view
side ps file = side.ps

# Name of intermediate ps file for top view
top ps file = top.ps

# Name of file to store spectrum as yaml
spectrum file = spectrum.yml

# Name of intermediate pdb file
temp pdb file = powder-tmp.pdb

# Output mtz File
mtz file = my_model.mtz

# Output Scalepack File
sca file = my_model.sca

# Command to call sfall
sfall = sfall

# Command to call mtz2various
mtz2various = mtz2various

# Command to call xprepx
xprepx = xprepx

# Command to call ps2pdf
ps2pdf = ps2pdf

# Command to call molauto
molauto = molauto

# Command to call molscript
molscript = molscript

# Command to convert image formats
convert = convert</pre>
</div>
<div class="toctree-wrapper compound">
<ul class="simple">
</ul>
</div>
</div>
</div>
<div class="section" id="indices-and-tables">
<h2>Indices and tables<a class="headerlink" href="#indices-and-tables" title="Permalink to this headline">¶</a></h2>
<ul class="simple">
<li><a class="reference internal" href="genindex.html"><em>Index</em></a></li>
<li><a class="reference internal" href="py-modindex.html"><em>Module Index</em></a></li>
<li><a class="reference internal" href="search.html"><em>Search Page</em></a></li>
</ul>
</div>
</div>


          </div>
        </div>
      </div>
      <div class="sphinxsidebar">
        <div class="sphinxsidebarwrapper">
  <h3><a href="#">Table Of Contents</a></h3>
  <ul>
<li><a class="reference internal" href="#">powder Documentation</a><ul>
<li><a class="reference internal" href="#complete-instructions-for-powder">Complete Instructions for <em>powder</em></a><ul>
<li><a class="reference internal" href="#prerequisits">Prerequisits</a></li>
<li><a class="reference internal" href="#instructions">Instructions</a></li>
</ul>
</li>
<li><a class="reference internal" href="#notes">Notes</a></li>
<li><a class="reference internal" href="#flags">Flags</a></li>
<li><a class="reference internal" href="#settings-file">Settings File</a><ul>
<li><a class="reference internal" href="#mandatory-settings">Mandatory Settings</a></li>
<li><a class="reference internal" href="#optional-settings">Optional Settings</a></li>
</ul>
</li>
<li><a class="reference internal" href="#example-settings-files">Example Settings Files</a><ul>
<li><a class="reference internal" href="#minimal-settings-file">Minimal Settings File</a></li>
<li><a class="reference internal" href="#complete-settings-file">Complete Settings File</a><ul>
</ul>
</li>
</ul>
</li>
<li><a class="reference internal" href="#indices-and-tables">Indices and tables</a></li>
</ul>
</li>
</ul>

  <h3>This Page</h3>
  <ul class="this-page-menu">
    <li><a href="_sources/index.txt"
           rel="nofollow">Show Source</a></li>
  </ul>
<div id="searchbox" style="display: none">
  <h3>Quick search</h3>
    <form class="search" action="search.html" method="get">
      <input type="text" name="q" />
      <input type="submit" value="Go" />
      <input type="hidden" name="check_keywords" value="yes" />
      <input type="hidden" name="area" value="default" />
    </form>
    <p class="searchtip" style="font-size: 90%">
    Enter search terms or a module, class or function name.
    </p>
</div>
<script type="text/javascript">$('#searchbox').show(0);</script>
        </div>
      </div>
      <div class="clearer"></div>
    </div>
    <div class="related">
      <h3>Navigation</h3>
      <ul>
        <li class="right" style="margin-right: 10px">
          <a href="genindex.html" title="General Index"
             >index</a></li>
        <li><a href="#">powder 0.9.1 documentation</a> &raquo;</li> 
      </ul>
    </div>
    <div class="footer">
        &copy; Copyright Copyright (c) 2013, James C. Stroud; All rights reserved..
      Created using <a href="http://sphinx.pocoo.org/">Sphinx</a> 1.2pre.
    </div>
  </body>
</html>