<html tal:replace="structure context/manage_page_header"/>

    <span tal:replace="structure context/manage_tabs"/>

    <br/>

    <form action="" method="post" tal:attributes="action request/URL1">
       <input type="submit" class="form-element" name="manage_verify:method"              value="   Verify Ledgers   "/>
       <input type="submit" class="form-element" name="manage_recalculateBalances:method" value="Recalculate Balances"/>
       <input type="submit" class="form-element" name="manage_recalculateControls:method" value="Recalculate Controls"/>
       <input type="submit" class="form-element" name="manage_repostAll:method"           value="  Repost All Txns   "/>
       <input type="submit" class="form-element" name="manage_fixupCatalogs:method"       value="      Recatalog     "/>
       <input type="submit" class="form-element" name="manage_reset:method"               value="    Reset Ledger    "/>
       <input type="submit" class="form-element" name="manage_resetProperties:method"     value="  Reset Properties  "/>
       <input type="submit" class="form-element" name="manage_resetPeriods:method"        value=" Reset Period Ends  "/>
       <input type="hidden" name="bothways:boolean" value="" 
              tal:attributes="value request/bothways | python: True"/>
    </form>

    <form action="" method="post" tal:attributes="action request/URL1"
          tal:condition="not: exists: request/manage_verify">
       <span class="form-label">From</span>
       <span class="list-item" tal:content="python: context.accrued_to.strftime('%Y-%m-%d')"/>
       <span class="form-label">To</span>
       <input class="form-element" name="effective:date" size="10"
              tal:attributes="value request/effective | python: DateTime().strftime('%Y-%m-%d')"/>
       <input type="submit" class="form-element" name="manage_dailyEnd:method"     value="  Daily Rollover  "/>
    </form>

    <form action="" method="post" tal:attributes="action request/URL1"
          tal:condition="exists: request/manage_verify">
      <tal:block tal:define="exceptions python: context.verifyExceptions(precision=request.get('precision', 0.01), bothways=request.get('bothways',True))">
        <div tal:condition="not: exceptions" class="form-help">Everything is OK</div>
        <table tal:condition="exceptions" border="0" cellpadding="2" cellspacing="0" width="100%">
           <tr class="list-header">
             <td class="list-item"></td>
             <td class="list-item" width="25"></td>           
             <td class="list-item">Exception</td>
             <td class="list-item">Date</td>
             <td class="list-item">Entered By</td>
             <td class="list-item">Ledger</td>
             <td class="list-item">Transaction</td>
             <td class="list-item">Account</td>
             <td class="list-item" align="right">Amount</td>
             <td class="list-item">Note</td>
           </tr>
           <tal:exceptions tal:repeat="e_tuple exceptions">
              <tr tal:define="exc python: e_tuple[0];
                              entry python: e_tuple[1];
                              note python: e_tuple[2];
                              txn entry/blTransaction | nothing"
                  tal:attributes="class python: repeat['e_tuple'].index % 2 and 'row-hilite' or 'row-normal'">
                  <td class="list-item"> 
                      <input type="checkbox" name="ids:list" value="" 
                             tal:attributes="value string:${txn/ledgerId}/${txn/transactionId}"/>
                  </td>
                  <td class="list-item">
                      <img src="" tal:attributes="src entry/icon"/>
                  </td>
	          <td class="list-item">
                     <a href="" tal:attributes="href string:${entry/absolute_url}/manage_propertiesForm"
                                tal:content="exc"/>
                  </td>
	          <td class="list-item" tal:on-error="string:"
                      tal:content="python: entry.effective().strftime('%Y/%m/%d')"/>
	          <td class="list-item" tal:content="entry/Creator"/>
	          <td class="list-item" tal:content="entry/ledgerId"/>
                  <td class="list-item">
                      <a href="" tal:condition="nocall: txn"
                                 tal:attributes="href string:${txn/absolute_url}/manage_workspace"
                                 tal:content="txn/getId"/>
                      &nbsp;
                      <span tal:condition="nocall: txn" tal:replace="txn/status"/>
                  </td>
                  <td class="list-item" tal:define="account entry/blAccount | nothing">
                      <a href="" tal:condition="python: account"
                                 tal:attributes="href string:${account/absolute_url}/manage_workspace"
                                 tal:content="account/prettyTitle"/>
                  </td>
	          <td class="list-item" tal:content="entry/amount" align="right" nowrap/>
                  <td class="list-item" tal:content="note"/>
              </tr>
           </tal:exceptions>
           <tr>
               <td class="list-item" colspan="10">
                   <input type="checkbox" name="force" value="1">
                   <span class="form-label">Force</span>&nbsp;&nbsp;
                   <input type="submit" class="form-element" name="manage_verifyRepost:method" value=" Repost "/>
               </td>
           </tr>
         </table>
      </tal:block>
    </form>

<html tal:replace="structure context/manage_page_footer"/>
