{% extends "root.html" %}
{% load i18n %}
{% load staticfiles %}
{% block title %}{% trans 'Upload a new file' %}{% endblock %}

{% block body %}
    <div id="upload">
        <input id="id_file" name="file" data-url="{% url 'updoc.views.upload_doc' %}" type="file"/>

        <div id="progress">
            <div class="bar" style="width: 0%;"></div>
        </div>
        <div id="upload_form">

        </div>
        <div id="decompress">
            <img src="{% static 'images/ajax-loader.gif' %}" alt="{% trans 'loading…' %}"/>
            {% trans 'Processing archive…' %}
        </div>
        <div id="decompress_error" class="error">
            {% trans 'An error occured during the processing.' %}
        </div>
        <script>
            $(function () {
                $('#id_file').fileupload({
                    dataType: 'html',
                    fail: function (e, data) {
                        $('#decompress_error').css('visibility', 'visible');
                        $('#decompress').css('visibility', 'hidden');
                        $('#progress').find('.bar').css('width', '0%');
                        $('#progress').find('.bar').css('border-width', '0px');
                    },
                    done: function (e, data) {
                        $('#id_file').slideUp();
                        $('#progress').slideUp();
                        $('#decompress').css('visibility', 'hidden');
                        $('#upload_form').append(data.result);
                    },
                    progressall: function (e, data) {
                        $('#decompress_error').css('visibility', 'hidden');
                        var progress = parseInt(data.loaded / data.total * 100, 10);
                        $('#progress').find('.bar').css('width', progress + '%');
                        $('#progress').find('.bar').css('border-width', '1px');
                        if(progress >= 99) {
                         $('#decompress').css('visibility', 'visible');
                        }
                    }
                });
            });
        </script>
    </div>
{% endblock %}
