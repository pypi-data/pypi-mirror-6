var tangelo={};(function(){"use strict";tangelo.version=function(){return"0.4.0"};tangelo.fatalError=function(e,t){if(t===undefined){t=e;throw new Error(t)}throw new Error("["+e+"] "+t)};tangelo.unavailable=function(e){var t=e.plugin,n=e.required,o,i;if(tangelo.isArray(n)){if(n.length===1){n=n[0]}else if(n.length===2){n=n[0]+" and "+n[1]}else{i="";for(o=0;o<n.length-1;o+=1){i+=n[o]+", "}i+="and "+n[n.length-1];n=i}}return function(){tangelo.fatalError("JavaScript include error: "+t+" requires "+n)}};tangelo.identity=function(e){return e};tangelo.isNumber=function(e){return typeof e==="number"};tangelo.isBoolean=function(e){return typeof e==="boolean"};tangelo.isArray=function(e){return Object.prototype.toString.call(e)==="[object Array]"};tangelo.isObject=function(e){return Object.prototype.toString.call(e)==="[object Object]"};tangelo.isString=function(e){return Object.prototype.toString.call(e)==="[object String]"};tangelo.isFunction=function(e){return Object.prototype.toString.call(e)==="[object Function]"};tangelo.absoluteUrl=function(e){var t=window.location.pathname[window.location.pathname.length-1]==="/";if(e.length>0){if(e[0]!=="/"&&e[0]!=="~"){e=window.location.pathname+(t?"":"/")+e}}return e};tangelo.accessor=function(e,t){var n,o,i;Function.prototype.clone=function(){var e=this,t;if(this.__isClone){e=this.__clonedFrom}t=function(){return e.apply(this,arguments)};for(i in this){t[i]=this[i]}t.__isClone=true;t.__clonedFrom=e;return t};if(e===undefined||e==={}){o=function(){tangelo.fatalError("tangelo.accessor()","I am an undefined accessor - you shouldn't be calling me!")};o.undefined=true}else if(tangelo.isFunction(e)){o=e.clone()}else if(!e){o=function(){return t}}else if(e.hasOwnProperty("value")){o=function(){return e.value}}else if(e.hasOwnProperty("index")){o=function(e,t){return t}}else if(e.hasOwnProperty("field")){if(e.field==="."){o=function(e){return e}}else{n=e.field.split(".");o=function(e){var o;for(o=0;o<n.length;o+=1){e=e[n[o]];if(e===undefined){return t}}return e}}}else{tangelo.fatalError("tangelo.accessor()","unknown accessor spec "+e)}o.accessor=true;return o};tangelo.appendFunction=function(e,t){var n=this;if(!e){return t}if(!t){return e}return function(){e.apply(n,arguments);t.apply(n,arguments)}};tangelo.requireCompatibleVersion=function(e){var t,n,o,i,r=function(e){var t;for(t=0;t<e.length;t+=1){if(isNaN(e[t])){return true}}return false};o=e.split(".").map(function(e){return+e});if(o.length===0||o.length>3||r(o)){tangelo.fatalError("tangelo.requireCompatibleVersion()","illegal argument '"+e+"'")}for(t=o.length;t<3;t+=1){o[t]=0}n=tangelo.version().split(".").map(function(e){return+e});if(o[0]===0){i=n[0]===0&&o[1]===n[1]&&o[2]<=n[2]}else{i=o[0]===n[0]&&o[1]<=n[1]&&o[2]<=n[2]}return i}})(window.$);(function(e,t){"use strict";e.allDefined=function(){var e;for(e=0;e<arguments.length;e+=1){if(arguments[e]===undefined){return false}}return true};if(!t){e.defaults=e.unavailable({plugin:"tangelo.defaults",required:"JQuery"})}e.defaults=function(e,n){if(e.length>0){if(e[0]!=="/"&&e[0]!=="~"){e=window.location.pathname+"/"+e}}t.ajax({url:"/service/defaults",data:{path:e},dataType:"json",error:function(e){n(undefined,undefined,e)},success:function(e){if(e.error){n(undefined,undefined,e.error)}else{n(e.result,e.status)}}})};e.uniqueID=function(){var e={"":true},t="abcdefghijklmnopqrstuvwxyzABCDEFGHIJKLMNOPQRSTUVWXYZ";return function(n){var o="",i;n=n||6;while(e.hasOwnProperty(o)){o="";for(i=0;i<n;i+=1){o+=t[Math.floor(Math.random()*52)]}}e[o]=true;return o}}();e.queryArguments=function(){var e={},t,n,o;if(window.location.search.length>1){for(n=0,o=window.location.search.substr(1).split("&");n<o.length;n+=1){t=o[n].split("=");e[decodeURI(t[0])]=t.length>1?decodeURI(t[1]):""}}return e}})(window.tangelo,window.jQuery);(function(e,t){"use strict";if(!(t&&t.widget)){t.fn.widget=e.unavailable({plugin:"tangelo.widget",required:["JQuery","JQuery UI"]});return}t.widget("tangelo.widget",{_setOption:function(t,n){if(this._defaults[t]&&this._defaults[t].accessor){this._super(t,e.accessor(n))}else{this._super(t,n)}},_setOptions:function(e){var n=this;t.each(e,function(e,t){n._setOption(e,t)});this._update()},_update:function(){}});e.widget=function(n,o){var i,r={_defaults:o.options||{},_create:function(){this.options=t.extend({},this._defaults,this.options);if(o._create){o._create.apply(this,arguments)}this._setOptions(this.options)}};for(i in o){if(o.hasOwnProperty(i)){if(i==="_defaults"){e.fatalError('tangelo.widget("'+n+'")',"You cannot use '_defaults' as a field name in your Tangelo widget")}else if(i!=="_create"){r[i]=o[i]}}}t.widget(n,t.tangelo.widget,r)}})(window.tangelo,window.jQuery);window.tangelo.vegaspec={};tangelo.vegaspec.geovis=function(e){var t={width:800,height:800,data:[{name:"countries",url:null,format:{type:"topojson",feature:"countries"}},{name:"links",transform:[{type:"copy",from:"data",fields:["source","target"]}]},{name:"filter"},{name:"table",transform:[{type:"force",links:"links",iterations:0},{type:"geo",lat:"data.latitude",lon:"data.longitude",projection:"azimuthalEqualArea",clipAngle:179.99,scale:200,translate:[400,400],precision:.1}]}],scales:[{name:"color",type:"ordinal",range:"category10"},{name:"size",type:"linear",range:[100,400],zero:false,domain:{data:"table",field:"data.size"}}],legends:[{fill:"color",orient:"left",properties:{labels:{fontSize:{value:18}},symbols:{size:{value:100},stroke:{value:"#fff"}}}}],marks:[{type:"path",from:{data:"countries",transform:[{type:"geopath",value:"data",projection:"azimuthalEqualArea",clipAngle:179.99,scale:200,translate:[400,400],precision:.1}]},properties:{enter:{stroke:{value:"#fff"},path:{field:"path"}},update:{fill:{value:"#ccc"}}}},{type:"path",from:{data:"links",transform:[{type:"link",shape:"curve"}]},properties:{update:{path:{field:"path"},stroke:{value:"black"},strokeOpacity:{value:1},strokeWidth:{value:1}}}},{type:"symbol",from:{data:"table"},properties:{enter:{x:{field:"x"},y:{field:"y"}},update:{stroke:{value:"#fff"},fill:{scale:"color",field:"data.color"},size:{scale:"size",field:"data.size"}}}}]};t.data[0].url=e;return t};window.tangelo.vtkweb={};(function(e,t,n){"use strict";e.vtkweb.processes=function(n){t.ajax({url:"/vtkweb",dataType:"json",error:function(e){n(undefined,e)},success:function(t){if(t.error){e.fatalError("tangelo.vtkweb.processes()",t.error)}n(t)}})};e.vtkweb.info=function(e,n){t.ajax({url:"/vtkweb/"+e,dataType:"json",error:function(e){n(undefined,e)},success:function(e){n(e)}})};(function(){var o={};e.vtkweb.launch=function(i){var r,s=e.absoluteUrl(i.url),a=i.callback,l=i.argstring,c=i.timeout,u=i.viewport;if(c!==undefined){console.warn("[tangelo.vtkweb.launch] warning: timeout argument has no effect")}if(s===undefined){e.fatalError("tangelo.vtkweb.launch()","argument 'url' required")}if(u===undefined){e.fatalError("tangelo.vtkweb.launch()","argument 'viewport' required")}r={program:s};if(l){r.args=l}t.ajax({url:"/vtkweb",type:"POST",data:r,dataType:"json",error:function(e){a(undefined,e)},success:function(i){var r,s;if(i.status==="failed"||i.status==="incomplete"){a(undefined,i.reason)}else if(i.status==="complete"){r={sessionURL:i.url};n.connect(r,function(e){s=n.createViewport({session:e.session});s.bind(u);t(window).resize(function(){if(s){s.render()}});s.render();o[i.key]={element:t(u).get(0),viewport:s}},function(t,n){e.fatalError("could not connect to VTKWeb server [code "+t+"]: "+n)});a(i.key)}else{e.fatalError("tangelo.vtkweb.launch()","unexpected report status '"+i.status+"'")}}})};e.vtkweb.terminate=function(e,n){t.ajax({url:"/vtkweb/"+e,type:"DELETE",dataType:"json",error:function(e){if(n){n(undefined,undefined,e)}},success:function(i){var r;if(!i.reason){o[e].viewport.unbind();r=o[e].element;delete o[e]}if(n){n(e,r,i.reason)}else if(r){t(r).empty()}}})}})()})(window.tangelo,window.jQuery,window.vtkWeb);(function(e,t,n){"use strict";if(!(t&&n)){e.unavailable({plugin:"controlPanel",required:["JQuery","d3"]});return}function o(o,i){var r,s,a,l,c;r=n.select(o);s=n.select(i);a="uncollapsed";c="20px";function u(){l=t(r.node()).height()+"px"}window.setTimeout(u,1e3);return function(){if(a==="uncollapsed"){r.transition().duration(500).style("height",c);s.classed("glyphicon-chevron-down",false).classed("glyphicon-chevron-up",true);a="collapsed"}else if(a==="collapsed"){r.transition().duration(500).style("height",l);s.classed("glyphicon-chevron-down",true).classed("glyphicon-chevron-up",false);a="uncollapsed"}else{e.fatalError("drawerToggle()","illegal state: "+a)}}}t.fn.controlPanel=function(){var t,i,r,s;i=n.select(this[0]);if(i.empty()){return}s=e.uniqueID();r=i.attr("id");if(!r){r="tangelo-control-panel-"+s;i.attr("id",r)}i.style("position","fixed").style("bottom","0px").style("width","100%").insert("div",":first-child").attr("id","tangelo-drawer-handle-"+s).style("text-align","center").style("cursor","pointer").on("mouseenter",function(){n.select(this).style("background","gray")}).on("mouseleave",function(){n.select(this).style("background",null)}).append("span").attr("id","tangelo-drawer-icon-"+s).classed("glyphicon",true).classed("glyphicon-chevron-down",true);t=o("#"+r,"#tangelo-drawer-icon-"+s);n.select("#tangelo-drawer-handle-"+s).on("click",t)}})(window.tangelo,window.jQuery,window.d3);(function(e,t,n,o){"use strict";if(!(t&&n&&o)){e.GoogleMapSVG=e.unavailable({plugin:"GoogleMapSVG",required:["JQuery","Google Maps API","d3"]});return}e.GoogleMapSVG=function(i,r,s,a){var l,c,u;this.id="gmsvg-"+e.uniqueID();this.mapdiv=o.select(i).append("div").attr("id",this.id).style("width",t(i).width()+"px").style("height",t(i).height()+"px").node();this.map=new n.maps.Map(this.mapdiv,r);this.setMap(this.map);this.size={width:t(this.mapdiv).width(),height:t(this.mapdiv).height()};l=this;t(this.mapdiv).resize(function(){n.maps.event.trigger(this.map,"resize")});this.cfg=s||{};if(a){n.maps.event.addListenerOnce(this.map,"idle",function(){a(l)})}};e.GoogleMapSVG.prototype=new n.maps.OverlayView;e.GoogleMapSVG.prototype.getSVG=function(){return this.svg.node()};e.GoogleMapSVG.prototype.getMap=function(){return this.map};e.GoogleMapSVG.prototype.computeCBArgs=function(){var e;e=o.select("#"+this.id+" [style*='webkit-transform: matrix']").style("-webkit-transform").split(" ").map(function(e,t){var n;if(t===0){n=e.slice("matrix(".length,-1)}else{n=e.slice(0,-1)}return n});return{svg:this.svg.node(),projection:this.getProjection(),zoom:this.map.getZoom(),translation:{x:e[4],y:e[5]},transform:e,zooming:e[0]!=="1"||e[3]!=="1"}};e.GoogleMapSVG.prototype.attachListener=function(o,i,r){var s=this,a;if(Object.prototype.toString.call(o)==="[object Array]"){t.each(o,function(e,t){s.attachListener(t,i,r)});return}if(r==="once"){a=n.maps.event.addListenerOnce}else if(r==="always"){a=n.maps.event.addListener}else{e.fatalError("GoogleMapSVG.attachListener()","illegal value for argument 'how'")}a(this.map,o,function(){var e=s.computeCBArgs();if(o==="draw"){if(e.zooming){window.setTimeout(n.maps.event.trigger,100,s.map,"draw")}}i.call(s,e)})};e.GoogleMapSVG.prototype.on=function(e,t){this.attachListener(e,t,"always")};e.GoogleMapSVG.prototype.onceOn=function(e,t){this.attachListener(e,t,"once")};e.GoogleMapSVG.prototype.trigger=function(e){n.maps.event.trigger(this.map,e)};e.GoogleMapSVG.prototype.shift=function(e,t,n){o.select(e).style("-webkit-transform","translate("+t+"px, "+n+"px)")};e.GoogleMapSVG.prototype.onAdd=function(){this.svg=o.select(this.getPanes().overlayMouseTarget).append("svg").attr("width",this.size.width).attr("height",this.size.height);if(this.cfg.initialize){this.cfg.initialize.call(this,this.svg.node(),this.getProjection(),this.map.getZoom())}};e.GoogleMapSVG.prototype.draw=function(){}})(window.tangelo,window.jQuery,window.google,window.d3);(function(e,t,n){"use strict";if(!(t&&n)){t.fn.svgColorLegend=e.unavailable({plugin:"svgColorLegend",required:["JQuery","d3"]});return}t.fn.svgColorLegend=function(e){var o,i,r,s,a,l,c,u,d,f,p,h,g,y,v,w,m,x,b,k,_,S,z,j;w=e.cmap_func;m=e.xoffset;x=e.yoffset;b=e.categories;k=e.height_padding;_=e.width_padding;S=e.text_spacing;z=e.legend_margins;j=e.clear;v=n.select(this[0]);j=j||false;if(j){v.selectAll("*").remove()}u=0;c=0;i=v.append("rect").style("fill","white").style("opacity",.7);t.each(b,function(e,t){v.append("rect").classed("colorbox",true).attr("x",m).style("fill",w(t));f=v.append("text").classed("legendtext",true).text(t);o=f[0][0].getBBox();if(o.width>u){u=o.width}if(o.height>c){c=o.height}});s=c+k;y=s;h=s*b.length;g=y+_+u;l=z.left||0;p=z.top||0;d=z.right||0;r=z.bottom||0;i.attr("x",m-l||0).attr("y",x-p||0).attr("width",l+g+d).attr("height",p+h+r);a=function(e,t){return x+t*s};v.selectAll(".colorbox").attr("width",s).attr("height",s).attr("y",a);v.selectAll(".legendtext").attr("x",m+y+_).attr("y",function(e,t){return S+a(e,t)})}})(window.tangelo,window.jQuery,window.d3);(function(e,t,n){"use strict";if(!(t&&t.widget&&n)){t.fn.dendrogram=e.unavailable({plugin:"dendrogram",required:["JQuery","JQuery UI","d3"]});return}e.widget("tangelo.dendrogram",{options:{label:e.accessor({value:""}),distance:e.accessor({value:1}),id:e.accessor({value:0}),margin:{top:20,right:120,bottom:20,left:120},nodeLimit:null,duration:750,root:null,source:null,data:null,mode:"hide",nodesize:7.5,textsize:10,orientation:"horizontal",lineStyle:"curved",nodeColor:e.accessor({value:"lightsteelblue"}),nodeOpacity:e.accessor({value:1}),hoverNodeColor:e.accessor({value:"green"}),hoverNodeOpacity:e.accessor({value:1}),selectedNodeColor:e.accessor({value:"firebrick"}),selectedNodeOpacity:e.accessor({value:1}),collapsedNodeColor:e.accessor({value:"blue"}),collapsedNodeOpacity:e.accessor({value:1}),onNodeCreate:null,onNodeDestroy:null},_actions:{collapse:null},action:function(e){return this._actions[e]},orientation:{abscissa:"y",ordinate:"x",heightvar:"height",widthvar:"width",xfunc:function(e,t){return t}},_lineStyle:function(e,t){return this.line({source:e,target:t})},_create:function(){var t=this;this._actions.collapse=function(e){if(t.options.mode==="hide"){if(e.children){e._children=e.children;e.children=null;e.collapsed=true;n.select(this).select("circle").style("fill",t.options.collapsedNodeColor).style("opacity",t.options.collapsedNodeOpacity).classed("children-hidden",true)}else{e.children=e._children;e._children=null;e.collapsed=false;n.select(this).select("circle").style("fill",t.options.nodeColor).style("opacity",t.options.nodeOpacity).classed("children-hidden",false)}}else if(t.options.mode==="focus"){t.options.root=e}else if(t.options.mode==="label"){e.showLabel=e.showLabel?false:true}t._setOptions({source:e})};if(this.options.orientation==="vertical"){this.orientation={abscissa:"x",ordinate:"y",heightvar:"width",widthvar:"height",xfunc:function(e,t){var n=(e.xminmax[0]+e.xminmax[1])/2;return 2*n-t}}}else if(this.options.orientation!=="horizontal"){e.fatalError("$.dendrogram()","illegal option for 'orientation': "+this.options.orientation)}this.tree=n.layout.partition().value(function(){return 1}).sort(n.ascending);this.line=null;if(this.options.lineStyle==="curved"){this.line=n.svg.diagonal().projection(function(e){return[t.orientation.xfunc(t,e[t.orientation.abscissa]),e[t.orientation.ordinate]]})}else if(this.options.lineStyle==="axisAligned"){this.line=n.svg.line().interpolate("step-before").x(function(e){return t.orientation.xfunc(t,e[t.orientation.abscissa])}).y(function(e){return e[t.orientation.ordinate]});this._lineStyle=function(e,n){return t.line([e,n])}}else{e.fatalError("$.dendrogram()","illegal option for 'lineStyle': "+this.options.lineStyle)}this.svg=n.select(this.element.get(0)).append("svg").append("g")},_update:function(){this.width=1200-this.options.margin.right-this.options.margin.left;this.height=800-this.options.margin.top-this.options.margin.bottom;if(!this.options.root){this.options.root=this.options.data}if(!this.options.mode){this.options.mode="hide"}this.tree.size([this.height,this.width]);n.select(this.element.get(0)).select("svg").attr("width",this[this.orientation.widthvar]+this.options.margin.right+this.options.margin.left).attr("height",this[this.orientation.heightvar]+this.options.margin.top+this.options.margin.bottom).select("g").attr("transform","translate("+this.options.margin.left+","+this.options.margin.top+")");this.options.root.x0=this[this.orientation.heightvar]/2;this.options.root.y0=0;var e=this.tree.nodes(this.options.root).reverse(),t=this.tree.links(e),o=this.options.source||this.options.root,i,r,s,a,l,c,u,d,f,p,h=this;u=0;function g(e,t){var n=0;e.y=t;e.x=e.x+e.dx/2;if(!e.parent){e.parent=e}if(e.children){e.children.forEach(function(o){o.parent=e;g(o,t+10*h.options.distance(o));n+=o.x});e.x=n/e.children.length}else{u+=1}}g(this.options.root,0);function y(e){var t,n,o;t=e;while(t.children&&t.children[0]){t=t.children[0]}n=e;while(n.children&&n.children[1]){n=n.children[1]}return[t.x,n.x]}this.xminmax=y(this.options.root);c=n.extent(e,function(e){return e.y})[1];e.forEach(function(e){e.y=e.y/c*(h.width-150)});if(this.options.nodeLimit&&e.length>this.options.nodeLimit){e.sort(function(e,t){return n.ascending(e.parent.y,t.parent.y)});e.forEach(function(e,t){e.index=t});d=e.slice(0,this.options.nodeLimit);c=d[d.length-1].parent.y;d.forEach(function(e){e.y=e.y>c?c:e.y});f=[];t.forEach(function(e){if(e.source.index<this.options.nodeLimit&&e.target.index<this.options.nodeLimit){f.push(e)}});e=d;t=f}function v(e){if(e.children){return v(e.children[0])}if(e._children){return v(e._children[0])}return e}function w(e){if(e.children){return w(e.children[e.children.length-1])}if(e._children){return w(e._children[e._children.length-1])}return e}function m(e){var t=e.children,n=0;if(!t){t=e._children}if(t){t.forEach(function(e){n+=m(e)});return n}return 1}i=this.svg.selectAll("g.node").data(e,function(e){return h.options.id(e)});r=i.enter().append("g").classed("node",true).attr("transform",function(){return"translate("+h.orientation.xfunc(h,o[h.orientation.abscissa+"0"])+","+o[h.orientation.ordinate+"0"]+")"});r.append("circle").attr("r",1e-6).classed("node",true).style("fill",this.options.nodeColor).style("opacity",this.options.nodeOpacity).style("stroke","black").style("stroke-width","1px").on("mouseenter.tangelo",function(){n.select(this).style("fill",h.options.hoverNodeColor).style("opacity",h.options.hoverNodeOpacity)}).on("mouseleave.tangelo",function(e){n.select(this).style("fill",e.collapsed?h.options.collapsedNodeColor:h.options.nodeColor).style("opacity",e.collapsed?h.options.collapsedNodeOpacity:h.options.nodeOpacity)});r.append("text").attr("x",10).attr("dy",".35em").attr("text-anchor","start").style("font-size",this.options.textsize+"px").text(this.options.label).style("fill-opacity",1e-6);s=i.transition().duration(this.options.duration).attr("transform",function(e){return"translate("+h.orientation.xfunc(h,e[h.orientation.abscissa])+","+e[h.orientation.ordinate]+")"});s.select("circle").attr("r",this.options.nodesize);s.select("text").text(function(e){var t=h.options.label(e);if(u<h.height/(.8*h.options.textsize)){return t}return""}).style("fill-opacity",1);a=i.exit().transition().duration(this.options.duration).attr("transform",function(){return"translate("+h.orientation.xfunc(h,o[h.orientation.abscissa])+","+o[h.orientation.ordinate]+")"}).remove();a.select("circle").attr("r",1e-6);a.select("text").style("fill-opacity",1e-6);l=this.svg.selectAll("path.link").data(t,function(e){return h.options.id(e.target)});l.enter().insert("path","g").classed("link",true).style("stroke","black").style("stroke-width","1px").style("fill","none").attr("d",function(){var e={x:o.x0,y:o.y0};return h._lineStyle(e,e)});l.transition().duration(this.options.duration).attr("d",function(e){return h._lineStyle(e.source,e.target)});l.exit().transition().duration(this.options.duration).attr("d",function(){var e={x:o.x,y:o.y};return h._lineStyle(e,e)}).remove();e.forEach(function(e){e.x0=e.x;e.y0=e.y});if(this.options.onNodeDestroy){a.each(this.options.onNodeDestroy)}if(this.options.onNodeCreate){r.each(this.options.onNodeCreate)}for(p in this._eventHandlers){if(this._eventHandlers.hasOwnProperty(p)){this.on(p,this._eventHandlers[p])}}},on:function(e,t){var n=this;n.svg.selectAll("g.node").selectAll("circle").on(e,t?function(e,o){t.call(n,e,o,this)}:null);if(t!==null){this._eventHandlers[e]=t}else{delete this._eventHandlers[e]}},_eventHandlers:{},download:function(e){var t,o,i,r;if(e==="pdf"){t=this.svg.selectAll("g.node").select("circle").attr("r",function(e){return e._children?this.options.nodesize:0});o=new window.XMLSerializer;i=n.select("svg").node();r=o.serializeToString(i);t.attr("r",this.options.nodesize);n.json("/service/svg2pdf").send("POST",r,function(e,t){window.location="/service/svg2pdf?id="+t.result})}else{window.alert("Unsupported export format type: "+e)}},reset:function(){function e(t){if(!t.children){t.children=t._children;t._children=null}if(t.children){t.children.forEach(e)}}e(this.options.data);this._setOptions({root:this.options.data})}})})(window.tangelo,window.jQuery,window.d3);(function(e,t,n){"use strict";if(!(t&&t.widget&&n)){t.fn.geodots=e.unavailable({plugin:"geodots",required:["JQuery","JQuery UI","Vega"]});return}e.widget("tangelo.geodots",{options:{latitude:e.accessor({value:0}),longitude:e.accessor({value:0}),size:e.accessor({value:20}),color:e.accessor({value:0}),worldGeometry:null,data:null},_create:function(){var o=this,i=e.vegaspec.geovis(o.options.worldGeometry);this.options=t.extend(true,{},this._defaults,this.options);n.parse.spec(i,function(e){o.vis=e;o._update()})},_update:function(){var e=this;if(this.options.data){this.options.data.forEach(function(t){t.latitude=e.options.latitude(t);t.longitude=e.options.longitude(t);t.size=e.options.size(t);t.color=e.options.color(t)});if(this.vis){this.vis({el:e.element.get(0),data:{table:e.options.data,links:[]}}).update()}}}})})(window.tangelo,window.jQuery,window.vg);(function(e,t,n){"use strict";if(!(t&&t.widget&&n)){t.fn.geonodelink=e.unavailable({plugin:"geonodelink",required:["JQuery","JQuery UI","Vega"]});return}e.widget("tangelo.geonodelink",{options:{nodeLatitude:e.accessor({value:0}),nodeLongitude:e.accessor({value:0}),nodeSize:e.accessor({value:20}),nodeColor:e.accessor({value:0}),linkColor:e.accessor({value:0}),linkSource:e.accessor({value:0}),linkTarget:e.accessor({value:0}),data:null},_create:function(){var t=this,o=e.vegaspec.geovis(t.options.worldGeometry);n.parse.spec(o,function(e){t.vis=e;t._update()})},_update:function(){var e=this;t.each(this.options.data.nodes,function(t,n){var o=e.options.data.nodes[t];o.latitude=e.options.nodeLatitude(o);o.longitude=e.options.nodeLongitude(o);o.size=e.options.nodeSize(o);o.color=e.options.nodeColor(o)});t.each(this.options.data.links,function(t,n){var o=e.options.data.links[t];o.color=e.options.linkColor(o);o.source=e.options.linkSource(o);o.target=e.options.linkTarget(o)});if(e.vis){e.vis({el:this.element.get(0),data:{table:e.options.data.nodes,links:e.options.data.links}}).update()}}})})(window.tangelo,window.jQuery,window.vg);(function(e,t,n,o){"use strict";if(!(t&&o&&o.widget&&n)){o.fn.mapdots=e.unavailable({plugin:"mapdots",required:["Google Maps API","JQuery","JQuery UI","d3"]});return}e.widget("tangelo.mapdots",{options:{hoverContent:e.accessor({value:""}),size:e.accessor({value:1}),color:e.accessor({value:""}),latitude:e.accessor({value:0}),longitude:e.accessor({value:0}),opacity:e.accessor({value:1}),data:null},_create:function(){var e=this.element.get(0),i=this,r,s;this.map=new t.maps.Map(e,{zoom:2,center:new t.maps.LatLng(0,0),mapTypeId:t.maps.MapTypeId.TERRAIN});n.select(e).style("width","100%").style("height","100%");o(e).resize(function(){t.maps.event.trigger(i.map,"resize")});this.overlay=new t.maps.OverlayView;this.overlay.onAdd=function(){var e;i.layer=n.select(this.getPanes().overlayMouseTarget).append("div").style("position","absolute");i.colorScale=n.scale.category10();this.draw=function(){var e,t=i.transform(this.getProjection());e=i.layer.selectAll("svg").data(i.options.data).each(t);e.enter().append("svg").each(t).attr("class","marker").style("cursor","crosshair").style("position","absolute").append("circle");n.selectAll("svg > circle").data(i.options.data).attr("r",function(e){return i.sizeScale(i.options.size(e))}).attr("cx",function(e){return i.sizeScale(i.options.size(e))+2}).attr("cy",function(e){return i.sizeScale(i.options.size(e))+2}).style("fill",function(e){return i.colorScale(i.options.color(e))}).style("opacity",function(e){return i.options.opacity(e)}).each(function(e){var t,n=i.options.hoverContent(e);if(!n){return}t={html:true,container:"body",placement:"top",trigger:"hover",content:i.options.hoverContent(e),delay:{show:0,hide:0}};o(this).popover(t)});e.exit().remove()};this.onRemove=function(){}};this.overlay.setMap(this.map)},_update:function(){var e=this;this.sizeScale=n.scale.sqrt().domain(n.extent(this.options.data,this.options.size)).range([5,15]);this.transform=function(o){return function(i){var r=e.sizeScale(e.options.size(i));i=new t.maps.LatLng(e.options.latitude(i),e.options.longitude(i));i=o.fromLatLngToDivPixel(i);return n.select(this).style("left",i.x-r-2+"px").style("top",i.y-r-2+"px").style("width",2*r+4+"px").style("height",2*r+4+"px")}};if(this.overlay.draw){this.overlay.draw()}}})})(window.tangelo,window.google,window.d3,window.jQuery);(function(e,t,n){"use strict";if(!(t&&t.widget&&n)){t.fn.nodelink=e.unavailable({plugin:"nodelink",required:["JQuery","JQuery UI","d3"]});return}e.widget("tangelo.nodelink",{options:{nodeCharge:e.accessor({value:-130}),nodeColor:e.accessor({value:"steelblue"}),nodeSize:e.accessor({value:10}),nodeLabel:e.accessor({value:""}),nodeOpacity:e.accessor({value:1}),nodeId:e.accessor({index:true}),linkSource:e.accessor({field:"source"}),linkTarget:e.accessor({field:"target"}),linkDistance:e.accessor({value:30}),linkOpacity:e.accessor({value:.2}),nodeX:e.accessor(),nodeY:e.accessor(),width:1e3,height:1e3,dynamicLabels:false,data:null},_create:function(){this.colorScale=n.scale.category10();this.force=n.layout.force();this.svg=n.select(this.element.get(0)).append("svg")},_update:function(){var e=this,t={};if(this.options.nodeX&&!this.options.nodeX.undefined){this.xScale=n.scale.linear().domain(n.extent(this.options.data.nodes,this.options.nodeX)).range([50,this.options.width-100])}if(this.options.nodeY&&!this.options.nodeY.undefined){this.yScale=n.scale.linear().domain(n.extent(this.options.data.nodes,this.options.nodeY)).range([this.options.height-100,50])}this.force.linkDistance(this.options.linkDistance).charge(this.options.nodeCharge).size([this.options.width,this.options.height]);this.options.data.nodes.forEach(function(n,o){t[e.options.nodeId(n,o)]=n;n.degree=0;n.outgoing=[];n.incoming=[]});this.options.data.links.forEach(function(n,o){n.source=t[e.options.linkSource(n,o)];n.target=t[e.options.linkTarget(n,o)];n.source.degree+=1;n.target.degree+=1;n.source.outgoing.push(n.target);n.target.incoming.push(n.source)});this.options.data.nodes.sort(function(e,t){return n.descending(e.degree,t.degree)});this.sizeScale=n.scale.sqrt().domain(n.extent(this.options.data.nodes,e.options.nodeSize)).range([5,15]);this.force.size([this.options.width,this.options.height]).nodes(this.options.data.nodes).links(this.options.data.links).start();this.link=this.svg.selectAll(".link").data(this.options.data.links);this.link.enter().append("line").classed("link",true).style("opacity",this.options.linkOpacity).style("stroke","black").style("stroke-width",1);this.node=this.svg.selectAll(".node").data(this.options.data.nodes);this.node.enter().append("circle").classed("node",true).call(this.force.drag).append("title");this.node.attr("r",function(t,n){return e.sizeScale(e.options.nodeSize(t,n))}).style("fill",function(t,n){return e.colorScale(e.options.nodeColor(t,n))}).style("opacity",this.options.nodeOpacity);this.node.selectAll("title").text(this.options.nodeLabel);if(!e.options.dynamicLabels){this.label=this.svg.selectAll("text").data(this.options.data.nodes);this.label.enter().append("text").text(this.options.nodeLabel)}this.force.on("tick",function(){e._tick.call(e)});this.force.resume()},_tick:function(){var e=this,t;if(this.options.nodeX&&!e.options.nodeX.undefined){e.options.data.nodes.forEach(function(t,n){t.x=e.xScale(e.options.nodeX(t,n))})}if(this.options.nodeY&&!e.options.nodeY.undefined){e.options.data.nodes.forEach(function(t,n){t.y=e.yScale(e.options.nodeY(t,n))})}if(e.options.dynamicLabels){t=e._nodeLabels();e.svg.selectAll("text").remove();e.svg.selectAll("text").data(t).enter().append("text").attr("x",function(e){return e.x}).attr("y",function(e){return e.y}).style("font-size",function(e){return e.count+8}).text(function(e){return e.label})}else{e.label.attr("x",function(e){return e.x}).attr("y",function(e){return e.y})}e.link.attr("x1",function(e){return e.source.x}).attr("y1",function(e){return e.source.y}).attr("x2",function(e){return e.target.x}).attr("y2",function(e){return e.target.y});e.node.attr("cx",function(e){return e.x}).attr("cy",function(e){return e.y})},_nodeLabels:function(){var e=this,t=[];e.options.data.nodes.forEach(function(e){e.visited=false});e.options.data.nodes.forEach(function(n,o){var i=0,r=[],s;function a(t){if(t.visited){return}if(Math.abs(t.x-n.x)<50&&Math.abs(t.y-n.y)<50){i+=1;r.push(e.options.nodeLabel(t,o));t.visited=true;t.incoming.forEach(a);t.outgoing.forEach(a)}}a(n);if(i>1){s=e._reduceLabels(r);t.push({count:i,label:s,x:n.x,y:n.y})}});return t},_reduceLabels:function(e){var t="",n={},o,i,r;e.forEach(function(e){var t,o=n;t=e.split(" ");while(t.length>0){if(!o[t[0]]){o[t[0]]={count:0,next:{}}}o[t[0]].count+=1;o=o[t[0]].next;t=t.slice(1)}});while(true){i=0;r=0;for(o in n){if(n.hasOwnProperty(o)){if(n[o].count>i){i=n[o].count;r=o}}}if(i<2){break}t+=" "+r;n=n[r].next}return t}})})(window.tangelo,window.jQuery,window.d3);window.tangelo.stream={};(function(e,t){"use strict";e.stream.streams=function(e){t.ajax({url:"/stream",dataType:"json",error:function(t){e(undefined,t)},success:function(t){e(t)}})};e.stream.start=function(n,o){n=e.absoluteUrl(n);t.ajax({url:n,dataType:"json",error:function(e){o(undefined,e)},success:function(e){o(e.stream_key)}})};e.stream.query=function(e,n){t.ajax({url:"/stream/"+e,dataType:"json",error:function(e){n(undefined,e)},success:function(e){if(e.error){console.warn("[tangelo.stream.query()] error: "+e.error);return}n(e)}})};e.stream.run=function(n,o,i){if(i===undefined){i=100}t.ajax({url:"/stream/"+n,dataType:"json",error:function(e){console.warn("[tangelo.stream.run()] error: ajax call failed; aborting stream run");o(undefined,e)},success:function(t){var r,s=true;if(t.error){console.warn("[tangelo.stream.run()] error: "+t.error+"; aborting stream run");return}r=o(t);if(r!==undefined){if(e.isFunction(r)){o=r}else if(e.isBoolean(r)){s=r}else if(e.isNumber(r)){i=r}}if(s){window.setTimeout(e.stream.run,i,n,o,i)}}})};e.stream.delete=function(e,n){t.ajax({url:"/stream/"+e,dataType:"json",type:"DELETE",error:function(e){if(n){n(undefined,e)}},success:function(e){if(n){n(e)}}})}})(window.tangelo,window.$);window.tangelo.data={};(function(e){"use strict";e.data.tree=function(t){var n=e.accessor(t.id,""),o=e.accessor(t.idChild,""),i=e.accessor(t.children),r=t.data,s={},a;r.forEach(function(e){s[n(e)]=e});r.forEach(function(e){if(i(e)){e.children=[];i(e).forEach(function(t){var n=s[o(t)];n.hasParent=true;e.children.push(n)})}});r.forEach(function(e){if(!e.hasParent){a=e}delete e.hasParent});return a}})(window.tangelo);