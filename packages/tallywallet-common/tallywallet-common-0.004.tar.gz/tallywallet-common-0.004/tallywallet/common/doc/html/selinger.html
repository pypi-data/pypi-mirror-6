

<!DOCTYPE html>
<!--[if IE 8]><html class="no-js lt-ie9" lang="en" > <![endif]-->
<!--[if gt IE 8]><!--> <html class="no-js" lang="en" > <!--<![endif]-->
<head>
  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  
  <title>Example &mdash; Tallywallet manual v0.004</title>
  

  
  

  
  <link href='https://fonts.googleapis.com/css?family=Lato:400,700|Roboto+Slab:400,700|Inconsolata:400,700' rel='stylesheet' type='text/css'>

  
  

    <script type="text/javascript">
      var DOCUMENTATION_OPTIONS = {
        URL_ROOT:'./',
        VERSION:'0.004',
        COLLAPSE_INDEX:false,
        FILE_SUFFIX:'.html',
        HAS_SOURCE:  true
      };
    </script>
      <script type="text/javascript" src="_static/jquery.js"></script>
      <script type="text/javascript" src="_static/underscore.js"></script>
      <script type="text/javascript" src="_static/doctools.js"></script>

    

  

  
  
    <link rel="stylesheet" href="_static/css/theme.css" type="text/css" />
    <script type="text/javascript" src="_static/js/theme.js"></script>
  

  
    <link rel="top" title="Tallywallet manual v0.004" href="index.html"/>
        <link rel="prev" title="Programming API" href="api.html"/> 

  <script src="//cdnjs.cloudflare.com/ajax/libs/modernizr/2.6.2/modernizr.min.js"></script>

</head>

<body class="wy-body-for-nav">

  <div class="wy-grid-for-nav">

    
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-nav-search">
        <a href="index.html" class="icon icon-home"> Tallywallet</a>
        <form class="wy-form" action="search.html" method="get">
  <input type="text" name="q" placeholder="Search docs" />
  <input type="hidden" name="check_keywords" value="yes" />
  <input type="hidden" name="area" value="default" />
</form>
      </div>

      <div class="wy-menu wy-menu-vertical" data-spy="affix">
        
        
            <ul class="current">
<li class="toctree-l1"><a class="reference internal" href="api.html">Programming API</a><ul>
<li class="toctree-l2"><a class="reference internal" href="api.html#module-tallywallet.common.currency">Currency</a></li>
<li class="toctree-l2"><a class="reference internal" href="api.html#trade">Trade</a></li>
<li class="toctree-l2"><a class="reference internal" href="api.html#module-tallywallet.common.exchange">Exchange</a></li>
<li class="toctree-l2"><a class="reference internal" href="api.html#module-tallywallet.common.ledger">Ledger</a></li>
<li class="toctree-l2"><a class="reference internal" href="api.html#module-tallywallet.common.output">Output</a></li>
</ul>
</li>
<li class="toctree-l1 current"><a class="current reference internal" href="">Example</a><ul>
<li class="toctree-l2"><a class="reference internal" href="#jan-1">Jan 1</a></li>
<li class="toctree-l2"><a class="reference internal" href="#jan-2">Jan 2</a></li>
<li class="toctree-l2"><a class="reference internal" href="#jan-3">Jan 3</a></li>
<li class="toctree-l2"><a class="reference internal" href="#jan-5">Jan 5</a></li>
<li class="toctree-l2"><a class="reference internal" href="#jan-7">Jan 7</a></li>
</ul>
</li>
</ul>

        
      </div>
      &nbsp;
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap">

      
      <nav class="wy-nav-top">
        <i data-toggle="wy-nav-top" class="icon icon-reorder"></i>
        <a href="/">Tallywallet</a>
      </nav>


      
      <div class="wy-nav-content">
        <div class="rst-content">
          <ul class="wy-breadcrumbs">
  <li><a href="index.html">Docs</a> &raquo;</li>
  <li><a href="">Example</a></li>
  
</ul>
<hr/>

          
  <div class="section" id="example">
<h1>Example<a class="headerlink" href="#example" title="Permalink to this headline">¶</a></h1>
<p>This example is taken from <a class="reference external" href="http://www.mscs.dal.ca/~selinger/accounting/">Peter Selinger&#8217;s tutorial</a> on multiple currency
accounting. We&#8217;ll use a Ledger to track the transactions set out below,
which comprise both actual expenses and incurred gains/losses due to variations
in currency rates.</p>
<p>The scenario is a brief trip from Canada to the USA, which requires buying US
dollars, spending some during exchange rate fluctuations, and changing back
to Canadian money at the end.</p>
<table border="1" class="docutils">
<colgroup>
<col width="8%" />
<col width="24%" />
<col width="11%" />
<col width="11%" />
<col width="11%" />
<col width="11%" />
<col width="24%" />
</colgroup>
<thead valign="bottom">
<tr class="row-odd"><th class="head">date</th>
<th class="head">&nbsp;</th>
<th class="head">asset</th>
<th class="head">asset</th>
<th class="head">capital</th>
<th class="head">expense</th>
<th class="head">trading</th>
</tr>
</thead>
<tbody valign="top">
<tr class="row-even"><td>Jan 1</td>
<td>Opening balance</td>
<td>CAD 200</td>
<td>USD 0</td>
<td>CAD 200</td>
<td>CAD 0</td>
<td>USD 0 CAD 0</td>
</tr>
<tr class="row-odd"><td>Jan 2</td>
<td>1 USD==1.20CAD</td>
<td>CAD-120</td>
<td>USD 100</td>
<td>.</td>
<td>.</td>
<td>USD 100 CAD 120</td>
</tr>
<tr class="row-even"><td>.</td>
<td>Balance</td>
<td>CAD 80</td>
<td>USD 100</td>
<td>CAD 200</td>
<td>CAD 0</td>
<td>USD 100 CAD 120</td>
</tr>
<tr class="row-odd"><td>Jan 3</td>
<td>1 USD==1.30CAD</td>
<td>.</td>
<td>USD-40</td>
<td>.</td>
<td>CAD 52</td>
<td>USD-40 CAD 52</td>
</tr>
<tr class="row-even"><td>.</td>
<td>Balance</td>
<td>CAD 80</td>
<td>USD 60</td>
<td>CAD 200</td>
<td>CAD 52</td>
<td>USD 60 CAD-68</td>
</tr>
<tr class="row-odd"><td>Jan 5</td>
<td>1 USD==1.25CAD</td>
<td>CAD 75</td>
<td>USD-60</td>
<td>.</td>
<td>.</td>
<td>USD-60 CAD 75</td>
</tr>
<tr class="row-even"><td>.</td>
<td>Balance</td>
<td>CAD 155</td>
<td>USD 0</td>
<td>CAD 200</td>
<td>CAD 52</td>
<td>USD 0  CAD 07</td>
</tr>
<tr class="row-odd"><td>Jan 7</td>
<td>Buy food</td>
<td>CAD-20</td>
<td>.</td>
<td>.</td>
<td>CAD 20</td>
<td>.</td>
</tr>
<tr class="row-even"><td>.</td>
<td>Balance</td>
<td>CAD 135</td>
<td>USD 0</td>
<td>CAD 200</td>
<td>CAD 72</td>
<td>USD 0  CAD 07</td>
</tr>
</tbody>
</table>
<p>Throughout, we&#8217;ll assume this boilerplate:</p>
<div class="highlight-python"><div class="highlight"><pre><span class="kn">import</span> <span class="nn">datetime</span>
<span class="kn">from</span> <span class="nn">decimal</span> <span class="kn">import</span> <span class="n">Decimal</span> <span class="k">as</span> <span class="n">Dl</span>
<span class="kn">from</span> <span class="nn">tallywallet.common.currency</span> <span class="kn">import</span> <span class="n">Currency</span> <span class="k">as</span> <span class="n">Cy</span>
<span class="kn">from</span> <span class="nn">tallywallet.common.ledger</span> <span class="kn">import</span> <span class="n">Ledger</span>
<span class="kn">from</span> <span class="nn">tallywallet.common.ledger</span> <span class="kn">import</span> <span class="n">Role</span>
</pre></div>
</div>
<div class="section" id="jan-1">
<h2>Jan 1<a class="headerlink" href="#jan-1" title="Permalink to this headline">¶</a></h2>
<p>First, we&#8217;ll establish a ledger with the necessary columns. We needn&#8217;t
define a currency trading account; that will be created for us:</p>
<div class="highlight-python"><div class="highlight"><pre><span class="n">ldgr</span> <span class="o">=</span> <span class="n">Ledger</span><span class="p">(</span>
    <span class="n">Column</span><span class="p">(</span><span class="s">&quot;Canadian cash&quot;</span><span class="p">,</span> <span class="n">Cy</span><span class="o">.</span><span class="n">CAD</span><span class="p">,</span> <span class="n">Role</span><span class="o">.</span><span class="n">asset</span><span class="p">),</span>
    <span class="n">Column</span><span class="p">(</span><span class="s">&quot;US cash&quot;</span><span class="p">,</span> <span class="n">Cy</span><span class="o">.</span><span class="n">USD</span><span class="p">,</span> <span class="n">Role</span><span class="o">.</span><span class="n">asset</span><span class="p">),</span>
    <span class="n">Column</span><span class="p">(</span><span class="s">&quot;Capital&quot;</span><span class="p">,</span> <span class="n">Cy</span><span class="o">.</span><span class="n">CAD</span><span class="p">,</span> <span class="n">Role</span><span class="o">.</span><span class="n">capital</span><span class="p">),</span>
    <span class="n">Column</span><span class="p">(</span><span class="s">&quot;Expense&quot;</span><span class="p">,</span> <span class="n">Cy</span><span class="o">.</span><span class="n">CAD</span><span class="p">,</span> <span class="n">Role</span><span class="o">.</span><span class="n">expense</span><span class="p">),</span>
    <span class="n">ref</span><span class="o">=</span><span class="n">Cy</span><span class="o">.</span><span class="n">CAD</span><span class="p">)</span>
</pre></div>
</div>
<p>At this point, there&#8217;s no balance, and no rates defined for the currencies.
<tt class="docutils literal"><span class="pre">ldgr.equation.status</span></tt> will evaluate to <tt class="docutils literal"><span class="pre">Status.failed</span></tt>.</p>
<p>The scenario begins with an opening balance of CAD 200. In double entry
book-keeping, this becomes an asset on the left hand side, and capital on the
right. We can define the opening balance like this:</p>
<div class="highlight-python"><div class="highlight"><pre><span class="k">for</span> <span class="n">amount</span><span class="p">,</span> <span class="n">col</span> <span class="ow">in</span> <span class="nb">zip</span><span class="p">(</span>
    <span class="p">(</span><span class="n">Dl</span><span class="p">(</span><span class="mi">200</span><span class="p">),</span> <span class="n">Dl</span><span class="p">(</span><span class="mi">0</span><span class="p">),</span> <span class="n">Dl</span><span class="p">(</span><span class="mi">200</span><span class="p">),</span> <span class="n">Dl</span><span class="p">(</span><span class="mi">0</span><span class="p">)),</span> <span class="n">ldgr</span><span class="o">.</span><span class="n">columns</span><span class="o">.</span><span class="n">values</span><span class="p">()</span>
<span class="p">):</span>
    <span class="n">ldgr</span><span class="o">.</span><span class="n">commit</span><span class="p">(</span>
        <span class="n">amount</span><span class="p">,</span> <span class="n">col</span><span class="p">,</span>
        <span class="n">ts</span><span class="o">=</span><span class="n">datetime</span><span class="o">.</span><span class="n">date</span><span class="p">(</span><span class="mi">2013</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">),</span> <span class="n">note</span><span class="o">=</span><span class="s">&quot;Opening balance&quot;</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="section" id="jan-2">
<h2>Jan 2<a class="headerlink" href="#jan-2" title="Permalink to this headline">¶</a></h2>
<p>Let&#8217;s apply the initial currency exchange rate. We do that by instantiating an
Exchange object, and creating a sequence of trades to apply to our ledger:</p>
<div class="highlight-python"><div class="highlight"><pre><span class="n">exchange</span> <span class="o">=</span> <span class="n">Exchange</span><span class="p">({(</span><span class="n">Cy</span><span class="o">.</span><span class="n">USD</span><span class="p">,</span> <span class="n">Cy</span><span class="o">.</span><span class="n">CAD</span><span class="p">):</span> <span class="n">Dl</span><span class="p">(</span><span class="s">&quot;1.2&quot;</span><span class="p">)})</span>
<span class="k">for</span> <span class="n">args</span> <span class="ow">in</span> <span class="n">ldgr</span><span class="o">.</span><span class="n">adjustments</span><span class="p">(</span><span class="n">exchange</span><span class="p">):</span>
    <span class="n">ldgr</span><span class="o">.</span><span class="n">commit</span><span class="p">(</span>
        <span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="n">ts</span><span class="o">=</span><span class="n">datetime</span><span class="o">.</span><span class="n">date</span><span class="p">(</span><span class="mi">2013</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">),</span>
        <span class="n">note</span><span class="o">=</span><span class="s">&quot;1 USD = 1.20 CAD&quot;</span><span class="p">)</span>
</pre></div>
</div>
<p>The next step is to buy CAD 120 worth of US dollars. How many USD will that
give us?:</p>
<div class="highlight-python"><div class="highlight"><pre><span class="n">usd</span> <span class="o">=</span> <span class="n">exchange</span><span class="o">.</span><span class="n">convert</span><span class="p">(</span><span class="mi">120</span><span class="p">,</span> <span class="n">TradePath</span><span class="p">(</span><span class="n">Cy</span><span class="o">.</span><span class="n">CAD</span><span class="p">,</span> <span class="n">Cy</span><span class="o">.</span><span class="n">CAD</span><span class="p">,</span> <span class="n">Cy</span><span class="o">.</span><span class="n">USD</span><span class="p">))</span>
</pre></div>
</div>
<p>So we add that to our US cash account:</p>
<div class="highlight-python"><div class="highlight"><pre><span class="n">ldgr</span><span class="o">.</span><span class="n">commit</span><span class="p">(</span><span class="n">usd</span><span class="p">,</span> <span class="n">ldgr</span><span class="o">.</span><span class="n">columns</span><span class="p">[</span><span class="s">&quot;US cash&quot;</span><span class="p">])</span>
</pre></div>
</div>
<p>If we should check <tt class="docutils literal"><span class="pre">ldgr.equation.status</span></tt> we&#8217;d get <tt class="docutils literal"><span class="pre">Status.failed</span></tt>.
Our book is unbalanced. We must remember to deduct from our Canadian cash:</p>
<div class="highlight-python"><div class="highlight"><pre><span class="n">ldgr</span><span class="o">.</span><span class="n">commit</span><span class="p">(</span><span class="o">-</span><span class="mi">120</span><span class="p">,</span> <span class="n">ldgr</span><span class="o">.</span><span class="n">columns</span><span class="p">[</span><span class="s">&quot;Canadian cash&quot;</span><span class="p">])</span>
</pre></div>
</div>
<p>And now, <tt class="docutils literal"><span class="pre">ldgr.equation.status</span></tt> will evaluate to <tt class="docutils literal"><span class="pre">Status.ok</span></tt>.</p>
</div>
<div class="section" id="jan-3">
<h2>Jan 3<a class="headerlink" href="#jan-3" title="Permalink to this headline">¶</a></h2>
<p>Our book holds both American and Canadian dollars, so it&#8217;s exposed to
fluctuations in the exchange rate. On 3rd January, you can get $1.30 Canadian
for one American greenback. Let&#8217;s apply that to our ledger:</p>
<div class="highlight-python"><div class="highlight"><pre><span class="n">exchange</span> <span class="o">=</span> <span class="n">Exchange</span><span class="p">({(</span><span class="n">Cy</span><span class="o">.</span><span class="n">USD</span><span class="p">,</span> <span class="n">Cy</span><span class="o">.</span><span class="n">CAD</span><span class="p">):</span> <span class="n">Dl</span><span class="p">(</span><span class="s">&quot;1.3&quot;</span><span class="p">)})</span>
<span class="k">for</span> <span class="n">args</span> <span class="ow">in</span> <span class="n">ldgr</span><span class="o">.</span><span class="n">adjustments</span><span class="p">(</span><span class="n">exchange</span><span class="p">):</span>
    <span class="n">ldgr</span><span class="o">.</span><span class="n">commit</span><span class="p">(</span>
        <span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="n">ts</span><span class="o">=</span><span class="n">datetime</span><span class="o">.</span><span class="n">date</span><span class="p">(</span><span class="mi">2013</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">3</span><span class="p">),</span>
        <span class="n">note</span><span class="o">=</span><span class="s">&quot;1 USD = 1.30 CAD&quot;</span><span class="p">)</span>
</pre></div>
</div>
<p>At this point in the story, we spend forty US dollars. On the left hand side of
the ledger, it&#8217;s clear that this needs to come from our US assets. But on the
right hand side, our expense account is in Canadian dollars. So we need to make
a calculation to determine how much to deduct from there:</p>
<div class="highlight-python"><div class="highlight"><pre><span class="n">cad</span> <span class="o">=</span> <span class="n">exchange</span><span class="o">.</span><span class="n">convert</span><span class="p">(</span><span class="mi">40</span><span class="p">,</span> <span class="n">TradePath</span><span class="p">(</span><span class="n">Cy</span><span class="o">.</span><span class="n">USD</span><span class="p">,</span> <span class="n">Cy</span><span class="o">.</span><span class="n">CAD</span><span class="p">,</span> <span class="n">Cy</span><span class="o">.</span><span class="n">CAD</span><span class="p">))</span>
</pre></div>
</div>
<p>And so:</p>
<div class="highlight-python"><div class="highlight"><pre><span class="n">ldgr</span><span class="o">.</span><span class="n">commit</span><span class="p">(</span><span class="o">-</span><span class="mi">40</span><span class="p">,</span> <span class="n">ldgr</span><span class="o">.</span><span class="n">columns</span><span class="p">[</span><span class="s">&quot;US cash&quot;</span><span class="p">])</span>
<span class="n">ldgr</span><span class="o">.</span><span class="n">commit</span><span class="p">(</span><span class="n">cad</span><span class="p">,</span> <span class="n">ldgr</span><span class="o">.</span><span class="n">columns</span><span class="p">[</span><span class="s">&quot;Expense&quot;</span><span class="p">])</span>
</pre></div>
</div>
</div>
<div class="section" id="jan-5">
<h2>Jan 5<a class="headerlink" href="#jan-5" title="Permalink to this headline">¶</a></h2>
<p>The exchange rate shifts a bit today in favour of the Canadian dollar. We don&#8217;t
make any purchases, but we do convert all our US dollars back to Canadian. So
there should be no change to the right hand side of our ledger, only movement
of our assets on the left.</p>
<p>First we apply the new rate:</p>
<div class="highlight-python"><div class="highlight"><pre><span class="n">exchange</span> <span class="o">=</span> <span class="n">Exchange</span><span class="p">({(</span><span class="n">Cy</span><span class="o">.</span><span class="n">USD</span><span class="p">,</span> <span class="n">Cy</span><span class="o">.</span><span class="n">CAD</span><span class="p">):</span> <span class="n">Dl</span><span class="p">(</span><span class="s">&quot;1.25&quot;</span><span class="p">)})</span>
<span class="k">for</span> <span class="n">args</span> <span class="ow">in</span> <span class="n">ldgr</span><span class="o">.</span><span class="n">adjustments</span><span class="p">(</span><span class="n">exchange</span><span class="p">):</span>
    <span class="n">ldgr</span><span class="o">.</span><span class="n">commit</span><span class="p">(</span>
        <span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="n">ts</span><span class="o">=</span><span class="n">datetime</span><span class="o">.</span><span class="n">date</span><span class="p">(</span><span class="mi">2013</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">5</span><span class="p">),</span>
        <span class="n">note</span><span class="o">=</span><span class="s">&quot;1 USD = 1.25 CAD&quot;</span><span class="p">)</span>
</pre></div>
</div>
<p>... then work out how much our US dollars are worth:</p>
<div class="highlight-python"><div class="highlight"><pre><span class="n">usd</span> <span class="o">=</span> <span class="n">ldgr</span><span class="o">.</span><span class="n">value</span><span class="p">(</span><span class="s">&quot;US cash&quot;</span><span class="p">)</span>
<span class="n">cad</span> <span class="o">=</span> <span class="n">exchange</span><span class="o">.</span><span class="n">convert</span><span class="p">(</span><span class="n">usd</span><span class="p">,</span> <span class="n">TradePath</span><span class="p">(</span><span class="n">Cy</span><span class="o">.</span><span class="n">USD</span><span class="p">,</span> <span class="n">Cy</span><span class="o">.</span><span class="n">CAD</span><span class="p">,</span> <span class="n">Cy</span><span class="o">.</span><span class="n">CAD</span><span class="p">))</span>
</pre></div>
</div>
<p>... and finish by committing that to our book:</p>
<div class="highlight-python"><div class="highlight"><pre><span class="n">ldgr</span><span class="o">.</span><span class="n">commit</span><span class="p">(</span><span class="o">-</span><span class="n">usd</span><span class="p">,</span> <span class="n">ldgr</span><span class="o">.</span><span class="n">columns</span><span class="p">[</span><span class="s">&quot;US cash&quot;</span><span class="p">])</span>
<span class="n">ldgr</span><span class="o">.</span><span class="n">commit</span><span class="p">(</span><span class="n">cad</span><span class="p">,</span> <span class="n">ldgr</span><span class="o">.</span><span class="n">columns</span><span class="p">[</span><span class="s">&quot;Canadian cash&quot;</span><span class="p">])</span>
</pre></div>
</div>
</div>
<div class="section" id="jan-7">
<h2>Jan 7<a class="headerlink" href="#jan-7" title="Permalink to this headline">¶</a></h2>
<p>We are now back in Canada but stuck in the airport waiting for our transfer
home. We want food. So we cough up twenty dollars for a nasty burger and a
bottle of fizzy beer. Here&#8217;s the transaction for that:</p>
<div class="highlight-python"><div class="highlight"><pre><span class="n">ldgr</span><span class="o">.</span><span class="n">commit</span><span class="p">(</span><span class="o">-</span><span class="mi">20</span><span class="p">,</span> <span class="n">cols</span><span class="p">[</span><span class="s">&quot;Canadian cash&quot;</span><span class="p">],</span> <span class="n">note</span><span class="o">=</span><span class="s">&quot;Buy food&quot;</span><span class="p">)</span>
<span class="n">ldgr</span><span class="o">.</span><span class="n">commit</span><span class="p">(</span><span class="mi">20</span><span class="p">,</span> <span class="n">cols</span><span class="p">[</span><span class="s">&quot;Expense&quot;</span><span class="p">],</span> <span class="n">note</span><span class="o">=</span><span class="s">&quot;Buy food&quot;</span><span class="p">)</span>
</pre></div>
</div>
<p>How much money do we have left? <tt class="docutils literal"><span class="pre">ldgr.value(&quot;Canadian</span> <span class="pre">cash&quot;)</span></tt> says $135.00.
Looking at the other columns it seems we spent CAD 72.00 during our trip. We
accidentally made CAD 7.00 due to the fluctuations in the exchange rate while
we were away.</p>
</div>
</div>


          <footer>
  
    <div class="rst-footer-buttons">
      
      
        <a href="api.html" class="btn btn-neutral" title="Programming API"><span class="icon icon-circle-arrow-left"></span> Previous</a>
      
    </div>
  

  <hr/>

  <p>
      &copy; Copyright 2013, D Haynes.
  </p>

  <a href="https://www.github.com/snide/sphinx_rtd_theme">Sphinx theme</a> provided by <a href="http://readthedocs.org">Read the Docs</a>
</footer>
        </div>
      </div>

    </section>

  </div>
  

</body>
</html>