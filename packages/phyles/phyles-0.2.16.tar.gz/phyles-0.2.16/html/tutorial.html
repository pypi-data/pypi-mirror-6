

<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN"
  "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">


<html xmlns="http://www.w3.org/1999/xhtml">
  <head>
    <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
    
    <title>2. Tutorial &mdash; phyles 0.2.16 documentation</title>
    
    <link rel="stylesheet" href="_static/default.css" type="text/css" />
    <link rel="stylesheet" href="_static/pygments.css" type="text/css" />
    
    <script type="text/javascript">
      var DOCUMENTATION_OPTIONS = {
        URL_ROOT:    '',
        VERSION:     '0.2.16',
        COLLAPSE_INDEX: false,
        FILE_SUFFIX: '.html',
        HAS_SOURCE:  true
      };
    </script>
    <script type="text/javascript" src="_static/jquery.js"></script>
    <script type="text/javascript" src="_static/underscore.js"></script>
    <script type="text/javascript" src="_static/doctools.js"></script>
    <link rel="top" title="phyles 0.2.16 documentation" href="index.html" />
    <link rel="next" title="3. Phyles API" href="phyles-api.html" />
    <link rel="prev" title="1. Introduction to Phyles" href="intro.html" /> 
  </head>
  <body>
    <div class="related">
      <h3>Navigation</h3>
      <ul>
        <li class="right" style="margin-right: 10px">
          <a href="genindex.html" title="General Index"
             accesskey="I">index</a></li>
        <li class="right" >
          <a href="py-modindex.html" title="Python Module Index"
             >modules</a> |</li>
        <li class="right" >
          <a href="phyles-api.html" title="3. Phyles API"
             accesskey="N">next</a> |</li>
        <li class="right" >
          <a href="intro.html" title="1. Introduction to Phyles"
             accesskey="P">previous</a> |</li>
        <li><a href="index.html">phyles 0.2.16 documentation</a> &raquo;</li> 
      </ul>
    </div>  

    <div class="document">
      <div class="documentwrapper">
        <div class="bodywrapper">
          <div class="body">
            
  <div class="section" id="tutorial">
<h1>2. Tutorial<a class="headerlink" href="#tutorial" title="Permalink to this headline">¶</a></h1>
<p>For the sake of a tutorial, lets assume that we need to calculate
cooking times for our barbecue. For this daunting task, we decide
we want a utility: a program that we can run from the command line
whenever we get the urge for a taste of smokey goodness.</p>
<div class="section" id="the-calculation">
<h2>2.1. The Calculation<a class="headerlink" href="#the-calculation" title="Permalink to this headline">¶</a></h2>
<div class="admonition note">
<p class="first admonition-title">Note</p>
<p class="last">This section isn&#8217;t as much about using phyles as it is
about framing the purpose of the example utility
quantitatively (<em>i.e.</em> into numbers) and in a way that
can be formulated as a python function. Hopefully
the example is not too complicated. However, I have
tried to make it just complicated enough to warrant
a full-fledged utility.</p>
</div>
<p>Let&#8217;s assume that we have three dishes we usually barbecue:</p>
<blockquote>
<div><table border="1" class="docutils">
<colgroup>
<col width="60%" />
<col width="40%" />
</colgroup>
<thead valign="bottom">
<tr class="row-odd"><th class="head">Dish</th>
<th class="head">Difficulty</th>
</tr>
</thead>
<tbody valign="top">
<tr class="row-even"><td>vegetable kabobs</td>
<td>1 dc</td>
</tr>
<tr class="row-odd"><td>smoked salmon</td>
<td>2 dc</td>
</tr>
<tr class="row-even"><td>brisket</td>
<td>3 dc</td>
</tr>
</tbody>
</table>
</div></blockquote>
<p>The numbers to the right of each dish gives the
<strong>difficulty</strong> of cooking (which we&#8217;ll abbreviate as &#8220;dc&#8221;
to express its units).</p>
<p>As an example of difficulty, cooking a typical batch of vegetable
kabobs for 1 hour at some some temperature (say 200 °F) is
equivalent to cooking a typical brisket for 3 hours at that
temperature. Or stated another way, brisket cooks about three
times as slow as vegetable kabobs.</p>
<p>For the sake of this tutorial, cooking difficulty applies to
temperature as well.  For instance, cooking a typical batch of
vegetable kabobs at 200 °F for 2 hours is equivalent to cooking a
typical brisket at 600 °F for 2 hours:</p>
<div class="math">
<p><img src="_images/math/213cc44f2354247a15d1aa5b0545b798f48160c8.png" alt="\frac{200 \,^{\circ}\mathrm{F} \times 2 \,\mathrm{hr}}
     {1 \,\mathrm{dc}} =
\frac{600 \,^{\circ}\mathrm{F} \times 2 \,\mathrm{hr}}
     {3 \,\mathrm{dc}}"/></p>
</div><p>Note how we divided both sides of the equation by
the difficulty of cooking for the respective dish
(1 dc for vegetable kabobs; 3 dc for brisket).
This calculation shows that we can quantify how
much we cook something by calculating what we&#8217;ll call
the &#8220;doneness&#8221;. Taking this example for brisket:</p>
<div class="math">
<p><img src="_images/math/5423068b59cb0d35252c5504906bac2e650aa964.png" alt="400 \,\text{doneness} =
\frac{600 \,^{\circ}\mathrm{F} \times 2 \,\mathrm{hr}}
     {3 \,\mathrm{dc}}"/></p>
</div><p>Or, as a mathematical formula:</p>
<div class="math">
<p><img src="_images/math/9102baec19532baea5ebf4c6a374a03b013b74d0.png" alt="\text{doneness} =
\displaystyle
     \frac
        {\text{temperature} \times \text{time}}
        {\text{difficulty}}"/></p>
</div><p>Using algebra <a class="footnote-reference" href="#alg" id="id1">[1]</a>, we can rearrange this equation to calculate
cooking times:</p>
<div class="math">
<p><img src="_images/math/49c0f61e8e09bf51d0f3b59ca429feb72f22d9ee.png" alt="\text{time} =
\displaystyle
     \frac
        {\text{doneness} \times
         \text{difficulty}}
        {\text{temperature}}"/></p>
</div><p>In other words, if we know the amount we need to cook
a dish (doneness), how difficult the dish
is to cook (difficulty), and the temperature that
we can achieve with our grill, then we can calculate
the cooking time.</p>
<p>So, how much do we want to cook an dish? This table
quantifies doneness for several common
cooking terms:</p>
<blockquote>
<div><table border="1" class="docutils">
<colgroup>
<col width="52%" />
<col width="48%" />
</colgroup>
<thead valign="bottom">
<tr class="row-odd"><th class="head">Term</th>
<th class="head">Doneness</th>
</tr>
</thead>
<tbody valign="top">
<tr class="row-even"><td>Rare</td>
<td>200</td>
</tr>
<tr class="row-odd"><td>Medium</td>
<td>350</td>
</tr>
<tr class="row-even"><td>Well-Done</td>
<td>500</td>
</tr>
</tbody>
</table>
</div></blockquote>
<p>Let&#8217;s try a calculation for smoked salmon (difficulty of 2) cooked
medium (doneness of 350) at 225 °F (which is about 107 °C):</p>
<div class="math">
<p><img src="_images/math/2fdf98e64c82a62b9ccb344b191078d0d28d2c48.png" alt="\text{time} =
\displaystyle
     \frac
        {350 \,\text{doneness} \times
         2 \,\mathrm{dc}}
        {225 \,^{\circ}\mathrm{F}} \approx 3.11 \,\mathrm{hr}"/></p>
</div><p>Thus it takes about 3.11 hr to cook a smoked salmon
to medium at 225 °F.</p>
<p>As a python function, this calculation might take the form:</p>
<div class="highlight-python"><div class="highlight"><pre><span class="k">def</span> <span class="nf">cooking_time</span><span class="p">(</span><span class="n">doneness</span><span class="p">,</span> <span class="n">difficulty</span><span class="p">,</span> <span class="n">temperature</span><span class="p">):</span>
  <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">  Return then cooking time given the desired `doneness`</span>
<span class="sd">  cooking, the `difficulty` of cooking,</span>
<span class="sd">  and the `temperature`.</span>

<span class="sd">   Args:</span>
<span class="sd">     - `doneness`: desired doneness (hr•°F/dc)</span>
<span class="sd">     - `difficulty`: difficulty of cooking for the dish (dc)</span>
<span class="sd">     - `temperature`: cooking temperature (°F)</span>

<span class="sd">   Returns: cooking time in hours (``float``)</span>

<span class="sd">   Raises: ``ValueError`` if the `temperature` is &lt;= 120 °F</span>

<span class="sd">   &gt;&gt;&gt; round(cooking_time(350, 2, 225), 2)</span>
<span class="sd">   3.11</span>
<span class="sd">   &quot;&quot;&quot;</span>
   <span class="k">if</span> <span class="n">T</span> <span class="o">&lt;=</span> <span class="mi">120</span><span class="p">:</span>
     <span class="n">msg</span> <span class="o">=</span> <span class="s">&quot;</span><span class="si">%s</span><span class="s"> °F is too cold to cook!&quot;</span> <span class="o">%</span> <span class="n">T</span>
     <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="n">msg</span><span class="p">)</span>
   <span class="k">return</span> <span class="nb">float</span><span class="p">(</span><span class="n">doneness</span> <span class="o">*</span> <span class="n">difficulty</span><span class="p">)</span> <span class="o">/</span> <span class="n">T</span>
</pre></div>
</div>
</div>
<div class="section" id="the-config-format">
<h2>2.2. The Config Format<a class="headerlink" href="#the-config-format" title="Permalink to this headline">¶</a></h2>
<p>Assuming that we have a utility that calulates cooking times based
on a config file, the file for this example might take the
following form:</p>
<div class="highlight-yaml"><div class="highlight"><pre><span class="l-Scalar-Plain">dish</span> <span class="p-Indicator">:</span> <span class="l-Scalar-Plain">smoked salmon</span>
<span class="l-Scalar-Plain">doneness</span> <span class="p-Indicator">:</span> <span class="l-Scalar-Plain">medium</span>
<span class="l-Scalar-Plain">temperature</span> <span class="p-Indicator">:</span> <span class="l-Scalar-Plain">225</span>
</pre></div>
</div>
<p>This config format is convenient for a user who doesn&#8217;t care that
smoked salmon has a difficulty of 1 dc or that medium corresponds
to a doneness of 350. However, it places a burden on the programmer
to read the file, ensure that &#8220;smoked salmon&#8221; and &#8220;medium&#8221; are
spelled correctly, and convert these string values into numbers.</p>
<p>That&#8217;s where phyles comes in!</p>
</div>
<div class="section" id="conversion">
<h2>2.3. Conversion<a class="headerlink" href="#conversion" title="Permalink to this headline">¶</a></h2>
<div class="section" id="dictionary-based-conversion">
<h3>2.3.1. Dictionary-Based Conversion<a class="headerlink" href="#dictionary-based-conversion" title="Permalink to this headline">¶</a></h3>
<p>We&#8217;ll tackle these tasks in steps, first finding a way to
convert specific strings into numbers. Python provides a convenient
way to do this conversion using its <a class="reference external" href="http://docs.python.org/2/library/stdtypes.html#dict" title="(in Python v2.7)"><tt class="xref py py-class docutils literal"><span class="pre">dict</span></tt></a> class:</p>
<div class="highlight-python"><div class="highlight"><pre><span class="n">doneness_dict</span> <span class="o">=</span> <span class="p">{</span><span class="s">&#39;rare&#39;</span><span class="p">:</span> <span class="mi">200</span><span class="p">,</span>
                 <span class="s">&#39;medium&#39;</span><span class="p">:</span> <span class="mi">350</span><span class="p">,</span>
                 <span class="s">&#39;well-done&#39;</span><span class="p">:</span> <span class="mi">500</span><span class="p">}</span>
</pre></div>
</div>
<p>Getting a value from a dictionary using a key is called
&#8220;item-getting&#8221;. Python item-getting raises a <tt class="xref py py-class docutils literal"><span class="pre">KeyError</span></tt>
when it fails:</p>
<div class="highlight-python"><div class="highlight"><pre><span class="gp">&gt;&gt;&gt; </span><span class="n">doneness_dict</span><span class="p">[</span><span class="s">&#39;raw&#39;</span><span class="p">]</span>
<span class="gt">Traceback (most recent call last):</span>
  File <span class="nb">&quot;&lt;stdin&gt;&quot;</span>, line <span class="m">1</span>, in <span class="n">&lt;module&gt;</span>
<span class="gr">KeyError</span>: <span class="n">&#39;raw&#39;</span>
</pre></div>
</div>
<p>As we&#8217;ll see, phyles allows for the creation of a converter
dictionary directly in <a class="reference internal" href="#the-schema-specification">the schema specification</a>.</p>
</div>
<div class="section" id="type-based-conversion">
<h3>2.3.2. Type-Based Conversion<a class="headerlink" href="#type-based-conversion" title="Permalink to this headline">¶</a></h3>
<p>When a YAML config file is parsed by a YAML parser, literals
like <tt class="docutils literal"><span class="pre">225</span></tt> evaluate to integers. However, a cooking
temperature may often be more useful as a <tt class="xref py py-class docutils literal"><span class="pre">float</span></tt>, as when it serves in the denominator of a fraction,
for example. In cases where a YAML literal evaluates to a python
type (<em>e.g.</em> <tt class="xref py py-class docutils literal"><span class="pre">int</span></tt>, <tt class="xref py py-class docutils literal"><span class="pre">float</span></tt>, <tt class="xref py py-class docutils literal"><span class="pre">str</span></tt>) that is
different from the type desired, the desired python type can be
used to to perform the conversion:</p>
<div class="highlight-python"><div class="highlight"><pre><span class="gp">&gt;&gt;&gt; </span><span class="nb">float</span><span class="p">(</span><span class="mi">225</span><span class="p">)</span>
<span class="go">225.0</span>
</pre></div>
</div>
<p>Like the <a class="reference external" href="http://docs.python.org/2/library/stdtypes.html#dict" title="(in Python v2.7)"><tt class="xref py py-class docutils literal"><span class="pre">dict</span></tt></a> item-getting, python types provide
error checking, raising exceptions upon failure:</p>
<div class="highlight-python"><div class="highlight"><pre><span class="gp">&gt;&gt;&gt; </span><span class="nb">float</span><span class="p">([</span><span class="mi">2</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">5</span><span class="p">])</span>
<span class="gt">Traceback (most recent call last):</span>
  File <span class="nb">&quot;&lt;stdin&gt;&quot;</span>, line <span class="m">1</span>, in <span class="n">?</span>
<span class="gr">TypeError</span>: <span class="n">float() argument must be a string or a number</span>
</pre></div>
</div>
<div class="highlight-python"><div class="highlight"><pre><span class="gp">&gt;&gt;&gt; </span><span class="nb">float</span><span class="p">(</span><span class="s">&quot;twotwentyfive&quot;</span><span class="p">)</span>
<span class="gt">Traceback (most recent call last):</span>
  File <span class="nb">&quot;&lt;stdin&gt;&quot;</span>, line <span class="m">1</span>, in <span class="n">?</span>
<span class="gr">ValueError</span>: <span class="n">could not convert string to float: twotwentyfive</span>
</pre></div>
</div>
</div>
<div class="section" id="conversion-by-user-defined-functions">
<h3>2.3.3. Conversion by User-Defined Functions<a class="headerlink" href="#conversion-by-user-defined-functions" title="Permalink to this headline">¶</a></h3>
<p>There is nothing particularly special about
<tt class="xref py py-func docutils literal"><span class="pre">dict.__getitem__()</span></tt> or python types.
They are simply functions (or more preciesly, &#8220;callables&#8221;)
that take a single value as a parameter
and return possibly different values. In cases where they fail,
<tt class="xref py py-func docutils literal"><span class="pre">dict.__getitem__()</span></tt> and python types raise three
kinds of exceptions:</p>
<blockquote>
<div><table border="1" class="docutils">
<colgroup>
<col width="43%" />
<col width="57%" />
</colgroup>
<thead valign="bottom">
<tr class="row-odd"><th class="head">Exception</th>
<th class="head">Raised By</th>
</tr>
</thead>
<tbody valign="top">
<tr class="row-even"><td><tt class="xref py py-class docutils literal"><span class="pre">KeyError</span></tt></td>
<td><a class="reference external" href="http://docs.python.org/2/library/stdtypes.html#dict" title="(in Python v2.7)"><tt class="xref py py-class docutils literal"><span class="pre">dict</span></tt></a> item-getting</td>
</tr>
<tr class="row-odd"><td><tt class="xref py py-class docutils literal"><span class="pre">TypeError</span></tt></td>
<td>python types</td>
</tr>
<tr class="row-even"><td><tt class="xref py py-class docutils literal"><span class="pre">ValueError</span></tt></td>
<td>python types</td>
</tr>
</tbody>
</table>
</div></blockquote>
<p>Thus, any python function that takes one and only one parameter
and raises either a <tt class="xref py py-class docutils literal"><span class="pre">KeyError</span></tt>, <tt class="xref py py-class docutils literal"><span class="pre">TypeError</span></tt>,
or <tt class="xref py py-class docutils literal"><span class="pre">ValueError</span></tt> upon failure, can serve as a converter.</p>
<p>For example, say we want to release a European version of
our barbecue utility, we could write a function to convert
temperature in °C into temperature in °F:</p>
<div class="highlight-python"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre> 1
 2
 3
 4
 5
 6
 7
 8
 9
10
11
12
13
14
15
16
17
18</pre></div></td><td class="code"><div class="highlight"><pre> <span class="k">def</span> <span class="nf">celsius_to_farenheit</span><span class="p">(</span><span class="n">c</span><span class="p">):</span>
   <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">   Returns the temperature in Farenheit given temperature</span>
<span class="sd">   in Celsius.</span>

<span class="sd">   Args:</span>
<span class="sd">     - c: temperature in Celsius</span>

<span class="sd">   Returns: temperature in Farenheit (float)</span>

<span class="sd">   &gt;&gt;&gt; celsius_to_farenheit(107.222)</span>
<span class="sd">   224.9996</span>
<span class="sd">   &quot;&quot;&quot;</span>
   <span class="n">c</span> <span class="o">=</span> <span class="nb">float</span><span class="p">(</span><span class="n">c</span><span class="p">)</span>
   <span class="k">if</span> <span class="n">c</span> <span class="o">&lt;</span> <span class="o">-</span><span class="mf">273.15</span><span class="p">:</span>
     <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s">&quot;Impossibly cold (</span><span class="si">%s</span><span class="s"> °C)!&quot;</span> <span class="o">%</span> <span class="n">c</span><span class="p">)</span>
   <span class="k">else</span><span class="p">:</span>
     <span class="k">return</span> <span class="p">(</span><span class="mf">1.8</span> <span class="o">*</span> <span class="n">c</span><span class="p">)</span> <span class="o">+</span> <span class="mi">32</span>
</pre></div>
</td></tr></table></div>
<p>Notice that on line 16, <tt class="xref py py-func docutils literal"><span class="pre">clesius_to_farenheit()</span></tt> raises
a <tt class="xref py py-class docutils literal"><span class="pre">ValueError</span></tt> if the temperature supplied to the function
is lower than the thermodynamic legal limit of -273.15 °C.</p>
</div>
<div class="section" id="choices">
<h3>2.3.4. Choices<a class="headerlink" href="#choices" title="Permalink to this headline">¶</a></h3>
<p>In some cases, no conversion is required but it is desirable
to check an option value against a list of choices. As shown
below, phyles allows the creation of lists of choices within
the schema specification. If choices are given in this way,
phyles creates a sensible error message if the value for
the option is not within the list of choices.</p>
</div>
</div>
<div class="section" id="the-schema-specification">
<h2>2.4. The Schema Specification<a class="headerlink" href="#the-schema-specification" title="Permalink to this headline">¶</a></h2>
<p>A schema in phyles (encapsulated by the <a class="reference internal" href="phyles-api.html#phyles.Schema" title="phyles.Schema"><tt class="xref py py-class docutils literal"><span class="pre">phyles.Schema</span></tt></a>
class), contains information to validate a configuration
as well as produce a sample configuration, complete with
documentation in comments. A schema is specified by a
&#8220;schema specification&#8221;.</p>
<p>The schema specification (often shortened to &#8220;spec&#8221;)
can take several forms, as fully explained in the documentation
to the <a class="reference internal" href="phyles-api.html#phyles.load_schema" title="phyles.load_schema"><tt class="xref py py-func docutils literal"><span class="pre">phyles.load_schema()</span></tt></a> function.</p>
<div class="section" id="example-schema-specification">
<h3>2.4.1. Example Schema Specification<a class="headerlink" href="#example-schema-specification" title="Permalink to this headline">¶</a></h3>
<p>For our barbecue example, we&#8217;ll use a schema specification
written as a <a class="reference external" href="http://yaml.org/type/omap.html">YAML omap</a>:</p>
<div class="highlight-yaml"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre> 1
 2
 3
 4
 5
 6
 7
 8
 9
10
11
12
13
14
15
16
17
18</pre></div></td><td class="code"><div class="highlight"><pre><span class="kt">!!omap</span>
<span class="p-Indicator">-</span> <span class="l-Scalar-Plain">dish</span> <span class="p-Indicator">:</span>
    <span class="p-Indicator">-</span> <span class="p-Indicator">-</span> <span class="l-Scalar-Plain">vegetable kabobs</span>
      <span class="p-Indicator">-</span> <span class="l-Scalar-Plain">smoked salmon</span>
      <span class="p-Indicator">-</span> <span class="l-Scalar-Plain">brisket</span>
    <span class="p-Indicator">-</span> <span class="l-Scalar-Plain">smoked salmon</span>
    <span class="p-Indicator">-</span> <span class="l-Scalar-Plain">Dish to cook</span>
<span class="p-Indicator">-</span> <span class="l-Scalar-Plain">doneness</span> <span class="p-Indicator">:</span>
    <span class="p-Indicator">-</span> <span class="l-Scalar-Plain">rare</span> <span class="p-Indicator">:</span> <span class="l-Scalar-Plain">200</span>
      <span class="l-Scalar-Plain">medium</span> <span class="p-Indicator">:</span> <span class="l-Scalar-Plain">350</span>
      <span class="l-Scalar-Plain">well-done</span> <span class="p-Indicator">:</span> <span class="l-Scalar-Plain">500</span>
    <span class="p-Indicator">-</span> <span class="l-Scalar-Plain">medium</span>
    <span class="p-Indicator">-</span> <span class="l-Scalar-Plain">How much to cook the dish</span>
<span class="p-Indicator">-</span> <span class="l-Scalar-Plain">temperature</span> <span class="p-Indicator">:</span>
    <span class="p-Indicator">-</span> <span class="l-Scalar-Plain">celsius to farenheit</span>
    <span class="p-Indicator">-</span> <span class="l-Scalar-Plain">105</span>
    <span class="p-Indicator">-</span> <span class="l-Scalar-Plain">Cooking temperature in °C</span>
    <span class="p-Indicator">-</span> <span class="l-Scalar-Plain">105</span>
</pre></div>
</td></tr></table></div>
</div>
<div class="section" id="required-elements-of-a-specification">
<h3>2.4.2. Required Elements of a Specification<a class="headerlink" href="#required-elements-of-a-specification" title="Permalink to this headline">¶</a></h3>
<p>The sequence value for each parameter (<em>e.g.</em> <tt class="docutils literal"><span class="pre">dish</span></tt>,
<tt class="docutils literal"><span class="pre">doneness</span></tt>, and <tt class="docutils literal"><span class="pre">temperature</span></tt>) in the schema
specification has three required elements (and a fourth
optional element, described below in the section
titled <a class="reference internal" href="#optional-default-values">Optional Default Values</a>):</p>
<blockquote>
<div><ol class="arabic">
<li><dl class="first docutils">
<dt>converter as either</dt>
<dd><ol class="first last loweralpha simple">
<li>a YAML string object of the name of the converter
function as keyed in the <cite>converters</cite> argument to
<tt class="xref py py-func docutils literal"><span class="pre">phyles.Schema.load_schema()</span></tt>
(as with <tt class="docutils literal"><span class="pre">temperature</span></tt> above, and discussed in the
section titled <a class="reference internal" href="#dictionary-of-converter-functions">Dictionary of Converter Functions</a>)</li>
<li>a YAML sequence object with a list of acceptable
choices (as with <tt class="docutils literal"><span class="pre">dish</span></tt> above)</li>
<li>or a YAML mapping object that maps choices to
converted values (as with <tt class="docutils literal"><span class="pre">doneness</span></tt> above)</li>
</ol>
</dd>
</dl>
</li>
<li><p class="first">an example value (for sample config files)</p>
</li>
<li><p class="first">documentation (which can be set to <tt class="docutils literal"><span class="pre">null</span></tt>
for no documentation; see <a class="reference external" href="http://yaml.org/type/null.html">YAML null</a>)</p>
</li>
</ol>
</div></blockquote>
<p>For <tt class="docutils literal"><span class="pre">temperature</span></tt>, these elements are</p>
<blockquote>
<div><ol class="arabic simple">
<li>converter: <tt class="docutils literal"><span class="pre">celsius</span> <span class="pre">to</span> <span class="pre">farenheit</span></tt></li>
<li>example: <tt class="docutils literal"><span class="pre">105</span></tt></li>
<li>documentation: <tt class="docutils literal"><span class="pre">Cooking</span> <span class="pre">temperature</span> <span class="pre">in</span> <span class="pre">°C</span></tt></li>
</ol>
</div></blockquote>
</div>
<div class="section" id="dictionary-of-converter-functions">
<h3>2.4.3. Dictionary of Converter Functions<a class="headerlink" href="#dictionary-of-converter-functions" title="Permalink to this headline">¶</a></h3>
<p>One question is how a <em>name</em> that evaluates to a
python <tt class="xref py py-class docutils literal"><span class="pre">str</span></tt> (<em>e.g.</em> <tt class="docutils literal"><span class="pre">doneness</span></tt>) translates
into a converter, which must be a function. As explained
more thoroughly in the discussion of <a class="reference internal" href="#the-schema">schema</a> below,
this translation is achieved using a <a class="reference external" href="http://docs.python.org/2/library/stdtypes.html#dict" title="(in Python v2.7)"><tt class="xref py py-class docutils literal"><span class="pre">dict</span></tt></a>. For
this barbecue example, we construct this <a class="reference external" href="http://docs.python.org/2/library/stdtypes.html#dict" title="(in Python v2.7)"><tt class="xref py py-class docutils literal"><span class="pre">dict</span></tt></a>
in the following way:</p>
<div class="highlight-python"><div class="highlight"><pre><span class="n">converters</span> <span class="o">=</span> <span class="p">{</span><span class="s">&#39;celsius to farenheit&#39;</span><span class="p">:</span> <span class="n">celsius_to_farenheit</span><span class="p">}</span>
</pre></div>
</div>
<p>We&#8217;ll see exactly how to use the <tt class="docutils literal"><span class="pre">converters</span></tt> <a class="reference external" href="http://docs.python.org/2/library/stdtypes.html#dict" title="(in Python v2.7)"><tt class="xref py py-class docutils literal"><span class="pre">dict</span></tt></a>
in the <a class="reference internal" href="#example-utility">example utility</a>.</p>
<div class="admonition note">
<p class="first admonition-title">Note</p>
<p class="last">The <tt class="xref py py-func docutils literal"><span class="pre">celsius_to_farenheit()</span></tt> function is defined
in the section titled
<a class="reference internal" href="#conversion-by-user-defined-functions">Conversion by User-Defined Functions</a></p>
</div>
</div>
<div class="section" id="phyles-standard-converters">
<h3>2.4.4. Phyles Standard Converters<a class="headerlink" href="#phyles-standard-converters" title="Permalink to this headline">¶</a></h3>
<p>There are several python types for which it is not
necessary to add entries to the
<tt class="docutils literal"><span class="pre">converters</span></tt> <a class="reference external" href="http://docs.python.org/2/library/stdtypes.html#dict" title="(in Python v2.7)"><tt class="xref py py-class docutils literal"><span class="pre">dict</span></tt></a>. The reason is that phyles
provides a set of built-in converters. For example, if a
<tt class="xref py py-class docutils literal"><span class="pre">float</span></tt> converter were needed, then the following
would be implicit and <strong>not required</strong> from the programmer:</p>
<div class="highlight-python"><div class="highlight"><pre><span class="n">converters</span> <span class="o">=</span> <span class="p">{</span><span class="s">&#39;float&#39;</span><span class="p">:</span> <span class="nb">float</span><span class="p">}</span>  <span class="c">#  &lt;-- NOT necessary!!</span>
</pre></div>
</div>
<p>These built-in converters provided by phyles are:</p>
<blockquote>
<div><ul class="simple">
<li><strong>map</strong>: <a class="reference external" href="http://docs.python.org/2/library/stdtypes.html#dict" title="(in Python v2.7)"><tt class="xref py py-class docutils literal"><span class="pre">dict</span></tt></a></li>
<li><strong>dict</strong>: <a class="reference external" href="http://docs.python.org/2/library/stdtypes.html#dict" title="(in Python v2.7)"><tt class="xref py py-class docutils literal"><span class="pre">dict</span></tt></a>
(encoded as a <a class="reference external" href="http://yaml.org/type/dict.html">YAML dict</a>)</li>
<li><strong>omap</strong>: <a class="reference external" href="http://docs.python.org/2/library/collections.html#collections.OrderedDict" title="(in Python v2.7)"><tt class="xref py py-class docutils literal"><span class="pre">collections.OrderedDict</span></tt></a></li>
<li><strong>odict</strong>: <a class="reference external" href="http://docs.python.org/2/library/collections.html#collections.OrderedDict" title="(in Python v2.7)"><tt class="xref py py-class docutils literal"><span class="pre">collections.OrderedDict</span></tt></a>
(alias for &#8220;omap&#8221;)</li>
<li><strong>pairs</strong>: <tt class="xref py py-class docutils literal"><span class="pre">list</span></tt> of 2-<tt class="xref py py-class docutils literal"><span class="pre">tuples</span></tt></li>
<li><strong>set</strong>: <a class="reference external" href="http://docs.python.org/2/library/stdtypes.html#set" title="(in Python v2.7)"><tt class="xref py py-class docutils literal"><span class="pre">set</span></tt></a></li>
<li><strong>seq</strong>: <tt class="xref py py-class docutils literal"><span class="pre">list</span></tt></li>
<li><strong>list</strong>: <tt class="xref py py-class docutils literal"><span class="pre">list</span></tt>
(encoded as a sequence, see <a class="reference external" href="http://docs.python.org/2/library/functions.html#list" title="(in Python v2.7)"><tt class="xref py py-func docutils literal"><span class="pre">list()</span></tt></a>)</li>
<li><strong>tuple</strong>: <tt class="xref py py-class docutils literal"><span class="pre">tuple</span></tt>
(encoded as a sequence, see <a class="reference external" href="http://docs.python.org/2/library/functions.html#tuple" title="(in Python v2.7)"><tt class="xref py py-func docutils literal"><span class="pre">tuple()</span></tt></a>)</li>
<li><strong>bool</strong>: <tt class="xref py py-class docutils literal"><span class="pre">bool</span></tt></li>
<li><strong>float</strong>: <tt class="xref py py-class docutils literal"><span class="pre">float</span></tt></li>
<li><strong>int</strong>: <tt class="xref py py-class docutils literal"><span class="pre">int</span></tt></li>
<li><strong>long</strong>: <tt class="xref py py-class docutils literal"><span class="pre">long</span></tt> (encoded as a <a class="reference external" href="http://yaml.org/type/int.html">YAML int</a>)</li>
<li><strong>complex</strong>: <tt class="xref py py-class docutils literal"><span class="pre">complex</span></tt>
(encoded as a sequence of 0 to 2, or as a string
representation, e.g. <tt class="docutils literal"><span class="pre">'3+2j'</span></tt>; see <a class="reference external" href="http://docs.python.org/2/library/functions.html#complex" title="(in Python v2.7)"><tt class="xref py py-func docutils literal"><span class="pre">complex()</span></tt></a>)</li>
<li><strong>str</strong>: <tt class="xref py py-class docutils literal"><span class="pre">str</span></tt></li>
<li><strong>unicode</strong>: <tt class="xref py py-class docutils literal"><span class="pre">unicode</span></tt></li>
<li><strong>timestamp</strong>: <a class="reference external" href="http://docs.python.org/2/library/datetime.html#datetime.datetime" title="(in Python v2.7)"><tt class="xref py py-class docutils literal"><span class="pre">datetime.datetime</span></tt></a>
(encoded as a <a class="reference external" href="http://yaml.org/type/timestamp.html">YAML timestamp</a>)</li>
<li><strong>slice</strong>: <tt class="xref py py-class docutils literal"><span class="pre">slice</span></tt>
(encoded as a sequence of 1 to 3, see <a class="reference external" href="http://docs.python.org/2/library/functions.html#slice" title="(in Python v2.7)"><tt class="xref py py-func docutils literal"><span class="pre">slice()</span></tt></a>)</li>
</ul>
</div></blockquote>
<div class="admonition note">
<p class="first admonition-title">Note</p>
<p class="last">Except where indicated, these types are encoded
according to the <a class="reference external" href="http://yaml.org/type/">YAML types</a> specification
in a YAML representation of a config.</p>
</div>
</div>
<div class="section" id="list-optional-converters">
<h3>2.4.5. List-Optional Converters<a class="headerlink" href="#list-optional-converters" title="Permalink to this headline">¶</a></h3>
<p>Any converter that is specified as a YAML string object
can be specified as &#8220;list-optional&#8221; by enclosing the string
in angle brackets (<tt class="docutils literal"><span class="pre">&quot;&lt;&quot;</span></tt> and <tt class="docutils literal"><span class="pre">&quot;&gt;&quot;</span></tt>).
For example, the barbecue program
might take one or more temperatures instead of just a
single temperature.</p>
<div class="highlight-yaml"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre>1
2
3
4
5</pre></div></td><td class="code"><div class="highlight"><pre><span class="p-Indicator">-</span> <span class="l-Scalar-Plain">temperature</span> <span class="p-Indicator">:</span>
    <span class="p-Indicator">-</span> <span class="l-Scalar-Plain">&lt;celsius to farenheit&gt;</span>
    <span class="p-Indicator">-</span> <span class="l-Scalar-Plain">105</span>
    <span class="p-Indicator">-</span> <span class="l-Scalar-Plain">Cooking temperature in °C, or list thereof</span>
    <span class="p-Indicator">-</span> <span class="l-Scalar-Plain">105</span>
</pre></div>
</td></tr></table></div>
<p>In such a case, the following would both be valid key-value
pairs for <tt class="docutils literal"><span class="pre">temperature</span></tt>.</p>
<div class="highlight-yaml"><div class="highlight"><pre><span class="l-Scalar-Plain">temperature</span> <span class="p-Indicator">:</span> <span class="l-Scalar-Plain">105</span>
</pre></div>
</div>
<div class="highlight-yaml"><div class="highlight"><pre><span class="l-Scalar-Plain">temperature</span> <span class="p-Indicator">:</span> <span class="p-Indicator">[</span><span class="nv">105</span><span class="p-Indicator">,</span> <span class="nv">120</span><span class="p-Indicator">]</span>
</pre></div>
</div>
<p>Note that a converter specified as list-optional will produce a
list for the key in the configuration, even if the value given in the
config file not a list. In the former example (<tt class="docutils literal"><span class="pre">temperatreu</span> <span class="pre">:</span> <span class="pre">105</span></tt>),
the config would have the value <tt class="docutils literal"><span class="pre">[105]</span></tt> for the
key <tt class="docutils literal"><span class="pre">&quot;temperature&quot;</span></tt>.  Thus, the list-optional angle
brackets can be thought of as meaning &#8220;make the value into a list
if it is not already&#8221;.</p>
<p>The capability to specify list-optional converters
does not limit the converter dictionary
from having keys that are enclosed by angle brackets:</p>
<div class="highlight-python"><div class="highlight"><pre><span class="n">converters</span> <span class="o">=</span> <span class="p">{</span><span class="s">&#39;&lt;some converter&gt;&#39;</span><span class="p">:</span> <span class="n">some_converter</span><span class="p">}</span>
</pre></div>
</div>
<p>Even a converter named in this way could be list-optional
in the schema specification:</p>
<div class="highlight-yaml"><div class="highlight"><pre><span class="p-Indicator">-</span> <span class="l-Scalar-Plain">a_parameter</span> <span class="p-Indicator">:</span>
    <span class="p-Indicator">-</span> <span class="l-Scalar-Plain">&lt;&lt;some converter&gt;&gt;</span>
    <span class="p-Indicator">-</span> <span class="l-Scalar-Plain">value</span>
    <span class="p-Indicator">-</span> <span class="l-Scalar-Plain">A particular paramter or list thereof</span>
</pre></div>
</div>
</div>
<div class="section" id="optional-default-values">
<h3>2.4.6. Optional Default Values<a class="headerlink" href="#optional-default-values" title="Permalink to this headline">¶</a></h3>
<p>Additional to the three required elements of a specification
parameter, an optional default value may  be specified as a
fourth element. In the <a class="reference internal" href="#example-schema-specification">example schema specification</a> the
default for the <tt class="docutils literal"><span class="pre">temperature</span></tt> parameter is <tt class="docutils literal"><span class="pre">105</span></tt>.  If a
default value is missing, as in <tt class="docutils literal"><span class="pre">dish</span></tt> and <tt class="docutils literal"><span class="pre">doneness</span></tt>, then
the parameter is required in the config file.</p>
<p>For example, the following config will fail vailidation
by a schema from the <a class="reference internal" href="#example-schema-specification">example schema specification</a> because
the specification requires a value for <tt class="docutils literal"><span class="pre">doneness</span></tt> (by
virtue of the specification&#8217;s missing a default value
for <tt class="docutils literal"><span class="pre">doneness</span></tt>):</p>
<div class="highlight-yaml"><div class="highlight"><pre><span class="l-Scalar-Plain">dish</span> <span class="p-Indicator">:</span> <span class="l-Scalar-Plain">smoked salmon</span>
<span class="l-Scalar-Plain">temperature</span> <span class="p-Indicator">:</span> <span class="l-Scalar-Plain">107</span>
</pre></div>
</div>
</div>
</div>
<div class="section" id="the-schema">
<h2>2.5. The Schema<a class="headerlink" href="#the-schema" title="Permalink to this headline">¶</a></h2>
<div class="section" id="loading-schema">
<h3>2.5.1. Loading Schema<a class="headerlink" href="#loading-schema" title="Permalink to this headline">¶</a></h3>
<p>To validate a config file, the information in <a class="reference internal" href="#the-schema-specification">the schema
specification</a> must be converted into a
functional schema, a conversion accomplished by the
<a class="reference internal" href="phyles-api.html#phyles.load_schema" title="phyles.load_schema"><tt class="xref py py-func docutils literal"><span class="pre">phyles.load_schema()</span></tt></a> function.</p>
</div>
<div class="section" id="validating-configs">
<h3>2.5.2. Validating Configs<a class="headerlink" href="#validating-configs" title="Permalink to this headline">¶</a></h3>
<p>Although the <a class="reference internal" href="phyles-api.html#phyles.set_up" title="phyles.set_up"><tt class="xref py py-func docutils literal"><span class="pre">phyles.set_up()</span></tt></a> function automates
these steps, it is useful to see how a schema is
constructed from a specification and further how the
schema validates a config. Using the running example
(<em>i.e.</em> with <tt class="docutils literal"><span class="pre">converters</span></tt> defined in the section titled
<a class="reference internal" href="#dictionary-of-converter-functions">Dictionary of Converter Functions</a>):</p>
<div class="highlight-python"><div class="highlight"><pre><span class="kn">import</span> <span class="nn">phyles</span>
<span class="kn">import</span> <span class="nn">yaml</span>

<span class="n">spec</span> <span class="o">=</span> <span class="s">&quot;&quot;&quot;</span>
<span class="s">       !!omap</span>
<span class="s">       - dish :</span>
<span class="s">           - - vegetable kabobs</span>
<span class="s">             - smoked salmon</span>
<span class="s">             - brisket</span>
<span class="s">           - smoked salmon</span>
<span class="s">           - Dish to cook</span>
<span class="s">       - doneness :</span>
<span class="s">           - rare : 200</span>
<span class="s">             medium : 350</span>
<span class="s">             well-done : 500</span>
<span class="s">           - medium</span>
<span class="s">           - How much to cook the dish</span>
<span class="s">       - temperature :</span>
<span class="s">           - celsius to farenheit</span>
<span class="s">           - 105</span>
<span class="s">           - Cooking temperature in °C</span>
<span class="s">           - 105</span>
<span class="s">       &quot;&quot;&quot;</span>

<span class="n">cfg</span> <span class="o">=</span> <span class="n">yaml</span><span class="o">.</span><span class="n">load</span><span class="p">(</span><span class="s">&quot;&quot;&quot;</span>
<span class="s">                dish : smoked salmon</span>
<span class="s">                doneness : medium</span>
<span class="s">                temperature : 107</span>
<span class="s">                &quot;&quot;&quot;</span><span class="p">)</span>

<span class="n">schema</span> <span class="o">=</span> <span class="n">phyles</span><span class="o">.</span><span class="n">load_schema</span><span class="p">(</span><span class="n">spec</span><span class="p">,</span> <span class="n">converters</span><span class="p">)</span>
<span class="n">config</span> <span class="o">=</span> <span class="n">schema</span><span class="o">.</span><span class="n">validate_config</span><span class="p">(</span><span class="n">cfg</span><span class="p">)</span>
</pre></div>
</div>
<p>The behavior of the resulting <tt class="docutils literal"><span class="pre">config</span></tt>, which is an instance
of <a class="reference internal" href="phyles-api.html#phyles.Configuration" title="phyles.Configuration"><tt class="xref py py-class docutils literal"><span class="pre">phyles.Configuration</span></tt></a>, will be discussed in more
detail in the section titled <a class="reference internal" href="#the-configuration">The Configuration</a>.</p>
<div class="admonition note">
<p class="first admonition-title">Note</p>
<p>The <tt class="docutils literal"><span class="pre">cfg</span></tt> could have just as easily
been created directly as a <a class="reference external" href="http://docs.python.org/2/library/stdtypes.html#dict" title="(in Python v2.7)"><tt class="xref py py-class docutils literal"><span class="pre">dict</span></tt></a>:</p>
<div class="highlight-python"><div class="highlight"><pre><span class="n">cfg</span> <span class="o">=</span> <span class="p">{</span><span class="s">&quot;dish&quot;</span><span class="p">:</span> <span class="s">&quot;smoked salmon&quot;</span><span class="p">,</span>
       <span class="s">&quot;doneness&quot;</span><span class="p">:</span> <span class="s">&quot;medium&quot;</span><span class="p">,</span>
       <span class="s">&quot;temperature&quot;</span><span class="p">:</span> <span class="mi">107</span><span class="p">}</span>
</pre></div>
</div>
<p class="last">However, YAML is used here for consistency
with earlier parts of this example and to
emphasize the point that the files
wherein configurations are stored are YAML files.
Phyles facilitates using YAML files for configurations.
For example the opening, reading, and validating
of which are automated by the
<a class="reference internal" href="phyles-api.html#phyles.Schema.read_config" title="phyles.Schema.read_config"><tt class="xref py py-func docutils literal"><span class="pre">phyles.Schema.read_config()</span></tt></a> function.</p>
</div>
</div>
<div class="section" id="creating-a-sample-config">
<h3>2.5.3. Creating a Sample Config<a class="headerlink" href="#creating-a-sample-config" title="Permalink to this headline">¶</a></h3>
<p>An instance of <a class="reference internal" href="phyles-api.html#phyles.Schema" title="phyles.Schema"><tt class="xref py py-class docutils literal"><span class="pre">phyles.Schema</span></tt></a> is capable of
producing a sample config file using the
<a class="reference internal" href="phyles-api.html#phyles.Schema.sample_config" title="phyles.Schema.sample_config"><tt class="xref py py-func docutils literal"><span class="pre">phyles.Schema.sample_config()</span></tt></a>. For example
given the <tt class="docutils literal"><span class="pre">schema</span></tt> we just created:</p>
<div class="highlight-python"><div class="highlight"><pre><span class="gp">&gt;&gt;&gt; </span><span class="k">print</span> <span class="n">schema</span><span class="o">.</span><span class="n">sample_config</span><span class="p">()</span>
<span class="go">%YAML 1.2</span>
<span class="go">---</span>

<span class="go"># Dish to cook</span>
<span class="go"># One of: vegetable kabobs, smoked salmon, brisket</span>
<span class="go">dish : smoked salmon</span>

<span class="go"># How much to cook the dish</span>
<span class="go"># One of: well-done, medium, rare</span>
<span class="go">doneness : medium</span>

<span class="go"># Cooking temperature in °C</span>
<span class="go">temperature : 105</span>
</pre></div>
</div>
</div>
</div>
<div class="section" id="the-configuration">
<h2>2.6. The Configuration<a class="headerlink" href="#the-configuration" title="Permalink to this headline">¶</a></h2>
<p>Instances of <a class="reference internal" href="phyles-api.html#phyles.Configuration" title="phyles.Configuration"><tt class="xref py py-class docutils literal"><span class="pre">phyles.Configuration</span></tt></a> are simply
ordered mappings. By virture of their <tt class="docutils literal"><span class="pre">original</span></tt> attribute,
<a class="reference internal" href="phyles-api.html#phyles.Configuration" title="phyles.Configuration"><tt class="xref py py-class docutils literal"><span class="pre">phyles.Configuration</span></tt></a> objects also retain memory
of the configuration before conversion (as with the
temperature, which was converted from Celsius to Farenheit):</p>
<div class="highlight-python"><div class="highlight"><pre><span class="gp">&gt;&gt;&gt; </span><span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="n">config</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
<span class="gp">... </span>  <span class="k">print</span> <span class="n">i</span>
<span class="go">(&#39;dish&#39;, &#39;smoked salmon&#39;)</span>
<span class="go">(&#39;doneness&#39;, 350)</span>
<span class="go">(&#39;temperature&#39;, 107.0)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">config</span><span class="p">[</span><span class="s">&#39;temperature&#39;</span><span class="p">]</span>
<span class="go">225.0</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">config</span><span class="o">.</span><span class="n">original</span><span class="p">[</span><span class="s">&#39;temperature&#39;</span><span class="p">]</span>
<span class="go">107</span>
</pre></div>
</div>
<p>Instances of <a class="reference internal" href="phyles-api.html#phyles.Configuration" title="phyles.Configuration"><tt class="xref py py-class docutils literal"><span class="pre">phyles.Configuration</span></tt></a> are useful inside a
utility, potentially being the sole parameter that needs to be
passed to functions. The following example assumes that the
function <tt class="xref py py-func docutils literal"><span class="pre">cooking_time()</span></tt> is defined as in the section titled
<a class="reference internal" href="#the-calculation">The Calculation</a>:</p>
<div class="highlight-python"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre> 1
 2
 3
 4
 5
 6
 7
 8
 9
10
11
12
13
14
15
16</pre></div></td><td class="code"><div class="highlight"><pre><span class="n">difficulties</span> <span class="o">=</span> <span class="p">{</span><span class="s">&#39;vegetable kabobs&#39;</span><span class="p">:</span> <span class="mi">1</span><span class="p">,</span>
                <span class="s">&#39;smoked salmon&#39;</span><span class="p">:</span> <span class="mi">2</span><span class="p">,</span>
                <span class="s">&#39;brisket&#39;</span><span class="p">:</span> <span class="mi">3</span><span class="p">}</span>

<span class="k">def</span> <span class="nf">report_cooking</span><span class="p">(</span><span class="n">config</span><span class="p">):</span>
  <span class="n">t</span> <span class="o">=</span> <span class="n">cooking_time</span><span class="p">(</span><span class="n">config</span><span class="p">[</span><span class="s">&#39;doneness&#39;</span><span class="p">],</span> <span class="n">config</span><span class="p">[</span><span class="s">&#39;difficulty&#39;</span><span class="p">],</span>
                   <span class="n">config</span><span class="p">[</span><span class="s">&#39;temperature&#39;</span><span class="p">])</span>
  <span class="n">message</span> <span class="o">=</span> <span class="s">&quot;Cooking time is </span><span class="si">%5.2f</span><span class="s"> hr.&quot;</span> <span class="o">%</span> <span class="n">t</span>
  <span class="n">message</span> <span class="o">=</span> <span class="n">message</span><span class="o">.</span><span class="n">center</span><span class="p">(</span><span class="mi">70</span><span class="p">)</span>
  <span class="n">config</span><span class="p">[</span><span class="s">&#39;outlet&#39;</span><span class="p">](</span><span class="n">message</span><span class="p">)</span>

<span class="k">def</span> <span class="nf">main</span><span class="p">(</span><span class="n">config</span><span class="p">):</span>
  <span class="o">...</span>
  <span class="n">config</span><span class="p">[</span><span class="s">&#39;difficulty&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">difficulties</span><span class="p">[</span><span class="n">config</span><span class="p">[</span><span class="s">&#39;dish&#39;</span><span class="p">]]</span>
  <span class="n">config</span><span class="p">[</span><span class="s">&#39;outlet&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="k">lambda</span> <span class="n">s</span><span class="p">:</span> <span class="n">sys</span><span class="o">.</span><span class="n">stdout</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="n">s</span> <span class="o">+</span> <span class="s">&quot;</span><span class="se">\n</span><span class="s">&quot;</span><span class="p">)</span>
  <span class="n">report_cooking</span><span class="p">(</span><span class="n">config</span><span class="p">)</span>
</pre></div>
</td></tr></table></div>
<p>While bundling arguments within a <tt class="xref py py-class docutils literal"><span class="pre">Configuration</span></tt>
may seem a little cumbersome at first, it facilitates the
adding of new configuration-based behaviors deep within a
utility and without the need to modify functions to accommodate additional parameters.</p>
<div class="admonition note">
<p class="first admonition-title">Note</p>
<p class="last">Not all functions of the utility need to take
a <tt class="xref py py-class docutils literal"><span class="pre">Configuration</span></tt> object as an argument. Here
<tt class="xref py py-func docutils literal"><span class="pre">cooking_time()</span></tt> still takes three distinct
arguments, but the &#8220;higher-level&#8221;
<tt class="xref py py-func docutils literal"><span class="pre">report_cooking()</span></tt> function takes config.
Such design considerations are left to the programmer.</p>
</div>
<p>As an example of the utility of a <tt class="xref py py-class docutils literal"><span class="pre">Configuration</span></tt> object,
notice that the message width above is hard-coded to 70 in line 9
above. In principle, this width could be user-configurable:</p>
<div class="highlight-python"><div class="highlight"><pre><span class="n">spec</span> <span class="o">=</span> <span class="s">&quot;&quot;&quot;</span>
<span class="s">       !!omap</span>
<span class="s">       - dish :</span>
<span class="s">           - - vegetable kabobs</span>
<span class="s">             - smoked salmon</span>
<span class="s">             - brisket</span>
<span class="s">           - smoked salmon</span>
<span class="s">           - Dish to cook</span>
<span class="s">       - doneness :</span>
<span class="s">           - rare : 200</span>
<span class="s">             medium : 350</span>
<span class="s">             well-done : 500</span>
<span class="s">           - medium</span>
<span class="s">           - How much to cook the dish</span>
<span class="s">       - temperature :</span>
<span class="s">           - celsius to farenheit</span>
<span class="s">           - 105</span>
<span class="s">           - Cooking temperature in °C</span>
<span class="s">           - 105</span>
<span class="s">       - width :</span>
<span class="s">           - int</span>
<span class="s">           - 70</span>
<span class="s">           - width of messages</span>
<span class="s">           - 70</span>
<span class="s">       &quot;&quot;&quot;</span>

<span class="n">cfg</span> <span class="o">=</span> <span class="n">yaml</span><span class="o">.</span><span class="n">load</span><span class="p">(</span><span class="s">&quot;&quot;&quot;</span>
<span class="s">                dish : smoked salmon</span>
<span class="s">                doneness : medium</span>
<span class="s">                temperature : 107</span>
<span class="s">                &quot;&quot;&quot;</span><span class="p">)</span>

<span class="n">schema</span> <span class="o">=</span> <span class="n">phyles</span><span class="o">.</span><span class="n">load_schema</span><span class="p">(</span><span class="n">spec</span><span class="p">,</span> <span class="n">converters</span><span class="p">)</span>
<span class="n">config</span> <span class="o">=</span> <span class="n">schema</span><span class="o">.</span><span class="n">validate_config</span><span class="p">(</span><span class="n">cfg</span><span class="p">)</span>
</pre></div>
</div>
<p>Now, the message width needs not be hard-coded, which is
a bane of maintenance:</p>
<div class="highlight-python"><div class="highlight"><pre><span class="k">def</span> <span class="nf">report_cooking</span><span class="p">(</span><span class="n">config</span><span class="p">):</span>
  <span class="n">t</span> <span class="o">=</span> <span class="n">cooking_time</span><span class="p">(</span><span class="n">config</span><span class="p">[</span><span class="s">&#39;doneness&#39;</span><span class="p">],</span> <span class="n">config</span><span class="p">[</span><span class="s">&#39;difficulty&#39;</span><span class="p">],</span>
                   <span class="n">config</span><span class="p">[</span><span class="s">&#39;temperature&#39;</span><span class="p">])</span>
  <span class="n">message</span> <span class="o">=</span> <span class="s">&quot;Cooking time is </span><span class="si">%s</span><span class="s"> hr.&quot;</span> <span class="o">%</span> <span class="n">t</span>
  <span class="n">message</span> <span class="o">=</span> <span class="n">message</span><span class="o">.</span><span class="n">center</span><span class="p">(</span><span class="n">config</span><span class="p">[</span><span class="s">&#39;width&#39;</span><span class="p">])</span>
  <span class="n">config</span><span class="p">[</span><span class="s">&#39;outlet&#39;</span><span class="p">](</span><span class="n">message</span><span class="p">)</span>
</pre></div>
</div>
<p>This enhanced functionality is essentially transparent
to the user because a default value (70) is provided for
the <tt class="docutils literal"><span class="pre">width</span></tt> option, rendering <tt class="docutils literal"><span class="pre">width</span></tt> optional in
the config file.</p>
</div>
<div class="section" id="example-utility">
<h2>2.7. Example Utility<a class="headerlink" href="#example-utility" title="Permalink to this headline">¶</a></h2>
<p>We now have all of the pieces we need to make a utility
package, complete with its own library module and
scripts (also called &#8220;executable programs&#8221;, or just
&#8220;programs&#8221;).  As part of the phyles source, an example
called &#8220;barbecue&#8221; is included in the directory
called &#8220;examples&#8221;.</p>
<div class="section" id="running-the-example">
<h3>2.7.1. Running the Example<a class="headerlink" href="#running-the-example" title="Permalink to this headline">¶</a></h3>
<p>Assuming phyles and its dependencies are installed,
the barbecue example is fully functioning in-place. For
example, try one of the following commands (depending
on your shell) from the <tt class="docutils literal"><span class="pre">examples/barbecue</span></tt> directory:</p>
<blockquote>
<div><p>bash-type shell:</p>
<div class="highlight-python"><pre>PYTHONPATH=".:${PYTHONPATH}" bin/barbecue-time -t</pre>
</div>
<p>csh/tcsh shell:</p>
<div class="highlight-python"><pre>env PYTHONPATH=".:${PYTHONPATH}" bin/barbecue-time -t</pre>
</div>
</div></blockquote>
<div class="admonition note">
<p class="first admonition-title">Note</p>
<p class="last">The part of the command that modifies <tt class="docutils literal"><span class="pre">$PYTHONPATH</span></tt>
allows for running the <tt class="docutils literal"><span class="pre">barbecue-time</span></tt> executable
in-place. Were the barbecue package installed as with
<tt class="docutils literal"><span class="pre">python</span> <span class="pre">setup.py</span> <span class="pre">install</span></tt> this modificaiton of
<tt class="docutils literal"><span class="pre">$PYTHONPATH</span></tt> would not be necessary.</p>
</div>
<p>These commands should produce the following output:</p>
<div class="highlight-yaml"><div class="highlight"><pre><span class="nt">%YAML</span> <span class="m">1.2</span>
<span class="nn">---</span>

<span class="c1"># Dish to cook</span>
<span class="c1"># One of: vegetable kabobs, smoked salmon, brisket</span>
<span class="l-Scalar-Plain">dish</span> <span class="p-Indicator">:</span> <span class="l-Scalar-Plain">smoked salmon</span>

<span class="c1"># How much to cook the dish</span>
<span class="c1"># One of: well-done, medium, rare</span>
<span class="l-Scalar-Plain">doneness</span> <span class="p-Indicator">:</span> <span class="l-Scalar-Plain">medium</span>

<span class="c1"># Cooking temperature in °C</span>
<span class="l-Scalar-Plain">temperature</span> <span class="p-Indicator">:</span> <span class="l-Scalar-Plain">105</span>

<span class="c1"># width of report</span>
<span class="l-Scalar-Plain">width</span> <span class="p-Indicator">:</span> <span class="l-Scalar-Plain">70</span>
</pre></div>
</div>
<div class="admonition note">
<p class="first admonition-title">Note</p>
<p class="last">The example barbecue package can even be installed with
<tt class="docutils literal"><span class="pre">python</span> <span class="pre">setup.py</span> <span class="pre">install</span></tt>, althought it isn&#8217;t
necessary.</p>
</div>
<p>Within the <tt class="docutils literal"><span class="pre">examples/barbecue/test-data</span></tt> directory is also a
config file called <tt class="docutils literal"><span class="pre">time-config.yml</span></tt>. This config file can
be used without installing the barbecue package:</p>
<blockquote>
<div><p>bash-type shell:</p>
<div class="highlight-python"><pre>PYTHONPATH=".:${PYTHONPATH}" \
    bin/barbecue-time -c test-data/time-config.yml</pre>
</div>
<p>csh/tcsh shell:</p>
<div class="highlight-python"><pre>env PYTHONPATH=".:${PYTHONPATH}" \
   bin/barbecue-time -c test-data/time-config.yml</pre>
</div>
</div></blockquote>
<p>These commands should produce the following output:</p>
<div class="highlight-python"><pre>======================================================================
                        barbecue-time v.0.1b1
======================================================================
                      Cooking time is  3.12 hr.
  ~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~
                       Done with smoked salmon!
  ~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~</pre>
</div>
<p>It is possible to override configuration settings on the command
line with the <tt class="docutils literal"><span class="pre">--override</span></tt> (or <tt class="docutils literal"><span class="pre">-o</span></tt>) argument:</p>
<blockquote>
<div><p>bash-type shell:</p>
<div class="highlight-python"><pre>PYTHONPATH=".:${PYTHONPATH}" \
      bin/barbecue-time -c test-data/time-config.yml \
                        -o 'temperature : 120'</pre>
</div>
<p>csh/tcsh shell:</p>
<div class="highlight-python"><pre>env PYTHONPATH=".:${PYTHONPATH}" \
      bin/barbecue-time -c test-data/time-config.yml \
                        -o 'temperature : 120'</pre>
</div>
</div></blockquote>
<p>Here, the command line temperature of 120 °C (248 °F) overrides the
temperature in the config (107 °C), reducing the cooking time.
These commands should produce the following output:</p>
<div class="highlight-python"><pre>======================================================================
                        barbecue-time v.0.1b1
======================================================================
                      Cooking time is  2.82 hr.
  ~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~
                       Done with smoked salmon!
  ~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~</pre>
</div>
<p>Before looking deeper into the barbecue example, let&#8217;s see how
phyles gracefully handles an error that can not be found at the
time when the config is validated because it potentially
depends on the state of the system while the program is running:</p>
<blockquote>
<div><p>bash-type shell:</p>
<div class="highlight-python"><pre>PYTHONPATH=".:${PYTHONPATH}" \
      bin/barbecue-time -c test-data/time-config.yml \
                        -o 'width : 10000'</pre>
</div>
<p>csh/tcsh shell:</p>
<div class="highlight-python"><pre>env PYTHONPATH=".:${PYTHONPATH}" \
      bin/barbecue-time -c test-data/time-config.yml \
                        -o 'width : 10000'</pre>
</div>
</div></blockquote>
<p>Here, a message width of 10000 overrides the config file
width of 70. This width is much too large to be displayed on any
normal terminal. The barbecue-time script uses the
<a class="reference internal" href="phyles-api.html#phyles.get_terminal_size" title="phyles.get_terminal_size"><tt class="xref py py-func docutils literal"><span class="pre">phyles.get_terminal_size()</span></tt></a> function to catch the problem
and raise an exception that is itself caught, resulting
in a sensible error message being sent to the user with a graceful
exit from the program:</p>
<div class="highlight-python"><pre>======================================================================
                        barbecue-time v.0.1b1
======================================================================

  ############################# ERROR ##############################
    Formatting 'width' (10000) bigger than window (78)
  ##################################################################</pre>
</div>
<p>Inspection of the contents of the barbecue utility will reveal
how these features of phyles can be used with a small amount of
code.</p>
</div>
<div class="section" id="barbecue-example-directory-structure">
<h3>2.7.2. Barbecue Example Directory Structure<a class="headerlink" href="#barbecue-example-directory-structure" title="Permalink to this headline">¶</a></h3>
<p>The barbecue example is structured as a typical python package,
serving as a template for most needs:</p>
<blockquote>
<div><ul>
<li><p class="first"><strong>barbecue/</strong> &#8211; top-level directory for package</p>
<ul>
<li><dl class="first docutils">
<dt><cite>CHANGES.txt</cite></dt>
<dd><p class="first last">contains version-by-version information about the
evolution of the package <a class="footnote-reference" href="#hitch" id="id2">[2]</a></p>
</dd>
</dl>
</li>
<li><dl class="first docutils">
<dt><cite>LICENSE.txt</cite></dt>
<dd><p class="first last">contains the text of the license <a class="footnote-reference" href="#hitch" id="id3">[2]</a></p>
</dd>
</dl>
</li>
<li><dl class="first docutils">
<dt><cite>MANIFEST.in</cite></dt>
<dd><p class="first last">tells the setup script which extra files
to include in a distribution <a class="footnote-reference" href="#hitch" id="id4">[2]</a></p>
</dd>
</dl>
</li>
<li><dl class="first docutils">
<dt><cite>README.rst</cite></dt>
<dd><p class="first last">contains broad information about the package <a class="footnote-reference" href="#hitch" id="id5">[2]</a></p>
</dd>
</dl>
</li>
<li><p class="first"><strong>barbecue/</strong> &#8211; package directory, holding the library code</p>
<blockquote>
<div><ul>
<li><dl class="first docutils">
<dt><cite>__init__.py</cite></dt>
<dd><p class="first last">init module for the package</p>
</dd>
</dl>
</li>
<li><dl class="first docutils">
<dt><a class="reference internal" href="#barbecue-py">_barbecue.py</a></dt>
<dd><p class="first last">module holding the library code</p>
</dd>
</dl>
</li>
<li><p class="first"><strong>schema/</strong> &#8211; directory holding schema for configs</p>
<blockquote>
<div><ul>
<li><dl class="first docutils">
<dt><cite>barbecue-time.yml</cite></dt>
<dd><p class="first last">the schema for the <a class="reference internal" href="#barbecue-time">barbecue-time</a> program</p>
</dd>
</dl>
</li>
</ul>
</div></blockquote>
</li>
</ul>
</div></blockquote>
</li>
<li><p class="first"><strong>bin/</strong> &#8211; a directory holding executable programs</p>
<blockquote>
<div><ul>
<li><dl class="first docutils">
<dt><a class="reference internal" href="#barbecue-time">barbecue-time</a></dt>
<dd><p class="first last">an example program that calculates cooking times</p>
</dd>
</dl>
</li>
</ul>
</div></blockquote>
</li>
<li><dl class="first docutils">
<dt><a class="reference internal" href="#setup-py">setup.py</a></dt>
<dd><p class="first last">a script for distribution and installation</p>
</dd>
</dl>
</li>
<li><p class="first"><strong>test-data/</strong> &#8211; directory that holds test-data</p>
<blockquote>
<div><ul>
<li><dl class="first docutils">
<dt><cite>time-config.yml</cite></dt>
<dd><p class="first last">a test configuration file for
the <a class="reference internal" href="#barbecue-time">barbecue-time</a> program</p>
</dd>
</dl>
</li>
</ul>
</div></blockquote>
</li>
</ul>
</li>
</ul>
</div></blockquote>
<p>Let&#8217;s look at some of the key files in the hierarchy and examine
salient features of each, starting first with the
<a class="reference internal" href="#barbecue-time">barbecue-time</a> program because it shows most directly how to
use phyles.</p>
</div>
<div class="section" id="barbecue-time">
<h3>2.7.3. barbecue-time<a class="headerlink" href="#barbecue-time" title="Permalink to this headline">¶</a></h3>
<div class="highlight-python"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre> 1
 2
 3
 4
 5
 6
 7
 8
 9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24
25
26
27
28
29
30
31
32
33
34
35
36
37
38
39
40
41
42
43
44
45
46</pre></div></td><td class="code"><div class="highlight"><pre> <span class="kn">import</span> <span class="nn">sys</span>
 <span class="kn">import</span> <span class="nn">phyles</span>
 <span class="kn">import</span> <span class="nn">barbecue</span>

 <span class="n">__program__</span> <span class="o">=</span> <span class="s">&quot;barbecue-time&quot;</span>
 <span class="n">__version__</span> <span class="o">=</span> <span class="s">&quot;0.1b1&quot;</span>

 <span class="k">def</span> <span class="nf">output_message</span><span class="p">(</span><span class="n">message</span><span class="p">,</span> <span class="n">config</span><span class="p">):</span>
   <span class="n">console_width</span> <span class="o">=</span> <span class="n">phyles</span><span class="o">.</span><span class="n">get_terminal_size</span><span class="p">()[</span><span class="mi">0</span><span class="p">]</span>
   <span class="k">if</span> <span class="n">config</span><span class="p">[</span><span class="s">&#39;width&#39;</span><span class="p">]</span> <span class="o">&gt;</span> <span class="n">console_width</span><span class="p">:</span>
     <span class="n">tplt</span> <span class="o">=</span> <span class="s">&quot;Formatting &#39;width&#39; (</span><span class="si">%s</span><span class="s">) bigger than window (</span><span class="si">%s</span><span class="s">)&quot;</span>
     <span class="n">message</span> <span class="o">=</span> <span class="n">tplt</span> <span class="o">%</span> <span class="p">(</span><span class="n">config</span><span class="p">[</span><span class="s">&#39;width&#39;</span><span class="p">],</span> <span class="n">console_width</span><span class="p">)</span>
     <span class="k">raise</span> <span class="n">barbecue</span><span class="o">.</span><span class="n">FormatError</span><span class="p">(</span><span class="n">message</span><span class="p">)</span>

   <span class="n">message</span> <span class="o">=</span> <span class="n">message</span><span class="o">.</span><span class="n">center</span><span class="p">(</span><span class="n">config</span><span class="p">[</span><span class="s">&#39;width&#39;</span><span class="p">])</span>
   <span class="n">config</span><span class="p">[</span><span class="s">&#39;outlet&#39;</span><span class="p">](</span><span class="n">message</span><span class="p">)</span>

 <span class="k">def</span> <span class="nf">report_cooking</span><span class="p">(</span><span class="n">config</span><span class="p">):</span>
   <span class="n">t</span> <span class="o">=</span> <span class="n">barbecue</span><span class="o">.</span><span class="n">cooking_time</span><span class="p">(</span><span class="n">config</span><span class="p">[</span><span class="s">&#39;doneness&#39;</span><span class="p">],</span>
                             <span class="n">config</span><span class="p">[</span><span class="s">&#39;difficulty&#39;</span><span class="p">],</span>
                             <span class="n">config</span><span class="p">[</span><span class="s">&#39;temperature&#39;</span><span class="p">])</span>

   <span class="n">message</span> <span class="o">=</span> <span class="s">&quot;Cooking time is </span><span class="si">%5.2f</span><span class="s"> hr.&quot;</span> <span class="o">%</span> <span class="n">t</span>
   <span class="n">output_message</span><span class="p">(</span><span class="n">message</span><span class="p">,</span> <span class="n">config</span><span class="p">)</span>

 <span class="k">def</span> <span class="nf">finish_up</span><span class="p">(</span><span class="n">config</span><span class="p">):</span>
   <span class="n">hline</span> <span class="o">=</span> <span class="s">&quot;~&quot;</span> <span class="o">*</span> <span class="p">(</span><span class="n">config</span><span class="p">[</span><span class="s">&#39;width&#39;</span><span class="p">]</span> <span class="o">-</span> <span class="mi">4</span><span class="p">)</span>
   <span class="n">output_message</span><span class="p">(</span><span class="n">hline</span><span class="p">,</span> <span class="n">config</span><span class="p">)</span>
   <span class="n">message</span> <span class="o">=</span> <span class="s">&quot;Done with </span><span class="si">%s</span><span class="s">!&quot;</span> <span class="o">%</span> <span class="n">config</span><span class="p">[</span><span class="s">&#39;dish&#39;</span><span class="p">]</span>
   <span class="n">output_message</span><span class="p">(</span><span class="n">message</span><span class="p">,</span> <span class="n">config</span><span class="p">)</span>
   <span class="n">output_message</span><span class="p">(</span><span class="n">hline</span><span class="p">,</span> <span class="n">config</span><span class="p">)</span>

 <span class="k">def</span> <span class="nf">main</span><span class="p">(</span><span class="n">config</span><span class="p">):</span>
   <span class="n">config</span><span class="p">[</span><span class="s">&#39;difficulty&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">barbecue</span><span class="o">.</span><span class="n">difficulties</span><span class="p">[</span><span class="n">config</span><span class="p">[</span><span class="s">&#39;dish&#39;</span><span class="p">]]</span>
   <span class="n">config</span><span class="p">[</span><span class="s">&#39;outlet&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="k">lambda</span> <span class="n">s</span><span class="p">:</span> <span class="n">sys</span><span class="o">.</span><span class="n">stdout</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="n">s</span> <span class="o">+</span> <span class="s">&quot;</span><span class="se">\n</span><span class="s">&quot;</span><span class="p">)</span>
   <span class="n">report_cooking</span><span class="p">(</span><span class="n">config</span><span class="p">)</span>
   <span class="n">finish_up</span><span class="p">(</span><span class="n">config</span><span class="p">)</span>

 <span class="k">if</span> <span class="n">__name__</span> <span class="o">==</span> <span class="s">&quot;__main__&quot;</span><span class="p">:</span>
   <span class="n">spec</span> <span class="o">=</span> <span class="n">phyles</span><span class="o">.</span><span class="n">package_spec</span><span class="p">(</span><span class="n">phyles</span><span class="o">.</span><span class="n">Undefined</span><span class="p">,</span> <span class="s">&quot;barbecue&quot;</span><span class="p">,</span>
                              <span class="s">&quot;schema&quot;</span><span class="p">,</span> <span class="s">&quot;barbecue-time.yml&quot;</span><span class="p">)</span>
   <span class="n">converters</span> <span class="o">=</span> <span class="p">{</span><span class="s">&#39;celsius to farenheit&#39;</span><span class="p">:</span>
                      <span class="n">barbecue</span><span class="o">.</span><span class="n">celsius_to_farenheit</span><span class="p">}</span>
   <span class="n">setup</span> <span class="o">=</span> <span class="n">phyles</span><span class="o">.</span><span class="n">set_up</span><span class="p">(</span><span class="n">__program__</span><span class="p">,</span> <span class="n">__version__</span><span class="p">,</span> <span class="n">spec</span><span class="p">,</span> <span class="n">converters</span><span class="p">)</span>
   <span class="n">phyles</span><span class="o">.</span><span class="n">run_main</span><span class="p">(</span><span class="n">main</span><span class="p">,</span> <span class="n">setup</span><span class="p">[</span><span class="s">&#39;config&#39;</span><span class="p">],</span>
                   <span class="n">catchall</span><span class="o">=</span><span class="n">barbecue</span><span class="o">.</span><span class="n">BarbecueError</span><span class="p">)</span>
</pre></div>
</td></tr></table></div>
<p>In terms of interacting with phyles, the most critical part of
<a class="reference internal" href="#barbecue-time">barbecue-time</a> is in lines 40-46:</p>
<blockquote>
<div><ul>
<li><dl class="first docutils">
<dt>Lines 40-41</dt>
<dd><p class="first last">The <a class="reference internal" href="phyles-api.html#phyles.package_spec" title="phyles.package_spec"><tt class="xref py py-func docutils literal"><span class="pre">phyles.package_spec()</span></tt></a> function is used to
retrieve the schema from the package.</p>
</dd>
</dl>
</li>
<li><dl class="first docutils">
<dt>Lines 42-43</dt>
<dd><p class="first last">The converters <a class="reference external" href="http://docs.python.org/2/library/stdtypes.html#dict" title="(in Python v2.7)"><tt class="xref py py-class docutils literal"><span class="pre">dict</span></tt></a> is created as in the
section title <a class="reference internal" href="#dictionary-of-converter-functions">Dictionary of Converter Functions</a>.</p>
</dd>
</dl>
</li>
<li><dl class="first docutils">
<dt>Line 44</dt>
<dd><p class="first last">The <a class="reference internal" href="phyles-api.html#phyles.set_up" title="phyles.set_up"><tt class="xref py py-func docutils literal"><span class="pre">phyles.set_up()</span></tt></a> function is used to parse
command line arguments, load the schema from the spec,
validate the config, and override any config setting
from the command line option <tt class="docutils literal"><span class="pre">--override</span></tt> (<tt class="docutils literal"><span class="pre">-o</span></tt>).</p>
</dd>
</dl>
</li>
<li><dl class="first docutils">
<dt>Lines 45-46</dt>
<dd><p class="first last">The <a class="reference internal" href="phyles-api.html#phyles.run_main" title="phyles.run_main"><tt class="xref py py-func docutils literal"><span class="pre">phyles.run_main()</span></tt></a> function is used to run
the main function inside a try-except block that
catches any exceptions assigned by the <tt class="docutils literal"><span class="pre">catchall</span></tt>
keyword argument, and exits gracefully if such
exceptions arise.</p>
</dd>
</dl>
</li>
</ul>
</div></blockquote>
<div class="admonition note">
<p class="first admonition-title">Note</p>
<p class="last">These few lines (40-46), along with specifying a schema,
are all that is truely needed to interface with phyles
and take advantage of the mose useful parts of its
functionality.</p>
</div>
<p>Like any good program, <a class="reference internal" href="#barbecue-time">barbecue-time</a> has a <tt class="xref py py-func docutils literal"><span class="pre">main()</span></tt> function:</p>
<blockquote>
<div><ul>
<li><dl class="first docutils">
<dt>Lines 34-35</dt>
<dd><p class="first last">The <tt class="docutils literal"><span class="pre">config</span></tt> is used as a global state, defining
new items called <tt class="docutils literal"><span class="pre">'difficulty'</span></tt> and <tt class="docutils literal"><span class="pre">'outlet'</span></tt>,
that will be used in other parts of the program.
Such use of a <a class="reference internal" href="phyles-api.html#phyles.Configuration" title="phyles.Configuration"><tt class="xref py py-class docutils literal"><span class="pre">phyles.Configuration</span></tt></a> object
is convenient, but left to the discretion of the
programmer.</p>
</dd>
</dl>
</li>
</ul>
</div></blockquote>
<p>Using a <a class="reference internal" href="phyles-api.html#phyles.Configuration" title="phyles.Configuration"><tt class="xref py py-class docutils literal"><span class="pre">phyles.Configuration</span></tt></a> object allows for
abstraction of functionality that depends on the configuration.</p>
<blockquote>
<div><ul>
<li><dl class="first docutils">
<dt>Line 9</dt>
<dd><p class="first last">The <a class="reference internal" href="phyles-api.html#phyles.get_terminal_size" title="phyles.get_terminal_size"><tt class="xref py py-func docutils literal"><span class="pre">phyles.get_terminal_size()</span></tt></a> function is
used to determine the width of the console.</p>
</dd>
</dl>
</li>
<li><dl class="first docutils">
<dt>Lines 10-13</dt>
<dd><p class="first last">The message width from the config file (keyed by
<tt class="docutils literal"><span class="pre">'width'</span></tt>) is checked against the console width.
If the message width is to large, then a
<tt class="xref py py-class docutils literal"><span class="pre">FormatError</span></tt> exception is raised. As we&#8217;ll
see upon inspection of the file <a class="reference internal" href="#barbecue-py">_barbecue.py</a>,
<tt class="xref py py-class docutils literal"><span class="pre">FormatError</span></tt> is a subclass of
<tt class="xref py py-class docutils literal"><span class="pre">BarbecueError</span></tt>, which is the catchall exception
for graceful exit (see line 45).</p>
</dd>
</dl>
</li>
<li><dl class="first docutils">
<dt>Lines 26-31</dt>
<dd><p class="first">The <tt class="xref py py-func docutils literal"><span class="pre">finish_up()</span></tt> function further demonstrates
the utility of <tt class="xref py py-class docutils literal"><span class="pre">Configuration</span></tt> objects and the
abstraction they allow. Note that the
<tt class="xref py py-func docutils literal"><span class="pre">output_message()</span></tt> function does not care how the
message is displayed&#8211;except that it is unfortunately
tied to the console width. Even this dependencey can
be remedied by further abstraction. For example, <tt class="docutils literal"><span class="pre">config</span></tt>
could have the item:</p>
<div class="highlight-python"><div class="highlight"><pre><span class="n">config</span><span class="p">[</span><span class="s">&#39;canv_width&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="k">lambda</span><span class="p">:</span> <span class="n">phyles</span><span class="o">.</span><span class="n">get_terminal_size</span><span class="p">()[</span><span class="mi">0</span><span class="p">]</span>
</pre></div>
</div>
<p>And then <tt class="xref py py-func docutils literal"><span class="pre">output_message()</span></tt> could be changed
accordingly:</p>
<div class="highlight-python"><div class="highlight"><pre><span class="k">def</span> <span class="nf">output_message</span><span class="p">(</span><span class="n">message</span><span class="p">,</span> <span class="n">config</span><span class="p">):</span>
  <span class="n">max_width</span> <span class="o">=</span> <span class="n">config</span><span class="p">[</span><span class="s">&#39;canv_width&#39;</span><span class="p">]()</span>
  <span class="k">if</span> <span class="n">config</span><span class="p">[</span><span class="s">&#39;width&#39;</span><span class="p">]</span> <span class="o">&gt;</span> <span class="n">max_width</span><span class="p">:</span>
    <span class="n">tplt</span> <span class="o">=</span> <span class="s">&quot;Formatting &#39;width&#39; (</span><span class="si">%s</span><span class="s">) bigger than window (</span><span class="si">%s</span><span class="s">)&quot;</span>
    <span class="n">message</span> <span class="o">=</span> <span class="n">tplt</span> <span class="o">%</span> <span class="p">(</span><span class="n">config</span><span class="p">[</span><span class="s">&#39;width&#39;</span><span class="p">],</span> <span class="n">max_width</span><span class="p">)</span>
    <span class="k">raise</span> <span class="n">barbecue</span><span class="o">.</span><span class="n">FormatError</span><span class="p">(</span><span class="n">message</span><span class="p">)</span>

  <span class="n">message</span> <span class="o">=</span> <span class="n">message</span><span class="o">.</span><span class="n">center</span><span class="p">(</span><span class="n">config</span><span class="p">[</span><span class="s">&#39;width&#39;</span><span class="p">])</span>
  <span class="n">config</span><span class="p">[</span><span class="s">&#39;outlet&#39;</span><span class="p">](</span><span class="n">message</span><span class="p">)</span>
</pre></div>
</div>
<p class="last">Now, since <tt class="docutils literal"><span class="pre">config['canv_width']</span></tt> can
be any function (or &#8220;callable&#8221;), the backend to which the
message is sent can be anything, including a console
or gui element like a <tt class="xref py py-class docutils literal"><span class="pre">Tkinter.Label</span></tt>.</p>
</dd>
</dl>
</li>
</ul>
</div></blockquote>
</div>
<div class="section" id="barbecue-py">
<h3>2.7.4. _barbecue.py<a class="headerlink" href="#barbecue-py" title="Permalink to this headline">¶</a></h3>
<p>The <a class="reference internal" href="#barbecue-py">_barbecue.py</a> file holds the main library code for
the barbecue package.</p>
<div class="highlight-python"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre> 1
 2
 3
 4
 5
 6
 7
 8
 9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24
25
26
27
28
29
30
31
32
33
34
35
36
37
38
39
40
41
42
43
44
45
46
47
48
49
50
51
52
53
54
55
56</pre></div></td><td class="code"><div class="highlight"><pre> <span class="c">#! /usr/bin/env python</span>
 <span class="c"># -*- coding: utf-8 -*-</span>

 <span class="n">difficulties</span> <span class="o">=</span> <span class="p">{</span><span class="s">&#39;vegetable kabobs&#39;</span><span class="p">:</span> <span class="mi">1</span><span class="p">,</span>
                 <span class="s">&#39;smoked salmon&#39;</span><span class="p">:</span> <span class="mi">2</span><span class="p">,</span>
                 <span class="s">&#39;brisket&#39;</span><span class="p">:</span> <span class="mi">3</span><span class="p">}</span>

 <span class="k">class</span> <span class="nc">BarbecueError</span><span class="p">(</span><span class="ne">Exception</span><span class="p">):</span>
   <span class="k">pass</span>

 <span class="k">class</span> <span class="nc">FormatError</span><span class="p">(</span><span class="n">BarbecueError</span><span class="p">):</span>
   <span class="k">pass</span>

 <span class="k">class</span> <span class="nc">TemperatureError</span><span class="p">(</span><span class="n">BarbecueError</span><span class="p">):</span>
   <span class="k">pass</span>

 <span class="k">def</span> <span class="nf">cooking_time</span><span class="p">(</span><span class="n">doneness</span><span class="p">,</span> <span class="n">difficulty</span><span class="p">,</span> <span class="n">T</span><span class="p">):</span>
     <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">     Return the cooking time given the desired doneness</span>
<span class="sd">     cooking, the difficulty of cooking, and the temperature.</span>

<span class="sd">     Args:</span>
<span class="sd">       - doneness: desired doneness (hr•°F/dc)</span>
<span class="sd">       - difficulty: difficulty of cooking for the dish (dc)</span>
<span class="sd">       - T: cooking temperature (°F)</span>

<span class="sd">     Returns: cooking time in hours (float)</span>

<span class="sd">     Raises: ``ValueError`` if the `temperature` is &lt;= 120 °F</span>

<span class="sd">     &gt;&gt;&gt; round(cooking_time(350, 2, 225), 2)</span>
<span class="sd">     3.11</span>
<span class="sd">     &quot;&quot;&quot;</span>
     <span class="k">if</span> <span class="n">T</span> <span class="o">&lt;=</span> <span class="mi">120</span><span class="p">:</span>
       <span class="n">msg</span> <span class="o">=</span> <span class="s">&quot;</span><span class="si">%s</span><span class="s"> °F is too cold to cook!&quot;</span> <span class="o">%</span> <span class="n">T</span>
       <span class="k">raise</span> <span class="n">TemperatureError</span><span class="p">(</span><span class="n">msg</span><span class="p">)</span>
     <span class="k">return</span> <span class="nb">float</span><span class="p">(</span><span class="n">doneness</span> <span class="o">*</span> <span class="n">difficulty</span><span class="p">)</span> <span class="o">/</span> <span class="n">T</span>

 <span class="k">def</span> <span class="nf">celsius_to_farenheit</span><span class="p">(</span><span class="n">c</span><span class="p">):</span>
   <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">   Returns the temperature in Farenheit given temperature</span>
<span class="sd">   in Celsius.</span>

<span class="sd">   Args:</span>
<span class="sd">     - c: temperature in Celsius</span>

<span class="sd">   Returns: temperature in Farenheit (float)</span>

<span class="sd">   &gt;&gt;&gt; celsius_to_farenheit(107.222)</span>
<span class="sd">   224.9996</span>
<span class="sd">   &quot;&quot;&quot;</span>
   <span class="n">c</span> <span class="o">=</span> <span class="nb">float</span><span class="p">(</span><span class="n">c</span><span class="p">)</span>
   <span class="k">if</span> <span class="n">c</span> <span class="o">&lt;</span> <span class="o">-</span><span class="mf">273.15</span><span class="p">:</span>
     <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s">&quot;Impossibly cold (</span><span class="si">%s</span><span class="s"> °C)!&quot;</span> <span class="o">%</span> <span class="n">c</span><span class="p">)</span>
   <span class="k">else</span><span class="p">:</span>
     <span class="k">return</span> <span class="p">(</span><span class="mf">1.8</span> <span class="o">*</span> <span class="n">c</span><span class="p">)</span> <span class="o">+</span> <span class="mi">32</span>
</pre></div>
</td></tr></table></div>
<p>Most of <a class="reference internal" href="#barbecue-py">_barbecue.py</a> documents its functionality. However,
it does have some key parts:</p>
<blockquote>
<div><ul>
<li><dl class="first docutils">
<dt>Line 2</dt>
<dd><p class="first last">This line designates the optional encoding for the file (see
<a class="reference external" href="http://www.python.org/dev/peps/pep-0263/">http://www.python.org/dev/peps/pep-0263/</a>). The UTF-8
encoding allows for display of the ubiquitous units
&#8220;°C&#8221; and &#8220;°F&#8221; in the docstrings and error messages.</p>
</dd>
</dl>
</li>
<li><dl class="first docutils">
<dt>Lines 6-8</dt>
<dd><p class="first">Some data is kept in the module, namely the conversions
from dish to cooking difficulty. If larger amounts of
data are needed, then it is better to include these
as so-called &#8220;package data&#8221; and use the
<tt class="xref py py-func docutils literal"><span class="pre">pkg_resources.resource_string()</span></tt> function from the
<a class="reference external" href="http://pypi.python.org/pypi/distribute">distribute</a> package or, failing that, the
<a class="reference internal" href="phyles-api.html#phyles.get_data_path" title="phyles.get_data_path"><tt class="xref py py-func docutils literal"><span class="pre">phyles.get_data_path()</span></tt></a> function, which tries to
find package data with every trick in the book.</p>
<div class="last admonition note">
<p class="first admonition-title">Note</p>
<p class="last">With proper utilization of <a class="reference external" href="http://goo.gl/9dQEK">python eggs</a>, a
programmer should find that use of the
<tt class="xref py py-func docutils literal"><span class="pre">pkg_resources.resource_string()</span></tt> function
is failsafe.</p>
</div>
</dd>
</dl>
</li>
<li><dl class="first docutils">
<dt>Lines 10-17</dt>
<dd><p class="first">As seen in the <a class="reference internal" href="#barbecue-time">barbecue-time</a> file (lines 45-46), the
<tt class="xref py py-class docutils literal"><span class="pre">BarbecueError</span></tt> is used as a catchall for anticipated
errors, allowing the program to exit gracefully if
any are raised while executing the <tt class="xref py py-func docutils literal"><span class="pre">main()</span></tt> function.</p>
<p>Created here are the <tt class="xref py py-class docutils literal"><span class="pre">BarbecueError</span></tt> and a couple of
decendants, corresponding to problems with formatting
and nonsensical cooking temperatures (lines 34-36).
Since these exceptions are <tt class="xref py py-class docutils literal"><span class="pre">BarbecueError</span></tt>
or inherit from it, then they fall under the catchall
and trigger graceful exit.</p>
<p>.note:</p>
<div class="last highlight-python"><pre>The `catchall` can also be a tuple of exceptions.
See :func:`phyles.run_main`.</pre>
</div>
</dd>
</dl>
</li>
</ul>
</div></blockquote>
</div>
<div class="section" id="manifest-in">
<h3>2.7.5. MANIFEST.in<a class="headerlink" href="#manifest-in" title="Permalink to this headline">¶</a></h3>
<p>To ensure that files get included in source distributions
(i.e. <tt class="docutils literal"><span class="pre">python</span> <span class="pre">setup.py</span> <span class="pre">sdist</span></tt>), it is important to specify
them in <a class="reference internal" href="#manifest-in">MANIFEST.in</a>.</p>
<div class="highlight-console"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre>1
2
3</pre></div></td><td class="code"><div class="highlight"><pre><span class="go">include *.txt</span>
<span class="go">include *.rst</span>
<span class="go">recursive-include barbecue *.yml</span>
</pre></div>
</td></tr></table></div>
<ul class="simple">
<li>Line 3 means to include all files matching the pattern <tt class="docutils literal"><span class="pre">*.yml</span></tt>
in the directory <tt class="docutils literal"><span class="pre">barbecue</span></tt> and all directories therein,
recursively. To ensure these files are installed from the
source distribution, they should also be specified in <a class="reference internal" href="#setup-py">setup.py</a>.</li>
</ul>
</div>
<div class="section" id="setup-py">
<h3>2.7.6. setup.py<a class="headerlink" href="#setup-py" title="Permalink to this headline">¶</a></h3>
<p>The <a class="reference internal" href="#setup-py">setup.py</a> script directs the distribution and installation
of python packages. See
<a class="reference external" href="http://guide.python-distribute.org/creation.html">http://guide.python-distribute.org/creation.html</a> for a complete
discussion.</p>
<p>Below is a partial (acutally, almost complete) listing of
<a class="reference internal" href="#setup-py">setup.py</a> mainly to (1) show the minimal required keyword
arguments and (2) show how to use the following keyword
arguments of the <tt class="xref py py-func docutils literal"><span class="pre">setup()</span></tt> function:</p>
<blockquote>
<div><ul class="simple">
<li><tt class="docutils literal"><span class="pre">packages</span></tt></li>
<li><tt class="docutils literal"><span class="pre">include_package_data</span></tt></li>
<li><tt class="docutils literal"><span class="pre">package_data</span></tt></li>
<li><tt class="docutils literal"><span class="pre">scripts</span></tt></li>
</ul>
</div></blockquote>
<div class="highlight-python"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre> 1
 2
 3
 4
 5
 6
 7
 8
 9
10
11
12
13
14
15
16
17
18
19
20
21</pre></div></td><td class="code"><div class="highlight"><pre> <span class="kn">import</span> <span class="nn">os</span>
 <span class="kn">import</span> <span class="nn">glob</span>

 <span class="kn">from</span> <span class="nn">setuptools</span> <span class="kn">import</span> <span class="n">setup</span><span class="p">,</span> <span class="n">find_packages</span>

 <span class="n">setup</span><span class="p">(</span><span class="n">name</span><span class="o">=</span><span class="s">&#39;barbecue&#39;</span><span class="p">,</span>
       <span class="n">version</span><span class="o">=</span><span class="s">&#39;0.1b1&#39;</span><span class="p">,</span>
       <span class="n">author</span><span class="o">=</span><span class="s">&#39;James C. Stroud&#39;</span><span class="p">,</span>
       <span class="n">author_email</span><span class="o">=</span><span class="s">&#39;jstroud@mbi.ucla.edu&#39;</span><span class="p">,</span>
       <span class="n">description</span><span class="o">=</span><span class="s">&#39;Utilities for cooking barbecue.&#39;</span><span class="p">,</span>
       <span class="n">url</span><span class="o">=</span><span class="s">&#39;http://phyles.bravais.net/barbecue&#39;</span><span class="p">,</span>
       <span class="n">classifiers</span> <span class="o">=</span><span class="p">[</span>
               <span class="s">&#39;Programming Language :: Python :: 2&#39;</span><span class="p">,</span>
          <span class="p">],</span>
       <span class="n">install_requires</span><span class="o">=</span><span class="p">[</span><span class="s">&quot;distribute&quot;</span><span class="p">,</span> <span class="s">&quot;phyles &gt;= 0.2.0&quot;</span><span class="p">],</span>
       <span class="n">license</span><span class="o">=</span><span class="s">&#39;LICENSE.txt&#39;</span><span class="p">,</span>
       <span class="n">long_description</span><span class="o">=</span><span class="nb">open</span><span class="p">(</span><span class="s">&#39;README.rst&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">read</span><span class="p">(),</span>
       <span class="n">packages</span><span class="o">=</span><span class="n">find_packages</span><span class="p">(),</span>
       <span class="n">include_package_data</span><span class="o">=</span><span class="bp">True</span><span class="p">,</span>
       <span class="n">package_data</span><span class="o">=</span><span class="p">{</span><span class="s">&#39;&#39;</span><span class="p">:</span> <span class="p">[</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="s">&#39;*&#39;</span><span class="p">,</span> <span class="s">&#39;*.yml&#39;</span><span class="p">)]},</span>
       <span class="n">scripts</span><span class="o">=</span><span class="n">glob</span><span class="o">.</span><span class="n">glob</span><span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="s">&#39;bin&#39;</span><span class="p">,</span> <span class="s">&#39;*&#39;</span><span class="p">)))</span>
</pre></div>
</td></tr></table></div>
<ul>
<li><dl class="first docutils">
<dt><tt class="docutils literal"><span class="pre">packages</span></tt> &#8211; line 18</dt>
<dd><p class="first last">It is notable that the keyword argument <tt class="docutils literal"><span class="pre">package_dir</span></tt>
is not required, nor is it necessary to specify the
package manually names because they are found automatically
by <tt class="xref py py-func docutils literal"><span class="pre">distribute.find_packages()</span></tt> imported on
line 4. Here, <tt class="docutils literal"><span class="pre">find_packages()</span></tt> evaluates to
<tt class="docutils literal"><span class="pre">['barbecue']</span></tt>.</p>
</dd>
</dl>
</li>
<li><dl class="first docutils">
<dt><tt class="docutils literal"><span class="pre">include_package_data</span></tt> &#8211; line 19</dt>
<dd><p class="first last">This keyword argument ensures that the files found
by the <tt class="docutils literal"><span class="pre">package_data</span></tt> keyword argument will be included
upon installation (not just packaging for distribution).</p>
</dd>
</dl>
</li>
<li><dl class="first docutils">
<dt><tt class="docutils literal"><span class="pre">package_data</span></tt> &#8211; line 20</dt>
<dd><p class="first">The empty string (<tt class="docutils literal"><span class="pre">''</span></tt>) means to include files that
match the corresponding patterns (<tt class="docutils literal"><span class="pre">['*/*.yml']</span></tt> for
unix-like systems) for <strong>all</strong> packages listed for the
<tt class="docutils literal"><span class="pre">packages</span></tt> keyword argument. Here, these packages are
found automatically.  In this barbecue example
<tt class="docutils literal"><span class="pre">{'':</span> <span class="pre">[os.path.join('*',</span> <span class="pre">'*.yml')]}</span></tt> matches
<tt class="docutils literal"><span class="pre">barbecue/schema/barbecue-time.yml</span></tt>.</p>
<p>Thus, the pattern <tt class="docutils literal"><span class="pre">os.path.join('*',</span> <span class="pre">'*.yml')</span></tt> means to
match every file ending with <tt class="docutils literal"><span class="pre">.yml</span></tt> in every sub-directory
of the <strong>package</strong> directory (containing the <tt class="docutils literal"><span class="pre">__init__.py</span></tt>
file; here <tt class="docutils literal"><span class="pre">barbecue</span></tt>). In other words, the pattern is
matched as if it were evaluated from the package directory
that contains the <tt class="docutils literal"><span class="pre">__init__.py</span></tt> file.</p>
<p>A simple way to check what the pattern will match is
to change to the package directory and then
execute the <tt class="docutils literal"><span class="pre">ls</span></tt> command with the pattern, as in
the final command here:</p>
<div class="last highlight-shell-session"><div class="highlight"><pre><span class="gp">[command@prompt]%</span> ls barbecue/
<span class="go">__init__.py  _barbecue.py  schema</span>
<span class="gp">[command@prompt]%</span> <span class="nb">cd </span>barbecue/
<span class="gp">[command@prompt]%</span> ls schema/
<span class="go">barbecue-time.yml</span>
<span class="gp">[command@prompt]%</span> ls */*.yml
<span class="go">schema/barbecue-time.yml</span>
</pre></div>
</div>
</dd>
</dl>
</li>
<li><dl class="first docutils">
<dt><tt class="docutils literal"><span class="pre">scripts</span></tt> &#8211; line 21</dt>
<dd><p class="first last">The value to <tt class="docutils literal"><span class="pre">scripts</span></tt> says to include all files
(<tt class="docutils literal"><span class="pre">'*'</span></tt>) in the <tt class="docutils literal"><span class="pre">bin</span></tt> directory, using the
<a class="reference external" href="http://docs.python.org/2/library/glob.html#glob.glob" title="(in Python v2.7)"><tt class="xref py py-func docutils literal"><span class="pre">glob.glob()</span></tt></a> function from the python standard
library, imported on line 2.  Here,
<tt class="docutils literal"><span class="pre">glob.glob(os.path.join('bin',</span> <span class="pre">'*'))</span></tt> evaluates to
<tt class="docutils literal"><span class="pre">[barbecue-time]</span></tt>.</p>
</dd>
</dl>
</li>
</ul>
</div>
</div>
<div class="section" id="phyles-and-entry-points">
<h2>2.8. Phyles and Entry Points<a class="headerlink" href="#phyles-and-entry-points" title="Permalink to this headline">¶</a></h2>
<p>Compared to <tt class="docutils literal"><span class="pre">scripts</span></tt>, a more robust way to implement programs
from a python package is to use <a class="reference external" href="http://goo.gl/Ss8dr">entry points</a>, which are
perfectly compatible with phyles:</p>
<blockquote>
<div><ul>
<li><p class="first">somewhere in <strong>setup.py</strong></p>
<blockquote>
<div><div class="highlight-python"><div class="highlight"><pre><span class="c"># somewhere in call to setuptools.setup()</span>
<span class="n">entry_points</span> <span class="o">=</span> <span class="p">{</span>
   <span class="s">&#39;console_scripts&#39;</span> <span class="p">:</span> <span class="p">[</span>
      <span class="s">&#39;some_program = my_package:_some_program&#39;</span><span class="p">]}</span>
</pre></div>
</div>
</div></blockquote>
</li>
<li><p class="first">somewhere in <strong>__init__.py</strong></p>
<blockquote>
<div><div class="highlight-python"><div class="highlight"><pre><span class="kn">from</span> <span class="nn">_my_module</span> <span class="kn">import</span> <span class="n">_some_program</span>
</pre></div>
</div>
</div></blockquote>
</li>
<li><p class="first">somewhere in <strong>_my_module.py</strong></p>
<blockquote>
<div><div class="highlight-python"><div class="highlight"><pre><span class="k">class</span> <span class="nc">AnticipatedError</span><span class="p">(</span><span class="ne">Exception</span><span class="p">):</span>
  <span class="k">pass</span>

<span class="k">def</span> <span class="nf">some_function</span><span class="p">(</span><span class="n">config</span><span class="p">):</span>
  <span class="c"># do stuff with config,</span>
  <span class="c"># interact with user, produce output,</span>
  <span class="c"># raise AnticipatedError when appropriate, etc.</span>
  <span class="o">...</span>

<span class="k">def</span> <span class="nf">_some_program</span><span class="p">():</span>
  <span class="n">spec</span> <span class="o">=</span> <span class="s">&quot;&quot;&quot;</span>
<span class="s">         !!omap</span>
<span class="s">         - param1 : [str, example 1, parameter 1]</span>
<span class="s">         - param2 : [int, 42, parameter 2]</span>
<span class="s">         &quot;&quot;&quot;</span>
  <span class="n">setup</span> <span class="o">=</span> <span class="n">phyles</span><span class="o">.</span><span class="n">set_up</span><span class="p">(</span><span class="s">&#39;some_program&#39;</span><span class="p">,</span> <span class="s">&#39;0.1.0&#39;</span> <span class="n">spec</span><span class="p">)</span>
  <span class="n">phyles</span><span class="o">.</span><span class="n">run_main</span><span class="p">(</span><span class="n">some_function</span><span class="p">,</span> <span class="n">setup</span><span class="p">[</span><span class="s">&#39;config&#39;</span><span class="p">],</span>
                           <span class="n">catchall</span><span class="o">=</span><span class="n">AnticipatedError</span><span class="p">)</span>
</pre></div>
</div>
<div class="admonition note">
<p class="first admonition-title">Note</p>
<p class="last">As in the barbecue example, the specification
(<tt class="docutils literal"><span class="pre">spec</span></tt>) is probably better included as a
separate file in the package data.</p>
</div>
</div></blockquote>
</li>
</ul>
</div></blockquote>
<p class="rubric">Footnotes</p>
<table class="docutils footnote" frame="void" id="alg" rules="none">
<colgroup><col class="label" /><col /></colgroup>
<tbody valign="top">
<tr><td class="label"><a class="fn-backref" href="#id1">[1]</a></td><td>The rule of algebra used here can be stated like this:
if a quantity is on top of the fraction on one side of
the equals sign, then it can be moved to the bottom of the
fraction on the other side of the equals sign,
and vice versa.</td></tr>
</tbody>
</table>
<table class="docutils footnote" frame="void" id="hitch" rules="none">
<colgroup><col class="label" /><col /></colgroup>
<tbody valign="top">
<tr><td class="label">[2]</td><td><em>(<a class="fn-backref" href="#id2">1</a>, <a class="fn-backref" href="#id3">2</a>, <a class="fn-backref" href="#id4">3</a>, <a class="fn-backref" href="#id5">4</a>)</em> <a class="reference external" href="http://guide.python-distribute.org/creation.html">http://guide.python-distribute.org/creation.html</a></td></tr>
</tbody>
</table>
</div>
</div>


          </div>
        </div>
      </div>
      <div class="sphinxsidebar">
        <div class="sphinxsidebarwrapper">
  <h3><a href="index.html">Table Of Contents</a></h3>
  <ul>
<li><a class="reference internal" href="#">2. Tutorial</a><ul>
<li><a class="reference internal" href="#the-calculation">2.1. The Calculation</a></li>
<li><a class="reference internal" href="#the-config-format">2.2. The Config Format</a></li>
<li><a class="reference internal" href="#conversion">2.3. Conversion</a><ul>
<li><a class="reference internal" href="#dictionary-based-conversion">2.3.1. Dictionary-Based Conversion</a></li>
<li><a class="reference internal" href="#type-based-conversion">2.3.2. Type-Based Conversion</a></li>
<li><a class="reference internal" href="#conversion-by-user-defined-functions">2.3.3. Conversion by User-Defined Functions</a></li>
<li><a class="reference internal" href="#choices">2.3.4. Choices</a></li>
</ul>
</li>
<li><a class="reference internal" href="#the-schema-specification">2.4. The Schema Specification</a><ul>
<li><a class="reference internal" href="#example-schema-specification">2.4.1. Example Schema Specification</a></li>
<li><a class="reference internal" href="#required-elements-of-a-specification">2.4.2. Required Elements of a Specification</a></li>
<li><a class="reference internal" href="#dictionary-of-converter-functions">2.4.3. Dictionary of Converter Functions</a></li>
<li><a class="reference internal" href="#phyles-standard-converters">2.4.4. Phyles Standard Converters</a></li>
<li><a class="reference internal" href="#list-optional-converters">2.4.5. List-Optional Converters</a></li>
<li><a class="reference internal" href="#optional-default-values">2.4.6. Optional Default Values</a></li>
</ul>
</li>
<li><a class="reference internal" href="#the-schema">2.5. The Schema</a><ul>
<li><a class="reference internal" href="#loading-schema">2.5.1. Loading Schema</a></li>
<li><a class="reference internal" href="#validating-configs">2.5.2. Validating Configs</a></li>
<li><a class="reference internal" href="#creating-a-sample-config">2.5.3. Creating a Sample Config</a></li>
</ul>
</li>
<li><a class="reference internal" href="#the-configuration">2.6. The Configuration</a></li>
<li><a class="reference internal" href="#example-utility">2.7. Example Utility</a><ul>
<li><a class="reference internal" href="#running-the-example">2.7.1. Running the Example</a></li>
<li><a class="reference internal" href="#barbecue-example-directory-structure">2.7.2. Barbecue Example Directory Structure</a></li>
<li><a class="reference internal" href="#barbecue-time">2.7.3. barbecue-time</a></li>
<li><a class="reference internal" href="#barbecue-py">2.7.4. _barbecue.py</a></li>
<li><a class="reference internal" href="#manifest-in">2.7.5. MANIFEST.in</a></li>
<li><a class="reference internal" href="#setup-py">2.7.6. setup.py</a></li>
</ul>
</li>
<li><a class="reference internal" href="#phyles-and-entry-points">2.8. Phyles and Entry Points</a></li>
</ul>
</li>
</ul>

  <h4>Previous topic</h4>
  <p class="topless"><a href="intro.html"
                        title="previous chapter">1. Introduction to Phyles</a></p>
  <h4>Next topic</h4>
  <p class="topless"><a href="phyles-api.html"
                        title="next chapter">3. Phyles API</a></p>
  <h3>This Page</h3>
  <ul class="this-page-menu">
    <li><a href="_sources/tutorial.txt"
           rel="nofollow">Show Source</a></li>
  </ul>
<div id="searchbox" style="display: none">
  <h3>Quick search</h3>
    <form class="search" action="search.html" method="get">
      <input type="text" name="q" />
      <input type="submit" value="Go" />
      <input type="hidden" name="check_keywords" value="yes" />
      <input type="hidden" name="area" value="default" />
    </form>
    <p class="searchtip" style="font-size: 90%">
    Enter search terms or a module, class or function name.
    </p>
</div>
<script type="text/javascript">$('#searchbox').show(0);</script>
        </div>
      </div>
      <div class="clearer"></div>
    </div>
    <div class="related">
      <h3>Navigation</h3>
      <ul>
        <li class="right" style="margin-right: 10px">
          <a href="genindex.html" title="General Index"
             >index</a></li>
        <li class="right" >
          <a href="py-modindex.html" title="Python Module Index"
             >modules</a> |</li>
        <li class="right" >
          <a href="phyles-api.html" title="3. Phyles API"
             >next</a> |</li>
        <li class="right" >
          <a href="intro.html" title="1. Introduction to Phyles"
             >previous</a> |</li>
        <li><a href="index.html">phyles 0.2.16 documentation</a> &raquo;</li> 
      </ul>
    </div>
    <div class="footer">
        &copy; Copyright Copyright (c) 2013, James C. Stroud; All rights reserved..
      Created using <a href="http://sphinx.pocoo.org/">Sphinx</a> 1.2pre.
    </div>
  </body>
</html>