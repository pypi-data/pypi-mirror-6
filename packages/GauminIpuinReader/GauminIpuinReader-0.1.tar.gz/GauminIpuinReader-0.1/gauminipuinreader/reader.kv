#:kivy 1.0.9

<Button>:
    background_color: 0.98,0.92,0.46,0.5

<MenuDropDown>:
    auto_width: False

    Button:
        text: "Ipuina kargatu"
        on_release: root.select("load")
        size_hint_y: None
        height: 40
    Button:
        text: "Hasierara joan"
        on_release: root.select("start")
        size_hint_y: None
        height: 40
    Button:
        text: "Honi buruz"
        on_release: root.select("about")
        size_hint_y: None
        height: 40
    Button:
        text: "Irten"
        on_release: app.stop()
        size_hint_y: None
        height: 40

<LoadIpuinWidget>:
    name: "load"

    BoxLayout:
        orientation: "vertical"

        canvas.before:
            Color:
                rgb: 0.5,0.5,0.5
            Rectangle:
                pos: root.pos
                size: root.size

        Label:
            text: "Aukeratu irakurri nahi duzun liburua"
            size_hint: 1, 0.1

        FileChooserListView:
            id: filechooser
            path: "."
            filters: ["*.ipuin"]

        BoxLayout:
            size_hint: 1, 0.1
            orientation: "horizontal"

            Button:
                text: "Kargatu"
                on_release: root.load_ipuin(filechooser.path, filechooser.selection)

            Button:
                text: "Ezeztatu"
                on_release: root.manager.current = "cover"

<StepWidget>:
    targets: targets
    img: image
    container: container

    name: "step"

    BoxLayout:
        id: container
        orientation: "vertical"

        Image:
            id: image
            source: "imgs/gaumin_logo.png"
            size_hint: (1, 0.3) if root.has_image else (1,0)

        RstDocument:
            text: root.rsttext
            size_hint: 1, 0.6

        BoxLayout:
            id: targets
            orientation: "horizontal"
            size_hint: 1, 0.1

<ReaderWidget>:
    step: step
    screenmanager: screenmanager

    orientation: "vertical"

    canvas.before:
        Color:
            rgb: 1,1,1
        Rectangle:
            pos: root.pos
            size: root.size

    BoxLayout:
        id: header
        orientation: "horizontal"
        size_hint: 1, 0.1

        canvas.before:
            Color:
                rgba: 0.98,0.92,0.46,0.5
            Rectangle:
                pos: header.pos
                size: header.size

        Button:
            id: menu_button
            size_hint: 0.1, 1
            on_release: root.open_menu(*args)

            Image:
                source:  "imgs/menu.png"
                pos: menu_button.pos
                size: menu_button.size

        Label:
            text: root.title
            color: 0,0,0,1

    ScreenManager:
        id: screenmanager

        LoadIpuinWidget:
            on_choose: root.load_ipuin(args[1])

        StepWidget:
            id: step
            ipuin: root.ipuin
            stepname: root.stepname

        Screen:
            name: "cover"

            BoxLayout:
                orientation: "vertical"

                Image:
                    source: root.cover
                    size_hint: 1, 0.6

                RstDocument:
                    text: root.ipuin_info
                    size_hint: 1, 0.3

                Button:
                    text: "Irakurri"
                    size_hint: 1, 0.1
                    on_release: root.start_reading()

        Screen:
            name: "about"

            BoxLayout:
                orientation: "vertical"

                RstDocument:
                    size_hint: 1, 0.8
                    text: root.about

                BoxLayout:
                    size_hint: 1, 0.2
                    orientation: "horizontal"

                    Image:
                        source: 'imgs/gisa_logo.png'
                    Image:
                        source: 'imgs/gaumin_logo.png'
                    Image:
                        source: 'imgs/ej_logo.png'
