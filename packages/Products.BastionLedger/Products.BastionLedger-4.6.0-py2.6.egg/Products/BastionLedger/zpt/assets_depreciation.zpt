<html tal:replace="structure context/manage_page_header"/>


      <span tal:replace="structure context/manage_tabs"/>

      <br/>
      <form action="" tal:attributes="action request/URL1" method="post"
            tal:define="date_range request/date_range | python: (DateTime()-365, DateTime())">

       <span class="form-label">From</span>
       <input type="text" class="form-element" size="12" name="date_range:list:date" value=""
              tal:attributes="value python: date_range[0].strftime('%Y/%m/%d')"/>
       &nbsp;&nbsp;&nbsp;
       <span class="form-label">To</span>
       <input type="text" class="form-element" size="12" name="date_range:list:date" value=""
              tal:attributes="value python: date_range[1].strftime('%Y/%m/%d')"/>
       <input class="form-element" type="submit" name="manage_depreciation" value=" Calculate "/>

       <table border="0" cellpadding="2" cellspacing="0" width="100%">
           <tr class="list-header">
               <td width="25"  class="list-item">Type</td>
               <td class="list-item">Name</td>
               <td class="list-item">Cost to Date</td>
               <td class="list-item">Deprec to Date</td>
               <td class="list-item">Deprec Method</td>
               <td class="list-item">Depreciation</td>
               <td class="list-item">Book Value</td>
     	       <td class="list-item">&nbsp;</td>
           </tr>
           <tal:block tal:repeat="item python: context.objectValues('BLAsset')">
               <tr class="row-hilite"
                   tal:define="depreciation python: item.depreciation(date_range);
                               totalCost item/totalCost;
                               bookValue python: totalCost - item.depreciation_to_date - depreciation"
                   tal:attributes="class python: repeat['item'].index % 2 and 'row-normal' or 'row-hilite'">
                   <td class="list-item">
                      <a href="" tal:attributes="href string:${item/getId}/manage_workspace" tal:on-error="string:">
                          <img src="" alt="" border="0"
                               tal:attributes="src string:${request/BASEPATH1}/${item/icon}; alt item/meta_type"/>
                      </a>
                   </td>
                   <td class="list-item">
                       <a href="" tal:attributes="href string:${item/getId}/manage_workspace" tal:on-error="string:" tal:content="item/title_or_id"/>
                   </td>
                   <td class="list-item" tal:content="item/totalCost"/>
                   <td class="list-item" tal:content="item/depreciation_to_date"/>
                   <td class="list-item" tal:content="item/depreciation_method"/>
                   <td class="list-item" tal:content="depreciation"/>
                   <td class="list-item" tal:content="bookValue"/>
                   <td class="list-item">&nbsp;</td>
               </tr>
           </tal:block>
         </table>

         <br/>
         <br/>
         <div class="form-label">Depreciation Transaction</div>
         <table tal:define="dep_amt python: context.depreciationAmount(date_range)">
            <tr>
                 <td class="list-item">
                    <img src="misc_/BastionLedger/blentry"/>
                 </td>
                 <td class="list-item"
                     tal:define="dep_exp python: context.Ledger.accountValues(tags='dep_exp')[0]"
                     tal:content="dep_exp/prettyTitle"/>
                 <td class="list-item" tal:content="dep_amt"/>
                 <td class="list-item"/>
            </tr>
            <tr>
                 <td class="list-item">
                     <img src="misc_/BastionLedger/blentry">
                 </td>
                 <td class="list-item" 
                     tal:define="dep_exp python: context.Ledger.accountValues(tags='accum_dep')[0]"
                     tal:content="dep_exp/prettyTitle"/>
                 <td class="list-item"/>
                 <td class="list-item" tal:content="dep_amt"/>
            </tr>
            <tr>
                 <td colspan="4">
                     <input class="form-element" type="submit" 
                            name="manage_applyDepreciation:method" value=" Post "/>
                 </td>
            </tr>
         </table>

      </form>


<html tal:replace="structure context/manage_page_footer"/>




