<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html tal:omit-tag=""
  lang="en"
  xml:lang="en"
  xmlns="http://www.w3.org/1999/xhtml"
  xmlns:metal="http://xml.zope.org/namespaces/metal"
  xmlns:tal="http://xml.zope.org/namespaces/tal"
  xmlns:i18n="http://xml.zope.org/namespaces/i18n"
  i18n:domain="silva"
  tal:define="    here python: context.edit;"
>

<metal:block use-macro="python: context.edit['macro_no_tabs'].macros['master']">
 <link type="text/css" rel="stylesheet"
   metal:fill-slot="extension_css"
   tal:attributes="href here/kupustyles.css/absolute_url" />

 <metal:block fill-slot="script">
   <tal:resource tal:replace="structure provider:resources" />
  <metal:macro use-macro="context/service_kupu_silva/kupupopup/macros/jsincludes" />
  <script type="text/javascript">
   onload_registry.register(function() {
      var settings = window.opener.kupu_settings;
      var doc = window.document;
      /* hide buttons */
      var buttons = settings[0];
      for (var i=0; i < buttons.length; i++) {
        var bname = buttons[i];
        var b = doc.getElementById(bname);
        b.style.display = 'none';
      }
      /* hide tools */
      var toolboxes = settings[2];
      for (var i=0; i < toolboxes.length; i++) {
        var tname = toolboxes[i];
        var t = doc.getElementById(tname);
        if (t != undefined) {
          t.style.display = 'none';
        }
      }
      /* hide text styles */
      var styles = settings[1];
      var tbstyles = doc.getElementById('kupu-tb-styles');
      for (var i=0; i < styles.length; i++) {
        for (var j=0; j < tbstyles.options.length; j++) {
          if (tbstyles.options[j].value == styles[i]) {
            tbstyles.options[j].parentNode.removeChild(tbstyles.options[j])
            break;
          }
        }
      }
      var optgroups = tbstyles.getElementsByTagName('optgroup');
      var i = 0;
      while (1) {
        if (optgroups.length == 0 || i >= optgroups.length) break;
        var optgroup = optgroups[i];
        var items = optgroup.getElementsByTagName('option');
        if (items.length == 0) {
          optgroup.parentNode.removeChild(optgroup);
        } else {
          i++;
        }
      }
      /* re-select the first visible option and trigger the onchange,
         as the first option may have changed (i.e. been removed) */
      /* this may change the the text style of the block where the
        cursor is, so ONLY do this if the document is empty! */
      var htmlbody = kupu.getHTMLBody()
      /* in IE htmlbody is an empty string, but in FF3 htmlbody
         is a <br>.  Go figure */
      if (htmlbody == unescape('%3Cbr%3E') || htmlbody == '') {
        if (document.createEvent) {
          var changeEvent =   document.createEvent('HTMLEvents');
          changeEvent.initEvent('change',true,true)
          tbstyles.dispatchEvent(changeEvent);
        } else if (tbstyles.fireEvent) {
          tbstyles.fireEvent('onchange');
        }
      }
   });
  </script>
</metal:block>

<metal:fill fill-slot="main"
   tal:define="silva_permissions context/edit/get_silva_permissions;">
  <metal:macro use-macro="context/service_kupu_silva/kupupopup/macros/body" />
 </metal:fill>

</metal:block>
</html>
