

<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN"
  "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">


<html xmlns="http://www.w3.org/1999/xhtml">
  <head>
    <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
    
    <title>radialx Documentation &mdash; radialx 0.7.2 documentation</title>
    
    <link rel="stylesheet" href="_static/default.css" type="text/css" />
    <link rel="stylesheet" href="_static/pygments.css" type="text/css" />
    
    <script type="text/javascript">
      var DOCUMENTATION_OPTIONS = {
        URL_ROOT:    '',
        VERSION:     '0.7.2',
        COLLAPSE_INDEX: false,
        FILE_SUFFIX: '.html',
        HAS_SOURCE:  true
      };
    </script>
    <script type="text/javascript" src="_static/jquery.js"></script>
    <script type="text/javascript" src="_static/underscore.js"></script>
    <script type="text/javascript" src="_static/doctools.js"></script>
    <link rel="top" title="radialx 0.7.2 documentation" href="#" /> 
  </head>
  <body>
    <div class="related">
      <h3>Navigation</h3>
      <ul>
        <li class="right" style="margin-right: 10px">
          <a href="genindex.html" title="General Index"
             accesskey="I">index</a></li>
        <li><a href="#">radialx 0.7.2 documentation</a> &raquo;</li> 
      </ul>
    </div>  

    <div class="document">
      <div class="documentwrapper">
        <div class="bodywrapper">
          <div class="body">
            
  <div class="section" id="radialx-documentation">
<h1>radialx Documentation<a class="headerlink" href="#radialx-documentation" title="Permalink to this headline">¶</a></h1>
<div class="section" id="introduction">
<h2>Introduction<a class="headerlink" href="#introduction" title="Permalink to this headline">¶</a></h2>
<p>RadialX is a python package for working with x-ray
powder diffraction data and for simulating
x-ray powder diffraction patterns from models.</p>
<p>The most complete documentation is available at
<a class="reference external" href="http://pythonhosted.org/radialx/">http://pythonhosted.org/radialx/</a>.</p>
<div class="section" id="documented-functionalities">
<h3>Documented Functionalities<a class="headerlink" href="#documented-functionalities" title="Permalink to this headline">¶</a></h3>
<p>At present, the only documented functionalities of RadialX are</p>
<ol class="arabic simple">
<li>The simulation of powder diffraction patterns
from PDB files using the utility called <strong>powderx</strong>.</li>
<li>Displaying of diffraction image header information
using the utility called <strong>headerx</strong>.</li>
</ol>
<p>Detailed usage for <a class="reference internal" href="#powderx">powderx</a> and <a class="reference internal" href="#headerx">headerx</a> are below.</p>
</div>
<div class="section" id="undocumented-functionalities">
<h3>Undocumented Functionalities<a class="headerlink" href="#undocumented-functionalities" title="Permalink to this headline">¶</a></h3>
<p>Other, undocumented, functionalities correspond to &#8220;modes&#8221; of the
utility called <strong>profilex</strong>:</p>
<ul class="simple">
<li><em>centering</em> mode: Finding the centers of powder diffraction images
in <a class="reference external" href="http://www.scripps.edu/~arvai/adxv.html">adxv</a> binary format.</li>
<li><em>averaging</em> mode: Radial integration of one or
more experimental powder diffraction patterns in <a class="reference external" href="http://www.scripps.edu/~arvai/adxv.html">adxv</a> binary format.</li>
<li><em>averaging</em> mode: Scaling of several powder experimental or simulated
diffraction patterns to a single experimental or simulated pattern.</li>
<li><em>difference</em> mode: Calculating the difference of two scaled
radially integrated experimental powder diffraction patterns.</li>
</ul>
<p>Although <strong>profilex</strong> is fully functional and heavily tested, its
user interface (i.e. config file format, etc.) is very likely to
change. For example, the modes will probably be split into different
different utilities and several config file parameters will
probably be renamed.</p>
<p>It is hoped that the entire RadialX package
will be fully documented soon.</p>
</div>
</div>
<div class="section" id="home-page-repository">
<h2>Home Page &amp; Repository<a class="headerlink" href="#home-page-repository" title="Permalink to this headline">¶</a></h2>
<p>Home Page: <a class="reference external" href="https://pypi.python.org/pypi/radialx/">https://pypi.python.org/pypi/radialx/</a></p>
<p>Documentation: <a class="reference external" href="http://pythonhosted.org/radialx/">http://pythonhosted.org/radialx/</a></p>
<p>Repository: <a class="reference external" href="https://github.com/jcstroud/radialx">https://github.com/jcstroud/radialx</a></p>
</div>
<div class="section" id="installation">
<h2>Installation<a class="headerlink" href="#installation" title="Permalink to this headline">¶</a></h2>
<div class="section" id="dependencies">
<h3>Dependencies<a class="headerlink" href="#dependencies" title="Permalink to this headline">¶</a></h3>
<div class="section" id="pip-setuptools">
<h4>pip &amp; setuptools<a class="headerlink" href="#pip-setuptools" title="Permalink to this headline">¶</a></h4>
<p>The installation of RadialX and many other python packages will
be made easier by <a class="reference external" href="https://pypi.python.org/pypi/pip">pip</a>. So, before going any further towards
installation, it is advisable to follow the
<a class="reference external" href="http://www.pip-installer.org/en/latest/installing.html">pip installation instructions</a>, including the
installation of setuptools described therein.
Setuptools is essential to pip.</p>
</div>
<div class="section" id="cctbx">
<h4>CCTBX<a class="headerlink" href="#cctbx" title="Permalink to this headline">¶</a></h4>
<p>At this point the <a class="reference external" href="http://cctbx.sourceforge.net/">CCTBX package</a> is <em>only</em> needed to
simulate powder diffraction patterns with the <strong>powderx</strong> utility.</p>
<p>For <strong>powderx</strong>, it will be necessary to have the full CCTBX package installed
and the <tt class="docutils literal"><span class="pre">cctbx.python</span></tt> executable in your path. <a class="reference external" href="http://cci.lbl.gov/cctbx_build/">Downloads are available</a>
for numerous operating systems, including Mac OS X, Windows 7 &amp; XP, and
several flavors of Linux. Additionally, it is possible to build
CCTBX from a source bundle or, for the more ambitious,
the SVN repository at sourceforge.</p>
<p>Because of the unusual python interpreter behavior forced by
the cctbx.python executable,
it is necessary to have all dependencies (except CCTBX itself)
installed both to the <tt class="docutils literal"><span class="pre">cctbx.python</span></tt> interpreter and to a system python
interpreter (e.g. at <tt class="docutils literal"><span class="pre">/usr/local/bin/python</span></tt>).</p>
<p>The difficulty here might be in using pip with CCTBX if
you are using one of the pre-built CCTBX distributions
called &#8220;cctbx+Python&#8221; or &#8220;cctbx plus&#8221;,
wherein the CCTBX distribution python
will be different from your system python.</p>
<p>One way to overcome this difficulty is simply to install all of the
packages twice, once to the CCTBX python
and once to the system python.</p>
<p>Installing to the system python interpreter is easy with pip.
For example, to install the <a class="reference external" href="https://pypi.python.org/pypi/pyfscache/">pyfscache</a> package:</p>
<div class="highlight-python"><pre>% sudo pip install pyfscache</pre>
</div>
<p>Note that &#8220;<tt class="docutils literal"><span class="pre">%</span></tt>&#8221; is the prompt and is not actually typed.</p>
<p>For the CCTBX python, things are slightly more complicated. First, when
following the <a class="reference external" href="http://www.pip-installer.org/en/latest/installing.html">pip installation instructions</a>, use <tt class="docutils literal"><span class="pre">cctbx.python</span></tt>
with <tt class="docutils literal"><span class="pre">ez_setup.py</span></tt> and <tt class="docutils literal"><span class="pre">get-pip.py</span></tt>. For example:</p>
<div class="highlight-python"><pre>% sudo cctbx.python ez_setup.py
% sudo cctbx.python get-pip.py</pre>
</div>
<p>Once this latter command completes, you&#8217;ll see among the final lines of output
something similar to:</p>
<div class="highlight-python"><pre>Installing pip script to /opt/cctbx/Python.framework/Versions/2.7/bin</pre>
</div>
<p>The directory path in this output points to the location of CCTBX&#8217;s pip,
which can be used directly. Using <a class="reference external" href="https://pypi.python.org/pypi/pyfscache/">pyfscache</a> as an example:</p>
<div class="highlight-python"><pre>% sudo /opt/cctbx/Python.framework/Versions/2.7/bin/pip install pyfscache</pre>
</div>
</div>
<div class="section" id="other-dependencies">
<h4>Other Dependencies<a class="headerlink" href="#other-dependencies" title="Permalink to this headline">¶</a></h4>
<p>Other python dependencies are (in alphabetical order):</p>
<blockquote>
<div><ul class="simple">
<li><a class="reference external" href="https://pypi.python.org/pypi/configobj/">configobj</a></li>
<li><a class="reference external" href="http://www.numpy.org/">numpy</a></li>
<li><a class="reference external" href="https://pypi.python.org/pypi/phyles/">phyles</a></li>
<li><a class="reference external" href="http://www.pythonware.com/products/pil/">PIL</a></li>
<li><a class="reference external" href="http://www.pydblite.net/">PyDBLite</a></li>
<li><a class="reference external" href="https://pypi.python.org/pypi/pyfscache/">pyfscache</a></li>
<li><a class="reference external" href="https://pypi.python.org/pypi/pygmyplot">pygmyplot</a></li>
<li><a class="reference external" href="http://pyyaml.org/">pyyaml</a></li>
<li><a class="reference external" href="http://scipy.org/">scipy</a></li>
</ul>
</div></blockquote>
<p>If not already present on your system, most (if not all) of
these dependencies can be installed by the python package
manager called <a class="reference external" href="https://pypi.python.org/pypi/pip">pip</a>.
The availability of each of these packages will be checked
during the <a class="reference internal" href="#build">build</a> of RadialX by the <tt class="docutils literal"><span class="pre">setup.py</span></tt> script.</p>
</div>
</div>
<div class="section" id="download">
<h3>Download<a class="headerlink" href="#download" title="Permalink to this headline">¶</a></h3>
<p>Because of the CCTBX dependency, it is not yet recommended
to install RadialX by using <a class="reference external" href="https://pypi.python.org/pypi/pip">pip</a>.</p>
<p>For now, the best way to obtain RadialX is to download the source
code from the GitHub repository:</p>
<div class="highlight-python"><pre>% git clone https://github.com/jcstroud/radialx.git</pre>
</div>
<p>This command automatically downloads and unpacks the complete
RadialX repository, which includes all of the code and some test data.</p>
</div>
<div class="section" id="build">
<h3>Build<a class="headerlink" href="#build" title="Permalink to this headline">¶</a></h3>
<p>It is advisable to look at the <tt class="docutils literal"><span class="pre">Makefile.inc</span></tt> file inside
the <tt class="docutils literal"><span class="pre">radialx</span></tt> directory to ensure that the settings reflect
your build environment. Most notably, ensure that the
<tt class="docutils literal"><span class="pre">PYTHON</span></tt> setting points to the desired python version and
that the <tt class="docutils literal"><span class="pre">bin</span></tt> directory under the directory specified
by the <tt class="docutils literal"><span class="pre">PREFIX</span></tt> setting is in your path.</p>
<p>For example, if <tt class="docutils literal"><span class="pre">PREFIX</span></tt> is set to <tt class="docutils literal"><span class="pre">/usr/local</span></tt>, then
ensure that <tt class="docutils literal"><span class="pre">/usr/local/bin</span></tt> is in your path.</p>
<p>These settings only affect how RadialX is built and where it is installed,
not how it will execute once installed.</p>
<p>Once downloaded, build and installation are easy:</p>
<div class="highlight-python"><pre>% cd radialx
% make
% sudo make install</pre>
</div>
<p>The <tt class="docutils literal"><span class="pre">make</span></tt> command will automatically call <tt class="docutils literal"><span class="pre">setup.py</span></tt> and install
the utilities (<tt class="docutils literal"><span class="pre">powderx</span></tt>, <tt class="docutils literal"><span class="pre">headerx</span></tt>, and <tt class="docutils literal"><span class="pre">profilex</span></tt>) into
the appropriate location, specified by the <tt class="docutils literal"><span class="pre">PREFIX</span></tt> setting.</p>
</div>
</div>
<div class="section" id="usage">
<h2>Usage<a class="headerlink" href="#usage" title="Permalink to this headline">¶</a></h2>
<p>Complete examples of how to use all of the RadialX utilites are
currently in the <tt class="docutils literal"><span class="pre">test</span></tt> directory of the <a class="reference internal" href="#download">source distribution</a>.
These examples are documented by comments in the config files called
<tt class="docutils literal"><span class="pre">powder.yml</span></tt> and <tt class="docutils literal"><span class="pre">profile.cfg</span></tt>, the latter serving presently
as the only source of documentation for the <strong>profilex</strong> utility.</p>
<p>Detailed instructions for the <a class="reference internal" href="#headerx">headerx</a> and <a class="reference internal" href="#powderx">powderx</a> utilities follow.</p>
<div class="section" id="headerx">
<h3>headerx<a class="headerlink" href="#headerx" title="Permalink to this headline">¶</a></h3>
<p>The <strong>headerx</strong> utility is the most straightforward to use. First,
convert an image file from the synchrotron or a home-source detector
to an <a class="reference external" href="http://www.scripps.edu/~arvai/adxv.html">adxv</a> binary file. This function is found under the
<tt class="docutils literal"><span class="pre">File</span></tt> → <tt class="docutils literal"><span class="pre">Save..</span></tt> menu of <a class="reference external" href="http://www.scripps.edu/~arvai/adxv.html">adxv</a>. Ensure that the checkboxes
for &#8220;Image&#8221; and &#8220;Binary&#8221; are checked in the <em>Adxv Save</em>
window. I prefer to name these adxv binary files with the &#8220;<tt class="docutils literal"><span class="pre">.bin</span></tt>&#8221;
extension.</p>
<p>Using a filed called <tt class="docutils literal"><span class="pre">stsaa_119a_0_003.bin</span></tt> as an example:</p>
<div class="highlight-python"><pre>% headerx stsaa_119a_0_003.bin</pre>
</div>
<p>This file is in the <tt class="docutils literal"><span class="pre">test/testdata</span></tt> directory and yields the following
output:</p>
<div class="highlight-python"><pre>     ===============  ===============
        HEADER_BYTES: 1024
                 DIM: 2
          BYTE_ORDER: little_endian
                TYPE: unsigned_short
               SIZE1: 3072
               SIZE2: 3072
          PIXEL_SIZE: 0.10259
                 BIN: 2x2
                 ADC: slow
         DETECTOR_SN: 911
            BEAMLINE: 24_ID_C
                DATE: Mon Jun  8 02:28:42 2009
                TIME: 10.0
            DISTANCE: 400.0
           OSC_RANGE: 1.0
                 PHI: 47.0
           OSC_START: 47.0
            TWOTHETA: 0.0
                AXIS: phi
          WAVELENGTH: 0.9793
       BEAM_CENTER_X: 157.11
       BEAM_CENTER_Y: 156.05
        TRANSMISSION: 10.0871
                PUCK: C
              SAMPLE: 2
            RING_CUR: 102.2
           RING_MODE: 0+24x1, ~1.3% Coupling
        MD2_APERTURE: 30
            UNIF_PED: 1500
CCD_IMAGE_SATURATION: 65535
     ===============  ===============
         Sanity Test
            4.7 Angs: 2357,1550 px
            4.7 Angs: 1531,2376 px
     ===============  ===============</pre>
</div>
<p>The &#8220;Sanity Test&#8221; is based on the header beam center. Hovering
the mouse over the given pixels in adxv should produce approximately
the given resolutions (depending on what adxv thinks is the beam center).</p>
</div>
<div class="section" id="powderx">
<h3>powderx<a class="headerlink" href="#powderx" title="Permalink to this headline">¶</a></h3>
<p>The <strong>powderx</strong> utility simulates powder diffraction patterns
from PDB files. These patterns are presented graphically and
also written to a file name designated by the user, as described
below.</p>
<div class="section" id="the-powderx-config-file">
<h4>The powderx Config File<a class="headerlink" href="#the-powderx-config-file" title="Permalink to this headline">¶</a></h4>
<p>A <a class="reference external" href="http://www.yaml.org/">yaml</a> formatted config file controls the behavior of <strong>powderx</strong>.
This config file is specified as an argument on the command line:</p>
<div class="highlight-python"><pre>powderx powder.yml</pre>
</div>
<p>An example config file named <tt class="docutils literal"><span class="pre">powder.yml</span></tt> is in the <tt class="docutils literal"><span class="pre">test/test-powder</span></tt>
directory of the source distribution. The powder config file will be
referred to as &#8220;<tt class="docutils literal"><span class="pre">powder.yml</span></tt>&#8221; herein. The provided example file
has comments that briefly describe each parameter. It is suggested just
to copy and modify the example <tt class="docutils literal"><span class="pre">powder.yml</span></tt> file from the
<tt class="docutils literal"><span class="pre">test/test-powder</span></tt> directory of the source distribution because
its format may change slightly between versions of RadialX.</p>
<p>An introduction to the <a class="reference internal" href="#yaml-config-format">yaml config format</a> is given below and provides
everything users need to know about yaml to write a config file
for <strong>powderx</strong>. For the curious, the full yaml specification (version 1.2) can
be found at <a class="reference external" href="http://www.yaml.org/spec/1.2/spec.html">http://www.yaml.org/spec/1.2/spec.html</a>.</p>
<p>The <tt class="docutils literal"><span class="pre">powder.yml</span></tt> file has three sections:</p>
<ul class="simple">
<li><tt class="docutils literal"><span class="pre">general</span></tt>: parameters that effect the user experience</li>
<li><tt class="docutils literal"><span class="pre">simulation</span></tt>: parameters for the powder diffraction simulation</li>
<li><tt class="docutils literal"><span class="pre">plot</span></tt>: parameters that modify the appearance of the plot</li>
<li><tt class="docutils literal"><span class="pre">experiment</span></tt>: parameters of the simulated diffraction experiment</li>
</ul>
<p>A detailed discussion of each section follows.</p>
<div class="section" id="general">
<h5>general<a class="headerlink" href="#general" title="Permalink to this headline">¶</a></h5>
<p>Parameters in the <tt class="docutils literal"><span class="pre">general</span></tt> section effect the user experience to
a limited extent.</p>
<ul class="simple">
<li><tt class="docutils literal"><span class="pre">powderx_version</span></tt>: version number of the <strong>powderx</strong> program;
it is critical for the config file version to match the version
of the <strong>powderx</strong> program</li>
<li><tt class="docutils literal"><span class="pre">verbosity</span></tt>: controls how verbose the output is;
values may be <tt class="docutils literal"><span class="pre">DEBUG</span></tt> (most verbose), <tt class="docutils literal"><span class="pre">INFO</span></tt>, <tt class="docutils literal"><span class="pre">WARNING</span></tt>,
<tt class="docutils literal"><span class="pre">ERROR</span></tt>, or <tt class="docutils literal"><span class="pre">CRITICAL</span></tt> (least verbose)</li>
</ul>
</div>
<div class="section" id="simulation">
<h5>simulation<a class="headerlink" href="#simulation" title="Permalink to this headline">¶</a></h5>
<p>Of the three sections in <tt class="docutils literal"><span class="pre">powder.yml</span></tt>, the <tt class="docutils literal"><span class="pre">simulation</span></tt> section
has the most parameters. Most of these parameters are self-explanatory.</p>
<ul>
<li><p class="first"><tt class="docutils literal"><span class="pre">pdb_name</span></tt>: pdb file from which to make a simulated pattern</p>
</li>
<li><p class="first"><tt class="docutils literal"><span class="pre">pattern_name</span></tt>: the simulated pattern is written to a file
of this name; the <a class="reference internal" href="#simulated-pattern-format">simulated pattern format</a> is described below</p>
</li>
<li><p class="first"><tt class="docutils literal"><span class="pre">d_max</span></tt>: maximum d-spacing (lowest resolution) for the
simulation, given in Ångstroms.</p>
</li>
<li><p class="first"><tt class="docutils literal"><span class="pre">d_min</span></tt>: minimum d-spacing (highest resolution) for the
simulation, given in Ångstroms.</p>
</li>
<li><p class="first"><tt class="docutils literal"><span class="pre">extinction_correction_x</span></tt>: an optional parameter refined during
extinction correction, which is applied to the simulated pattern;
this correction is discussed in the SHELXL 97 manual on page 7-7
(<a class="reference external" href="http://shelx.uni-ac.gwdg.de/SHELX/shelx97.pdf">http://shelx.uni-ac.gwdg.de/SHELX/shelx97.pdf</a>); use <tt class="docutils literal"><span class="pre">null</span></tt>
or <tt class="docutils literal"><span class="pre">0</span></tt> if extinction correction is not desired</p>
</li>
<li><p class="first"><tt class="docutils literal"><span class="pre">v</span></tt> &amp; <tt class="docutils literal"><span class="pre">w</span></tt>: for the summation of reflections, the square
of the full-width at half-max (FWHM) of a Lorentzian diffraction
peak is equal to to v + w tan(θ)</p>
</li>
<li><dl class="first docutils">
<dt><tt class="docutils literal"><span class="pre">B</span></tt>: isotropic temperature factor; if the simulated pattern</dt>
<dd><p class="first last">is to be scaled with experimental data, then <tt class="docutils literal"><span class="pre">B</span></tt> should be
set to 0 because it will be refined during scaling</p>
</dd>
</dl>
</li>
<li><p class="first"><tt class="docutils literal"><span class="pre">apply_Lp</span></tt>: apply Lorentz &amp; polarization correction
(<tt class="docutils literal"><span class="pre">True</span></tt> or <tt class="docutils literal"><span class="pre">False</span></tt>)</p>
</li>
<li><p class="first"><tt class="docutils literal"><span class="pre">pattern_shells</span></tt>: number of points in the simulated pattern;
each point represents the integrated intensity of the shell</p>
</li>
<li><p class="first"><tt class="docutils literal"><span class="pre">peak_widths</span></tt>: the intensity of a reflection is taken to be
0 beyond this number of FWHM from the center of the Lorentzian
reflection peak</p>
</li>
<li><p class="first"><tt class="docutils literal"><span class="pre">bin_reflections</span></tt>: reflections may be binned by resolution such
that all the reflections within a shell
(specified by <tt class="docutils literal"><span class="pre">pattern_shells</span></tt>) are taken to have the
same center and peak shape (i.e. the same FWHM),
making the calculations significantly faster at
the expense of a small decrease in accuracy;
values for <tt class="docutils literal"><span class="pre">bin_reflections</span></tt> may be <tt class="docutils literal"><span class="pre">True</span></tt> or <tt class="docutils literal"><span class="pre">False</span></tt></p>
</li>
</ul>
</div>
<div class="section" id="plot">
<h5>plot<a class="headerlink" href="#plot" title="Permalink to this headline">¶</a></h5>
<p>The <tt class="docutils literal"><span class="pre">plot</span></tt> section controls the appearance of the plot.</p>
<ul class="simple">
<li><tt class="docutils literal"><span class="pre">window_name</span></tt>: name of the plot window</li>
<li><tt class="docutils literal"><span class="pre">left</span></tt>, <tt class="docutils literal"><span class="pre">right</span></tt>, <tt class="docutils literal"><span class="pre">top</span></tt>, <tt class="docutils literal"><span class="pre">bottom</span></tt>:
margins between plot and page border; note that axes labels
are in the margins</li>
<li><tt class="docutils literal"><span class="pre">plot_points</span></tt>: the data is rebinned simply for the purposes
of the plot; the plot will have <tt class="docutils literal"><span class="pre">plot_points</span></tt> points</li>
<li><tt class="docutils literal"><span class="pre">x_ticks</span></tt>: number of ticks on the x-axis; labeled
by 2θ.</li>
</ul>
</div>
<div class="section" id="experiment">
<h5>experiment<a class="headerlink" href="#experiment" title="Permalink to this headline">¶</a></h5>
<p>A simulated diffraction pattern is the result of a simulated
experiment. The parameters of the <tt class="docutils literal"><span class="pre">experiment</span></tt> section specify
simulated experimental details.</p>
<ul class="simple">
<li><tt class="docutils literal"><span class="pre">WAVELENGTH</span></tt>: radiation wavelength</li>
<li><tt class="docutils literal"><span class="pre">DISTANCE</span></tt>: the distance from the sample to the detector</li>
</ul>
<p>Please note that yaml is case-sensitive, so these latter
two parameter names must be in all caps.</p>
</div>
</div>
<div class="section" id="summation">
<h4>Summation<a class="headerlink" href="#summation" title="Permalink to this headline">¶</a></h4>
<p>The simulated powder diffraction pattern is the spherical
summation of diffraction intensity for <img class="math" src="_images/math/fc97ef67268cd4e91bacdf12b8901d7036c9a056.png" alt="N"/> resolution shells,
each shell being summed independently. All shells have the same
width in <img class="math" src="_images/math/e7fe4fc87a1b38d0b6f1f34da3c84a3fd3cb64c6.png" alt="\varrho"/>, or <img class="math" src="_images/math/5c48043ecfaab5fb00f760fdc43718375bd9280d.png" alt="\sin(\theta)/\lambda"/>, where
<img class="math" src="_images/math/52e8ed7a3ba22130ad3984eb2cd413406475a689.png" alt="\theta"/> is the Bragg angle and <img class="math" src="_images/math/ce4588fd900d02afcbd260bc07f54cce49a7dc4a.png" alt="\lambda"/> is
the wavelength.</p>
<p>Given that the structure factor for a Miller index, <img class="math" src="_images/math/35d5a56b422de4dedc173b449bfe309836d98219.png" alt="hk\ell"/>,
is <img class="math" src="_images/math/5970c8d632f2c80ad0034ef0a10214ab67a3ec53.png" alt="F_{hk\ell}"/>, then the corresponding intensity
<img class="math" src="_images/math/342011ae539c1a7e2ee088d92ea371eccd7c623a.png" alt="I_{hk\ell}"/> is</p>
<div class="math">
<p><img src="_images/math/0fabef434e57caa795fc728afc82d221488207c6.png" alt="I_{hk\ell} =
  \dfrac{M}{V^{2}}
  \left [
    \dfrac{1 + \cos^{2}(2\theta)}
           {\sin^{2}\theta \cos\theta}
  \right ]
  \left | F_{hk\ell} \right |^{2}
  \exp \left (
          \dfrac{-2B\sin^{2}\theta}{\lambda^{2}}
       \right )"/></p>
</div><p>Where <img class="math" src="_images/math/12d58aa29201da09d8e620f8698e3a37547f6b4a.png" alt="V"/> is the unit cell volume, <img class="math" src="_images/math/5d1e4485dc90c450e8c76826516c1b2ccb8fce16.png" alt="M"/> is
the multiplicity of the reflection, and <img class="math" src="_images/math/ff5fb3d775862e2123b007eb4373ff6cc1a34d4e.png" alt="B"/> the isotropic
temperature factor.</p>
<p>If the simulated pattern is to be scaled to
experimental data using the <strong>profilex</strong> utility,
<img class="math" src="_images/math/ff5fb3d775862e2123b007eb4373ff6cc1a34d4e.png" alt="B"/> should be set to 0 because <img class="math" src="_images/math/ff5fb3d775862e2123b007eb4373ff6cc1a34d4e.png" alt="B"/> is
refined during scaling. Note that when <img class="math" src="_images/math/ff5fb3d775862e2123b007eb4373ff6cc1a34d4e.png" alt="B"/>
is set to 0, the expression for diffraction intensity
simplifies to</p>
<div class="math">
<p><img src="_images/math/2cc8daba206f3387740471df06b4487de0af4d15.png" alt="I_{hk\ell} =
  \dfrac{M}{V^{2}}
  \left [
    \dfrac{1 + \cos^{2}(2\theta)}
           {\sin^{2}\theta \cos\theta}
  \right ]
  \left | F_{hk\ell} \right |^{2}"/></p>
</div><p>The term
<img class="math" src="_images/math/e5db74389d2e0bc8326e2dce870456d8c5ffc1e0.png" alt="\dfrac{1 + \cos^{2}(2\theta)}{\sin^{2}\theta \cos\theta}"/>
is the Lorentz polarization correction, which may be applied
to the simulated pattern using the <tt class="docutils literal"><span class="pre">apply_Lp</span></tt> setting
within the <tt class="docutils literal"><span class="pre">simulation</span></tt> section of the config file.</p>
<p>Diffraction intensities are distributed throughout a profile,
approximated by <strong>powderx</strong> as a <a class="reference external" href="http://en.wikipedia.org/wiki/Cauchy_distribution">Lorentzian distribution</a> (also
called a &#8220;Cauchy distribution&#8221;). This distribution takes the form</p>
<div class="math">
<p><img src="_images/math/5afc4fddd6eb7dea607dccfc54f4362e2d215954.png" alt="A_{J}^{L} = \dfrac{2}{\pi H_{B}}
   \left [1 + \dfrac{4}{H_{B}^{2}}
              \left ( 2\theta_{i} - 2\theta_{hk\ell} \right )^2
   \right ]^{-1}"/></p>
</div><p>Where <img class="math" src="_images/math/e8e4509589b391d8c2b2039882eeef900ce2920e.png" alt="A_{J}^{L}"/> is the intensity contribution
at angle <img class="math" src="_images/math/6698f722f8a21f9cf097bb915bd9cf92ab72cf2e.png" alt="\theta_{i}"/>, <img class="math" src="_images/math/e206002f82cce5da59a8aa4503a5f684b1f9c09c.png" alt="H_{B}"/> is the FWHM
of the peak, and <img class="math" src="_images/math/83460a62da3e32a61803383bd3e0e3e708e729ed.png" alt="\theta_{hk\ell}"/> is the angle of
diffraction for the Miller index <img class="math" src="_images/math/35d5a56b422de4dedc173b449bfe309836d98219.png" alt="hk\ell"/>.
For the purposes of the simulation, <img class="math" src="_images/math/6698f722f8a21f9cf097bb915bd9cf92ab72cf2e.png" alt="\theta_{i}"/> is taken
from the middles (in <img class="math" src="_images/math/e7fe4fc87a1b38d0b6f1f34da3c84a3fd3cb64c6.png" alt="\varrho"/>) of the shells.</p>
<p>Because it is computationally expensive to calculate the contribution
of every reflection to every shell, <strong>powderx</strong> allows the user
to limit the calculations to the shells in the neighborhood
of <img class="math" src="_images/math/6698f722f8a21f9cf097bb915bd9cf92ab72cf2e.png" alt="\theta_{i}"/> using the <tt class="docutils literal"><span class="pre">peak_widths</span></tt> setting. This setting
specifies the width of the neighborhood in multiples of the FWHM.</p>
<p>The FWHM, or <img class="math" src="_images/math/e206002f82cce5da59a8aa4503a5f684b1f9c09c.png" alt="H_{B}"/>, can be expressed as a function of the Bragg
angle of the reflection:</p>
<div class="math">
<p><img src="_images/math/698b17ded649bbb3461f9d96da900ac009acff3c.png" alt="H_{B}^{2} = v \tan \theta_{hk\ell} + w"/></p>
</div><p>The two parameters of this expression, <img class="math" src="_images/math/a9f23bf124b6b2b2a993eb313c72e678664ac74a.png" alt="v"/> and <img class="math" src="_images/math/9ee4b825a2e36ae093ed7be5e4851ef453b34914.png" alt="w"/>
may be adjusted using the config file settings <tt class="docutils literal"><span class="pre">v</span></tt> and <tt class="docutils literal"><span class="pre">w</span></tt>,
respectively.</p>
</div>
</div>
</div>
<div class="section" id="file-formats">
<h2>File Formats<a class="headerlink" href="#file-formats" title="Permalink to this headline">¶</a></h2>
<div class="section" id="simulated-pattern-format">
<h3>Simulated Pattern Format<a class="headerlink" href="#simulated-pattern-format" title="Permalink to this headline">¶</a></h3>
<p>The simulated integrated diffraction pattern is written to a yaml
formatted file specified by the <tt class="docutils literal"><span class="pre">pattern_name</span></tt> setting
in the <tt class="docutils literal"><span class="pre">simulation</span></tt> section of <tt class="docutils literal"><span class="pre">powder.yml</span></tt>. In yaml terms, the
pattern is stored as a list of [2θ, intensity] pairs keyed by
the word &#8220;<tt class="docutils literal"><span class="pre">pattern</span></tt>&#8221;.
A python program can make a 2-D <a class="reference external" href="http://www.numpy.org/">numpy</a> array from the pattern easily
if <a class="reference external" href="http://www.numpy.org/">numpy</a> (<a class="reference external" href="http://numpy.scipy.org/">http://numpy.scipy.org/</a>) and <a class="reference external" href="http://pyyaml.org/">pyYAML</a> (<a class="reference external" href="http://pyyaml.org/">http://pyyaml.org/</a>)
are installed.  For example, if the pattern is stored in the
file &#8220;<tt class="docutils literal"><span class="pre">pattern.yml</span></tt>&#8221;:</p>
<div class="highlight-python"><div class="highlight"><pre><span class="kn">import</span> <span class="nn">numpy</span>
<span class="kn">import</span> <span class="nn">yaml</span>
<span class="n">ary</span> <span class="o">=</span> <span class="n">numpy</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">yaml</span><span class="o">.</span><span class="n">load</span><span class="p">(</span><span class="nb">open</span><span class="p">(</span><span class="s">&#39;pattern.yml&#39;</span><span class="p">)))[</span><span class="s">&#39;pattern&#39;</span><span class="p">]</span>
</pre></div>
</div>
<p>The array called &#8220;<tt class="docutils literal"><span class="pre">ary</span></tt>&#8221; is a Nx2 array, with each of the N rows being a
[2θ, intensity] pair.</p>
<p>More generally, the pattern starts on the fourth line of the yaml
file and each data line conforms to the following FORTRAN
formatted read:</p>
<div class="highlight-python"><pre>REAL X, Y
READ '(5X, F10.0, 1X, F10.0)', X, Y</pre>
</div>
<p>The following are the first six lines of a yaml simulated powder diffraction
pattern file:</p>
<div class="highlight-python"><pre>model : "../testdata/stg06-phi06.4-wc-03.8-rc1.0-m4-12.pdb"
pattern :
  # [   2-theta, intensity ]
  - [  5.205029, 0.5671240 ]
  - [  5.285076, 0.5882654 ]
  - [  5.365124, 0.6002413 ]</pre>
</div>
</div>
<div class="section" id="yaml-config-format">
<h3>YAML Config Format<a class="headerlink" href="#yaml-config-format" title="Permalink to this headline">¶</a></h3>
<p>The <tt class="docutils literal"><span class="pre">powder.yml</span></tt> file has a simple structure, which can be understood
from the following listing:</p>
<div class="highlight-python"><pre>%YAML 1.2
---
section_1 :
   parameter_a : value_a
   parameter_b : value_b
section_2 :
   parameter_c : value_c</pre>
</div>
<p>Here, the first line is optional and indicates to a yaml parser that
the file conforms to the yaml specification version 1.2. The second
line of three dashes indicates the beginning of a yaml document.
Each section name is on a line by itself and followed by a colon.
Each parameter key-value pair is <em>indented</em> relative to
the section names. All parameter key-value pairs are indented the
same number of spaces.
A colon separates the parameter key from its
associated value.</p>
<p>Note that yaml is case sensitive.</p>
<div class="toctree-wrapper compound">
<ul class="simple">
</ul>
</div>
</div>
</div>
</div>
<div class="section" id="indices-and-tables">
<h1>Indices and tables<a class="headerlink" href="#indices-and-tables" title="Permalink to this headline">¶</a></h1>
<ul class="simple">
<li><a class="reference internal" href="genindex.html"><em>Index</em></a></li>
<li><a class="reference internal" href="py-modindex.html"><em>Module Index</em></a></li>
<li><a class="reference internal" href="search.html"><em>Search Page</em></a></li>
</ul>
</div>


          </div>
        </div>
      </div>
      <div class="sphinxsidebar">
        <div class="sphinxsidebarwrapper">
  <h3><a href="#">Table Of Contents</a></h3>
  <ul>
<li><a class="reference internal" href="#">radialx Documentation</a><ul>
<li><a class="reference internal" href="#introduction">Introduction</a><ul>
<li><a class="reference internal" href="#documented-functionalities">Documented Functionalities</a></li>
<li><a class="reference internal" href="#undocumented-functionalities">Undocumented Functionalities</a></li>
</ul>
</li>
<li><a class="reference internal" href="#home-page-repository">Home Page &amp; Repository</a></li>
<li><a class="reference internal" href="#installation">Installation</a><ul>
<li><a class="reference internal" href="#dependencies">Dependencies</a><ul>
<li><a class="reference internal" href="#pip-setuptools">pip &amp; setuptools</a></li>
<li><a class="reference internal" href="#cctbx">CCTBX</a></li>
<li><a class="reference internal" href="#other-dependencies">Other Dependencies</a></li>
</ul>
</li>
<li><a class="reference internal" href="#download">Download</a></li>
<li><a class="reference internal" href="#build">Build</a></li>
</ul>
</li>
<li><a class="reference internal" href="#usage">Usage</a><ul>
<li><a class="reference internal" href="#headerx">headerx</a></li>
<li><a class="reference internal" href="#powderx">powderx</a><ul>
<li><a class="reference internal" href="#the-powderx-config-file">The powderx Config File</a><ul>
<li><a class="reference internal" href="#general">general</a></li>
<li><a class="reference internal" href="#simulation">simulation</a></li>
<li><a class="reference internal" href="#plot">plot</a></li>
<li><a class="reference internal" href="#experiment">experiment</a></li>
</ul>
</li>
<li><a class="reference internal" href="#summation">Summation</a></li>
</ul>
</li>
</ul>
</li>
<li><a class="reference internal" href="#file-formats">File Formats</a><ul>
<li><a class="reference internal" href="#simulated-pattern-format">Simulated Pattern Format</a></li>
<li><a class="reference internal" href="#yaml-config-format">YAML Config Format</a><ul>
</ul>
</li>
</ul>
</li>
</ul>
</li>
<li><a class="reference internal" href="#indices-and-tables">Indices and tables</a></li>
</ul>

  <h3>This Page</h3>
  <ul class="this-page-menu">
    <li><a href="_sources/index.txt"
           rel="nofollow">Show Source</a></li>
  </ul>
<div id="searchbox" style="display: none">
  <h3>Quick search</h3>
    <form class="search" action="search.html" method="get">
      <input type="text" name="q" />
      <input type="submit" value="Go" />
      <input type="hidden" name="check_keywords" value="yes" />
      <input type="hidden" name="area" value="default" />
    </form>
    <p class="searchtip" style="font-size: 90%">
    Enter search terms or a module, class or function name.
    </p>
</div>
<script type="text/javascript">$('#searchbox').show(0);</script>
        </div>
      </div>
      <div class="clearer"></div>
    </div>
    <div class="related">
      <h3>Navigation</h3>
      <ul>
        <li class="right" style="margin-right: 10px">
          <a href="genindex.html" title="General Index"
             >index</a></li>
        <li><a href="#">radialx 0.7.2 documentation</a> &raquo;</li> 
      </ul>
    </div>
    <div class="footer">
        &copy; Copyright Copyright (c) 2013, James C. Stroud; All rights reserved..
      Created using <a href="http://sphinx.pocoo.org/">Sphinx</a> 1.2pre.
    </div>
  </body>
</html>