<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN"
  "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">


<html xmlns="http://www.w3.org/1999/xhtml">
  <head>
    <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
    
    <title>transaction.interfaces &mdash; transaction 1.2 documentation</title>
    
    <link rel="stylesheet" href="../../_static/default.css" type="text/css" />
    <link rel="stylesheet" href="../../_static/pygments.css" type="text/css" />
    
    <script type="text/javascript">
      var DOCUMENTATION_OPTIONS = {
        URL_ROOT:    '../../',
        VERSION:     '1.2',
        COLLAPSE_INDEX: false,
        FILE_SUFFIX: '.html',
        HAS_SOURCE:  true
      };
    </script>
    <script type="text/javascript" src="../../_static/jquery.js"></script>
    <script type="text/javascript" src="../../_static/underscore.js"></script>
    <script type="text/javascript" src="../../_static/doctools.js"></script>
    <link rel="top" title="transaction 1.2 documentation" href="../../index.html" />
    <link rel="up" title="Module code" href="../index.html" /> 
  </head>
  <body>
    <div class="related">
      <h3>Navigation</h3>
      <ul>
        <li class="right" style="margin-right: 10px">
          <a href="../../genindex.html" title="General Index"
             accesskey="I">index</a></li>
        <li class="right" >
          <a href="../../py-modindex.html" title="Python Module Index"
             >modules</a> |</li>
        <li><a href="../../index.html">transaction 1.2 documentation</a> &raquo;</li>
          <li><a href="../index.html" accesskey="U">Module code</a> &raquo;</li> 
      </ul>
    </div>  

    <div class="document">
      <div class="documentwrapper">
        <div class="bodywrapper">
          <div class="body">
            
  <h1>Source code for transaction.interfaces</h1><div class="highlight"><pre>
<span class="c">##############################################################################</span>
<span class="c">#</span>
<span class="c"># Copyright (c) 2001, 2002 Zope Foundation and Contributors.</span>
<span class="c"># All Rights Reserved.</span>
<span class="c">#</span>
<span class="c"># This software is subject to the provisions of the Zope Public License,</span>
<span class="c"># Version 2.1 (ZPL).  A copy of the ZPL should accompany this distribution.</span>
<span class="c"># THIS SOFTWARE IS PROVIDED &quot;AS IS&quot; AND ANY AND ALL EXPRESS OR IMPLIED</span>
<span class="c"># WARRANTIES ARE DISCLAIMED, INCLUDING, BUT NOT LIMITED TO, THE IMPLIED</span>
<span class="c"># WARRANTIES OF TITLE, MERCHANTABILITY, AGAINST INFRINGEMENT, AND FITNESS</span>
<span class="c"># FOR A PARTICULAR PURPOSE.</span>
<span class="c">#</span>
<span class="c">##############################################################################</span>

<span class="kn">import</span> <span class="nn">zope.interface</span>

<div class="viewcode-block" id="ITransactionManager"><a class="viewcode-back" href="../../api.html#transaction.interfaces.ITransactionManager">[docs]</a><span class="k">class</span> <span class="nc">ITransactionManager</span><span class="p">(</span><span class="n">zope</span><span class="o">.</span><span class="n">interface</span><span class="o">.</span><span class="n">Interface</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;An object that manages a sequence of transactions.</span>

<span class="sd">    Applications use transaction managers to establish transaction boundaries.</span>
<span class="sd">    &quot;&quot;&quot;</span>

<div class="viewcode-block" id="ITransactionManager.begin"><a class="viewcode-back" href="../../api.html#transaction.interfaces.ITransactionManager.begin">[docs]</a>    <span class="k">def</span> <span class="nf">begin</span><span class="p">():</span>
        <span class="sd">&quot;&quot;&quot;Begin a new transaction.</span>

<span class="sd">        If an existing transaction is in progress, it will be aborted.</span>

<span class="sd">        The newTransaction() method of registered synchronizers is called,</span>
<span class="sd">        passing the new transaction object.</span>
<span class="sd">        &quot;&quot;&quot;</span>
</div>
<div class="viewcode-block" id="ITransactionManager.get"><a class="viewcode-back" href="../../api.html#transaction.interfaces.ITransactionManager.get">[docs]</a>    <span class="k">def</span> <span class="nf">get</span><span class="p">():</span>
        <span class="sd">&quot;&quot;&quot;Get the current transaction.</span>
<span class="sd">        &quot;&quot;&quot;</span>
</div>
<div class="viewcode-block" id="ITransactionManager.commit"><a class="viewcode-back" href="../../api.html#transaction.interfaces.ITransactionManager.commit">[docs]</a>    <span class="k">def</span> <span class="nf">commit</span><span class="p">():</span>
        <span class="sd">&quot;&quot;&quot;Commit the current transaction.</span>
<span class="sd">        &quot;&quot;&quot;</span>
</div>
<div class="viewcode-block" id="ITransactionManager.abort"><a class="viewcode-back" href="../../api.html#transaction.interfaces.ITransactionManager.abort">[docs]</a>    <span class="k">def</span> <span class="nf">abort</span><span class="p">():</span>
        <span class="sd">&quot;&quot;&quot;Abort the current transaction.</span>
<span class="sd">        &quot;&quot;&quot;</span>
</div>
<div class="viewcode-block" id="ITransactionManager.doom"><a class="viewcode-back" href="../../api.html#transaction.interfaces.ITransactionManager.doom">[docs]</a>    <span class="k">def</span> <span class="nf">doom</span><span class="p">():</span>
        <span class="sd">&quot;&quot;&quot;Doom the current transaction.</span>
<span class="sd">        &quot;&quot;&quot;</span>
</div>
<div class="viewcode-block" id="ITransactionManager.isDoomed"><a class="viewcode-back" href="../../api.html#transaction.interfaces.ITransactionManager.isDoomed">[docs]</a>    <span class="k">def</span> <span class="nf">isDoomed</span><span class="p">():</span>
        <span class="sd">&quot;&quot;&quot;Returns True if the current transaction is doomed, otherwise False.</span>
<span class="sd">        &quot;&quot;&quot;</span>
</div>
<div class="viewcode-block" id="ITransactionManager.savepoint"><a class="viewcode-back" href="../../api.html#transaction.interfaces.ITransactionManager.savepoint">[docs]</a>    <span class="k">def</span> <span class="nf">savepoint</span><span class="p">(</span><span class="n">optimistic</span><span class="o">=</span><span class="bp">False</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Create a savepoint from the current transaction.</span>

<span class="sd">        If the optimistic argument is true, then data managers that</span>
<span class="sd">        don&#39;t support savepoints can be used, but an error will be</span>
<span class="sd">        raised if the savepoint is rolled back.</span>

<span class="sd">        An ISavepoint object is returned.</span>
<span class="sd">        &quot;&quot;&quot;</span>
</div>
<div class="viewcode-block" id="ITransactionManager.registerSynch"><a class="viewcode-back" href="../../api.html#transaction.interfaces.ITransactionManager.registerSynch">[docs]</a>    <span class="k">def</span> <span class="nf">registerSynch</span><span class="p">(</span><span class="n">synch</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Register an ISynchronizer.</span>

<span class="sd">        Synchronizers are notified about some major events in a transaction&#39;s</span>
<span class="sd">        life.  See ISynchronizer for details.</span>
<span class="sd">        &quot;&quot;&quot;</span>
</div>
<div class="viewcode-block" id="ITransactionManager.unregisterSynch"><a class="viewcode-back" href="../../api.html#transaction.interfaces.ITransactionManager.unregisterSynch">[docs]</a>    <span class="k">def</span> <span class="nf">unregisterSynch</span><span class="p">(</span><span class="n">synch</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Unregister an ISynchronizer.</span>

<span class="sd">        Synchronizers are notified about some major events in a transaction&#39;s</span>
<span class="sd">        life.  See ISynchronizer for details.</span>
<span class="sd">        &quot;&quot;&quot;</span>
</div></div>
<div class="viewcode-block" id="ITransaction"><a class="viewcode-back" href="../../api.html#transaction.interfaces.ITransaction">[docs]</a><span class="k">class</span> <span class="nc">ITransaction</span><span class="p">(</span><span class="n">zope</span><span class="o">.</span><span class="n">interface</span><span class="o">.</span><span class="n">Interface</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;Object representing a running transaction.</span>

<span class="sd">    Objects with this interface may represent different transactions</span>
<span class="sd">    during their lifetime (.begin() can be called to start a new</span>
<span class="sd">    transaction using the same instance, although that example is</span>
<span class="sd">    deprecated and will go away in ZODB 3.6).</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="n">user</span> <span class="o">=</span> <span class="n">zope</span><span class="o">.</span><span class="n">interface</span><span class="o">.</span><span class="n">Attribute</span><span class="p">(</span>
        <span class="sd">&quot;&quot;&quot;A user name associated with the transaction.</span>

<span class="sd">        The format of the user name is defined by the application.  The value</span>
<span class="sd">        is of Python type str.  Storages record the user value, as meta-data,</span>
<span class="sd">        when a transaction commits.</span>

<span class="sd">        A storage may impose a limit on the size of the value; behavior is</span>
<span class="sd">        undefined if such a limit is exceeded (for example, a storage may</span>
<span class="sd">        raise an exception, or truncate the value).</span>
<span class="sd">        &quot;&quot;&quot;</span><span class="p">)</span>

    <span class="n">description</span> <span class="o">=</span> <span class="n">zope</span><span class="o">.</span><span class="n">interface</span><span class="o">.</span><span class="n">Attribute</span><span class="p">(</span>
        <span class="sd">&quot;&quot;&quot;A textual description of the transaction.</span>

<span class="sd">        The value is of Python type str.  Method note() is the intended</span>
<span class="sd">        way to set the value.  Storages record the description, as meta-data,</span>
<span class="sd">        when a transaction commits.</span>

<span class="sd">        A storage may impose a limit on the size of the description; behavior</span>
<span class="sd">        is undefined if such a limit is exceeded (for example, a storage may</span>
<span class="sd">        raise an exception, or truncate the value).</span>
<span class="sd">        &quot;&quot;&quot;</span><span class="p">)</span>

<div class="viewcode-block" id="ITransaction.commit"><a class="viewcode-back" href="../../api.html#transaction.interfaces.ITransaction.commit">[docs]</a>    <span class="k">def</span> <span class="nf">commit</span><span class="p">():</span>
        <span class="sd">&quot;&quot;&quot;Finalize the transaction.</span>

<span class="sd">        This executes the two-phase commit algorithm for all</span>
<span class="sd">        IDataManager objects associated with the transaction.</span>
<span class="sd">        &quot;&quot;&quot;</span>
</div>
<div class="viewcode-block" id="ITransaction.abort"><a class="viewcode-back" href="../../api.html#transaction.interfaces.ITransaction.abort">[docs]</a>    <span class="k">def</span> <span class="nf">abort</span><span class="p">():</span>
        <span class="sd">&quot;&quot;&quot;Abort the transaction.</span>

<span class="sd">        This is called from the application.  This can only be called</span>
<span class="sd">        before the two-phase commit protocol has been started.</span>
<span class="sd">        &quot;&quot;&quot;</span>
</div>
<div class="viewcode-block" id="ITransaction.doom"><a class="viewcode-back" href="../../api.html#transaction.interfaces.ITransaction.doom">[docs]</a>    <span class="k">def</span> <span class="nf">doom</span><span class="p">():</span>
        <span class="sd">&quot;&quot;&quot;Doom the transaction.</span>

<span class="sd">        Dooms the current transaction. This will cause</span>
<span class="sd">        DoomedTransactionException to be raised on any attempt to commit the</span>
<span class="sd">        transaction.</span>

<span class="sd">        Otherwise the transaction will behave as if it was active.</span>
<span class="sd">        &quot;&quot;&quot;</span>
</div>
<div class="viewcode-block" id="ITransaction.savepoint"><a class="viewcode-back" href="../../api.html#transaction.interfaces.ITransaction.savepoint">[docs]</a>    <span class="k">def</span> <span class="nf">savepoint</span><span class="p">(</span><span class="n">optimistic</span><span class="o">=</span><span class="bp">False</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Create a savepoint.</span>

<span class="sd">        If the optimistic argument is true, then data managers that don&#39;t</span>
<span class="sd">        support savepoints can be used, but an error will be raised if the</span>
<span class="sd">        savepoint is rolled back.</span>

<span class="sd">        An ISavepoint object is returned.</span>
<span class="sd">        &quot;&quot;&quot;</span>
</div>
<div class="viewcode-block" id="ITransaction.join"><a class="viewcode-back" href="../../api.html#transaction.interfaces.ITransaction.join">[docs]</a>    <span class="k">def</span> <span class="nf">join</span><span class="p">(</span><span class="n">datamanager</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Add a data manager to the transaction.</span>

<span class="sd">        `datamanager` must provide the transactions.interfaces.IDataManager</span>
<span class="sd">        interface.</span>
<span class="sd">        &quot;&quot;&quot;</span>
</div>
<div class="viewcode-block" id="ITransaction.note"><a class="viewcode-back" href="../../api.html#transaction.interfaces.ITransaction.note">[docs]</a>    <span class="k">def</span> <span class="nf">note</span><span class="p">(</span><span class="n">text</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Add text to the transaction description.</span>

<span class="sd">        This modifies the `.description` attribute; see its docs for more</span>
<span class="sd">        detail.  First surrounding whitespace is stripped from `text`.  If</span>
<span class="sd">        `.description` is currently an empty string, then the stripped text</span>
<span class="sd">        becomes its value, else two newlines and the stripped text are</span>
<span class="sd">        appended to `.description`.</span>
<span class="sd">        &quot;&quot;&quot;</span>
</div>
<div class="viewcode-block" id="ITransaction.setUser"><a class="viewcode-back" href="../../api.html#transaction.interfaces.ITransaction.setUser">[docs]</a>    <span class="k">def</span> <span class="nf">setUser</span><span class="p">(</span><span class="n">user_name</span><span class="p">,</span> <span class="n">path</span><span class="o">=</span><span class="s">&quot;/&quot;</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Set the user name.</span>

<span class="sd">        path should be provided if needed to further qualify the</span>
<span class="sd">        identified user.  This is a convenience method used by Zope.</span>
<span class="sd">        It sets the .user attribute to str(path) + &quot; &quot; + str(user_name).</span>
<span class="sd">        This sets the `.user` attribute; see its docs for more detail.</span>
<span class="sd">        &quot;&quot;&quot;</span>
</div>
<div class="viewcode-block" id="ITransaction.setExtendedInfo"><a class="viewcode-back" href="../../api.html#transaction.interfaces.ITransaction.setExtendedInfo">[docs]</a>    <span class="k">def</span> <span class="nf">setExtendedInfo</span><span class="p">(</span><span class="n">name</span><span class="p">,</span> <span class="n">value</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Add extension data to the transaction.</span>

<span class="sd">        name is the name of the extension property to set, of Python type</span>
<span class="sd">        str; value must be picklable.  Multiple calls may be made to set</span>
<span class="sd">        multiple extension properties, provided the names are distinct.</span>

<span class="sd">        Storages record the extension data, as meta-data, when a transaction</span>
<span class="sd">        commits.</span>

<span class="sd">        A storage may impose a limit on the size of extension data; behavior</span>
<span class="sd">        is undefined if such a limit is exceeded (for example, a storage may</span>
<span class="sd">        raise an exception, or remove `&lt;name, value&gt;` pairs).</span>
<span class="sd">        &quot;&quot;&quot;</span>

    <span class="c"># deprecated38</span></div>
<div class="viewcode-block" id="ITransaction.beforeCommitHook"><a class="viewcode-back" href="../../api.html#transaction.interfaces.ITransaction.beforeCommitHook">[docs]</a>    <span class="k">def</span> <span class="nf">beforeCommitHook</span><span class="p">(</span><span class="n">__hook</span><span class="p">,</span> <span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kws</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Register a hook to call before the transaction is committed.</span>

<span class="sd">        THIS IS DEPRECATED IN ZODB 3.6.  Use addBeforeCommitHook() instead.</span>

<span class="sd">        The specified hook function will be called after the transaction&#39;s</span>
<span class="sd">        commit method has been called, but before the commit process has been</span>
<span class="sd">        started.  The hook will be passed the specified positional and keyword</span>
<span class="sd">        arguments.</span>

<span class="sd">        Multiple hooks can be registered and will be called in the order they</span>
<span class="sd">        were registered (first registered, first called).  This method can</span>
<span class="sd">        also be called from a hook:  an executing hook can register more</span>
<span class="sd">        hooks.  Applications should take care to avoid creating infinite loops</span>
<span class="sd">        by recursively registering hooks.</span>

<span class="sd">        Hooks are called only for a top-level commit.  A savepoint</span>
<span class="sd">        does not call any hooks.  If the transaction is aborted, hooks</span>
<span class="sd">        are not called, and are discarded.  Calling a hook &quot;consumes&quot; its</span>
<span class="sd">        registration too:  hook registrations do not persist across</span>
<span class="sd">        transactions.  If it&#39;s desired to call the same hook on every</span>
<span class="sd">        transaction commit, then beforeCommitHook() must be called with that</span>
<span class="sd">        hook during every transaction; in such a case consider registering a</span>
<span class="sd">        synchronizer object via a TransactionManager&#39;s registerSynch() method</span>
<span class="sd">        instead.</span>
<span class="sd">        &quot;&quot;&quot;</span>
</div>
<div class="viewcode-block" id="ITransaction.addBeforeCommitHook"><a class="viewcode-back" href="../../api.html#transaction.interfaces.ITransaction.addBeforeCommitHook">[docs]</a>    <span class="k">def</span> <span class="nf">addBeforeCommitHook</span><span class="p">(</span><span class="n">hook</span><span class="p">,</span> <span class="n">args</span><span class="o">=</span><span class="p">(),</span> <span class="n">kws</span><span class="o">=</span><span class="bp">None</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Register a hook to call before the transaction is committed.</span>

<span class="sd">        The specified hook function will be called after the transaction&#39;s</span>
<span class="sd">        commit method has been called, but before the commit process has been</span>
<span class="sd">        started.  The hook will be passed the specified positional (`args`)</span>
<span class="sd">        and keyword (`kws`) arguments.  `args` is a sequence of positional</span>
<span class="sd">        arguments to be passed, defaulting to an empty tuple (no positional</span>
<span class="sd">        arguments are passed).  `kws` is a dictionary of keyword argument</span>
<span class="sd">        names and values to be passed, or the default None (no keyword</span>
<span class="sd">        arguments are passed).</span>

<span class="sd">        Multiple hooks can be registered and will be called in the order they</span>
<span class="sd">        were registered (first registered, first called).  This method can</span>
<span class="sd">        also be called from a hook:  an executing hook can register more</span>
<span class="sd">        hooks.  Applications should take care to avoid creating infinite loops</span>
<span class="sd">        by recursively registering hooks.</span>

<span class="sd">        Hooks are called only for a top-level commit.  A</span>
<span class="sd">        savepoint creation does not call any hooks.  If the</span>
<span class="sd">        transaction is aborted, hooks are not called, and are discarded.</span>
<span class="sd">        Calling a hook &quot;consumes&quot; its registration too:  hook registrations</span>
<span class="sd">        do not persist across transactions.  If it&#39;s desired to call the same</span>
<span class="sd">        hook on every transaction commit, then addBeforeCommitHook() must be</span>
<span class="sd">        called with that hook during every transaction; in such a case</span>
<span class="sd">        consider registering a synchronizer object via a TransactionManager&#39;s</span>
<span class="sd">        registerSynch() method instead.</span>
<span class="sd">        &quot;&quot;&quot;</span>
</div>
<div class="viewcode-block" id="ITransaction.getBeforeCommitHooks"><a class="viewcode-back" href="../../api.html#transaction.interfaces.ITransaction.getBeforeCommitHooks">[docs]</a>    <span class="k">def</span> <span class="nf">getBeforeCommitHooks</span><span class="p">():</span>
        <span class="sd">&quot;&quot;&quot;Return iterable producing the registered addBeforeCommit hooks.</span>

<span class="sd">        A triple (hook, args, kws) is produced for each registered hook.</span>
<span class="sd">        The hooks are produced in the order in which they would be invoked</span>
<span class="sd">        by a top-level transaction commit.</span>
<span class="sd">        &quot;&quot;&quot;</span>
</div>
<div class="viewcode-block" id="ITransaction.addAfterCommitHook"><a class="viewcode-back" href="../../api.html#transaction.interfaces.ITransaction.addAfterCommitHook">[docs]</a>    <span class="k">def</span> <span class="nf">addAfterCommitHook</span><span class="p">(</span><span class="n">hook</span><span class="p">,</span> <span class="n">args</span><span class="o">=</span><span class="p">(),</span> <span class="n">kws</span><span class="o">=</span><span class="bp">None</span><span class="p">):</span>
         <span class="sd">&quot;&quot;&quot;Register a hook to call after a transaction commit attempt.</span>

<span class="sd">         The specified hook function will be called after the transaction</span>
<span class="sd">         commit succeeds or aborts.  The first argument passed to the hook</span>
<span class="sd">         is a Boolean value, true if the commit succeeded, or false if the</span>
<span class="sd">         commit aborted.  `args` specifies additional positional, and `kws`</span>
<span class="sd">         keyword, arguments to pass to the hook.  `args` is a sequence of</span>
<span class="sd">         positional arguments to be passed, defaulting to an empty tuple</span>
<span class="sd">         (only the true/false success argument is passed).  `kws` is a</span>
<span class="sd">         dictionary of keyword argument names and values to be passed, or</span>
<span class="sd">         the default None (no keyword arguments are passed).</span>

<span class="sd">         Multiple hooks can be registered and will be called in the order they</span>
<span class="sd">         were registered (first registered, first called).  This method can</span>
<span class="sd">         also be called from a hook:  an executing hook can register more</span>
<span class="sd">         hooks.  Applications should take care to avoid creating infinite loops</span>
<span class="sd">         by recursively registering hooks.</span>

<span class="sd">         Hooks are called only for a top-level commit.  A</span>
<span class="sd">         savepoint creation does not call any hooks.  Calling a</span>
<span class="sd">         hook &quot;consumes&quot; its registration:  hook registrations do not</span>
<span class="sd">         persist across transactions.  If it&#39;s desired to call the same</span>
<span class="sd">         hook on every transaction commit, then addAfterCommitHook() must be</span>
<span class="sd">         called with that hook during every transaction; in such a case</span>
<span class="sd">         consider registering a synchronizer object via a TransactionManager&#39;s</span>
<span class="sd">         registerSynch() method instead.</span>
<span class="sd">         &quot;&quot;&quot;</span>
</div>
<div class="viewcode-block" id="ITransaction.getAfterCommitHooks"><a class="viewcode-back" href="../../api.html#transaction.interfaces.ITransaction.getAfterCommitHooks">[docs]</a>    <span class="k">def</span> <span class="nf">getAfterCommitHooks</span><span class="p">():</span>
        <span class="sd">&quot;&quot;&quot;Return iterable producing the registered addAfterCommit hooks.</span>

<span class="sd">        A triple (hook, args, kws) is produced for each registered hook.</span>
<span class="sd">        The hooks are produced in the order in which they would be invoked</span>
<span class="sd">        by a top-level transaction commit.</span>
<span class="sd">        &quot;&quot;&quot;</span>
</div></div>
<span class="k">class</span> <span class="nc">ITransactionDeprecated</span><span class="p">(</span><span class="n">zope</span><span class="o">.</span><span class="n">interface</span><span class="o">.</span><span class="n">Interface</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;Deprecated parts of the transaction API.&quot;&quot;&quot;</span>

    <span class="k">def</span> <span class="nf">begin</span><span class="p">(</span><span class="n">info</span><span class="o">=</span><span class="bp">None</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Begin a new transaction.</span>

<span class="sd">        If the transaction is in progress, it is aborted and a new</span>
<span class="sd">        transaction is started using the same transaction object.</span>
<span class="sd">        &quot;&quot;&quot;</span>

    <span class="c"># TODO: deprecate this for 3.6.</span>
    <span class="k">def</span> <span class="nf">register</span><span class="p">(</span><span class="nb">object</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Register the given object for transaction control.&quot;&quot;&quot;</span>


<div class="viewcode-block" id="IDataManager"><a class="viewcode-back" href="../../api.html#transaction.interfaces.IDataManager">[docs]</a><span class="k">class</span> <span class="nc">IDataManager</span><span class="p">(</span><span class="n">zope</span><span class="o">.</span><span class="n">interface</span><span class="o">.</span><span class="n">Interface</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;Objects that manage transactional storage.</span>

<span class="sd">    These objects may manage data for other objects, or they may manage</span>
<span class="sd">    non-object storages, such as relational databases.  For example,</span>
<span class="sd">    a ZODB.Connection.</span>

<span class="sd">    Note that when some data is modified, that data&#39;s data manager should</span>
<span class="sd">    join a transaction so that data can be committed when the user commits</span>
<span class="sd">    the transaction.</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="n">transaction_manager</span> <span class="o">=</span> <span class="n">zope</span><span class="o">.</span><span class="n">interface</span><span class="o">.</span><span class="n">Attribute</span><span class="p">(</span>
        <span class="sd">&quot;&quot;&quot;The transaction manager (TM) used by this data manager.</span>

<span class="sd">        This is a public attribute, intended for read-only use.  The value</span>
<span class="sd">        is an instance of ITransactionManager, typically set by the data</span>
<span class="sd">        manager&#39;s constructor.</span>
<span class="sd">        &quot;&quot;&quot;</span><span class="p">)</span>

<div class="viewcode-block" id="IDataManager.abort"><a class="viewcode-back" href="../../api.html#transaction.interfaces.IDataManager.abort">[docs]</a>    <span class="k">def</span> <span class="nf">abort</span><span class="p">(</span><span class="n">transaction</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Abort a transaction and forget all changes.</span>

<span class="sd">        Abort must be called outside of a two-phase commit.</span>

<span class="sd">        Abort is called by the transaction manager to abort</span>
<span class="sd">        transactions that are not yet in a two-phase commit.  It may</span>
<span class="sd">        also be called when rolling back a savepoint made before the</span>
<span class="sd">        data manager joined the transaction.</span>

<span class="sd">        In any case, after abort is called, the data manager is no</span>
<span class="sd">        longer participating in the transaction.  If there are new</span>
<span class="sd">        changes, the data manager must rejoin the transaction.</span>
<span class="sd">        &quot;&quot;&quot;</span>

    <span class="c"># Two-phase commit protocol.  These methods are called by the ITransaction</span>
    <span class="c"># object associated with the transaction being committed.  The sequence</span>
    <span class="c"># of calls normally follows this regular expression:</span>
    <span class="c">#     tpc_begin commit tpc_vote (tpc_finish | tpc_abort)</span>
</div>
<div class="viewcode-block" id="IDataManager.tpc_begin"><a class="viewcode-back" href="../../api.html#transaction.interfaces.IDataManager.tpc_begin">[docs]</a>    <span class="k">def</span> <span class="nf">tpc_begin</span><span class="p">(</span><span class="n">transaction</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Begin commit of a transaction, starting the two-phase commit.</span>

<span class="sd">        transaction is the ITransaction instance associated with the</span>
<span class="sd">        transaction being committed.</span>
<span class="sd">        &quot;&quot;&quot;</span>
</div>
<div class="viewcode-block" id="IDataManager.commit"><a class="viewcode-back" href="../../api.html#transaction.interfaces.IDataManager.commit">[docs]</a>    <span class="k">def</span> <span class="nf">commit</span><span class="p">(</span><span class="n">transaction</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Commit modifications to registered objects.</span>

<span class="sd">        Save changes to be made persistent if the transaction commits (if</span>
<span class="sd">        tpc_finish is called later).  If tpc_abort is called later, changes</span>
<span class="sd">        must not persist.</span>

<span class="sd">        This includes conflict detection and handling.  If no conflicts or</span>
<span class="sd">        errors occur, the data manager should be prepared to make the</span>
<span class="sd">        changes persist when tpc_finish is called.</span>
<span class="sd">        &quot;&quot;&quot;</span>
</div>
<div class="viewcode-block" id="IDataManager.tpc_vote"><a class="viewcode-back" href="../../api.html#transaction.interfaces.IDataManager.tpc_vote">[docs]</a>    <span class="k">def</span> <span class="nf">tpc_vote</span><span class="p">(</span><span class="n">transaction</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Verify that a data manager can commit the transaction.</span>

<span class="sd">        This is the last chance for a data manager to vote &#39;no&#39;.  A</span>
<span class="sd">        data manager votes &#39;no&#39; by raising an exception.</span>

<span class="sd">        transaction is the ITransaction instance associated with the</span>
<span class="sd">        transaction being committed.</span>
<span class="sd">        &quot;&quot;&quot;</span>
</div>
<div class="viewcode-block" id="IDataManager.tpc_finish"><a class="viewcode-back" href="../../api.html#transaction.interfaces.IDataManager.tpc_finish">[docs]</a>    <span class="k">def</span> <span class="nf">tpc_finish</span><span class="p">(</span><span class="n">transaction</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Indicate confirmation that the transaction is done.</span>

<span class="sd">        Make all changes to objects modified by this transaction persist.</span>

<span class="sd">        transaction is the ITransaction instance associated with the</span>
<span class="sd">        transaction being committed.</span>

<span class="sd">        This should never fail.  If this raises an exception, the</span>
<span class="sd">        database is not expected to maintain consistency; it&#39;s a</span>
<span class="sd">        serious error.</span>
<span class="sd">        &quot;&quot;&quot;</span>
</div>
<div class="viewcode-block" id="IDataManager.tpc_abort"><a class="viewcode-back" href="../../api.html#transaction.interfaces.IDataManager.tpc_abort">[docs]</a>    <span class="k">def</span> <span class="nf">tpc_abort</span><span class="p">(</span><span class="n">transaction</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Abort a transaction.</span>

<span class="sd">        This is called by a transaction manager to end a two-phase commit on</span>
<span class="sd">        the data manager.  Abandon all changes to objects modified by this</span>
<span class="sd">        transaction.</span>

<span class="sd">        transaction is the ITransaction instance associated with the</span>
<span class="sd">        transaction being committed.</span>

<span class="sd">        This should never fail.</span>
<span class="sd">        &quot;&quot;&quot;</span>
</div>
<div class="viewcode-block" id="IDataManager.sortKey"><a class="viewcode-back" href="../../api.html#transaction.interfaces.IDataManager.sortKey">[docs]</a>    <span class="k">def</span> <span class="nf">sortKey</span><span class="p">():</span>
        <span class="sd">&quot;&quot;&quot;Return a key to use for ordering registered DataManagers.</span>

<span class="sd">        In order to guarantee a total ordering, keys must be strings.</span>

<span class="sd">        ZODB uses a global sort order to prevent deadlock when it commits</span>
<span class="sd">        transactions involving multiple resource managers.  The resource</span>
<span class="sd">        manager must define a sortKey() method that provides a global ordering</span>
<span class="sd">        for resource managers.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="c"># Alternate version:</span>
        <span class="c">#&quot;&quot;&quot;Return a consistent sort key for this connection.</span>
        <span class="c">#</span>
        <span class="c">#This allows ordering multiple connections that use the same storage in</span>
        <span class="c">#a consistent manner. This is unique for the lifetime of a connection,</span>
        <span class="c">#which is good enough to avoid ZEO deadlocks.</span>
        <span class="c">#&quot;&quot;&quot;</span>
</div></div>
<div class="viewcode-block" id="ISavepointDataManager"><a class="viewcode-back" href="../../api.html#transaction.interfaces.ISavepointDataManager">[docs]</a><span class="k">class</span> <span class="nc">ISavepointDataManager</span><span class="p">(</span><span class="n">IDataManager</span><span class="p">):</span>

<div class="viewcode-block" id="ISavepointDataManager.savepoint"><a class="viewcode-back" href="../../api.html#transaction.interfaces.ISavepointDataManager.savepoint">[docs]</a>    <span class="k">def</span> <span class="nf">savepoint</span><span class="p">():</span>
        <span class="sd">&quot;&quot;&quot;Return a data-manager savepoint (IDataManagerSavepoint).</span>
<span class="sd">        &quot;&quot;&quot;</span>
</div></div>
<div class="viewcode-block" id="IDataManagerSavepoint"><a class="viewcode-back" href="../../api.html#transaction.interfaces.IDataManagerSavepoint">[docs]</a><span class="k">class</span> <span class="nc">IDataManagerSavepoint</span><span class="p">(</span><span class="n">zope</span><span class="o">.</span><span class="n">interface</span><span class="o">.</span><span class="n">Interface</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;Savepoint for data-manager changes for use in transaction savepoints.</span>

<span class="sd">    Datamanager savepoints are used by, and only by, transaction savepoints.</span>

<span class="sd">    Note that data manager savepoints don&#39;t have any notion of, or</span>
<span class="sd">    responsibility for, validity.  It isn&#39;t the responsibility of</span>
<span class="sd">    data-manager savepoints to prevent multiple rollbacks or rollbacks after</span>
<span class="sd">    transaction termination.  Preventing invalid savepoint rollback is the</span>
<span class="sd">    responsibility of transaction rollbacks.  Application code should never</span>
<span class="sd">    use data-manager savepoints.</span>
<span class="sd">    &quot;&quot;&quot;</span>

<div class="viewcode-block" id="IDataManagerSavepoint.rollback"><a class="viewcode-back" href="../../api.html#transaction.interfaces.IDataManagerSavepoint.rollback">[docs]</a>    <span class="k">def</span> <span class="nf">rollback</span><span class="p">():</span>
        <span class="sd">&quot;&quot;&quot;Rollback any work done since the savepoint.</span>
<span class="sd">        &quot;&quot;&quot;</span>
</div></div>
<div class="viewcode-block" id="ISavepoint"><a class="viewcode-back" href="../../api.html#transaction.interfaces.ISavepoint">[docs]</a><span class="k">class</span> <span class="nc">ISavepoint</span><span class="p">(</span><span class="n">zope</span><span class="o">.</span><span class="n">interface</span><span class="o">.</span><span class="n">Interface</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;A transaction savepoint.</span>
<span class="sd">    &quot;&quot;&quot;</span>

<div class="viewcode-block" id="ISavepoint.rollback"><a class="viewcode-back" href="../../api.html#transaction.interfaces.ISavepoint.rollback">[docs]</a>    <span class="k">def</span> <span class="nf">rollback</span><span class="p">():</span>
        <span class="sd">&quot;&quot;&quot;Rollback any work done since the savepoint.</span>

<span class="sd">        InvalidSavepointRollbackError is raised if the savepoint isn&#39;t valid.</span>
<span class="sd">        &quot;&quot;&quot;</span>
</div>
    <span class="n">valid</span> <span class="o">=</span> <span class="n">zope</span><span class="o">.</span><span class="n">interface</span><span class="o">.</span><span class="n">Attribute</span><span class="p">(</span>
        <span class="s">&quot;Boolean indicating whether the savepoint is valid&quot;</span><span class="p">)</span>
</div>
<div class="viewcode-block" id="InvalidSavepointRollbackError"><a class="viewcode-back" href="../../api.html#transaction.interfaces.InvalidSavepointRollbackError">[docs]</a><span class="k">class</span> <span class="nc">InvalidSavepointRollbackError</span><span class="p">(</span><span class="ne">Exception</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;Attempt to rollback an invalid savepoint.</span>

<span class="sd">    A savepoint may be invalid because:</span>

<span class="sd">    - The surrounding transaction has committed or aborted.</span>

<span class="sd">    - An earlier savepoint in the same transaction has been rolled back.</span>
<span class="sd">    &quot;&quot;&quot;</span>
</div>
<div class="viewcode-block" id="ISynchronizer"><a class="viewcode-back" href="../../api.html#transaction.interfaces.ISynchronizer">[docs]</a><span class="k">class</span> <span class="nc">ISynchronizer</span><span class="p">(</span><span class="n">zope</span><span class="o">.</span><span class="n">interface</span><span class="o">.</span><span class="n">Interface</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;Objects that participate in the transaction-boundary notification API.</span>
<span class="sd">    &quot;&quot;&quot;</span>

<div class="viewcode-block" id="ISynchronizer.beforeCompletion"><a class="viewcode-back" href="../../api.html#transaction.interfaces.ISynchronizer.beforeCompletion">[docs]</a>    <span class="k">def</span> <span class="nf">beforeCompletion</span><span class="p">(</span><span class="n">transaction</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Hook that is called by the transaction at the start of a commit.</span>
<span class="sd">        &quot;&quot;&quot;</span>
</div>
<div class="viewcode-block" id="ISynchronizer.afterCompletion"><a class="viewcode-back" href="../../api.html#transaction.interfaces.ISynchronizer.afterCompletion">[docs]</a>    <span class="k">def</span> <span class="nf">afterCompletion</span><span class="p">(</span><span class="n">transaction</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Hook that is called by the transaction after completing a commit.</span>
<span class="sd">        &quot;&quot;&quot;</span>
</div>
<div class="viewcode-block" id="ISynchronizer.newTransaction"><a class="viewcode-back" href="../../api.html#transaction.interfaces.ISynchronizer.newTransaction">[docs]</a>    <span class="k">def</span> <span class="nf">newTransaction</span><span class="p">(</span><span class="n">transaction</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Hook that is called at the start of a transaction.</span>

<span class="sd">        This hook is called when, and only when, a transaction manager&#39;s</span>
<span class="sd">        begin() method is called explictly.</span>
<span class="sd">        &quot;&quot;&quot;</span>
</div></div>
<div class="viewcode-block" id="TransactionError"><a class="viewcode-back" href="../../api.html#transaction.interfaces.TransactionError">[docs]</a><span class="k">class</span> <span class="nc">TransactionError</span><span class="p">(</span><span class="ne">Exception</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;An error occurred due to normal transaction processing.&quot;&quot;&quot;</span>
</div>
<div class="viewcode-block" id="TransactionFailedError"><a class="viewcode-back" href="../../api.html#transaction.interfaces.TransactionFailedError">[docs]</a><span class="k">class</span> <span class="nc">TransactionFailedError</span><span class="p">(</span><span class="n">TransactionError</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;Cannot perform an operation on a transaction that previously failed.</span>

<span class="sd">    An attempt was made to commit a transaction, or to join a transaction,</span>
<span class="sd">    but this transaction previously raised an exception during an attempt</span>
<span class="sd">    to commit it.  The transaction must be explicitly aborted, either by</span>
<span class="sd">    invoking abort() on the transaction, or begin() on its transaction</span>
<span class="sd">    manager.</span>
<span class="sd">    &quot;&quot;&quot;</span>
</div>
<div class="viewcode-block" id="DoomedTransaction"><a class="viewcode-back" href="../../api.html#transaction.interfaces.DoomedTransaction">[docs]</a><span class="k">class</span> <span class="nc">DoomedTransaction</span><span class="p">(</span><span class="n">TransactionError</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;A commit was attempted on a transaction that was doomed.&quot;&quot;&quot;</span>
</div>
<div class="viewcode-block" id="TransientError"><a class="viewcode-back" href="../../api.html#transaction.interfaces.TransientError">[docs]</a><span class="k">class</span> <span class="nc">TransientError</span><span class="p">(</span><span class="n">TransactionError</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;An error has occured when performing a transaction.</span>

<span class="sd">    It&#39;s possible that retrying the transaction will succeed.</span>
<span class="sd">    &quot;&quot;&quot;</span></div>
</pre></div>

          </div>
        </div>
      </div>
      <div class="sphinxsidebar">
        <div class="sphinxsidebarwrapper">
<div id="searchbox" style="display: none">
  <h3>Quick search</h3>
    <form class="search" action="../../search.html" method="get">
      <input type="text" name="q" />
      <input type="submit" value="Go" />
      <input type="hidden" name="check_keywords" value="yes" />
      <input type="hidden" name="area" value="default" />
    </form>
    <p class="searchtip" style="font-size: 90%">
    Enter search terms or a module, class or function name.
    </p>
</div>
<script type="text/javascript">$('#searchbox').show(0);</script>
        </div>
      </div>
      <div class="clearer"></div>
    </div>
    <div class="related">
      <h3>Navigation</h3>
      <ul>
        <li class="right" style="margin-right: 10px">
          <a href="../../genindex.html" title="General Index"
             >index</a></li>
        <li class="right" >
          <a href="../../py-modindex.html" title="Python Module Index"
             >modules</a> |</li>
        <li><a href="../../index.html">transaction 1.2 documentation</a> &raquo;</li>
          <li><a href="../index.html" >Module code</a> &raquo;</li> 
      </ul>
    </div>
    <div class="footer">
        &copy; Copyright 2012, Zope Foundation Contributors.
      Created using <a href="http://sphinx-doc.org/">Sphinx</a> 1.2.2.
    </div>
  </body>
</html>