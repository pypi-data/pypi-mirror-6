

<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN"
  "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">

<html xmlns="http://www.w3.org/1999/xhtml">
  <head>
    <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
    
    <title>Getting started with Funk &mdash; Funk v0.3 documentation</title>
    <link rel="stylesheet" href="../_static/default.css" type="text/css" />
    <link rel="stylesheet" href="../_static/pygments.css" type="text/css" />
    <script type="text/javascript">
      var DOCUMENTATION_OPTIONS = {
        URL_ROOT:    '../',
        VERSION:     '0.3',
        COLLAPSE_INDEX: false,
        FILE_SUFFIX: '',
        HAS_SOURCE:  true
      };
    </script>
    <script type="text/javascript" src="../_static/jquery.js"></script>
    <script type="text/javascript" src="../_static/underscore.js"></script>
    <script type="text/javascript" src="../_static/doctools.js"></script>
    <link rel="top" title="Funk v0.3 documentation" href="../" />
    <link rel="next" title="funk" href="../funk/" />
    <link rel="prev" title="Welcome to Funk’s documentation!" href="../" /> 
  </head>
  <body>
    <div class="related">
      <h3>Navigation</h3>
      <ul>
        <li class="right" style="margin-right: 10px">
          <a href="../genindex/" title="General Index"
             accesskey="I">index</a></li>
        <li class="right" >
          <a href="../py-modindex/" title="Python Module Index"
             >modules</a> |</li>
        <li class="right" >
          <a href="../funk/" title="funk"
             accesskey="N">next</a> |</li>
        <li class="right" >
          <a href="../" title="Welcome to Funk’s documentation!"
             accesskey="P">previous</a> |</li>
        <li><a href="../">Funk v0.3 documentation</a> &raquo;</li> 
      </ul>
    </div>  

    <div class="document">
      <div class="documentwrapper">
        <div class="bodywrapper">
          <div class="body">
            
  <div class="section" id="getting-started-with-funk">
<h1>Getting started with Funk<a class="headerlink" href="#getting-started-with-funk" title="Permalink to this headline">¶</a></h1>
<p>Let&#8217;s say we have a <tt class="xref py py-class docutils literal"><span class="pre">TagRepository</span></tt> class, which has a <tt class="xref py py-func docutils literal"><span class="pre">fetch_all()</span></tt>
method on it. This method will fetch all instances of <tt class="xref py py-class docutils literal"><span class="pre">Tag</span></tt> from the
database for us. The <tt class="xref py py-class docutils literal"><span class="pre">Tag</span></tt> class looks like this:</p>
<div class="highlight-python"><div class="highlight"><pre><span class="k">class</span> <span class="nc">Tag</span><span class="p">(</span><span class="nb">object</span><span class="p">):</span>
    <span class="k">def</span> <span class="nf">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">name</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">name</span> <span class="o">=</span> <span class="n">name</span>
</pre></div>
</div>
<p>We also have a class that we&#8217;d like to test, called <tt class="xref py py-class docutils literal"><span class="pre">TagDisplayer</span></tt>. Its
constructor takes a <tt class="xref py py-class docutils literal"><span class="pre">TagRepository</span></tt>, and has a method <tt class="xref py py-func docutils literal"><span class="pre">display_all()</span></tt>.
We expect that this method will grab all of the tags from the respository,
sort them into alphabetical order,
and write their names into a string, separated by new lines. So, we can write
our test function like so (I&#8217;m using nose as the testing framework, but other
testing frameworks should work just fine):</p>
<div class="highlight-python"><div class="highlight"><pre><span class="kn">from</span> <span class="nn">nose.tools</span> <span class="kn">import</span> <span class="n">assert_equals</span>
<span class="kn">import</span> <span class="nn">funk</span>
<span class="kn">from</span> <span class="nn">funk</span> <span class="kn">import</span> <span class="n">expects</span>

<span class="nd">@funk.with_mocks</span>
<span class="k">def</span> <span class="nf">test_tag_displayer_writes_all_tag_names_in_alphabetical_order_onto_separate_lines</span><span class="p">(</span><span class="n">mocks</span><span class="p">):</span>
    <span class="n">tag_repository</span> <span class="o">=</span> <span class="n">mocks</span><span class="o">.</span><span class="n">mock</span><span class="p">(</span><span class="n">TagRepository</span><span class="p">)</span>
    <span class="n">expects</span><span class="p">(</span><span class="n">tag_repository</span><span class="p">)</span><span class="o">.</span><span class="n">fetch_all</span><span class="p">(</span><span class="n">sorted</span><span class="o">=</span><span class="bp">False</span><span class="p">)</span><span class="o">.</span><span class="n">returns</span><span class="p">([</span><span class="n">Tag</span><span class="p">(</span><span class="s">&#39;python&#39;</span><span class="p">),</span> <span class="n">Tag</span><span class="p">(</span><span class="s">&#39;debian&#39;</span><span class="p">)])</span>

    <span class="n">tag_displayer</span> <span class="o">=</span> <span class="n">TagDisplayer</span><span class="p">(</span><span class="n">tag_repository</span><span class="p">)</span>
    <span class="n">assert_equals</span><span class="p">(</span><span class="n">tag_displayer</span><span class="o">.</span><span class="n">display_all</span><span class="p">(),</span> <span class="s">&#39;debian</span><span class="se">\n</span><span class="s">python&#39;</span><span class="p">)</span>
</pre></div>
</div>
<p>Note the that test method takes a mocks as an argument.
If necessary, you can build you own instances by calling <a class="reference internal" href="../funk/#funk.Mocks" title="funk.Mocks"><tt class="xref py py-class docutils literal"><span class="pre">funk.Mocks</span></tt></a>.
This is the object that allows you to create mocks, by calling <a class="reference internal" href="../funk/#funk.Mocks.mock" title="funk.Mocks.mock"><tt class="xref py py-func docutils literal"><span class="pre">mock()</span></tt></a>.</p>
<p>It&#8217;s probably worth deconstructing the expectation setup here. We start with
the simpler expectation:</p>
<div class="highlight-python"><div class="highlight"><pre><span class="n">expects</span><span class="p">(</span><span class="n">tag_repository</span><span class="p">)</span><span class="o">.</span><span class="n">fetch_all</span>
</pre></div>
</div>
<p>This means that we expect <tt class="docutils literal"><span class="pre">fetch_all</span></tt> to be called on <tt class="docutils literal"><span class="pre">tag_repository</span></tt> with
any possible arguments exactly once. If it is called, it will return <tt class="xref py py-const xref docutils literal"><span class="pre">None</span></tt>.</p>
<p>So, we need to specify the arguments we expect it to be called with. While you
can set up both positional and keyword arguments, we expect a single keyword
argument. We can set up this expectation in two ways. The first is as above:</p>
<div class="highlight-python"><div class="highlight"><pre><span class="n">expects</span><span class="p">(</span><span class="n">tag_repository</span><span class="p">)</span><span class="o">.</span><span class="n">fetch_all</span><span class="p">(</span><span class="n">sorted</span><span class="o">=</span><span class="bp">False</span><span class="p">)</span>
</pre></div>
</div>
<p>Alternatively (and equivalently):</p>
<div class="highlight-python"><div class="highlight"><pre><span class="n">expects</span><span class="p">(</span><span class="n">tag_repository</span><span class="p">)</span><span class="o">.</span><span class="n">fetch_all</span><span class="o">.</span><span class="n">with_args</span><span class="p">(</span><span class="n">sorted</span><span class="o">=</span><span class="bp">False</span><span class="p">)</span>
</pre></div>
</div>
<p>Finally, we set the return value using <a class="reference internal" href="../funk/#funk.call.Call.returns" title="funk.call.Call.returns"><tt class="xref py py-func docutils literal"><span class="pre">returns()</span></tt></a>:</p>
<div class="highlight-python"><div class="highlight"><pre><span class="n">expects</span><span class="p">(</span><span class="n">tag_repository</span><span class="p">)</span><span class="o">.</span><span class="n">fetch_all</span><span class="p">(</span><span class="n">sorted</span><span class="o">=</span><span class="bp">False</span><span class="p">)</span><span class="o">.</span><span class="n">returns</span><span class="p">([</span><span class="n">Tag</span><span class="p">(</span><span class="s">&#39;python&#39;</span><span class="p">),</span> <span class="n">Tag</span><span class="p">(</span><span class="s">&#39;debian&#39;</span><span class="p">)])</span>
</pre></div>
</div>
<p>Note that we could have called <a class="reference internal" href="../funk/#funk.call.Call.returns" title="funk.call.Call.returns"><tt class="xref py py-func docutils literal"><span class="pre">returns()</span></tt></a> without setting up
the arguments. This is useful when you just don&#8217;t care what the arguments are,
but the return values are important. For instance:</p>
<div class="highlight-python"><div class="highlight"><pre><span class="n">expects</span><span class="p">(</span><span class="n">tag_repository</span><span class="p">)</span><span class="o">.</span><span class="n">fetch_all</span><span class="o">.</span><span class="n">returns</span><span class="p">([</span><span class="n">Tag</span><span class="p">(</span><span class="s">&#39;python&#39;</span><span class="p">),</span> <span class="n">Tag</span><span class="p">(</span><span class="s">&#39;debian&#39;</span><span class="p">)])</span>
</pre></div>
</div>
<p>Since the <tt class="xref py py-class docutils literal"><span class="pre">TagDisplayer</span></tt> has been written to have its dependencies injected,
inserting the mocked tag repository into the tag displayer is extremely
straightforward &#8211; simply pass it in via the constructor.</p>
<p>If the method is working correctly, then the test will pass. But what if the
test is not working correctly? One possibility is that the tag displayer calls
the wrong method &#8211; for instance, it might try to call the non-existant method
<tt class="xref py py-func docutils literal"><span class="pre">fetch_all_tags()</span></tt>. If this happens, the test fails:</p>
<div class="highlight-python"><pre>AttributeError: 'Mock' object has no attribute 'fetch_all_tags'</pre>
</div>
<p>Alternatively, we might call <tt class="xref py py-func docutils literal"><span class="pre">fetch_all()</span></tt> with a single argument, <tt class="docutils literal"><span class="pre">'spam'</span></tt>,
instead of the correct keyword argument:</p>
<div class="highlight-python"><pre>AssertionError: Unexpected invocation: tag_repository.fetch_all(spam)</pre>
</div>
<p>If we call the method with the correct arguments twice:</p>
<div class="highlight-python"><pre>AssertionError: Unexpected invocation: tag_repository.fetch_all(sorted=False)</pre>
</div>
<p>If we don&#8217;t call the method at all, the test will fail since the mock did not
have all of its expected methods called:</p>
<div class="highlight-python"><pre>AssertionError: Not all expectations were satisfied. Expected call: tag_repository.fetch_all(sorted=False)</pre>
</div>
<p>But what if we don&#8217;t want the test to fail if the method is not called? We can use
<a class="reference internal" href="../funk/#funk.allows" title="funk.allows"><tt class="xref py py-func docutils literal"><span class="pre">allows()</span></tt></a> instead of <a class="reference internal" href="../funk/#funk.expects" title="funk.expects"><tt class="xref py py-func docutils literal"><span class="pre">expects()</span></tt></a>. They both
behave in the same manner, except that <a class="reference internal" href="../funk/#funk.expects" title="funk.expects"><tt class="xref py py-func docutils literal"><span class="pre">expects()</span></tt></a> will expect exactly one
matching call, whereas <a class="reference internal" href="../funk/#funk.allows" title="funk.allows"><tt class="xref py py-func docutils literal"><span class="pre">allows()</span></tt></a> will allow any number of calls, including
none.</p>
<div class="section" id="different-expectations-on-the-same-method">
<h2>Different expectations on the same method<a class="headerlink" href="#different-expectations-on-the-same-method" title="Permalink to this headline">¶</a></h2>
<p>Sometimes, we expect the same method to be called more than once, but we might
want it to behave differently on successive calls. For instance, let&#8217;s say we
have a database object that can delete objects from the database. The first time
we call <tt class="xref py py-func docutils literal"><span class="pre">delete()</span></tt> on a tag, it should return <tt class="xref py py-const xref docutils literal"><span class="pre">True</span></tt> to indicate a
successful deletion. On any subsequent calls, it should return <tt class="xref py py-const xref docutils literal"><span class="pre">False</span></tt>
since the tag has already been deleted. For instance:</p>
<div class="highlight-python"><div class="highlight"><pre><span class="n">database</span> <span class="o">=</span> <span class="n">mocks</span><span class="o">.</span><span class="n">mock</span><span class="p">(</span><span class="s">&#39;database&#39;</span><span class="p">)</span>
<span class="n">expects</span><span class="p">(</span><span class="n">database</span><span class="p">)</span><span class="o">.</span><span class="n">delete</span><span class="p">(</span><span class="n">tag</span><span class="p">)</span><span class="o">.</span><span class="n">returns</span><span class="p">(</span><span class="bp">True</span><span class="p">)</span>
<span class="n">allows</span><span class="p">(</span><span class="n">database</span><span class="p">)</span><span class="o">.</span><span class="n">delete</span><span class="p">(</span><span class="n">tag</span><span class="p">)</span><span class="o">.</span><span class="n">returns</span><span class="p">(</span><span class="bp">False</span><span class="p">)</span>

<span class="c"># To demonstrate the behaviour of the mocked database</span>
<span class="k">assert</span> <span class="n">database</span><span class="o">.</span><span class="n">delete</span><span class="p">(</span><span class="n">tag</span><span class="p">)</span> <span class="ow">is</span> <span class="bp">True</span>
<span class="k">assert</span> <span class="n">database</span><span class="o">.</span><span class="n">delete</span><span class="p">(</span><span class="n">tag</span><span class="p">)</span> <span class="ow">is</span> <span class="bp">False</span>
<span class="k">assert</span> <span class="n">database</span><span class="o">.</span><span class="n">delete</span><span class="p">(</span><span class="n">tag</span><span class="p">)</span> <span class="ow">is</span> <span class="bp">False</span>
</pre></div>
</div>
<p>The first call to <tt class="docutils literal"><span class="pre">database.delete</span></tt> returns the first return value since
the arguments match, and it was declared first. However, subsequent calls
return the second return value since using <a class="reference internal" href="../funk/#funk.expects" title="funk.expects"><tt class="xref py py-func docutils literal"><span class="pre">expects()</span></tt></a> means that call
can be matched only once, where the call created by <a class="reference internal" href="../funk/#funk.allows" title="funk.allows"><tt class="xref py py-func docutils literal"><span class="pre">allows()</span></tt></a> can
be matched any number of times.</p>
<p>We might also decide to set up another expectation so that deleting any other
tag returns <tt class="xref py py-const xref docutils literal"><span class="pre">False</span></tt>:</p>
<div class="highlight-python"><div class="highlight"><pre><span class="n">database</span> <span class="o">=</span> <span class="n">mocks</span><span class="o">.</span><span class="n">mock</span><span class="p">(</span><span class="s">&#39;database&#39;</span><span class="p">)</span>
<span class="n">expects</span><span class="p">(</span><span class="n">database</span><span class="p">)</span><span class="o">.</span><span class="n">delete</span><span class="p">(</span><span class="n">tag</span><span class="p">)</span><span class="o">.</span><span class="n">returns</span><span class="p">(</span><span class="bp">True</span><span class="p">)</span>
<span class="n">allows</span><span class="p">(</span><span class="n">database</span><span class="p">)</span><span class="o">.</span><span class="n">delete</span><span class="p">(</span><span class="n">tag</span><span class="p">)</span><span class="o">.</span><span class="n">returns</span><span class="p">(</span><span class="bp">False</span><span class="p">)</span>
<span class="n">allows</span><span class="p">(</span><span class="n">database</span><span class="p">)</span><span class="o">.</span><span class="n">delete</span><span class="o">.</span><span class="n">returns</span><span class="p">(</span><span class="bp">False</span><span class="p">)</span>

<span class="c"># To demonstrate the behaviour of the mocked database</span>
<span class="k">assert</span> <span class="n">database</span><span class="o">.</span><span class="n">delete</span><span class="p">(</span><span class="n">tag</span><span class="p">)</span> <span class="ow">is</span> <span class="bp">True</span>
<span class="k">assert</span> <span class="n">database</span><span class="o">.</span><span class="n">delete</span><span class="p">(</span><span class="n">tag</span><span class="p">)</span> <span class="ow">is</span> <span class="bp">False</span>
<span class="k">assert</span> <span class="n">database</span><span class="o">.</span><span class="n">delete</span><span class="p">(</span><span class="n">tag</span><span class="p">)</span> <span class="ow">is</span> <span class="bp">False</span>
<span class="k">assert</span> <span class="n">database</span><span class="o">.</span><span class="n">delete</span><span class="p">(</span><span class="n">another_tag</span><span class="p">)</span> <span class="ow">is</span> <span class="bp">False</span>
<span class="k">assert</span> <span class="n">database</span><span class="o">.</span><span class="n">delete</span><span class="p">(</span><span class="mf">42</span><span class="p">)</span> <span class="ow">is</span> <span class="bp">False</span>
<span class="k">assert</span> <span class="n">database</span><span class="o">.</span><span class="n">delete</span><span class="p">(</span><span class="n">number</span><span class="o">=</span><span class="mf">42</span><span class="p">)</span> <span class="ow">is</span> <span class="bp">False</span>
</pre></div>
</div>
<p>While the above assertions will pass, we probably didn&#8217;t want to allow those two
final call. While we want to allow any tag to be used, we shouldn&#8217;t allow
any arguments. To solve this problem, we can use a matcher like so:</p>
<div class="highlight-python"><div class="highlight"><pre><span class="kn">from</span> <span class="nn">funk.matcher</span> <span class="kn">import</span> <span class="n">is_a</span>
<span class="o">...</span>

<span class="n">database</span> <span class="o">=</span> <span class="n">mocks</span><span class="o">.</span><span class="n">mock</span><span class="p">(</span><span class="s">&#39;database&#39;</span><span class="p">)</span>
<span class="n">expects</span><span class="p">(</span><span class="n">database</span><span class="p">)</span><span class="o">.</span><span class="n">delete</span><span class="p">(</span><span class="n">tag</span><span class="p">)</span><span class="o">.</span><span class="n">returns</span><span class="p">(</span><span class="bp">True</span><span class="p">)</span>
<span class="n">allows</span><span class="p">(</span><span class="n">database</span><span class="p">)</span><span class="o">.</span><span class="n">delete</span><span class="p">(</span><span class="n">tag</span><span class="p">)</span><span class="o">.</span><span class="n">returns</span><span class="p">(</span><span class="bp">False</span><span class="p">)</span>
<span class="n">allows</span><span class="p">(</span><span class="n">database</span><span class="p">)</span><span class="o">.</span><span class="n">delete</span><span class="p">(</span><span class="n">is_a</span><span class="p">(</span><span class="n">Tag</span><span class="p">))</span><span class="o">.</span><span class="n">returns</span><span class="p">(</span><span class="bp">False</span><span class="p">)</span>

<span class="c"># To demonstrate the behaviour of the mocked database</span>
<span class="k">assert</span> <span class="n">database</span><span class="o">.</span><span class="n">delete</span><span class="p">(</span><span class="n">tag</span><span class="p">)</span> <span class="ow">is</span> <span class="bp">True</span>
<span class="k">assert</span> <span class="n">database</span><span class="o">.</span><span class="n">delete</span><span class="p">(</span><span class="n">tag</span><span class="p">)</span> <span class="ow">is</span> <span class="bp">False</span>
<span class="k">assert</span> <span class="n">database</span><span class="o">.</span><span class="n">delete</span><span class="p">(</span><span class="n">tag</span><span class="p">)</span> <span class="ow">is</span> <span class="bp">False</span>
<span class="k">assert</span> <span class="n">database</span><span class="o">.</span><span class="n">delete</span><span class="p">(</span><span class="n">another_tag</span><span class="p">)</span> <span class="ow">is</span> <span class="bp">False</span>
<span class="n">database</span><span class="o">.</span><span class="n">delete</span><span class="p">(</span><span class="mf">42</span><span class="p">)</span> <span class="c"># Unexpected invocation, raises AssertionError</span>
<span class="n">database</span><span class="o">.</span><span class="n">delete</span><span class="p">(</span><span class="n">number</span><span class="o">=</span><span class="mf">42</span><span class="p">)</span> <span class="c"># Unexpected invocation, raises AssertionError</span>
</pre></div>
</div>
<p>Note that we define the generic expectation after the other expectations. If
we&#8217;d written the test like so:</p>
<div class="highlight-python"><div class="highlight"><pre><span class="n">database</span> <span class="o">=</span> <span class="n">mocks</span><span class="o">.</span><span class="n">mock</span><span class="p">(</span><span class="s">&#39;database&#39;</span><span class="p">)</span>
<span class="n">allows</span><span class="p">(</span><span class="n">database</span><span class="p">)</span><span class="o">.</span><span class="n">delete</span><span class="p">(</span><span class="n">is_a</span><span class="p">(</span><span class="n">Tag</span><span class="p">))</span><span class="o">.</span><span class="n">returns</span><span class="p">(</span><span class="bp">False</span><span class="p">)</span>
<span class="n">expects</span><span class="p">(</span><span class="n">database</span><span class="p">)</span><span class="o">.</span><span class="n">delete</span><span class="p">(</span><span class="n">tag</span><span class="p">)</span><span class="o">.</span><span class="n">returns</span><span class="p">(</span><span class="bp">True</span><span class="p">)</span>
<span class="n">allows</span><span class="p">(</span><span class="n">database</span><span class="p">)</span><span class="o">.</span><span class="n">delete</span><span class="p">(</span><span class="n">tag</span><span class="p">)</span><span class="o">.</span><span class="n">returns</span><span class="p">(</span><span class="bp">False</span><span class="p">)</span>
</pre></div>
</div>
<p>Then even the first call to <tt class="docutils literal"><span class="pre">database.delete(tag)</span></tt> would return <tt class="xref py py-const xref docutils literal"><span class="pre">False</span></tt>
since the first matching expectation for that call returns <tt class="xref py py-const xref docutils literal"><span class="pre">False</span></tt>.</p>
</div>
<div class="section" id="base-classes">
<h2>Base classes<a class="headerlink" href="#base-classes" title="Permalink to this headline">¶</a></h2>
<p>Using our earlier example, we had a <tt class="xref py py-class docutils literal"><span class="pre">TagRepository</span></tt>. It had a method
<tt class="xref py py-func docutils literal"><span class="pre">fetch_all()</span></tt> that we expected to be called, so we set up the test like so:</p>
<div class="highlight-python"><div class="highlight"><pre><span class="kn">from</span> <span class="nn">nose.tools</span> <span class="kn">import</span> <span class="n">assert_equals</span>
<span class="kn">from</span> <span class="nn">funk</span> <span class="kn">import</span> <span class="n">with_mocks</span>
<span class="kn">from</span> <span class="nn">funk</span> <span class="kn">import</span> <span class="n">expects</span>

<span class="nd">@with_mocks</span>
<span class="k">def</span> <span class="nf">test_tag_displayer_writes_all_tag_names_onto_separate_lines</span><span class="p">(</span><span class="n">mocks</span><span class="p">):</span>
    <span class="n">tag_repository</span> <span class="o">=</span> <span class="n">mocks</span><span class="o">.</span><span class="n">mock</span><span class="p">(</span><span class="n">name</span><span class="o">=</span><span class="s">&#39;tag_repository&#39;</span><span class="p">)</span>
    <span class="n">expects</span><span class="p">(</span><span class="n">tag_repository</span><span class="p">)</span><span class="o">.</span><span class="n">fetch_all</span><span class="p">(</span><span class="n">sorted</span><span class="o">=</span><span class="bp">False</span><span class="p">)</span><span class="o">.</span><span class="n">returns</span><span class="p">([</span><span class="n">Tag</span><span class="p">(</span><span class="s">&#39;python&#39;</span><span class="p">),</span> <span class="n">Tag</span><span class="p">(</span><span class="s">&#39;debian&#39;</span><span class="p">)])</span>

    <span class="n">tag_displayer</span> <span class="o">=</span> <span class="n">TagDisplayer</span><span class="p">(</span><span class="n">tag_repository</span><span class="p">)</span>
    <span class="n">assert_equals</span><span class="p">(</span><span class="n">tag_displayer</span><span class="o">.</span><span class="n">display_all</span><span class="p">(),</span> <span class="s">&#39;python</span><span class="se">\n</span><span class="s">debian&#39;</span><span class="p">)</span>
</pre></div>
</div>
<p>We then decide to rename the method <tt class="xref py py-func docutils literal"><span class="pre">fetch_all()</span></tt> to <tt class="xref py py-func docutils literal"><span class="pre">get_all()</span></tt>. However,
this unit test will still pass without changing the <tt class="xref py py-class docutils literal"><span class="pre">TagDisplayer</span></tt> since
we&#8217;re still mocking a method called <tt class="xref py py-func docutils literal"><span class="pre">fetch_all()</span></tt>. To help in this situation,
you can pass in a base class for mocks:</p>
<div class="highlight-python"><div class="highlight"><pre><span class="n">tag_repository</span> <span class="o">=</span> <span class="n">mocks</span><span class="o">.</span><span class="n">mock</span><span class="p">(</span><span class="n">TagRepository</span><span class="p">,</span> <span class="n">name</span><span class="o">=</span><span class="s">&#39;tag_repository&#39;</span><span class="p">)</span>
</pre></div>
</div>
<p>Now, Funk will only allow you to expect and allow methods that are defined on
<tt class="xref py py-class docutils literal"><span class="pre">TagRepository</span></tt>. Running the test as is causes an <tt class="xref py py-class docutils literal"><span class="pre">AssertionError</span></tt>
to be raised:</p>
<div class="highlight-python"><pre>Method 'fetch_all' is not defined on type object 'TagRepository'</pre>
</div>
<p>Two words of caution about using this feature. Firstly, this only works if
the method is explicitly defined on the base class. This is often not the case
if the method is dynamically generated, such as by overriding
<tt class="xref py py-func docutils literal"><span class="pre">__getattribute__()</span></tt> on the type.</p>
<p>Secondly, this is no substitute for integration testing. While its true that the
unit test above would not have failed, there should have been some integration
test in your system that would have failed due to the method name change. The
aim of allowing you to specify the base class is so that you can find that
failure a little quicker.</p>
</div>
</div>


          </div>
        </div>
      </div>
      <div class="sphinxsidebar">
        <div class="sphinxsidebarwrapper">
  <h3><a href="../">Table Of Contents</a></h3>
  <ul>
<li><a class="reference internal" href="#">Getting started with Funk</a><ul>
<li><a class="reference internal" href="#different-expectations-on-the-same-method">Different expectations on the same method</a></li>
<li><a class="reference internal" href="#base-classes">Base classes</a></li>
</ul>
</li>
</ul>

  <h4>Previous topic</h4>
  <p class="topless"><a href="../"
                        title="previous chapter">Welcome to Funk&#8217;s documentation!</a></p>
  <h4>Next topic</h4>
  <p class="topless"><a href="../funk/"
                        title="next chapter"><tt class="docutils literal docutils literal"><span class="pre">funk</span></tt></a></p>
  <h3>This Page</h3>
  <ul class="this-page-menu">
    <li><a href="../_sources/guide.txt"
           rel="nofollow">Show Source</a></li>
  </ul>
<div id="searchbox" style="display: none">
  <h3>Quick search</h3>
    <form class="search" action="../search/" method="get">
      <input type="text" name="q" size="18" />
      <input type="submit" value="Go" />
      <input type="hidden" name="check_keywords" value="yes" />
      <input type="hidden" name="area" value="default" />
    </form>
    <p class="searchtip" style="font-size: 90%">
    Enter search terms or a module, class or function name.
    </p>
</div>
<script type="text/javascript">$('#searchbox').show(0);</script>
        </div>
      </div>
      <div class="clearer"></div>
    </div>
    <div class="related">
      <h3>Navigation</h3>
      <ul>
        <li class="right" style="margin-right: 10px">
          <a href="../genindex/" title="General Index"
             >index</a></li>
        <li class="right" >
          <a href="../py-modindex/" title="Python Module Index"
             >modules</a> |</li>
        <li class="right" >
          <a href="../funk/" title="funk"
             >next</a> |</li>
        <li class="right" >
          <a href="../" title="Welcome to Funk’s documentation!"
             >previous</a> |</li>
        <li><a href="../">Funk v0.3 documentation</a> &raquo;</li> 
      </ul>
    </div>
    <div class="footer">
        &copy; Copyright 2009–2010, Michael Williamson.
      Created using <a href="http://sphinx.pocoo.org/">Sphinx</a> 1.0.3.
    </div>
  </body>
</html>